(function(){const F=document.createElement("link").relList;if(F&&F.supports&&F.supports("modulepreload"))return;for(const B of document.querySelectorAll('link[rel="modulepreload"]'))N(B);new MutationObserver(B=>{for(const le of B)if(le.type==="childList")for(const A of le.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&N(A)}).observe(document,{childList:!0,subtree:!0});function $(B){const le={};return B.integrity&&(le.integrity=B.integrity),B.referrerPolicy&&(le.referrerPolicy=B.referrerPolicy),B.crossOrigin==="use-credentials"?le.credentials="include":B.crossOrigin==="anonymous"?le.credentials="omit":le.credentials="same-origin",le}function N(B){if(B.ep)return;B.ep=!0;const le=$(B);fetch(B.href,le)}})();function cp(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}var Cc={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.0/LICENSE.txt
 */var zg=Cc.exports,Vf;function Ng(){return Vf||(Vf=1,function(D,F){(function($,N){D.exports=N()})(zg,function(){var $={},N={};function B(A,u,Le){if(N[A]=Le,A==="index"){var Ae="var sharedModule = {}; ("+N.shared+")(sharedModule); ("+N.worker+")(sharedModule);",_e={};return N.shared(_e),N.index($,_e),typeof window<"u"&&$.setWorkerUrl(window.URL.createObjectURL(new Blob([Ae],{type:"text/javascript"}))),$}}B("shared",["exports"],function(A){function u(r,t,n,o){return new(n||(n=Promise))(function(h,g){function _(S){try{w(o.next(S))}catch(k){g(k)}}function x(S){try{w(o.throw(S))}catch(k){g(k)}}function w(S){var k;S.done?h(S.value):(k=S.value,k instanceof n?k:new n(function(M){M(k)})).then(_,x)}w((o=o.apply(r,t||[])).next())})}function Le(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ae,_e;function de(){if(_e)return Ae;function r(t,n){this.x=t,this.y=n}return _e=1,Ae=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,o=t.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),o=Math.sin(t),h=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=h,this},_rotateAround:function(t,n){var o=Math.cos(t),h=Math.sin(t),g=n.y+h*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-h*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t},Ae}typeof SuppressedError=="function"&&SuppressedError;var we,ae,Te=Le(de()),ot=function(){if(ae)return we;function r(t,n,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=h}return ae=1,we=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var x=0,w=1;for(o=t,h=0;h<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<n));h++)t>g?x=o:w=o,o=.5*(w-x)+x;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},we}(),pt=Le(ot);let Ct,vt;function nt(){return Ct==null&&(Ct=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ct}function ft(){if(vt==null&&(vt=!1,nt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const h=4*o;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){vt=!0;break}}}return vt||!1}var rt=1e-6,lt=typeof Float32Array<"u"?Float32Array:Array;function wt(){var r=new lt(9);return lt!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ft(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function It(){var r=new lt(3);return lt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function oi(r){return Math.hypot(r[0],r[1],r[2])}function Xt(r,t,n){var o=new lt(3);return o[0]=r,o[1]=t,o[2]=n,o}function ri(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function li(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r}function ut(r,t,n){var o=t[0],h=t[1],g=t[2],_=n[0],x=n[1],w=n[2];return r[0]=h*w-g*x,r[1]=g*_-o*w,r[2]=o*x-h*_,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Bt,Ht=oi;function ui(r,t,n){var o=t[0],h=t[1],g=t[2],_=t[3];return r[0]=n[0]*o+n[4]*h+n[8]*g+n[12]*_,r[1]=n[1]*o+n[5]*h+n[9]*g+n[13]*_,r[2]=n[2]*o+n[6]*h+n[10]*g+n[14]*_,r[3]=n[3]*o+n[7]*h+n[11]*g+n[15]*_,r}function Li(){var r=new lt(4);return lt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function gi(r,t,n,o){var h=.5*Math.PI/180;t*=h,n*=h,o*=h;var g=Math.sin(t),_=Math.cos(t),x=Math.sin(n),w=Math.cos(n),S=Math.sin(o),k=Math.cos(o);return r[0]=g*w*k-_*x*S,r[1]=_*x*k+g*w*S,r[2]=_*w*S-g*x*k,r[3]=_*w*k+g*x*S,r}function xt(){var r=new lt(2);return lt!=Float32Array&&(r[0]=0,r[1]=0),r}function bi(r,t){var n=new lt(2);return n[0]=r,n[1]=t,n}It(),Bt=new lt(4),lt!=Float32Array&&(Bt[0]=0,Bt[1]=0,Bt[2]=0,Bt[3]=0),It(),Xt(1,0,0),Xt(0,1,0),Li(),Li(),wt(),xt();const jt=8192;function yi(r,t,n){return t*(jt/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}function Ot(r,t){return(r%t+t)%t}function Bi(r,t,n){return r*(1-n)+t*n}function hr(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,n=t*r;return 4*(r<.5?n:3*(r-t)+n-.75)}function dr(r,t,n,o){const h=new pt(r,t,n,o);return g=>h.solve(g)}const ze=dr(.25,.1,.25,1);function ji(r,t,n){return Math.min(n,Math.max(t,r))}function vi(r,t,n){const o=n-t,h=((r-t)%o+o)%o+t;return h===t?n:h}function yt(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let me=1;function ci(r,t,n){const o={};for(const h in r)o[h]=t.call(this,r[h],h,r);return o}function Yn(r,t,n){const o={};for(const h in r)t.call(this,r[h],h,r)&&(o[h]=r[h]);return o}function tn(r){return Array.isArray(r)?r.map(tn):typeof r=="object"&&r?ci(r,tn):r}const ps={};function nn(r){ps[r]||(typeof console<"u"&&console.warn(r),ps[r]=!0)}function Hn(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Je(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Kr=null;function Rr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const fr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ms(r,t,n,o,h){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(r,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const x=_.startsWith("BGR"),w=new Uint8ClampedArray(o*h*4);if(yield g.copyTo(w,function(S,k,M,j,G){const q=4*Math.max(1,0),X=(Math.max(0,M)-M)*j*4+q,Q=4*j,ne=Math.max(0,k),be=Math.max(0,M);return{rect:{x:ne,y:be,width:Math.min(S.width,k+j)-ne,height:Math.min(S.height,M+G)-be},layout:[{offset:X,stride:Q}]}}(r,t,n,o,h)),x)for(let S=0;S<w.length;S+=4){const k=w[S];w[S]=w[S+2],w[S+2]=k}return w}finally{g.close()}})}let Vt,pr;function ir(r,t,n,o){return r.addEventListener(t,n,o),{unsubscribe:()=>{r.removeEventListener(t,n,o)}}}function Mn(r){return r*Math.PI/180}function At(r){return r/Math.PI*180}const gs={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},si={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Nt="AbortError";function ke(){return new Error(Nt)}const Y={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function H(r){return Y.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const W="global-dispatcher";class ce extends Error{constructor(t,n,o,h){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=h}}const xe=()=>Je(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ee=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=H(r.url);if(o)return o(r,t);if(Je(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:W},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(xe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,h){return u(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:xe(),signal:h.signal});let _,x;o.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{_=yield fetch(g)}catch(S){throw new ce(0,S.message,o.url,new Blob)}if(!_.ok){const S=yield _.blob();throw new ce(_.status,_.statusText,o.url,S)}x=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const w=yield x;if(h.signal.aborted)throw ke();return{data:w,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(r,t);if(Je(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:W},t)}var n;return function(o,h){return new Promise((g,_)=>{var x;const w=new XMLHttpRequest;w.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(w.responseType="arraybuffer");for(const S in o.headers)w.setRequestHeader(S,o.headers[S]);o.type==="json"&&(w.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=o.credentials==="include",w.onerror=()=>{_(new Error(w.statusText))},w.onload=()=>{if(!h.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let S=w.response;if(o.type==="json")try{S=JSON.parse(w.response)}catch(k){return void _(k)}g({data:S,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const S=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});_(new ce(w.status,w.statusText,o.url,S))}},h.signal.addEventListener("abort",()=>{w.abort(),_(ke())}),w.send(o.body)})}(r,t)};function Me(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function Ie(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Ve(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class Ue{constructor(t,n={}){yt(this,n),this.type=t}}class Pe extends Ue{constructor(t,n={}){super("error",yt({error:t},n))}}class Ze{on(t,n){return this._listeners=this._listeners||{},Ie(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Ve(t,n,this._listeners),Ve(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ie(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new Ue(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of h)x.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of g)Ve(o,x,this._oneTimeListeners),x.call(this,t);const _=this._eventedParent;_&&(yt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Pe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const st=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qe(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return st.forEach(o=>{o in t&&(n[o]=t[o])}),n}function ct(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!ct(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!ct(r[n],t[n]))return!1;return!0}return r===t}function St(r,t){r.push(t)}function Dt(r,t,n){St(n,{command:"addSource",args:[r,t[r]]})}function wi(r,t,n){St(t,{command:"removeSource",args:[r]}),n[r]=!0}function mi(r,t,n,o){wi(r,n,o),Dt(r,t,n)}function hi(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!ct(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!ct(r[n][o],t[n][o]))return!1;return!0}function Pt(r,t,n,o,h,g){r=r||{},t=t||{};for(const _ in r)Object.prototype.hasOwnProperty.call(r,_)&&(ct(r[_],t[_])||n.push({command:g,args:[o,_,t[_],h]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(r,_)&&(ct(r[_],t[_])||n.push({command:g,args:[o,_,t[_],h]}))}function Qt(r){return r.id}function Zi(r,t){return r[t.id]=t,r}class et{constructor(t,n,o,h){this.message=(t?`${t}: `:"")+o,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function ln(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class Ri extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Ji{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,h]of n)this.bindings[o]=h}concat(t){return new Ji(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Dr={kind:"null"},tt={kind:"number"},Gt={kind:"string"},qt={kind:"boolean"},An={kind:"color"},_s={kind:"projectionDefinition"},jn={kind:"object"},kt={kind:"value"},zr={kind:"collator"},ys={kind:"formatted"},Di={kind:"padding"},Nr={kind:"colorArray"},vs={kind:"numberArray"},mr={kind:"resolvedImage"},Fs={kind:"variableAnchorOffsetCollection"};function Wn(r,t){return{kind:"array",itemType:r,N:t}}function fi(r){if(r.kind==="array"){const t=fi(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const xs=[Dr,tt,Gt,qt,An,_s,ys,jn,Wn(kt),Di,vs,Nr,mr,Fs];function bs(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!bs(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of xs)if(!bs(n,t))return null}}return`Expected ${fi(r)} but found ${fi(t)} instead.`}function Or(r,t){return t.some(n=>n.kind===r.kind)}function Fr(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function Jr(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Uo=.96422,Vo=.82521,Wa=4/29,ws=6/29,ra=3*ws*ws,Sr=ws*ws*ws,nr=Math.PI/180,Go=180/Math.PI;function Ts(r){return(r%=360)<0&&(r+=360),r}function Bs([r,t,n,o]){let h,g;const _=Ja((.2225045*(r=Ka(r))+.7168786*(t=Ka(t))+.0606169*(n=Ka(n)))/1);r===t&&t===n?h=g=_:(h=Ja((.4360747*r+.3850649*t+.1430804*n)/Uo),g=Ja((.0139322*r+.0971045*t+.7141733*n)/Vo));const x=116*_-16;return[x<0?0:x,500*(h-_),200*(_-g),o]}function Ka(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ja(r){return r>Sr?Math.pow(r,1/3):r/ra+Wa}function qo([r,t,n,o]){let h=(r+16)/116,g=isNaN(t)?h:h+t/500,_=isNaN(n)?h:h-n/200;return h=1*Qr(h),g=Uo*Qr(g),_=Vo*Qr(_),[sa(3.1338561*g-1.6168667*h-.4906146*_),sa(-.9787684*g+1.9161415*h+.033454*_),sa(.0719453*g-.2289914*h+1.4052427*_),o]}function sa(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Qr(r){return r>ws?r*r*r:ra*(r-Wa)}const gr=Object.hasOwn||function(r,t){return Object.prototype.hasOwnProperty.call(r,t)};function Kt(r,t){return gr(r,t)?r[t]:void 0}function Er(r){return parseInt(r.padEnd(2,r),16)/255}function Br(r,t){return jr(t?r/100:r,0,1)}function jr(r,t,n){return Math.min(Math.max(t,r),n)}function ki(r){return!r.some(Number.isNaN)}const Ur={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function rr(r,t,n){return r+n*(t-r)}function _r(r,t,n){return r.map((o,h)=>rr(o,t[h],n))}class Ut{constructor(t,n,o,h=1,g=!0){this.r=t,this.g=n,this.b=o,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,n,o,h]))}static parse(t){if(t instanceof Ut)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Kt(Ur,o);if(h){const[_,x,w]=h;return[_/255,x/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let x=1;return[Er(o.slice(x,x+=_)),Er(o.slice(x,x+=_)),Er(o.slice(x,x+=_)),Er(o.slice(x,x+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[x,w,S,k,M,j,G,q,X,Q,ne,be]=_,he=[k||" ",G||" ",Q].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const V=[S,j,X].join(""),J=V==="%%%"?100:V===""?255:0;if(J){const pe=[jr(+w/J,0,1),jr(+M/J,0,1),jr(+q/J,0,1),ne?Br(+ne,be):1];if(ki(pe))return pe}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,x,w,S,k,M,j,G,q]=g,X=[w||" ",k||" ",j].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const Q=[+x,jr(+S,0,100),jr(+M,0,100),G?Br(+G,q):1];if(ki(Q))return function([ne,be,he,V]){function J(pe){const Ne=(pe+ne/30)%12,Xe=be*Math.min(he,1-he);return he-Xe*Math.max(-1,Math.min(Ne-3,9-Ne,1))}return ne=Ts(ne),be/=100,he/=100,[J(0),J(8),J(4),V]}(Q)}}}(t);return n?new Ut(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,n/g,o/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,h,g]=Bs(t),_=Math.sqrt(o*o+h*h);return[Math.round(1e4*_)?Ts(Math.atan2(h,o)*Go):NaN,_,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Bs(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,h]=this.rgb;return`rgba(${[t,n,o].map(g=>Math.round(255*g)).join(",")},${h})`}static interpolate(t,n,o,h="rgb"){switch(h){case"rgb":{const[g,_,x,w]=_r(t.rgb,n.rgb,o);return new Ut(g,_,x,w,!1)}case"hcl":{const[g,_,x,w]=t.hcl,[S,k,M,j]=n.hcl;let G,q;if(isNaN(g)||isNaN(S))isNaN(g)?isNaN(S)?G=NaN:(G=S,x!==1&&x!==0||(q=k)):(G=g,M!==1&&M!==0||(q=_));else{let he=S-g;S>g&&he>180?he-=360:S<g&&g-S>180&&(he+=360),G=g+o*he}const[X,Q,ne,be]=function([he,V,J,pe]){return he=isNaN(he)?0:he*nr,qo([J,Math.cos(he)*V,Math.sin(he)*V,pe])}([G,q??rr(_,k,o),rr(x,M,o),rr(w,j,o)]);return new Ut(X,Q,ne,be,!1)}case"lab":{const[g,_,x,w]=qo(_r(t.lab,n.lab,o));return new Ut(g,_,x,w,!1)}}}}Ut.black=new Ut(0,0,0,1),Ut.white=new Ut(1,1,1,1),Ut.transparent=new Ut(0,0,0,0),Ut.red=new Ut(1,0,0,1);class _n{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Is=["bottom","center","top"];class Qa{constructor(t,n,o,h,g,_){this.text=t,this.image=n,this.scale=o,this.fontStack=h,this.textColor=g,this.verticalAlign=_}}class yn{constructor(t){this.sections=t}static fromString(t){return new yn([new Qa(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof yn?t:yn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Xi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Xi)return t;if(typeof t=="number")return new Xi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Xi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new Xi(_r(t.values,n.values,o))}}class rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rn)return t;if(typeof t=="number")return new rn([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new rn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new rn(_r(t.values,n.values,o))}}class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(typeof t=="string"){const o=Ut.parse(t);return o?new un([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const h=Ut.parse(o);if(!h)return;n.push(h)}return new un(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,h="rgb"){const g=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)g.push(Ut.interpolate(t.values[_],n.values[_],o,h));return new un(g)}}class Mi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const pi=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Yt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Yt)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],h=t[n+1];if(typeof o!="string"||!pi.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Yt(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const h=t.values,g=n.values;if(h.length!==g.length)throw new Mi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let x=0;x<h.length;x+=2){if(h[x]!==g[x])throw new Mi(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${g[x]}`);_.push(h[x]);const[w,S]=h[x+1],[k,M]=g[x+1];_.push([rr(w,k,o),rr(S,M,o)])}return new Yt(_)}}class vn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new vn({name:t,available:!1}):null}}class $t{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new $t(t,n,o)}static parse(t){return t instanceof $t?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new $t(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new $t(t.from,t.to,t.transition):typeof t=="string"?new $t(t,t,1):void 0}}function Zt(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function es(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof $t||r instanceof Ut||r instanceof _n||r instanceof yn||r instanceof Xi||r instanceof rn||r instanceof un||r instanceof Yt||r instanceof vn)return!0;if(Array.isArray(r)){for(const t of r)if(!es(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!es(r[t]))return!1;return!0}return!1}function bt(r){if(r===null)return Dr;if(typeof r=="string")return Gt;if(typeof r=="boolean")return qt;if(typeof r=="number")return tt;if(r instanceof Ut)return An;if(r instanceof $t)return _s;if(r instanceof _n)return zr;if(r instanceof yn)return ys;if(r instanceof Xi)return Di;if(r instanceof rn)return vs;if(r instanceof un)return Nr;if(r instanceof Yt)return Fs;if(r instanceof vn)return mr;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const h=bt(o);if(n){if(n===h)continue;n=kt;break}n=h}return Wn(n||kt,t)}return jn}function ts(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Ut||r instanceof $t||r instanceof yn||r instanceof Xi||r instanceof rn||r instanceof un||r instanceof Yt||r instanceof vn?r.toString():JSON.stringify(r)}class dn{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!es(t[1]))return n.error("invalid value");const o=t[1];let h=bt(o);const g=n.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new dn(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ss={string:Gt,number:tt,boolean:qt,object:jn};class Kn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,h=1;const g=t[0];if(g==="array"){let x,w;if(t.length>2){const S=t[1];if(typeof S!="string"||!(S in Ss)||S==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ss[S],h++}else x=kt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}o=Wn(x,w)}else{if(!Ss[g])throw new Error(`Types doesn't contain name = ${g}`);o=Ss[g]}const _=[];for(;h<t.length;h++){const x=n.parse(t[h],h,kt);if(!x)return null;_.push(x)}return new Kn(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!bs(this.type,bt(o)))return o;if(n===this.args.length-1)throw new Mi(`Expected value to be of type ${fi(this.type)}, but found ${fi(bt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const eo={"to-boolean":qt,"to-color":An,"to-number":tt,"to-string":Gt};class yr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!eo[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const h=eo[o],g=[];for(let _=1;_<t.length;_++){const x=n.parse(t[_],_,kt);if(!x)return null;g.push(x)}return new yr(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const h of this.args){if(n=h.evaluate(t),o=null,n instanceof Ut)return n;if(typeof n=="string"){const g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Zt(n[0],n[1],n[2],n[3]),!o))return new Ut(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Mi(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const h=Xi.parse(n);if(h)return h}throw new Mi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const h=rn.parse(n);if(h)return h}throw new Mi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const h=un.parse(n);if(h)return h}throw new Mi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const h=Yt.parse(n);if(h)return h}throw new Mi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Mi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return yn.fromString(ts(this.args[0].evaluate(t)));case"resolvedImage":return vn.fromString(ts(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ts(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const kr=["Unknown","Point","LineString","Polygon"];class aa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=Ut.parse(t),this._parseColorCache.set(t,n)),n}}class oa{constructor(t,n,o=[],h,g=new Ji,_=[]){this.registry=t,this.path=o,this.key=o.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=_,this.expectedType=h,this._isConstant=n}parse(t,n,o,h,g={}){return n?this.concat(n,o,h)._parse(t,g):this._parse(t,g)}_parse(t,n){function o(h,g,_){return _==="assert"?new Kn(g,[h]):_==="coerce"?new yr(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,w=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(w.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(w.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(w.kind)||x.kind==="colorArray"&&["value","string","array"].includes(w.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(w.kind))_=o(_,x,n.typeAnnotation||"coerce");else if(this.checkSubtype(x,w))return null}else _=o(_,x,n.typeAnnotation||"assert")}if(!(_ instanceof dn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const x=new aa;try{_=new dn(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const h=typeof t=="number"?this.path.concat(t):this.path,g=o?this.scope.concat(o):this.scope;return new oa(this.registry,this._isConstant,h,n||null,g,this.errors)}error(t,...n){const o=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ri(o,t))}checkSubtype(t,n){const o=bs(t,n);return o&&this.error(o),o}}class xn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=n.parse(t[g+1],g+1);if(!x)return null;o.push([_,x])}const h=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return h?new xn(o,h):null}outputDefined(){return this.result.outputDefined()}}class bn{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new bn(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class cn{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,tt),h=n.parse(t[2],2,Wn(n.expectedType||kt));return o&&h?new cn(h.type.itemType,o,h):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new Mi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Mi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Mi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class vr{constructor(t,n){this.type=qt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,kt),h=n.parse(t[2],2,kt);return o&&h?Or(o.type,[qt,Gt,tt,Dr,kt])?new vr(o,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Fr(n,["boolean","string","number","null"]))throw new Mi(`Expected first argument to be of type boolean, string, number or null, but found ${fi(bt(n))} instead.`);if(!Fr(o,["string","array"]))throw new Mi(`Expected second argument to be of type array or string, but found ${fi(bt(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class js{constructor(t,n,o){this.type=tt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,kt),h=n.parse(t[2],2,kt);if(!o||!h)return null;if(!Or(o.type,[qt,Gt,tt,Dr,kt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,tt);return g?new js(o,h,g):null}return new js(o,h)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Fr(n,["boolean","string","number","null"]))throw new Mi(`Expected first argument to be of type boolean, string, number or null, but found ${fi(bt(n))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),Fr(o,["string"])){const g=o.indexOf(n,h);return g===-1?-1:[...o.slice(0,g)].length}if(Fr(o,["array"]))return o.indexOf(n,h);throw new Mi(`Expected second argument to be of type array or string, but found ${fi(bt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class xr{constructor(t,n,o,h,g,_){this.inputType=t,this.type=n,this.input=o,this.cases=h,this.outputs=g,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const g={},_=[];for(let S=2;S<t.length-1;S+=2){let k=t[S];const M=t[S+1];Array.isArray(k)||(k=[k]);const j=n.concat(S);if(k.length===0)return j.error("Expected at least one branch label.");for(const q of k){if(typeof q!="number"&&typeof q!="string")return j.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return j.error("Numeric branch labels must be integer values.");if(o){if(j.checkSubtype(o,bt(q)))return null}else o=bt(q);if(g[String(q)]!==void 0)return j.error("Branch labels must be unique.");g[String(q)]=_.length}const G=n.parse(M,S,h);if(!G)return null;h=h||G.type,_.push(G)}const x=n.parse(t[1],1,kt);if(!x)return null;const w=n.parse(t[t.length-1],t.length-1,h);return w?x.type.kind!=="value"&&n.concat(1).checkSubtype(o,x.type)?null:new xr(o,h,x,g,_,w):null}evaluate(t){const n=this.input.evaluate(t);return(bt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Qi{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const h=[];for(let _=1;_<t.length-1;_+=2){const x=n.parse(t[_],_,qt);if(!x)return null;const w=n.parse(t[_+1],_+1,o);if(!w)return null;h.push([x,w]),o=o||w.type}const g=n.parse(t[t.length-1],t.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new Qi(o,h,g)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Un{constructor(t,n,o,h){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,kt),h=n.parse(t[2],2,tt);if(!o||!h)return null;if(!Or(o.type,[Wn(kt),Gt,kt]))return n.error(`Expected first argument to be of type array or string, but found ${fi(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,tt);return g?new Un(o.type,o,h,g):null}return new Un(o.type,o,h)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),Fr(n,["string"]))return[...n].slice(o,h).join("");if(Fr(n,["array"]))return n.slice(o,h);throw new Mi(`Expected first argument to be of type array or string, but found ${fi(bt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Es(r,t){const n=r.length-1;let o,h,g=0,_=n,x=0;for(;g<=_;)if(x=Math.floor((g+_)/2),o=r[x],h=r[x+1],o<=t){if(x===n||t<h)return x;g=x+1}else{if(!(o>t))throw new Mi("Input is not a number.");_=x-1}return 0}class Us{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of o)this.labels.push(h),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,tt);if(!o)return null;const h=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<t.length;_+=2){const x=_===1?-1/0:t[_],w=t[_+1],S=_,k=_+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=n.parse(w,k,g);if(!M)return null;g=g||M.type,h.push([x,M])}return new Us(g,o,h)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return o[0].evaluate(t);const g=n.length;return h>=n[g-1]?o[g-1].evaluate(t):o[Es(n,h)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function jl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var is,la,to=function(){if(la)return is;function r(t,n,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=h}return la=1,is=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var x=0,w=1;for(o=t,h=0;h<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<n));h++)t>g?x=o:w=o,o=.5*(w-x)+x;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},is}(),Ul=jl(to);class Ln{constructor(t,n,o,h,g){this.type=t,this.operator=n,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(t,n,o,h){let g=0;if(t.name==="exponential")g=sr(n,t.base,o,h);else if(t.name==="linear")g=sr(n,1,o,h);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Ul(_[0],_[1],_[2],_[3]).solve(sr(n,1,o,h))}return g}static parse(t,n){let[o,h,g,..._]=t;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some(k=>typeof k!="number"||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,tt),!g)return null;const x=[];let w=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==Nr?n.expectedType&&n.expectedType.kind!=="value"&&(w=n.expectedType):w=An;for(let S=0;S<_.length;S+=2){const k=_[S],M=_[S+1],j=S+3,G=S+4;if(typeof k!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(x.length&&x[x.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const q=n.parse(M,G,w);if(!q)return null;w=w||q.type,x.push([k,q])}return Jr(w,tt)||Jr(w,_s)||Jr(w,An)||Jr(w,Di)||Jr(w,vs)||Jr(w,Nr)||Jr(w,Fs)||Jr(w,Wn(tt))?new Ln(w,o,h,g,x):n.error(`Type ${fi(w)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return o[0].evaluate(t);const g=n.length;if(h>=n[g-1])return o[g-1].evaluate(t);const _=Es(n,h),x=Ln.interpolationFactor(this.interpolation,h,n[_],n[_+1]),w=o[_].evaluate(t),S=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return rr(w,S,x);case"color":return Ut.interpolate(w,S,x);case"padding":return Xi.interpolate(w,S,x);case"colorArray":return un.interpolate(w,S,x);case"numberArray":return rn.interpolate(w,S,x);case"variableAnchorOffsetCollection":return Yt.interpolate(w,S,x);case"array":return _r(w,S,x);case"projectionDefinition":return $t.interpolate(w,S,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ut.interpolate(w,S,x,"hcl");case"colorArray":return un.interpolate(w,S,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ut.interpolate(w,S,x,"lab");case"colorArray":return un.interpolate(w,S,x,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function sr(r,t,n,o){const h=o-n,g=r-n;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}const Ai={color:Ut.interpolate,number:rr,padding:Xi.interpolate,numberArray:rn.interpolate,colorArray:un.interpolate,variableAnchorOffsetCollection:Yt.interpolate,array:_r};class Vn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const h=n.expectedType;h&&h.kind!=="value"&&(o=h);const g=[];for(const x of t.slice(1)){const w=n.parse(x,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,g.push(w)}if(!o)throw new Error("No output type");const _=h&&g.some(x=>bs(h,x.type));return new Vn(_?kt:o,g)}evaluate(t){let n,o=null,h=0;for(const g of this.args)if(h++,o=g.evaluate(t),o&&o instanceof vn&&!o.available&&(n||(n=o.name),o=null,h===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ta(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ua(r,t,n,o){return o.compare(t,n)===0}function ns(r,t,n){const o=r!=="=="&&r!=="!=";return class hp{constructor(g,_,x){this.type=qt,this.lhs=g,this.rhs=_,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const x=g[0];let w=_.parse(g[1],1,kt);if(!w)return null;if(!Ta(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${fi(w.type)}'.`);let S=_.parse(g[2],2,kt);if(!S)return null;if(!Ta(x,S.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${fi(S.type)}'.`);if(w.type.kind!==S.type.kind&&w.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${fi(w.type)}' and '${fi(S.type)}'.`);o&&(w.type.kind==="value"&&S.type.kind!=="value"?w=new Kn(S.type,[w]):w.type.kind!=="value"&&S.type.kind==="value"&&(S=new Kn(w.type,[S])));let k=null;if(g.length===4){if(w.type.kind!=="string"&&S.type.kind!=="string"&&w.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(k=_.parse(g[3],3,zr),!k)return null}return new hp(w,S,k)}evaluate(g){const _=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const w=bt(_),S=bt(x);if(w.kind!==S.kind||w.kind!=="string"&&w.kind!=="number")throw new Mi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${S.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=bt(_),S=bt(x);if(w.kind!=="string"||S.kind!=="string")return t(g,_,x)}return this.collator?n(g,_,x,this.collator.evaluate(g)):t(g,_,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Ia=ns("==",function(r,t,n){return t===n},ua),io=ns("!=",function(r,t,n){return t!==n},function(r,t,n,o){return!ua(0,t,n,o)}),$o=ns("<",function(r,t,n){return t<n},function(r,t,n,o){return o.compare(t,n)<0}),br=ns(">",function(r,t,n){return t>n},function(r,t,n,o){return o.compare(t,n)>0}),Zo=ns("<=",function(r,t,n){return t<=n},function(r,t,n,o){return o.compare(t,n)<=0}),wn=ns(">=",function(r,t,n){return t>=n},function(r,t,n,o){return o.compare(t,n)>=0});class rs{constructor(t,n,o){this.type=zr,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const h=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,qt);if(!h)return null;const g=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,qt);if(!g)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,Gt),!_)?null:new rs(h,g,_)}evaluate(t){return new _n(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Sa{constructor(t,n,o,h,g){this.type=Gt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,tt);if(!o)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,Gt),!g))return null;let _=null;if(h.currency&&(_=n.parse(h.currency,1,Gt),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=n.parse(h["min-fraction-digits"],1,tt),!x))return null;let w=null;return h["max-fraction-digits"]&&(w=n.parse(h["max-fraction-digits"],1,tt),!w)?null:new Sa(o,g,_,x,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Vs{constructor(t){this.type=ys,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=t.length-1;++_){const x=t[_];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let w=null;if(x["font-scale"]&&(w=n.parse(x["font-scale"],1,tt),!w))return null;let S=null;if(x["text-font"]&&(S=n.parse(x["text-font"],1,Wn(Gt)),!S))return null;let k=null;if(x["text-color"]&&(k=n.parse(x["text-color"],1,An),!k))return null;let M=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Is.includes(x["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(M=n.parse(x["vertical-align"],1,Gt),!M)return null}const j=h[h.length-1];j.scale=w,j.font=S,j.textColor=k,j.verticalAlign=M}else{const w=n.parse(t[_],1,kt);if(!w)return null;const S=w.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Vs(h)}evaluate(t){return new yn(this.sections.map(n=>{const o=n.content.evaluate(t);return bt(o)===mr?new Qa("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new Qa(ts(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Ea{constructor(t){this.type=mr,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Gt);return o?new Ea(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=vn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class ca{constructor(t){this.type=tt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${fi(o.type)} instead.`):new ca(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Mi(`Expected value to be of type string or array, but found ${fi(bt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ar=8192;function Vl(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*ar),Math.round(o*h*ar)]}function no(r,t){const n=Math.pow(2,t.z);return[(h=(r[0]/ar+t.x)/n,360*h-180),(o=(r[1]/ar+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function ha(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function da(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Xo(r,t,n){const o=r[0]-t[0],h=r[1]-t[1],g=r[0]-n[0],_=r[1]-n[1];return o*_-g*h==0&&o*g<=0&&h*_<=0}function fa(r,t,n,o){return(h=[o[0]-n[0],o[1]-n[1]])[0]*(g=[t[0]-r[0],t[1]-r[1]])[1]-h[1]*g[0]!=0&&!(!ka(r,t,n,o)||!ka(n,o,r,t));var h,g}function Yo(r,t,n){for(const o of n)for(let h=0;h<o.length-1;++h)if(fa(r,t,o[h],o[h+1]))return!0;return!1}function Gs(r,t,n=!1){let o=!1;for(const x of t)for(let w=0;w<x.length-1;w++){if(Xo(r,x[w],x[w+1]))return n;(g=x[w])[1]>(h=r)[1]!=(_=x[w+1])[1]>h[1]&&h[0]<(_[0]-g[0])*(h[1]-g[1])/(_[1]-g[1])+g[0]&&(o=!o)}var h,g,_;return o}function Ho(r,t){for(const n of t)if(Gs(r,n))return!0;return!1}function Wo(r,t){for(const n of r)if(!Gs(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Yo(r[n],r[n+1],t))return!1;return!0}function Ko(r,t){for(const n of t)if(Wo(r,n))return!0;return!1}function ka(r,t,n,o){const h=o[0]-n[0],g=o[1]-n[1],_=(r[0]-n[0])*g-h*(r[1]-n[1]),x=(t[0]-n[0])*g-h*(t[1]-n[1]);return _>0&&x<0||_<0&&x>0}function ro(r,t,n){const o=[];for(let h=0;h<r.length;h++){const g=[];for(let _=0;_<r[h].length;_++){const x=Vl(r[h][_],n);ha(t,x),g.push(x)}o.push(g)}return o}function Jo(r,t,n){const o=[];for(let h=0;h<r.length;h++){const g=ro(r[h],t,n);o.push(g)}return o}function Qo(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const h=.5*o;let g=r[0]-n[0]>h?-o:n[0]-r[0]>h?o:0;g===0&&(g=r[0]-n[2]>h?-o:n[2]-r[0]>h?o:0),r[0]+=g}ha(t,r)}function so(r,t,n,o){const h=Math.pow(2,o.z)*ar,g=[o.x*ar,o.y*ar],_=[];for(const x of r)for(const w of x){const S=[w.x+g[0],w.y+g[1]];Qo(S,t,n,h),_.push(S)}return _}function ao(r,t,n,o){const h=Math.pow(2,o.z)*ar,g=[o.x*ar,o.y*ar],_=[];for(const w of r){const S=[];for(const k of w){const M=[k.x+g[0],k.y+g[1]];ha(t,M),S.push(M)}_.push(S)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of _)for(const S of w)Qo(S,t,n,h)}var x;return _}class ks{constructor(t,n){this.type=qt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(es(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const h=[];for(const g of o.features){const{type:_,coordinates:x}=g.geometry;_==="Polygon"&&h.push(x),_==="MultiPolygon"&&h.push(...x)}if(h.length)return new ks(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ks(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ks(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const x=ro(o.coordinates,g,_),w=so(n.geometry(),h,g,_);if(!da(h,g))return!1;for(const S of w)if(!Gs(S,x))return!1}if(o.type==="MultiPolygon"){const x=Jo(o.coordinates,g,_),w=so(n.geometry(),h,g,_);if(!da(h,g))return!1;for(const S of w)if(!Ho(S,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const x=ro(o.coordinates,g,_),w=ao(n.geometry(),h,g,_);if(!da(h,g))return!1;for(const S of w)if(!Wo(S,x))return!1}if(o.type==="MultiPolygon"){const x=Jo(o.coordinates,g,_),w=ao(n.geometry(),h,g,_);if(!da(h,g))return!1;for(const S of w)if(!Ko(S,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let oo=class{constructor(r=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const h=r-1>>1,g=t[h];if(n(o,g)>=0)break;t[r]=g,r=h}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,h=t[r];for(;r<o;){let g=1+(r<<1);const _=g+1;if(_<this.length&&n(t[_],t[g])<0&&(g=_),n(t[g],h)>=0)break;t[r]=t[g],r=g}t[r]=h}};function Ca(r,t,n=0,o=r.length-1,h=Gl){for(;o>n;){if(o-n>600){const w=o-n+1,S=t-n+1,k=Math.log(w),M=.5*Math.exp(2*k/3),j=.5*Math.sqrt(k*M*(w-M)/w)*(S-w/2<0?-1:1);Ca(r,t,Math.max(n,Math.floor(t-S*M/w+j)),Math.min(o,Math.floor(t+(w-S)*M/w+j)),h)}const g=r[t];let _=n,x=o;for(Cs(r,n,t),h(r[o],g)>0&&Cs(r,n,o);_<x;){for(Cs(r,_,x),_++,x--;h(r[_],g)<0;)_++;for(;h(r[x],g)>0;)x--}h(r[n],g)===0?Cs(r,n,x):(x++,Cs(r,x,o)),x<=t&&(n=x+1),t<=x&&(o=x-1)}}function Cs(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function Gl(r,t){return r<t?-1:r>t?1:0}function pa(r,t){if(r.length<=1)return[r];const n=[];let o,h;for(const g of r){const _=el(g);_!==0&&(g.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(o&&n.push(o),o=[g]):o.push(g))}if(o&&n.push(o),t>1)for(let g=0;g<n.length;g++)n[g].length<=t||(Ca(n[g],t,1,n[g].length-1,lo),n[g]=n[g].slice(0,t));return n}function lo(r,t){return t.area-r.area}function el(r){let t=0;for(let n,o,h=0,g=r.length,_=g-1;h<g;_=h++)n=r[h],o=r[_],t+=(o.x-n.x)*(n.y+o.y);return t}const uo=1/298.257223563,co=uo*(2-uo),tl=Math.PI/180;class ho{constructor(t){const n=6378.137*tl*1e3,o=Math.cos(t*tl),h=1/(1-co*(1-o*o)),g=Math.sqrt(h);this.kx=n*g*o,this.ky=n*g*h*(1-co)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,h=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(t,n){let o,h,g,_,x=1/0;for(let w=0;w<t.length-1;w++){let S=t[w][0],k=t[w][1],M=this.wrap(t[w+1][0]-S)*this.kx,j=(t[w+1][1]-k)*this.ky,G=0;M===0&&j===0||(G=(this.wrap(n[0]-S)*this.kx*M+(n[1]-k)*this.ky*j)/(M*M+j*j),G>1?(S=t[w+1][0],k=t[w+1][1]):G>0&&(S+=M/this.kx*G,k+=j/this.ky*G)),M=this.wrap(n[0]-S)*this.kx,j=(n[1]-k)*this.ky;const q=M*M+j*j;q<x&&(x=q,o=S,h=k,g=w,_=G)}return{point:[o,h],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function ti(r,t){return t[0]-r[0]}function Pa(r){return r[1]-r[0]+1}function Cr(r,t){return r[1]>=r[0]&&r[1]<t}function Gn(r,t){if(r[0]>r[1])return[null,null];const n=Pa(r);if(t){if(n===2)return[r,null];const h=Math.floor(n/2);return[[r[0],r[0]+h],[r[0]+h,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function or(r,t){if(!Cr(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)ha(n,r[o]);return n}function f(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)ha(t,o);return t}function s(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function a(r,t,n){if(!s(r)||!s(t))return NaN;let o=0,h=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(h=r[1]-t[3]),r[3]<t[1]&&(h=t[1]-r[3]),n.distance([0,0],[o,h])}function d(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function v(r,t,n,o,h){const g=Math.min(d(r,[n,o],h),d(t,[n,o],h)),_=Math.min(d(n,[r,t],h),d(o,[r,t],h));return Math.min(g,_)}function I(r,t,n,o,h){if(!Cr(t,r.length)||!Cr(o,n.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const x=r[_],w=r[_+1];for(let S=o[0];S<o[1];++S){const k=n[S],M=n[S+1];if(fa(x,w,k,M))return 0;g=Math.min(g,v(x,w,k,M,h))}}return g}function P(r,t,n,o,h){if(!Cr(t,r.length)||!Cr(o,n.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let x=o[0];x<=o[1];++x)if(g=Math.min(g,h.distance(r[_],n[x])),g===0)return g;return g}function O(r,t,n){if(Gs(r,t,!0))return 0;let o=1/0;for(const h of t){const g=h[0],_=h[h.length-1];if(g!==_&&(o=Math.min(o,d(r,[_,g],n)),o===0))return o;const x=n.pointOnLine(h,r);if(o=Math.min(o,n.distance(r,x.point)),o===0)return o}return o}function K(r,t,n,o){if(!Cr(t,r.length))return NaN;for(let g=t[0];g<=t[1];++g)if(Gs(r[g],n,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const _=r[g],x=r[g+1];for(const w of n)for(let S=0,k=w.length,M=k-1;S<k;M=S++){const j=w[M],G=w[S];if(fa(_,x,j,G))return 0;h=Math.min(h,v(_,x,j,G,o))}}return h}function re(r,t){for(const n of r)for(const o of n)if(Gs(o,t,!0))return!0;return!1}function Ce(r,t,n,o=1/0){const h=f(r),g=f(t);if(o!==1/0&&a(h,g,n)>=o)return o;if(da(h,g)){if(re(r,t))return 0}else if(re(t,r))return 0;let _=1/0;for(const x of r)for(let w=0,S=x.length,k=S-1;w<S;k=w++){const M=x[k],j=x[w];for(const G of t)for(let q=0,X=G.length,Q=X-1;q<X;Q=q++){const ne=G[Q],be=G[q];if(fa(M,j,ne,be))return 0;_=Math.min(_,v(M,j,ne,be,n))}}return _}function Oe(r,t,n,o,h,g){if(!g)return;const _=a(or(o,g),h,n);_<t&&r.push([_,g,[0,0]])}function We(r,t,n,o,h,g,_){if(!g||!_)return;const x=a(or(o,g),or(h,_),n);x<t&&r.push([x,g,_])}function ht(r,t,n,o,h=1/0){let g=Math.min(o.distance(r[0],n[0][0]),h);if(g===0)return g;const _=new oo([[0,[0,r.length-1],[0,0]]],ti),x=f(n);for(;_.length>0;){const w=_.pop();if(w[0]>=g)continue;const S=w[1],k=t?50:100;if(Pa(S)<=k){if(!Cr(S,r.length))return NaN;if(t){const M=K(r,S,n,o);if(isNaN(M)||M===0)return M;g=Math.min(g,M)}else for(let M=S[0];M<=S[1];++M){const j=O(r[M],n,o);if(g=Math.min(g,j),g===0)return 0}}else{const M=Gn(S,t);Oe(_,g,o,r,x,M[0]),Oe(_,g,o,r,x,M[1])}}return g}function Et(r,t,n,o,h,g=1/0){let _=Math.min(g,h.distance(r[0],n[0]));if(_===0)return _;const x=new oo([[0,[0,r.length-1],[0,n.length-1]]],ti);for(;x.length>0;){const w=x.pop();if(w[0]>=_)continue;const S=w[1],k=w[2],M=t?50:100,j=o?50:100;if(Pa(S)<=M&&Pa(k)<=j){if(!Cr(S,r.length)&&Cr(k,n.length))return NaN;let G;if(t&&o)G=I(r,S,n,k,h),_=Math.min(_,G);else if(t&&!o){const q=r.slice(S[0],S[1]+1);for(let X=k[0];X<=k[1];++X)if(G=d(n[X],q,h),_=Math.min(_,G),_===0)return _}else if(!t&&o){const q=n.slice(k[0],k[1]+1);for(let X=S[0];X<=S[1];++X)if(G=d(r[X],q,h),_=Math.min(_,G),_===0)return _}else G=P(r,S,n,k,h),_=Math.min(_,G)}else{const G=Gn(S,t),q=Gn(k,o);We(x,_,h,r,n,G[0],q[0]),We(x,_,h,r,n,G[0],q[1]),We(x,_,h,r,n,G[1],q[0]),We(x,_,h,r,n,G[1],q[1])}}return _}function Rt(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class Jt{constructor(t,n){this.type=tt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(es(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Jt(o,o.features.map(h=>Rt(h.geometry)).flat());if(o.type==="Feature")return new Jt(o,Rt(o.geometry));if("type"in o&&"coordinates"in o)return new Jt(o,Rt(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const h=n.geometry(),g=h.flat().map(w=>no([w.x,w.y],n.canonical));if(h.length===0)return NaN;const _=new ho(g[0][1]);let x=1/0;for(const w of o){switch(w.type){case"Point":x=Math.min(x,Et(g,!1,[w.coordinates],!1,_,x));break;case"LineString":x=Math.min(x,Et(g,!1,w.coordinates,!0,_,x));break;case"Polygon":x=Math.min(x,ht(g,!1,w.coordinates,_,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const h=n.geometry(),g=h.flat().map(w=>no([w.x,w.y],n.canonical));if(h.length===0)return NaN;const _=new ho(g[0][1]);let x=1/0;for(const w of o){switch(w.type){case"Point":x=Math.min(x,Et(g,!0,[w.coordinates],!1,_,x));break;case"LineString":x=Math.min(x,Et(g,!0,w.coordinates,!0,_,x));break;case"Polygon":x=Math.min(x,ht(g,!0,w.coordinates,_,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const h=n.geometry();if(h.length===0||h[0].length===0)return NaN;const g=pa(h,0).map(w=>w.map(S=>S.map(k=>no([k.x,k.y],n.canonical)))),_=new ho(g[0][0][0][1]);let x=1/0;for(const w of o)for(const S of g){switch(w.type){case"Point":x=Math.min(x,ht([w.coordinates],!1,S,_,x));break;case"LineString":x=Math.min(x,ht(w.coordinates,!0,S,_,x));break;case"Polygon":x=Math.min(x,Ce(S,w.coordinates,_,x))}if(x===0)return x}return x}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ei{constructor(t){this.type=kt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new ei(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?Kt(o,this.key):null}eachChild(){}outputDefined(){return!1}}const _i={"==":Ia,"!=":io,">":br,"<":$o,">=":wn,"<=":Zo,array:Kn,at:cn,boolean:Kn,case:Qi,coalesce:Vn,collator:rs,format:Vs,image:Ea,in:vr,"index-of":js,interpolate:Ln,"interpolate-hcl":Ln,"interpolate-lab":Ln,length:ca,let:xn,literal:dn,match:xr,number:Kn,"number-format":Sa,object:Kn,slice:Un,step:Us,string:Kn,"to-boolean":yr,"to-color":yr,"to-number":yr,"to-string":yr,var:bn,within:ks,distance:Jt,"global-state":ei};class Ti{constructor(t,n,o,h){this.name=t,this.type=n,this._evaluate=o,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],h=Ti.definitions[o];if(!h)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([S])=>!Array.isArray(S)||S.length===t.length-1);let w=null;for(const[S,k]of x){w=new oa(n.registry,ma,n.path,null,n.scope);const M=[];let j=!1;for(let G=1;G<t.length;G++){const q=t[G],X=Array.isArray(S)?S[G-1]:S.type,Q=w.parse(q,1+M.length,X);if(!Q){j=!0;break}M.push(Q)}if(!j)if(Array.isArray(S)&&S.length!==M.length)w.error(`Expected ${S.length} arguments, but found ${M.length} instead.`);else{for(let G=0;G<M.length;G++){const q=Array.isArray(S)?S[G]:S.type,X=M[G];w.concat(G+1).checkSubtype(q,X.type)}if(w.errors.length===0)return new Ti(o,g,k,M)}}if(x.length===1)n.errors.push(...w.errors);else{const S=(x.length?x:_).map(([M])=>{return j=M,Array.isArray(j)?`(${j.map(fi).join(", ")})`:`(${fi(j.type)}...)`;var j}).join(" | "),k=[];for(let M=1;M<t.length;M++){const j=n.parse(t[M],1+k.length);if(!j)return null;k.push(fi(j.type))}n.error(`Expected arguments of type ${S}, but found (${k.join(", ")}) instead.`)}return null}static register(t,n){Ti.definitions=n;for(const o in n)t[o]=Ti}}function fn(r,[t,n,o,h]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const g=h?h.evaluate(r):1,_=Zt(t,n,o,g);if(_)throw new Mi(_);return new Ut(t/255,n/255,o/255,g,!1)}function ss(r,t){return r in t}function Ps(r,t){const n=t[r];return n===void 0?null:n}function as(r){return{type:r}}function ma(r){if(r instanceof bn)return ma(r.boundExpression);if(r instanceof Ti&&r.name==="error"||r instanceof rs||r instanceof ks||r instanceof Jt||r instanceof ei)return!1;const t=r instanceof yr||r instanceof Kn;let n=!0;return r.eachChild(o=>{n=t?n&&ma(o):n&&o instanceof dn}),!!n&&ga(r)&&Ms(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ga(r){if(r instanceof Ti&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ks||r instanceof Jt)return!1;let t=!0;return r.eachChild(n=>{t&&!ga(n)&&(t=!1)}),t}function qs(r){if(r instanceof Ti&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!qs(n)&&(t=!1)}),t}function Ms(r,t){if(r instanceof Ti&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!Ms(o,t)&&(n=!1)}),n}function fo(r){return{result:"success",value:r}}function os(r){return{result:"error",value:r}}function ls(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ql(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function $l(r){return!!r.expression&&r.expression.interpolated}function ii(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function _a(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&bt(r)===jn}function Fu(r){return r}function Bu(r,t){const n=r.stops&&typeof r.stops[0][0]=="object",o=n||!(n||r.property!==void 0),h=r.type||($l(t)?"exponential":"interval"),g=function(k){switch(k.type){case"color":return Ut.parse;case"padding":return Xi.parse;case"numberArray":return rn.parse;case"colorArray":return un.parse;default:return null}}(t);if(g&&((r=ln({},r)).stops&&(r.stops=r.stops.map(k=>[k[0],g(k[1])])),r.default=g(r.default?r.default:t.default)),r.colorSpace&&(_=r.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var _;const x=function(k){switch(k){case"exponential":return ju;case"interval":return Bc;case"categorical":return Fc;case"identity":return Uu;default:throw new Error(`Unknown function type "${k}"`)}}(h);let w,S;if(h==="categorical"){w=Object.create(null);for(const k of r.stops)w[k[0]]=k[1];S=typeof r.stops[0][0]}if(n){const k={},M=[];for(let q=0;q<r.stops.length;q++){const X=r.stops[q],Q=X[0].zoom;k[Q]===void 0&&(k[Q]={zoom:Q,type:r.type,property:r.property,default:r.default,stops:[]},M.push(Q)),k[Q].stops.push([X[0].value,X[1]])}const j=[];for(const q of M)j.push([k[q].zoom,Bu(k[q],t)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:Ln.interpolationFactor.bind(void 0,G),zoomStops:j.map(q=>q[0]),evaluate:({zoom:q},X)=>ju({stops:j,base:r.base},t,q).evaluate(q,X)}}if(o){const k=h==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Ln.interpolationFactor.bind(void 0,k),zoomStops:r.stops.map(M=>M[0]),evaluate:({zoom:M})=>x(r,t,M,w,S)}}return{kind:"source",evaluate(k,M){const j=M&&M.properties?M.properties[r.property]:void 0;return j===void 0?po(r.default,t.default):x(r,t,j,w,S)}}}function po(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function Fc(r,t,n,o,h){return po(typeof n===h?o[n]:void 0,r.default,t.default)}function Bc(r,t,n){if(ii(n)!=="number")return po(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const h=Es(r.stops.map(g=>g[0]),n);return r.stops[h][1]}function ju(r,t,n){const o=r.base!==void 0?r.base:1;if(ii(n)!=="number")return po(r.default,t.default);const h=r.stops.length;if(h===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[h-1][0])return r.stops[h-1][1];const g=Es(r.stops.map(k=>k[0]),n),_=function(k,M,j,G){const q=G-j,X=k-j;return q===0?0:M===1?X/q:(Math.pow(M,X)-1)/(Math.pow(M,q)-1)}(n,o,r.stops[g][0],r.stops[g+1][0]),x=r.stops[g][1],w=r.stops[g+1][1],S=Ai[t.type]||Fu;return typeof x.evaluate=="function"?{evaluate(...k){const M=x.evaluate.apply(void 0,k),j=w.evaluate.apply(void 0,k);if(M!==void 0&&j!==void 0)return S(M,j,_,r.colorSpace)}}:S(x,w,_,r.colorSpace)}function Uu(r,t,n){switch(t.type){case"color":n=Ut.parse(n);break;case"formatted":n=yn.fromString(n.toString());break;case"resolvedImage":n=vn.fromString(n.toString());break;case"padding":n=Xi.parse(n);break;case"colorArray":n=un.parse(n);break;case"numberArray":n=rn.parse(n);break;default:ii(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return po(n,r.default,t.default)}Ti.register(_i,{error:[{kind:"error"},[Gt],(r,[t])=>{throw new Mi(t.evaluate(r))}],typeof:[Gt,[kt],(r,[t])=>fi(bt(t.evaluate(r)))],"to-rgba":[Wn(tt,4),[An],(r,[t])=>{const[n,o,h,g]=t.evaluate(r).rgb;return[255*n,255*o,255*h,g]}],rgb:[An,[tt,tt,tt],fn],rgba:[An,[tt,tt,tt,tt],fn],has:{type:qt,overloads:[[[Gt],(r,[t])=>ss(t.evaluate(r),r.properties())],[[Gt,jn],(r,[t,n])=>ss(t.evaluate(r),n.evaluate(r))]]},get:{type:kt,overloads:[[[Gt],(r,[t])=>Ps(t.evaluate(r),r.properties())],[[Gt,jn],(r,[t,n])=>Ps(t.evaluate(r),n.evaluate(r))]]},"feature-state":[kt,[Gt],(r,[t])=>Ps(t.evaluate(r),r.featureState||{})],properties:[jn,[],r=>r.properties()],"geometry-type":[Gt,[],r=>r.geometryType()],id:[kt,[],r=>r.id()],zoom:[tt,[],r=>r.globals.zoom],"heatmap-density":[tt,[],r=>r.globals.heatmapDensity||0],elevation:[tt,[],r=>r.globals.elevation||0],"line-progress":[tt,[],r=>r.globals.lineProgress||0],accumulated:[kt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[tt,as(tt),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[tt,as(tt),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:tt,overloads:[[[tt,tt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[tt],(r,[t])=>-t.evaluate(r)]]},"/":[tt,[tt,tt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[tt,[tt,tt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[tt,[],()=>Math.LN2],pi:[tt,[],()=>Math.PI],e:[tt,[],()=>Math.E],"^":[tt,[tt,tt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[tt,[tt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[tt,[tt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[tt,[tt],(r,[t])=>Math.log(t.evaluate(r))],log2:[tt,[tt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[tt,[tt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[tt,[tt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[tt,[tt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[tt,[tt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[tt,[tt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[tt,[tt],(r,[t])=>Math.atan(t.evaluate(r))],min:[tt,as(tt),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[tt,as(tt),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[tt,[tt],(r,[t])=>Math.abs(t.evaluate(r))],round:[tt,[tt],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[tt,[tt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[tt,[tt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[qt,[Gt,kt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[qt,[kt],(r,[t])=>r.id()===t.value],"filter-type-==":[qt,[Gt],(r,[t])=>r.geometryType()===t.value],"filter-<":[qt,[Gt,kt],(r,[t,n])=>{const o=r.properties()[t.value],h=n.value;return typeof o==typeof h&&o<h}],"filter-id-<":[qt,[kt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[qt,[Gt,kt],(r,[t,n])=>{const o=r.properties()[t.value],h=n.value;return typeof o==typeof h&&o>h}],"filter-id->":[qt,[kt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[qt,[Gt,kt],(r,[t,n])=>{const o=r.properties()[t.value],h=n.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[qt,[kt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[qt,[Gt,kt],(r,[t,n])=>{const o=r.properties()[t.value],h=n.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[qt,[kt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[qt,[kt],(r,[t])=>t.value in r.properties()],"filter-has-id":[qt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[qt,[Wn(Gt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[qt,[Wn(kt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[qt,[Gt,Wn(kt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[qt,[Gt,Wn(kt)],(r,[t,n])=>function(o,h,g,_){for(;g<=_;){const x=g+_>>1;if(h[x]===o)return!0;h[x]>o?_=x-1:g=x+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:qt,overloads:[[[qt,qt],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[as(qt),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:qt,overloads:[[[qt,qt],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[as(qt),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[qt,[qt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[qt,[Gt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[Gt,[Gt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Gt,[Gt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Gt,as(kt),(r,t)=>t.map(n=>ts(n.evaluate(r))).join("")],"resolved-locale":[Gt,[zr],(r,[t])=>t.evaluate(r).resolvedLocale()]});class il{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new aa,this._defaultValue=n?function(o){if(o.type==="color"&&_a(o.default))return new Ut(0,0,0,0);switch(o.type){case"color":return Ut.parse(o.default)||null;case"padding":return Xi.parse(o.default)||null;case"numberArray":return rn.parse(o.default)||null;case"colorArray":return un.parse(o.default)||null;case"variableAnchorOffsetCollection":return Yt.parse(o.default)||null;case"projectionDefinition":return $t.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,h,g,_){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,h,g,_){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Mi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function nl(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in _i}function rl(r,t){const n=new oa(_i,ma,[],t?function(h){const g={color:An,string:Gt,number:tt,enum:Gt,boolean:qt,formatted:ys,padding:Di,numberArray:vs,colorArray:Nr,projectionDefinition:_s,resolvedImage:mr,variableAnchorOffsetCollection:Fs};return h.type==="array"?Wn(g[h.value]||kt,h.length):g[h.type]}(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?fo(new il(o,t)):os(n.errors)}class mo{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!qs(n.expression),this.globalStateRefs=Aa(n.expression)}evaluateWithoutErrorHandling(t,n,o,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,h,g,_)}evaluate(t,n,o,h,g,_){return this._styleExpression.evaluate(t,n,o,h,g,_)}}class sl{constructor(t,n,o,h){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!qs(n.expression),this.globalStateRefs=Aa(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,o,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,h,g,_)}evaluate(t,n,o,h,g,_){return this._styleExpression.evaluate(t,n,o,h,g,_)}interpolationFactor(t,n,o){return this.interpolationType?Ln.interpolationFactor(this.interpolationType,t,n,o):0}}function Zl(r,t){const n=rl(r,t);if(n.result==="error")return n;const o=n.value.expression,h=ga(o);if(!h&&!ls(t))return os([new Ri("","data expressions not supported")]);const g=Ms(o,["zoom"]);if(!g&&!ql(t))return os([new Ri("","zoom expressions not supported")]);const _=Ma(o);return _||g?_ instanceof Ri?os([_]):_ instanceof Ln&&!$l(t)?os([new Ri("",'"interpolate" expressions cannot be used with this property')]):fo(_?new sl(h?"camera":"composite",n.value,_.labels,_ instanceof Ln?_.interpolation:void 0):new mo(h?"constant":"source",n.value)):os([new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class go{constructor(t,n){this._parameters=t,this._specification=n,ln(this,Bu(this._parameters,this._specification))}static deserialize(t){return new go(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ma(r){let t=null;if(r instanceof xn)t=Ma(r.result);else if(r instanceof Vn){for(const n of r.args)if(t=Ma(n),t)break}else(r instanceof Us||r instanceof Ln)&&r.input instanceof Ti&&r.input.name==="zoom"&&(t=r);return t instanceof Ri||r.eachChild(n=>{const o=Ma(n);o instanceof Ri?t=o:!t&&o?t=new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Aa(r,t=new Set){return r instanceof ei&&t.add(r.key),r.eachChild(n=>{Aa(n,t)}),t}function _o(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!_o(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Xl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $s(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};_o(r)||(r=al(r));const t=rl(r,Xl);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,h)=>t.value.evaluate(n,o,{},h),needGeometry:Vu(r),getGlobalStateRefs:()=>Aa(t.value.expression)}}function jc(r,t){return r<t?-1:r>t?1:0}function Vu(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Vu(r[t]))return!0;return!1}function al(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Yl(r[1],r[2],"=="):t==="!="?yo(Yl(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Yl(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(al))):t==="all"?["all"].concat(r.slice(1).map(al)):t==="none"?["all"].concat(r.slice(1).map(al).map(yo)):t==="in"?Gu(r[1],r.slice(2)):t==="!in"?yo(Gu(r[1],r.slice(2))):t==="has"?qu(r[1]):t!=="!has"||yo(qu(r[1]));var n}function Yl(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Gu(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(jc)]]:["filter-in-small",r,["literal",t]]}}function qu(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function yo(r){return["!",r]}function ol(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(const g of r)h+=`${ol(g)},`;return`${h}]`}const n=Object.keys(r).sort();let o="{";for(let h=0;h<n.length;h++)o+=`${JSON.stringify(n[h])}:${ol(r[n[h]])},`;return`${o}}`}function ll(r){let t="";for(const n of st)t+=`/${ol(r[n])}`;return t}function $u(r){const t=r.value;return t?[new et(r.key,t,"constants have been deprecated as of v8")]:[]}function Yi(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Zs(r){if(Array.isArray(r))return r.map(Zs);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Zs(r[n]);return t}return Yi(r)}function Pr(r){const t=r.key,n=r.value,o=r.valueSpec||{},h=r.objectElementValidators||{},g=r.style,_=r.styleSpec,x=r.validateSpec;let w=[];const S=ii(n);if(S!=="object")return[new et(t,n,`object expected, ${S} found`)];for(const k in n){const M=k.split(".")[0],j=Kt(o,M)||o["*"];let G;if(Kt(h,M))G=h[M];else if(Kt(o,M))G=x;else if(h["*"])G=h["*"];else{if(!o["*"]){w.push(new et(t,n[k],`unknown property "${k}"`));continue}G=x}w=w.concat(G({key:(t&&`${t}.`)+k,value:n[k],valueSpec:j,style:g,styleSpec:_,object:n,objectKey:k,validateSpec:x},n))}for(const k in o)h[k]||o[k].required&&o[k].default===void 0&&n[k]===void 0&&w.push(new et(t,n,`missing required property "${k}"`));return w}function ul(r){const t=r.value,n=r.valueSpec,o=r.style,h=r.styleSpec,g=r.key,_=r.arrayElementValidator||r.validateSpec;if(ii(t)!=="array")return[new et(g,t,`array expected, ${ii(t)} found`)];if(n.length&&t.length!==n.length)return[new et(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new et(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let x={type:n.value,values:n.values};h.$version<7&&(x.function=n.function),ii(n.value)==="object"&&(x=n.value);let w=[];for(let S=0;S<t.length;S++)w=w.concat(_({array:t,arrayIndex:S,value:t[S],valueSpec:x,validateSpec:r.validateSpec,style:o,styleSpec:h,key:`${g}[${S}]`}));return w}function vo(r){const t=r.key,n=r.value,o=r.valueSpec;let h=ii(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new et(t,n,`number expected, ${h} found`)]:"minimum"in o&&n<o.minimum?[new et(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new et(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function La(r){const t=r.valueSpec,n=Yi(r.value.type);let o,h,g,_={};const x=n!=="categorical"&&r.value.property===void 0,w=!x,S=ii(r.value.stops)==="array"&&ii(r.value.stops[0])==="array"&&ii(r.value.stops[0][0])==="object",k=Pr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(G){if(n==="identity")return[new et(G.key,G.value,'identity function may not have a "stops" property')];let q=[];const X=G.value;return q=q.concat(ul({key:G.key,value:X,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:M})),ii(X)==="array"&&X.length===0&&q.push(new et(G.key,X,"array must have at least one stop")),q},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:t,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return n==="identity"&&x&&k.push(new et(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||k.push(new et(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!$l(r.valueSpec)&&k.push(new et(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(w&&!ls(r.valueSpec)?k.push(new et(r.key,r.value,"property functions not supported")):x&&!ql(r.valueSpec)&&k.push(new et(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!S||r.value.property!==void 0||k.push(new et(r.key,r.value,'"property" property is required')),k;function M(G){let q=[];const X=G.value,Q=G.key;if(ii(X)!=="array")return[new et(Q,X,`array expected, ${ii(X)} found`)];if(X.length!==2)return[new et(Q,X,`array length 2 expected, length ${X.length} found`)];if(S){if(ii(X[0])!=="object")return[new et(Q,X,`object expected, ${ii(X[0])} found`)];if(X[0].zoom===void 0)return[new et(Q,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new et(Q,X,"object stop key must have value")];if(g&&g>Yi(X[0].zoom))return[new et(Q,X[0].zoom,"stop zoom values must appear in ascending order")];Yi(X[0].zoom)!==g&&(g=Yi(X[0].zoom),h=void 0,_={}),q=q.concat(Pr({key:`${Q}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:vo,value:j}}))}else q=q.concat(j({key:`${Q}[0]`,value:X[0],validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},X));return nl(Zs(X[1]))?q.concat([new et(`${Q}[1]`,X[1],"expressions are not allowed in function stops.")]):q.concat(G.validateSpec({key:`${Q}[1]`,value:X[1],valueSpec:t,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function j(G,q){const X=ii(G.value),Q=Yi(G.value),ne=G.value!==null?G.value:q;if(o){if(X!==o)return[new et(G.key,ne,`${X} stop domain type must match previous stop domain type ${o}`)]}else o=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new et(G.key,ne,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&n!=="categorical"){let be=`number expected, ${X} found`;return ls(t)&&n===void 0&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new et(G.key,ne,be)]}return n!=="categorical"||X!=="number"||isFinite(Q)&&Math.floor(Q)===Q?n!=="categorical"&&X==="number"&&h!==void 0&&Q<h?[new et(G.key,ne,"stop domain values must appear in ascending order")]:(h=Q,n==="categorical"&&Q in _?[new et(G.key,ne,"stop domain values must be unique")]:(_[Q]=!0,[])):[new et(G.key,ne,`integer expected, found ${Q}`)]}}function Ra(r){const t=(r.expressionContext==="property"?Zl:rl)(Zs(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new et(`${r.key}${o.key}`,r.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new et(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!qs(n))return[new et(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!qs(n))return[new et(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Ms(n,["zoom","feature-state"]))return[new et(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!ga(n))return[new et(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hl(r){const t=r.key,n=r.value,o=ii(n);return o!=="string"?[new et(t,n,`color expected, ${o} found`)]:Ut.parse(String(n))?[]:[new et(t,n,`color expected, "${n}" found`)]}function xo(r){const t=r.key,n=r.value,o=r.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(Yi(n))===-1&&h.push(new et(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Yi(n))===-1&&h.push(new et(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Wl(r){return _o(Zs(r.value))?Ra(ln({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zu(r)}function Zu(r){const t=r.value,n=r.key;if(ii(t)!=="array")return[new et(n,t,`array expected, ${ii(t)} found`)];const o=r.styleSpec;let h,g=[];if(t.length<1)return[new et(n,t,"filter array must have at least 1 element")];switch(g=g.concat(xo({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),Yi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yi(t[1])==="$type"&&g.push(new et(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new et(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=ii(t[1]),h!=="string"&&g.push(new et(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let _=2;_<t.length;_++)h=ii(t[_]),Yi(t[1])==="$type"?g=g.concat(xo({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new et(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(Zu({key:`${n}[${_}]`,value:t[_],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=ii(t[1]),t.length!==2?g.push(new et(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new et(`${n}[1]`,t[1],`string expected, ${h} found`))}return g}function Xu(r,t){const n=r.key,o=r.validateSpec,h=r.style,g=r.styleSpec,_=r.value,x=r.objectKey,w=g[`${t}_${r.layerType}`];if(!w)return[];const S=x.match(/^(.*)-transition$/);if(t==="paint"&&S&&w[S[1]]&&w[S[1]].transition)return o({key:n,value:_,valueSpec:g.transition,style:h,styleSpec:g});const k=r.valueSpec||w[x];if(!k)return[new et(n,_,`unknown property "${x}"`)];let M;if(ii(_)==="string"&&ls(k)&&!k.tokens&&(M=/^{([^}]+)}$/.exec(_)))return[new et(n,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const j=[];return r.layerType==="symbol"&&(x==="text-field"&&h&&!h.glyphs&&j.push(new et(n,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&_a(Zs(_))&&Yi(_.type)==="identity"&&j.push(new et(n,_,'"text-font" does not support identity functions'))),j.concat(o({key:r.key,value:_,valueSpec:k,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:x}))}function Da(r){return Xu(r,"paint")}function za(r){return Xu(r,"layout")}function lr(r){let t=[];const n=r.value,o=r.key,h=r.style,g=r.styleSpec;if(ii(n)!=="object")return[new et(o,n,`object expected, ${ii(n)} found`)];n.type||n.ref||t.push(new et(o,n,'either "type" or "ref" is required'));let _=Yi(n.type);const x=Yi(n.ref);if(n.id){const w=Yi(n.id);for(let S=0;S<r.arrayIndex;S++){const k=h.layers[S];Yi(k.id)===w&&t.push(new et(o,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(S=>{S in n&&t.push(new et(o,n[S],`"${S}" is prohibited for ref layers`))}),h.layers.forEach(S=>{Yi(S.id)===x&&(w=S)}),w?w.ref?t.push(new et(o,n.ref,"ref cannot reference another ref layer")):_=Yi(w.type):t.push(new et(o,n.ref,`ref layer "${x}" not found`))}else if(_!=="background")if(n.source){const w=h.sources&&h.sources[n.source],S=w&&Yi(w.type);w?S==="vector"&&_==="raster"?t.push(new et(o,n.source,`layer "${n.id}" requires a raster source`)):S!=="raster-dem"&&_==="hillshade"||S!=="raster-dem"&&_==="color-relief"?t.push(new et(o,n.source,`layer "${n.id}" requires a raster-dem source`)):S==="raster"&&_!=="raster"?t.push(new et(o,n.source,`layer "${n.id}" requires a vector source`)):S!=="vector"||n["source-layer"]?S==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new et(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||S==="geojson"&&w.lineMetrics||t.push(new et(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new et(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new et(o,n.source,`source "${n.source}" not found`))}else t.push(new et(o,n,'missing required property "source"'));return t=t.concat(Pr({key:o,value:n,valueSpec:g.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:g.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Wl,layout:w=>Pr({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":S=>za(ln({layerType:_},S))}}),paint:w=>Pr({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":S=>Da(ln({layerType:_},S))}})}})),t}function Vr(r){const t=r.value,n=r.key,o=ii(t);return o!=="string"?[new et(n,t,`string expected, ${o} found`)]:[]}const Kl={promoteId:function({key:r,value:t}){if(ii(t)==="string")return Vr({key:r,value:t});{const n=[];for(const o in t)n.push(...Vr({key:`${r}.${o}`,value:t[o]}));return n}}};function Yu(r){const t=r.value,n=r.key,o=r.styleSpec,h=r.style,g=r.validateSpec;if(!t.type)return[new et(n,t,'"type" is required')];const _=Yi(t.type);let x;switch(_){case"vector":case"raster":return x=Pr({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Kl,validateSpec:g}),x;case"raster-dem":return x=function(w){var S;const k=(S=w.sourceName)!==null&&S!==void 0?S:"",M=w.value,j=w.styleSpec,G=j.source_raster_dem,q=w.style;let X=[];const Q=ii(M);if(M===void 0)return X;if(Q!=="object")return X.push(new et("source_raster_dem",M,`object expected, ${Q} found`)),X;const ne=Yi(M.encoding)==="custom",be=["redFactor","greenFactor","blueFactor","baseShift"],he=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const V in M)!ne&&be.includes(V)?X.push(new et(V,M[V],`In "${k}": "${V}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):G[V]?X=X.concat(w.validateSpec({key:V,value:M[V],valueSpec:G[V],validateSpec:w.validateSpec,style:q,styleSpec:j})):X.push(new et(V,M[V],`unknown property "${V}"`));return X}({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:g}),x;case"geojson":if(x=Pr({key:n,value:t,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:g,objectElementValidators:Kl}),t.cluster)for(const w in t.clusterProperties){const[S,k]=t.clusterProperties[w],M=typeof S=="string"?[S,["accumulated"],["get",w]]:S;x.push(...Ra({key:`${n}.${w}.map`,value:k,expressionContext:"cluster-map"})),x.push(...Ra({key:`${n}.${w}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return x;case"video":return Pr({key:n,value:t,valueSpec:o.source_video,style:h,validateSpec:g,styleSpec:o});case"image":return Pr({key:n,value:t,valueSpec:o.source_image,style:h,validateSpec:g,styleSpec:o});case"canvas":return[new et(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xo({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Hu(r){const t=r.value,n=r.styleSpec,o=n.light,h=r.style;let g=[];const _=ii(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new et("light",t,`object expected, ${_} found`)]),g;for(const x in t){const w=x.match(/^(.*)-transition$/);g=g.concat(w&&o[w[1]]&&o[w[1]].transition?r.validateSpec({key:x,value:t[x],valueSpec:n.transition,validateSpec:r.validateSpec,style:h,styleSpec:n}):o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new et(x,t[x],`unknown property "${x}"`)])}return g}function Na(r){const t=r.value,n=r.styleSpec,o=n.sky,h=r.style,g=ii(t);if(t===void 0)return[];if(g!=="object")return[new et("sky",t,`object expected, ${g} found`)];let _=[];for(const x in t)_=_.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],style:h,styleSpec:n}):[new et(x,t[x],`unknown property "${x}"`)]);return _}function Jl(r){const t=r.value,n=r.styleSpec,o=n.terrain,h=r.style;let g=[];const _=ii(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new et("terrain",t,`object expected, ${_} found`)]),g;for(const x in t)g=g.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new et(x,t[x],`unknown property "${x}"`)]);return g}function cl(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const h=[],g=[];for(const _ in n)n[_].id&&h.includes(n[_].id)&&t.push(new et(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),h.push(n[_].id),n[_].url&&g.includes(n[_].url)&&t.push(new et(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),g.push(n[_].url),t=t.concat(Pr({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Vr({key:o,value:n})}function Wu(r){return t=r.value,t&&t.constructor===Object?[]:[new et(r.key,r.value,`object expected, ${ii(r.value)} found`)];var t}const hl={"*":()=>[],array:ul,boolean:function(r){const t=r.value,n=r.key,o=ii(t);return o!=="boolean"?[new et(n,t,`boolean expected, ${o} found`)]:[]},number:vo,color:Hl,constants:$u,enum:xo,filter:Wl,function:La,layer:lr,object:Pr,source:Yu,light:Hu,sky:Na,terrain:Jl,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,h=r.style,g=ii(t);if(t===void 0)return[];if(g!=="object")return[new et("projection",t,`object expected, ${g} found`)];let _=[];for(const x in t)_=_.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],style:h,styleSpec:n}):[new et(x,t[x],`unknown property "${x}"`)]);return _},projectionDefinition:function(r){const t=r.key;let n=r.value;n=n instanceof String?n.valueOf():n;const o=ii(n);return o!=="array"||function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}(n)||function(h){return!!["interpolate","step","literal"].includes(h[0])}(n)?["array","string"].includes(o)?[]:[new et(t,n,`projection expected, invalid type "${o}" found`)]:[new et(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Vr,formatted:function(r){return Vr(r).length===0?[]:Ra(r)},resolvedImage:function(r){return Vr(r).length===0?[]:Ra(r)},padding:function(r){const t=r.key,n=r.value;if(ii(n)==="array"){if(n.length<1||n.length>4)return[new et(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let h=[];for(let g=0;g<n.length;g++)h=h.concat(r.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:r.validateSpec,valueSpec:o}));return h}return vo({key:t,value:n,valueSpec:{}})},numberArray:function(r){const t=r.key,n=r.value;if(ii(n)==="array"){const o={type:"number"};if(n.length<1)return[new et(t,n,"array length at least 1 expected, length 0 found")];let h=[];for(let g=0;g<n.length;g++)h=h.concat(r.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:r.validateSpec,valueSpec:o}));return h}return vo({key:t,value:n,valueSpec:{}})},colorArray:function(r){const t=r.key,n=r.value;if(ii(n)==="array"){if(n.length<1)return[new et(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let h=0;h<n.length;h++)o=o.concat(Hl({key:`${t}[${h}]`,value:n[h]}));return o}return Hl({key:t,value:n})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=ii(n),h=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new et(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<n.length;_+=2)g=g.concat(xo({key:`${t}[${_}]`,value:n[_],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(ul({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return g},sprite:cl,state:Wu};function dl(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=dl,n.expression&&_a(Yi(t))?La(r):n.expression&&nl(Zs(t))?Ra(r):n.type&&hl[n.type]?hl[n.type](r):Pr(ln({},r,{valueSpec:n.type?o[n.type]:n}))}function Oa(r){const t=r.value,n=r.key,o=Vr(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new et(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new et(n,t,'"glyphs" url must include a "{range}" token'))),o}function Mr(r,t=ve){let n=[];return n=n.concat(dl({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:dl,objectElementValidators:{glyphs:Oa,"*":()=>[]}})),r.constants&&(n=n.concat($u({key:"constants",value:r.constants}))),Ku(n)}function Gr(r){return function(t){return r({...t,validateSpec:dl})}}function Ku(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function Jn(r){return function(...t){return Ku(r.apply(this,t))}}Mr.source=Jn(Gr(Yu)),Mr.sprite=Jn(Gr(cl)),Mr.glyphs=Jn(Gr(Oa)),Mr.light=Jn(Gr(Hu)),Mr.sky=Jn(Gr(Na)),Mr.terrain=Jn(Gr(Jl)),Mr.state=Jn(Gr(Wu)),Mr.layer=Jn(Gr(lr)),Mr.filter=Jn(Gr(Wl)),Mr.paintProperty=Jn(Gr(Da)),Mr.layoutProperty=Jn(Gr(za));const Fa=Mr,Uc=Fa.light,fl=Fa.sky,Vc=Fa.paintProperty,Ql=Fa.layoutProperty;function bo(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new Pe(new Error(o.message))),n=!0;return n}class Ba{constructor(t,n,o){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let w=0;w<this.d*this.d;w++){const S=_[3+w],k=_[3+w+1];h.push(S===k?null:_.subarray(S,k))}const x=_[3+h.length+1];this.keys=_.subarray(_[3+h.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const g=o/n*t;this.min=-g,this.max=t+g}insert(t,n,o,h,g){this._forEachCell(n,o,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,h,g,_){this.cells[g].push(_)}query(t,n,o,h,g){const _=this.min,x=this.max;if(t<=_&&n<=_&&x<=o&&x<=h&&!g)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,n,o,h,this._queryCell,w,{},g),w}}_queryCell(t,n,o,h,g,_,x,w){const S=this.cells[g];if(S!==null){const k=this.keys,M=this.bboxes;for(let j=0;j<S.length;j++){const G=S[j];if(x[G]===void 0){const q=4*G;(w?w(M[q+0],M[q+1],M[q+2],M[q+3]):t<=M[q+2]&&n<=M[q+3]&&o>=M[q+0]&&h>=M[q+1])?(x[G]=!0,_.push(k[G])):x[G]=!1}}}}_forEachCell(t,n,o,h,g,_,x,w){const S=this._convertToCellCoord(t),k=this._convertToCellCoord(n),M=this._convertToCellCoord(o),j=this._convertToCellCoord(h);for(let G=S;G<=M;G++)for(let q=k;q<=j;q++){const X=this.d*q+G;if((!w||w(this._convertFromCellCoord(G),this._convertFromCellCoord(q),this._convertFromCellCoord(G+1),this._convertFromCellCoord(q+1)))&&g.call(this,t,n,o,h,X,_,x,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=n;for(let _=0;_<t.length;_++){const x=t[_];h[3+_]=g,h.set(x,g),g+=x.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Ba(t.buffer)}}const us={};function dt(r,t,n={}){if(us[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),us[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}dt("Object",Object),dt("Set",Set),dt("TransferableGridIndex",Ba),dt("Color",Ut),dt("Error",Error),dt("AJAXError",ce),dt("ResolvedImage",vn),dt("StylePropertyFunction",go),dt("StyleExpression",il,{omit:["_evaluator"]}),dt("ZoomDependentExpression",sl),dt("ZoomConstantExpression",mo),dt("CompoundExpression",Ti,{omit:["_evaluate"]});for(const r in _i)_i[r]._classRegistryKey||dt(`Expression_${r}`,_i[r]);function eu(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function wo(r){return r.$name||r.constructor._classRegistryKey}function tu(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=wo(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||eu(r)||Rr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function To(r,t){if(tu(r))return(eu(r)||Rr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const g=[];for(const _ of r)g.push(To(_,t));return g}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=wo(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!us[n])throw new Error(`${n} is not registered.`);const{klass:o}=us[n],h=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in r){if(!r.hasOwnProperty(g)||us[n].omit.indexOf(g)>=0)continue;const _=r[g];h[g]=us[n].shallow.indexOf(g)>=0?_:To(_,t)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}function ja(r){if(tu(r))return r;if(Array.isArray(r))return r.map(ja);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=wo(r)||"Object";if(!us[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=us[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const h of Object.keys(r)){if(h==="$name")continue;const g=r[h];o[h]=us[t].shallow.indexOf(h)>=0?g:ja(g)}return o}class iu{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const ni={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Hangul Syllables":r=>r>=44032&&r<=55215,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function nu(r){for(const t of r)if(ml(t.charCodeAt(0)))return!0;return!1}function Ju(r){for(const t of r)if(!qc(t.charCodeAt(0)))return!1;return!0}function pl(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Gc=pl(["Arab","Dupl","Mong","Ougr","Syrc"]);function qc(r){return!Gc.test(String.fromCodePoint(r))}const ru=pl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ml(r){return!(r!==746&&r!==747&&(r<4352||!(ni["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ni["CJK Compatibility"](r)||ni["CJK Strokes"](r)||!(!ni["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ni["Enclosed CJK Letters and Months"](r)||ni["Ideographic Description Characters"](r)||ni.Kanbun(r)||ni.Katakana(r)&&r!==12540||!(!ni["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ni["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ni["Vertical Forms"](r)||ni["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||ru.test(String.fromCodePoint(r)))))}function su(r){return!(ml(r)||function(t){return!!(ni["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ni["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ni["Letterlike Symbols"](t)||ni["Number Forms"](t)||ni["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ni["Control Pictures"](t)&&t!==9251||ni["Optical Character Recognition"](t)||ni["Enclosed Alphanumerics"](t)||ni["Geometric Shapes"](t)||ni["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ni["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ni["CJK Symbols and Punctuation"](t)||ni.Katakana(t)||ni["Private Use Area"](t)||ni["CJK Compatibility Forms"](t)||ni["Small Form Variants"](t)||ni["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const Qu=pl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Io(r){return Qu.test(String.fromCodePoint(r))}function $c(r,t){return!(!t&&Io(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ni.Khmer(r))}function au(r){for(const t of r)if(Io(t.charCodeAt(0)))return!0;return!1}const Xs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(Xs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return u(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const n=r.pluginURL,o=new Promise(g=>{this.loadScriptResolve=g});t(n);const h=new Promise(g=>setTimeout(()=>g(),this.TIMEOUT));if(yield Promise.race([o,h]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:n};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class Fi{constructor(t,n){this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new iu,this.transition=n.transition||{},this.globalState=n.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new iu,this.transition={},this.globalState={})}isSupportedScript(t){return function(n,o){for(const h of n)if(!$c(h.charCodeAt(0),o))return!1;return!0}(t,Xs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class So{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,h){if(_a(o))return new go(o,h);if(nl(o)){const g=Zl(o,h);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return h.type==="color"&&typeof o=="string"?g=Ut.parse(o):h.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?h.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?h.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?g=Yt.parse(o):h.type==="projectionDefinition"&&typeof o=="string"&&(g=$t.parse(o)):g=un.parse(o):g=rn.parse(o):g=Xi.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>g}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class gl{constructor(t){this.property=t,this.value=new So(t,void 0)}transitioned(t,n){return new ec(this.property,this.value,n,yt({},t.transition,this.transition),t.now)}untransitioned(){return new ec(this.property,this.value,null,{},0)}}class ou{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return tn(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new gl(this._values[t].property)),this._values[t].value=new So(this._values[t].property,n===null?void 0:tn(n))}getTransition(t){return tn(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new gl(this._values[t].property)),this._values[t].transition=tn(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const h=this.getTransition(n);h!==void 0&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){const o=new tc(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(t,n._values[h]);return o}untransitioned(){const t=new tc(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ec{constructor(t,n,o,h,g){this.property=t,this.value=n,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const h=t.now||0,g=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(t,n,o);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),g,hr(x))}}return g}}class tc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const h=new _l(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,o);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Zc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return tn(this._values[t].value)}setValue(t,n){this._values[t]=new So(this._values[t].property,n===null?void 0:tn(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const h=new _l(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,o);return h}}class cs{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,h){return this.property.evaluate(this.value,this.parameters,t,n,o,h)}}class _l{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class _t{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const h=Ai[this.specification.type];return h?h(t,n,o):t}}class zt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,h){return new cs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,h)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new cs(this,{kind:"constant",value:void 0},t.parameters);const h=Ai[this.specification.type];if(h){const g=h(t.value.value,n.value.value,o);return new cs(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,o,h,g,_){return t.kind==="constant"?t.value:t.evaluate(n,o,h,g,_)}}class yl extends zt{possiblyEvaluate(t,n,o,h){if(t.value===void 0)return new cs(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,h),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,x=this._calculate(_,_,_,n);return new cs(this,{kind:"constant",value:x},n)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new cs(this,{kind:"constant",value:g},n)}return new cs(this,t.expression,n)}evaluate(t,n,o,h,g,_){if(t.kind==="source"){const x=t.evaluate(n,o,h,g,_);return this._calculate(x,x,x,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,h),t.evaluate({zoom:Math.floor(n.zoom)},o,h),t.evaluate({zoom:Math.floor(n.zoom)+1},o,h),n):t.value}_calculate(t,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class lu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,h);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new Fi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Fi(Math.floor(n.zoom),n)),t.expression.evaluate(new Fi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Eo{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,h){return!!t.expression.evaluate(n,null,{},o,h)}interpolate(){return!1}}class Qn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new So(o,void 0),g=this.defaultTransitionablePropertyValues[n]=new gl(o);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}dt("DataDrivenProperty",zt),dt("DataConstantProperty",_t),dt("CrossFadedDataDrivenProperty",yl),dt("CrossFadedProperty",lu),dt("ColorRampProperty",Eo);const ic="-transition";class Rn extends Ze{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=$s(t.filter)),n.layout&&(this._unevaluatedLayout=new Zc(n.layout)),n.paint)){this._transitionablePaint=new ou(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _l(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=$s(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const h of o.getGlobalStateRefs())t.add(h)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Ql,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(ic)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Vc,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(ic))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,x,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Yn(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,h,g={}){return(!g||g.validate!==!1)&&bo(this,t.call(Fa,{key:n,layerType:this.type,objectKey:o,value:h,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof cs&&ls(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const nc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ya{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hi(r,t=1){let n=0,o=0;return{members:r.map(h=>{const g=nc[h.type].BYTES_PER_ELEMENT,_=n=rc(n,Math.max(t,g)),x=h.components||1;return o=Math.max(o,g),n+=g*x,{name:h.name,type:h.type,components:x,offset:_}}),size:rc(n,Math.max(o,t)),alignment:t}}function rc(r,t){return Math.ceil(r/t)*t}class Ys extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.int16[h+0]=n,this.int16[h+1]=o,t}}Ys.prototype.bytesPerElement=4,dt("StructArrayLayout2i4",Ys);class Hs extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=h,t}}Hs.prototype.bytesPerElement=6,dt("StructArrayLayout3i6",Hs);class uu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h)}emplace(t,n,o,h,g){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=h,this.int16[_+3]=g,t}}uu.prototype.bytesPerElement=8,dt("StructArrayLayout4i8",uu);class vl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,x){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=_,this.int16[w+5]=x,t}}vl.prototype.bytesPerElement=12,dt("StructArrayLayout2i4i12",vl);class va extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,x){const w=4*t,S=8*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[S+4]=h,this.uint8[S+5]=g,this.uint8[S+6]=_,this.uint8[S+7]=x,t}}va.prototype.bytesPerElement=8,dt("StructArrayLayout2i4ub8",va);class ko extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.float32[h+0]=n,this.float32[h+1]=o,t}}ko.prototype.bytesPerElement=8,dt("StructArrayLayout2f8",ko);class cu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,x,w,S,k){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,h,g,_,x,w,S,k)}emplace(t,n,o,h,g,_,x,w,S,k,M){const j=10*t;return this.uint16[j+0]=n,this.uint16[j+1]=o,this.uint16[j+2]=h,this.uint16[j+3]=g,this.uint16[j+4]=_,this.uint16[j+5]=x,this.uint16[j+6]=w,this.uint16[j+7]=S,this.uint16[j+8]=k,this.uint16[j+9]=M,t}}cu.prototype.bytesPerElement=20,dt("StructArrayLayout10ui20",cu);class xl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,x,w,S,k,M,j){const G=this.length;return this.resize(G+1),this.emplace(G,t,n,o,h,g,_,x,w,S,k,M,j)}emplace(t,n,o,h,g,_,x,w,S,k,M,j,G){const q=12*t;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=h,this.int16[q+3]=g,this.uint16[q+4]=_,this.uint16[q+5]=x,this.uint16[q+6]=w,this.uint16[q+7]=S,this.int16[q+8]=k,this.int16[q+9]=M,this.int16[q+10]=j,this.int16[q+11]=G,t}}xl.prototype.bytesPerElement=24,dt("StructArrayLayout4i4ui4i24",xl);class hu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=h,t}}hu.prototype.bytesPerElement=12,dt("StructArrayLayout3f12",hu);class p extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}p.prototype.bytesPerElement=4,dt("StructArrayLayout1ul4",p);class e extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,x,w,S){const k=this.length;return this.resize(k+1),this.emplace(k,t,n,o,h,g,_,x,w,S)}emplace(t,n,o,h,g,_,x,w,S,k){const M=10*t,j=5*t;return this.int16[M+0]=n,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+3]=g,this.int16[M+4]=_,this.int16[M+5]=x,this.uint32[j+3]=w,this.uint16[M+8]=S,this.uint16[M+9]=k,t}}e.prototype.bytesPerElement=20,dt("StructArrayLayout6i1ul2ui20",e);class i extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,x){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=_,this.int16[w+5]=x,t}}i.prototype.bytesPerElement=12,dt("StructArrayLayout2i2i2i12",i);class l extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,h,g)}emplace(t,n,o,h,g,_){const x=4*t,w=8*t;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=h,this.int16[w+6]=g,this.int16[w+7]=_,t}}l.prototype.bytesPerElement=16,dt("StructArrayLayout2f1f2i16",l);class c extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,x){const w=16*t,S=4*t,k=8*t;return this.uint8[w+0]=n,this.uint8[w+1]=o,this.float32[S+1]=h,this.float32[S+2]=g,this.int16[k+6]=_,this.int16[k+7]=x,t}}c.prototype.bytesPerElement=16,dt("StructArrayLayout2ub2f2i16",c);class m extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=o,this.uint16[g+2]=h,t}}m.prototype.bytesPerElement=6,dt("StructArrayLayout3ui6",m);class y extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne){const be=this.length;return this.resize(be+1),this.emplace(be,t,n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne)}emplace(t,n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne,be){const he=24*t,V=12*t,J=48*t;return this.int16[he+0]=n,this.int16[he+1]=o,this.uint16[he+2]=h,this.uint16[he+3]=g,this.uint32[V+2]=_,this.uint32[V+3]=x,this.uint32[V+4]=w,this.uint16[he+10]=S,this.uint16[he+11]=k,this.uint16[he+12]=M,this.float32[V+7]=j,this.float32[V+8]=G,this.uint8[J+36]=q,this.uint8[J+37]=X,this.uint8[J+38]=Q,this.uint32[V+10]=ne,this.int16[he+22]=be,t}}y.prototype.bytesPerElement=48,dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class b extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne,be,he,V,J,pe,Ne,Xe,je,Ge,Ke,He){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,t,n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne,be,he,V,J,pe,Ne,Xe,je,Ge,Ke,He)}emplace(t,n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne,be,he,V,J,pe,Ne,Xe,je,Ge,Ke,He,Qe){const $e=32*t,gt=16*t;return this.int16[$e+0]=n,this.int16[$e+1]=o,this.int16[$e+2]=h,this.int16[$e+3]=g,this.int16[$e+4]=_,this.int16[$e+5]=x,this.int16[$e+6]=w,this.int16[$e+7]=S,this.uint16[$e+8]=k,this.uint16[$e+9]=M,this.uint16[$e+10]=j,this.uint16[$e+11]=G,this.uint16[$e+12]=q,this.uint16[$e+13]=X,this.uint16[$e+14]=Q,this.uint16[$e+15]=ne,this.uint16[$e+16]=be,this.uint16[$e+17]=he,this.uint16[$e+18]=V,this.uint16[$e+19]=J,this.uint16[$e+20]=pe,this.uint16[$e+21]=Ne,this.uint16[$e+22]=Xe,this.uint32[gt+12]=je,this.float32[gt+13]=Ge,this.float32[gt+14]=Ke,this.uint16[$e+30]=He,this.uint16[$e+31]=Qe,t}}b.prototype.bytesPerElement=64,dt("StructArrayLayout8i15ui1ul2f2ui64",b);class T extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}T.prototype.bytesPerElement=4,dt("StructArrayLayout1f4",T);class E extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=o,this.float32[g+2]=h,t}}E.prototype.bytesPerElement=12,dt("StructArrayLayout1ui2f12",E);class C extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=o,this.uint16[g+3]=h,t}}C.prototype.bytesPerElement=8,dt("StructArrayLayout1ul2ui8",C);class z extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=o,t}}z.prototype.bytesPerElement=4,dt("StructArrayLayout2ui4",z);class R extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}R.prototype.bytesPerElement=2,dt("StructArrayLayout1ui2",R);class U extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h)}emplace(t,n,o,h,g){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=h,this.float32[_+3]=g,t}}U.prototype.bytesPerElement=16,dt("StructArrayLayout4f16",U);class Z extends ya{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Te(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class te extends e{get(t){return new Z(this,t)}}dt("CollisionBoxArray",te);class ee extends ya{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ee.prototype.size=48;class ie extends y{get(t){return new ee(this,t)}}dt("PlacedSymbolArray",ie);class se extends ya{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}se.prototype.size=64;class fe extends b{get(t){return new se(this,t)}}dt("SymbolInstanceArray",fe);class oe extends T{getoffsetX(t){return this.float32[1*t+0]}}dt("GlyphOffsetArray",oe);class ge extends Hs{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}dt("SymbolLineVertexArray",ge);class ye extends ya{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ye.prototype.size=12;class ue extends E{get(t){return new ye(this,t)}}dt("TextAnchorOffsetArray",ue);class Se extends ya{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Se.prototype.size=8;class Fe extends C{get(t){return new Se(this,t)}}dt("FeatureIndexArray",Fe);class Re extends Ys{}class De extends Ys{}class Be extends Ys{}class at extends vl{}class it extends va{}class Ye extends ko{}class mt extends cu{}class Wt extends xl{}class xi extends hu{}class Vi extends p{}class Si extends i{}class Gi extends c{}class Ci extends m{}class Ei extends z{}const Pi=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dn}=Pi;class di{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,h){const g=this.segments[this.segments.length-1];return t>di.MAX_VERTEX_ARRAY_LENGTH&&nn(`Max vertices per segment is ${di.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${di.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+t>di.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h?this.createNewSegment(n,o,h):g}createNewSegment(t,n,o){const h={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,h){return new di([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Tn(r,t){return 256*(r=ji(Math.floor(r),0,255))+ji(Math.floor(t),0,255)}di.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dt("SegmentVector",di);const zn=Hi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ws,Ks,Js,hs={exports:{}},Co={exports:{}},Po={exports:{}},Ua=function(){if(Js)return hs.exports;Js=1;var r=(Ws||(Ws=1,Co.exports=function(n,o){var h,g,_,x,w,S,k,M;for(g=n.length-(h=3&n.length),_=o,w=3432918353,S=461845907,M=0;M<g;)k=255&n.charCodeAt(M)|(255&n.charCodeAt(++M))<<8|(255&n.charCodeAt(++M))<<16|(255&n.charCodeAt(++M))<<24,++M,_=27492+(65535&(x=5*(65535&(_=(_^=k=(65535&(k=(k=(65535&k)*w+(((k>>>16)*w&65535)<<16)&4294967295)<<15|k>>>17))*S+(((k>>>16)*S&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(k=0,h){case 3:k^=(255&n.charCodeAt(M+2))<<16;case 2:k^=(255&n.charCodeAt(M+1))<<8;case 1:_^=k=(65535&(k=(k=(65535&(k^=255&n.charCodeAt(M)))*w+(((k>>>16)*w&65535)<<16)&4294967295)<<15|k>>>17))*S+(((k>>>16)*S&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Co.exports),t=(Ks||(Ks=1,Po.exports=function(n,o){for(var h,g=n.length,_=o^g,x=0;g>=4;)h=1540483477*(65535&(h=255&n.charCodeAt(x)|(255&n.charCodeAt(++x))<<8|(255&n.charCodeAt(++x))<<16|(255&n.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++x;switch(g){case 3:_^=(255&n.charCodeAt(x+2))<<16;case 2:_^=(255&n.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Po.exports);return hs.exports=r,hs.exports.murmur3=r,hs.exports.murmur2=t,hs.exports}(),ur=Le(Ua);class qr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,h){this.ids.push(Qs(t)),this.positions.push(n,o,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Qs(t);let o=0,h=this.ids.length-1;for(;o<h;){const _=o+h>>1;this.ids[_]>=n?h=_:o=_+1}const g=[];for(;this.ids[o]===n;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(t,n){const o=new Float64Array(t.ids),h=new Uint32Array(t.positions);return xa(o,h,0,o.length-1),n&&n.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(t){const n=new qr;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Qs(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ur(String(r))}function xa(r,t,n,o){for(;n<o;){const h=r[n+o>>1];let g=n-1,_=o+1;for(;;){do g++;while(r[g]<h);do _--;while(r[_]>h);if(g>=_)break;en(r,g,_),en(t,3*g,3*_),en(t,3*g+1,3*_+1),en(t,3*g+2,3*_+2)}_-n<o-_?(xa(r,t,n,_),n=_+1):(xa(r,t,_+1,o),o=_)}}function en(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}dt("FeaturePositionMap",qr);class zi{constructor(t,n){this.gl=t.gl,this.location=n}}class er extends zi{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class pn extends zi{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class sc extends zi{constructor(t,n){super(t,n),this.current=Ut.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Xc=new Float32Array(16);function du(r){return[Tn(255*r.r,255*r.g),Tn(255*r.b,255*r.a)]}class Mo{constructor(t,n,o){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new sc(t,n):new er(t,n)}}class Va{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new pn(t,n):new er(t,n)}}class As{constructor(t,n,o,h){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,o,h,g){const _=this.paintVertexArray.length,x=this.expression.evaluate(new Fi(0),n,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,x)}updatePaintArray(t,n,o,h){const g=this.expression.evaluate({zoom:0},o,h);this._setPaintValue(t,n,g)}_setPaintValue(t,n,o){if(this.type==="color"){const h=du(o);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nn{constructor(t,n,o,h,g,_){this.expression=t,this.uniformNames=n.map(x=>`u_${x}_t`),this.type=o,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,n,o,h,g){const _=this.expression.evaluate(new Fi(this.zoom),n,{},h,[],g),x=this.expression.evaluate(new Fi(this.zoom+1),n,{},h,[],g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,_,x)}updatePaintArray(t,n,o,h){const g=this.expression.evaluate({zoom:this.zoom},o,h),_=this.expression.evaluate({zoom:this.zoom+1},o,h);this._setPaintValue(t,n,g,_)}_setPaintValue(t,n,o,h){if(this.type==="color"){const g=du(o),_=du(h);for(let x=t;x<n;x++)this.paintVertexArray.emplace(x,g[0],g[1],_[0],_[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=ji(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,o){return new er(t,n)}}class Ls{constructor(t,n,o,h,g,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,h,g){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(t,n,o,h){if(!h||!o)return;const{min:g,mid:_,max:x}=o,w=h[g],S=h[_],k=h[x];if(w&&S&&k)for(let M=t;M<n;M++)this.zoomInPaintVertexArray.emplace(M,S.tl[0],S.tl[1],S.br[0],S.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],S.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,S.tl[0],S.tl[1],S.br[0],S.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],S.pixelRatio,k.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,zn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,zn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fu{constructor(t,n,o){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!o(g))continue;const _=t.paint.get(g);if(!(_ instanceof cs&&ls(_.property.specification)))continue;const x=pu(g,t.type),w=_.value,S=_.property.specification.type,k=_.property.useIntegerZoom,M=_.property.specification["property-type"],j=M==="cross-faded"||M==="cross-faded-data-driven";if(w.kind==="constant")this.binders[g]=j?new Va(w.value,x):new Mo(w.value,x,S),h.push(`/u_${g}`);else if(w.kind==="source"||j){const G=mu(g,S,"source");this.binders[g]=j?new Ls(w,S,k,n,G,t.id):new As(w,x,S,G),h.push(`/a_${g}`)}else{const G=mu(g,S,"composite");this.binders[g]=new Nn(w,x,S,k,n,G),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof As||n instanceof Nn?n.maxValue:0}populatePaintArrays(t,n,o,h,g){for(const _ in this.binders){const x=this.binders[_];(x instanceof As||x instanceof Nn||x instanceof Ls)&&x.populatePaintArray(t,n,o,h,g)}}setConstantPatternPositions(t,n){for(const o in this.binders){const h=this.binders[o];h instanceof Va&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,h,g){let _=!1;for(const x in t){const w=n.getPositions(x);for(const S of w){const k=o.feature(S.index);for(const M in this.binders){const j=this.binders[M];if((j instanceof As||j instanceof Nn||j instanceof Ls)&&j.expression.isStateDependent===!0){const G=h.paint.get(M);j.expression=G.value,j.updatePaintArray(S.start,S.end,k,t[x],g),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Mo||o instanceof Va)&&t.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof As||o instanceof Nn)for(let h=0;h<o.paintVertexAttributes.length;h++)t.push(o.paintVertexAttributes[h].name);else if(o instanceof Ls)for(let h=0;h<zn.members.length;h++)t.push(zn.members[h].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Mo||o instanceof Va||o instanceof Nn)for(const h of o.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof Mo||g instanceof Va||g instanceof Nn){for(const _ of g.uniformNames)if(n[_]){const x=g.getBinding(t,n[_],_);o.push({name:_,property:h,binding:x})}}}return o}setUniforms(t,n,o,h){for(const{name:g,property:_,binding:x}of n)this.binders[_].setUniform(x,h,o.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Ls){const h=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof As||o instanceof Nn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof As||o instanceof Nn||o instanceof Ls)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof As||n instanceof Nn||n instanceof Ls)&&n.destroy()}}}class ea{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new fu(h,n,o);this.needsUpload=!1,this._featureMap=new qr,this._bufferOffset=0}populatePaintArrays(t,n,o,h,g,_){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,n,h,g,_);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,h){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function pu(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function mu(r,t,n){const o={color:{source:ko,composite:U},number:{source:T,composite:ko}},h=function(g){return{"line-pattern":{source:mt,composite:mt},"fill-pattern":{source:mt,composite:mt},"fill-extrusion-pattern":{source:mt,composite:mt}}[g]}(r);return h&&h[n]||o[t][n]}dt("ConstantBinder",Mo),dt("CrossFadedConstantBinder",Va),dt("SourceExpressionBinder",As),dt("CrossFadedCompositeBinder",Ls),dt("CompositeExpressionBinder",Nn),dt("ProgramConfiguration",fu,{omit:["_buffers"]}),dt("ProgramConfigurationSet",ea);const Ao=Math.pow(2,14)-1,td=-Ao-1;function Lo(r){const t=jt/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const h=n[o];for(let g=0;g<h.length;g++){const _=h[g],x=Math.round(_.x*t),w=Math.round(_.y*t);_.x=ji(x,td,Ao),_.y=ji(w,td,Ao),(x<_.x||x>_.x+1||w<_.y||w>_.y+1)&&nn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ro(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Lo(r):[]}}const id=-32768;function Wp(r,t,n,o,h){r.emplaceBack(id+8*t+o,id+8*n+h)}class Yc{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new De,this.indexArray=new Ci,this.segments=new di,this.programConfigurations=new ea(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const h=this.layers[0],g=[];let _=null,x=!1,w=h.type==="heatmap";if(h.type==="circle"){const k=h;_=k.layout.get("circle-sort-key"),x=!_.isConstant(),w=w||k.paint.get("circle-pitch-alignment")==="map"}const S=w?n.subdivisionGranularity.circle:1;for(const{feature:k,id:M,index:j,sourceLayerIndex:G}of t){const q=this.layers[0]._featureFilter.needGeometry,X=Ro(k,q);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom,{globalState:this.globalState}),X,o))continue;const Q=x?_.evaluate(X,{},o):void 0,ne={id:M,properties:k.properties,type:k.type,sourceLayerIndex:G,index:j,geometry:q?X.geometry:Lo(k),patterns:{},sortKey:Q};g.push(ne)}x&&g.sort((k,M)=>k.sortKey-M.sortKey);for(const k of g){const{geometry:M,index:j,sourceLayerIndex:G}=k,q=t[j].feature;this.addFeature(k,M,j,o,S),n.featureIndex.insert(q,M,j,G,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,h,g=1){let _;switch(g){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const x=_.length;for(const w of n)for(const S of w){const k=S.x,M=S.y;if(k<0||k>=jt||M<0||M>=jt)continue;const j=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,t.sortKey),G=j.vertexLength;for(let q=0;q<x;q++)for(let X=0;X<x;X++)Wp(this.layoutVertexArray,k,M,_[X],_[q]);for(let q=0;q<x-1;q++)for(let X=0;X<x-1;X++){const Q=G+q*x+X,ne=G+(q+1)*x+X;this.indexArray.emplaceBack(Q,ne+1,Q+1),this.indexArray.emplaceBack(Q,ne,ne+1)}j.vertexLength+=x*x,j.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},h)}}function nd(r,t){for(let n=0;n<r.length;n++)if(bl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(bl(r,t[n]))return!0;return!!Hc(r,t)}function Kp(r,t,n){return!!bl(r,t)||!!Wc(t,r,n)}function rd(r,t){if(r.length===1)return ad(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let h=0;h<o.length;h++)if(bl(r,o[h]))return!0}for(let n=0;n<r.length;n++)if(ad(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Hc(r,t[n]))return!0;return!1}function Jp(r,t,n){if(r.length>1){if(Hc(r,t))return!0;for(let o=0;o<t.length;o++)if(Wc(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Wc(r[o],t,n))return!0;return!1}function Hc(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],h=r[n+1];for(let g=0;g<t.length-1;g++)if(Qp(o,h,t[g],t[g+1]))return!0}return!1}function Qp(r,t,n,o){return Hn(r,n,o)!==Hn(t,n,o)&&Hn(r,t,n)!==Hn(r,t,o)}function Wc(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let h=1;h<t.length;h++)if(sd(r,t[h-1],t[h])<o)return!0;return!1}function sd(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const h=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function ad(r,t){let n,o,h,g=!1;for(let _=0;_<r.length;_++){n=r[_];for(let x=0,w=n.length-1;x<n.length;w=x++)o=n[x],h=n[w],o.y>t.y!=h.y>t.y&&t.x<(h.x-o.x)*(t.y-o.y)/(h.y-o.y)+o.x&&(g=!g)}return g}function bl(r,t){let n=!1;for(let o=0,h=r.length-1;o<r.length;h=o++){const g=r[o],_=r[h];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function em(r,t,n){const o=n[0],h=n[2];if(r.x<o.x&&t.x<o.x||r.x>h.x&&t.x>h.x||r.y<o.y&&t.y<o.y||r.y>h.y&&t.y>h.y)return!1;const g=Hn(r,t,n[0]);return g!==Hn(r,t,n[1])||g!==Hn(r,t,n[2])||g!==Hn(r,t,n[3])}function gu(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function ac(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function oc(r,t,n,o,h){if(!t[0]&&!t[1])return r;const g=Te.convert(t)._mult(h);n==="viewport"&&g._rotate(-o);const _=[];for(let x=0;x<r.length;x++)_.push(r[x].sub(g));return _}let od,ld;dt("CircleBucket",Yc,{omit:["layers"]});var tm={get paint(){return ld=ld||new Qn({"circle-radius":new zt(ve.paint_circle["circle-radius"]),"circle-color":new zt(ve.paint_circle["circle-color"]),"circle-blur":new zt(ve.paint_circle["circle-blur"]),"circle-opacity":new zt(ve.paint_circle["circle-opacity"]),"circle-translate":new _t(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return od=od||new Qn({"circle-sort-key":new zt(ve.layout_circle["circle-sort-key"])})}};class im extends Rn{constructor(t){super(t,tm)}createBucket(t){return new Yc(t)}queryRadius(t){const n=t;return gu("circle-radius",this,n)+gu("circle-stroke-width",this,n)+ac(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:h,transform:g,pixelsToTileUnits:_,unwrappedTileID:x,getElevation:w}){const S=oc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,_),k=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),M=this.paint.get("circle-pitch-alignment")==="map",j=M?S:function(q,X,Q,ne){return q.map(be=>ud(be,X,Q,ne))}(S,g,x,w),G=M?k*_:k;for(const q of h)for(const X of q){const Q=M?X:ud(X,g,x,w);let ne=G;const be=g.projectTileCoordinates(X.x,X.y,x,w).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ne*=be/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ne*=g.cameraToCenterDistance/be),Kp(j,Q,ne))return!0}return!1}}function ud(r,t,n,o){const h=t.projectTileCoordinates(r.x,r.y,n,o).point;return new Te((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}class cd extends Yc{}let hd;dt("HeatmapBucket",cd,{omit:["layers"]});var nm={get paint(){return hd=hd||new Qn({"heatmap-radius":new zt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eo(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(ve.paint_heatmap["heatmap-opacity"])})}};function Kc(r,{width:t,height:n},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*n*o}`)}else h=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=h,r}function dd(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const h=Kc({},{width:t,height:n},o);Jc(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=h.data}function Jc(r,t,n,o,h,g){if(h.width===0||h.height===0)return t;if(h.width>r.width||h.height>r.height||n.x>r.width-h.width||n.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||o.x>t.width-h.width||o.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=r.data,x=t.data;if(_===x)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){const S=((n.y+w)*r.width+n.x)*g,k=((o.y+w)*t.width+o.x)*g;for(let M=0;M<h.width*g;M++)x[k+M]=_[S+M]}return t}class _u{constructor(t,n){Kc(this,t,1,n)}resize(t){dd(this,t,1)}clone(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,h,g){Jc(t,n,o,h,g,1)}}class wr{constructor(t,n){Kc(this,t,4,n)}resize(t){dd(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,h,g){Jc(t,n,o,h,g,4)}setPixel(t,n,o){const h=4*(t*this.width+n);this.data[h+0]=Math.round(255*o.r/o.a),this.data[h+1]=Math.round(255*o.g/o.a),this.data[h+2]=Math.round(255*o.b/o.a),this.data[h+3]=Math.round(255*o.a)}}function fd(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,h=r.image||new wr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(_,x,w)=>{t[r.evaluationKey]=w;const S=r.expression.evaluate(t);h.setPixel(_/4/n,x/4,S)};if(r.clips)for(let _=0,x=0;_<o;++_,x+=4*n)for(let w=0,S=0;w<n;w++,S+=4){const k=w/(n-1),{start:M,end:j}=r.clips[_];g(x,S,M*(1-k)+j*k)}else for(let _=0,x=0;_<n;_++,x+=4)g(0,x,_/(n-1));return h}dt("AlphaImage",_u),dt("RGBAImage",wr);const Qc="big-fb";class rm extends Rn{createBucket(t){return new cd(t)}constructor(t){super(t,nm),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Qc)&&this.heatmapFbos.delete(Qc)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let pd;var sm={get paint(){return pd=pd||new Qn({"hillshade-illumination-direction":new _t(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new _t(ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new _t(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new _t(ve.paint_hillshade["hillshade-method"])})}};class am extends Rn{constructor(t){super(t,sm),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const g=Math.max(t.length,n.length,o.length,h.length);t=t.concat(Array(g-t.length).fill(t.at(-1))),n=n.concat(Array(g-n.length).fill(n.at(-1))),o=o.concat(Array(g-o.length).fill(o.at(-1))),h=h.concat(Array(g-h.length).fill(h.at(-1)));const _=n.map(Mn);return{directionRadians:t.map(Mn),altitudeRadians:_,shadowColor:h,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let md;var om={get paint(){return md=md||new Qn({"color-relief-opacity":new _t(ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Eo(ve["paint_color-relief"]["color-relief-color"])})}};class eh{constructor(t,n,o,h){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,h)}update(t,n,o){const{width:h,height:g}=t,_=!(this.size&&this.size[0]===h&&this.size[1]===g||o),{context:x}=this,{gl:w}=x;if(this.useMipmap=!!(n&&n.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[h,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Rr(t)?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,t):w.texImage2D(w.TEXTURE_2D,0,this.format,h,g,0,this.format,w.UNSIGNED_BYTE,t.data);else{const{x:S,y:k}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Rr(t)?w.texSubImage2D(w.TEXTURE_2D,0,S,k,w.RGBA,w.UNSIGNED_BYTE,t):w.texSubImage2D(w.TEXTURE_2D,0,S,k,h,g,w.RGBA,w.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,o){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),o!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class gd{constructor(t,n,o,h=1,g=1,_=1,x=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void nn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const w=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=_,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<w;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(w,S)]=this.data[this._idx(w-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,w)]=this.data[this._idx(S,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<w;S++)for(let k=0;k<w;k++){const M=this.get(S,k);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,n){const o=new Uint8Array(this.data.buffer),h=4*this._idx(t,n);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return _d(t,this.getUnpackVector())}getPixels(){return new wr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,_=o*this.dim,x=o*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(o){case-1:_=x-1;break;case 1:x=_+1}const w=-n*this.dim,S=-o*this.dim;for(let k=_;k<x;k++)for(let M=h;M<g;M++)this.data[this._idx(M,k)]=t.data[this._idx(M+w,k+S)]}}function _d(r,t){const n=t[0],o=t[1],h=t[2],g=t[3],_=Math.min(n,o,h),x=Math.round((r+g)/_);return{r:Math.floor(x*_/n)%256,g:Math.floor(x*_/o)%256,b:Math.floor(x*_/h)%256}}dt("DEMData",gd);class lm extends Rn{constructor(t){super(t,om)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof mo&&o._styleExpression.expression instanceof Ln){this.colorRampExpression=o;const _=o._styleExpression.expression;n.elevationStops=_.labels,n.colorStops=[];for(const x of n.elevationStops)n.colorStops.push(_.evaluate({globals:{elevation:x}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Ut.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const h={elevationStops:[],colorStops:[]},g=(n.elevationStops.length-1)/(t-1);for(let _=0;_<n.elevationStops.length-.5;_+=g)h.elevationStops.push(n.elevationStops[Math.round(_)]),h.colorStops.push(n.colorStops[Math.round(_)]);return nn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(n),g=new wr({width:h.colorStops.length,height:1}),_=new wr({width:h.colorStops.length,height:1});for(let x=0;x<h.elevationStops.length;x++){const w=_d(h.elevationStops[x],o);_.setPixel(0,x,new Ut(w.r/255,w.g/255,w.b/255,1)),g.setPixel(0,x,h.colorStops[x])}return this.colorRampTextures={elevationTexture:new eh(t,_,t.gl.RGBA),colorTexture:new eh(t,g,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const um=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:cm}=um;function th(r,t,n){const o=n.patternDependencies;let h=!1;for(const g of t){const _=g.paint.get(`${r}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,o[x.to]=!0,o[x.from]=!0)}return h}function ih(r,t,n,o,h){const g=h.patternDependencies;for(const _ of t){const x=_.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:o-1},n,{},h.availableImages),S=x.evaluate({zoom:o},n,{},h.availableImages),k=x.evaluate({zoom:o+1},n,{},h.availableImages);w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,k=k&&k.name?k.name:k,g[w]=!0,g[S]=!0,g[k]=!0,n.patterns[_.id]={min:w,mid:S,max:k}}}return n}function yd(r,t,n,o,h){let g;if(h===function(_,x,w,S){let k=0;for(let M=x,j=w-S;M<w;M+=S)k+=(_[j]-_[M])*(_[M+1]+_[j+1]),j=M;return k}(r,t,n,o)>0)for(let _=t;_<n;_+=o)g=wd(_/o|0,r[_],r[_+1],g);else for(let _=n-o;_>=t;_-=o)g=wd(_/o|0,r[_],r[_+1],g);return g&&wl(g,g.next)&&(bu(g),g=g.next),g}function Do(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!wl(o,o.next)&&sn(o.prev,o,o.next)!==0)o=o.next;else{if(bu(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function yu(r,t,n,o,h,g,_){if(!r)return;!_&&g&&function(w,S,k,M){let j=w;do j.z===0&&(j.z=nh(j.x,j.y,S,k,M)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==w);j.prevZ.nextZ=null,j.prevZ=null,function(G){let q,X=1;do{let Q,ne=G;G=null;let be=null;for(q=0;ne;){q++;let he=ne,V=0;for(let pe=0;pe<X&&(V++,he=he.nextZ,he);pe++);let J=X;for(;V>0||J>0&&he;)V!==0&&(J===0||!he||ne.z<=he.z)?(Q=ne,ne=ne.nextZ,V--):(Q=he,he=he.nextZ,J--),be?be.nextZ=Q:G=Q,Q.prevZ=be,be=Q;ne=he}be.nextZ=null,X*=2}while(q>1)}(j)}(r,o,h,g);let x=r;for(;r.prev!==r.next;){const w=r.prev,S=r.next;if(g?dm(r,o,h,g):hm(r))t.push(w.i,r.i,S.i),bu(r),r=S.next,x=S.next;else if((r=S)===x){_?_===1?yu(r=fm(Do(r),t),t,n,o,h,g,2):_===2&&pm(r,t,n,o,h,g):yu(Do(r),t,n,o,h,g,1);break}}}function hm(r){const t=r.prev,n=r,o=r.next;if(sn(t,n,o)>=0)return!1;const h=t.x,g=n.x,_=o.x,x=t.y,w=n.y,S=o.y,k=Math.min(h,g,_),M=Math.min(x,w,S),j=Math.max(h,g,_),G=Math.max(x,w,S);let q=o.next;for(;q!==t;){if(q.x>=k&&q.x<=j&&q.y>=M&&q.y<=G&&vu(h,x,g,w,_,S,q.x,q.y)&&sn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function dm(r,t,n,o){const h=r.prev,g=r,_=r.next;if(sn(h,g,_)>=0)return!1;const x=h.x,w=g.x,S=_.x,k=h.y,M=g.y,j=_.y,G=Math.min(x,w,S),q=Math.min(k,M,j),X=Math.max(x,w,S),Q=Math.max(k,M,j),ne=nh(G,q,t,n,o),be=nh(X,Q,t,n,o);let he=r.prevZ,V=r.nextZ;for(;he&&he.z>=ne&&V&&V.z<=be;){if(he.x>=G&&he.x<=X&&he.y>=q&&he.y<=Q&&he!==h&&he!==_&&vu(x,k,w,M,S,j,he.x,he.y)&&sn(he.prev,he,he.next)>=0||(he=he.prevZ,V.x>=G&&V.x<=X&&V.y>=q&&V.y<=Q&&V!==h&&V!==_&&vu(x,k,w,M,S,j,V.x,V.y)&&sn(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;he&&he.z>=ne;){if(he.x>=G&&he.x<=X&&he.y>=q&&he.y<=Q&&he!==h&&he!==_&&vu(x,k,w,M,S,j,he.x,he.y)&&sn(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;V&&V.z<=be;){if(V.x>=G&&V.x<=X&&V.y>=q&&V.y<=Q&&V!==h&&V!==_&&vu(x,k,w,M,S,j,V.x,V.y)&&sn(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function fm(r,t){let n=r;do{const o=n.prev,h=n.next.next;!wl(o,h)&&xd(o,n,n.next,h)&&xu(o,h)&&xu(h,o)&&(t.push(o.i,n.i,h.i),bu(n),bu(n.next),n=r=h),n=n.next}while(n!==r);return Do(n)}function pm(r,t,n,o,h,g){let _=r;do{let x=_.next.next;for(;x!==_.prev;){if(_.i!==x.i&&vm(_,x)){let w=bd(_,x);return _=Do(_,_.next),w=Do(w,w.next),yu(_,t,n,o,h,g,0),void yu(w,t,n,o,h,g,0)}x=x.next}_=_.next}while(_!==r)}function mm(r,t){let n=r.x-t.x;return n===0&&(n=r.y-t.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function gm(r,t){const n=function(h,g){let _=g;const x=h.x,w=h.y;let S,k=-1/0;if(wl(h,_))return _;do{if(wl(h,_.next))return _.next;if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){const X=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(X<=x&&X>k&&(k=X,S=_.x<_.next.x?_:_.next,X===x))return S}_=_.next}while(_!==g);if(!S)return null;const M=S,j=S.x,G=S.y;let q=1/0;_=S;do{if(x>=_.x&&_.x>=j&&x!==_.x&&vd(w<G?x:k,w,j,G,w<G?k:x,w,_.x,_.y)){const X=Math.abs(w-_.y)/(x-_.x);xu(_,h)&&(X<q||X===q&&(_.x>S.x||_.x===S.x&&_m(S,_)))&&(S=_,q=X)}_=_.next}while(_!==M);return S}(r,t);if(!n)return t;const o=bd(n,r);return Do(o,o.next),Do(n,n.next)}function _m(r,t){return sn(r.prev,r,t.prev)<0&&sn(t.next,r,r.next)<0}function nh(r,t,n,o,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ym(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function vd(r,t,n,o,h,g,_,x){return(h-_)*(t-x)>=(r-_)*(g-x)&&(r-_)*(o-x)>=(n-_)*(t-x)&&(n-_)*(g-x)>=(h-_)*(o-x)}function vu(r,t,n,o,h,g,_,x){return!(r===_&&t===x)&&vd(r,t,n,o,h,g,_,x)}function vm(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,o){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==o.i&&h.next.i!==o.i&&xd(h,h.next,n,o))return!0;h=h.next}while(h!==n);return!1}(r,t)&&(xu(r,t)&&xu(t,r)&&function(n,o){let h=n,g=!1;const _=(n.x+o.x)/2,x=(n.y+o.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==n);return g}(r,t)&&(sn(r.prev,r,t.prev)||sn(r,t.prev,t))||wl(r,t)&&sn(r.prev,r,r.next)>0&&sn(t.prev,t,t.next)>0)}function sn(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function wl(r,t){return r.x===t.x&&r.y===t.y}function xd(r,t,n,o){const h=uc(sn(r,t,n)),g=uc(sn(r,t,o)),_=uc(sn(n,o,r)),x=uc(sn(n,o,t));return h!==g&&_!==x||!(h!==0||!lc(r,n,t))||!(g!==0||!lc(r,o,t))||!(_!==0||!lc(n,r,o))||!(x!==0||!lc(n,t,o))}function lc(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function uc(r){return r>0?1:r<0?-1:0}function xu(r,t){return sn(r.prev,r,r.next)<0?sn(r,t,r.next)>=0&&sn(r,r.prev,t)>=0:sn(r,t,r.prev)<0||sn(r,r.next,t)<0}function bd(r,t){const n=rh(r.i,r.x,r.y),o=rh(t.i,t.x,t.y),h=r.next,g=t.prev;return r.next=t,t.prev=r,n.next=h,h.prev=n,o.next=n,n.prev=o,g.next=o,o.prev=g,o}function wd(r,t,n,o){const h=rh(r,t,n);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function bu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function rh(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Tl{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class cc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}cc.noSubdivision=new cc({fill:new Tl(0,0),line:new Tl(0,0),tile:new Tl(0,0),stencil:new Tl(0,0),circle:1}),dt("SubdivisionGranularityExpression",Tl),dt("SubdivisionGranularitySetting",cc);const Il=-32768,wu=32767;class xm{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=jt/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),h=0|Math.round(n),g=this._getKey(o,h);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,_),this._vertexBuffer.push(o,h),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(h,g){const _=[];for(let x=0;x<g.length;x+=3){const w=g[x],S=g[x+1],k=g[x+2],M=h[2*w],j=h[2*w+1];(h[2*S]-M)*(h[2*k+1]-j)-(h[2*S+1]-j)*(h[2*k]-M)>0?(_.push(w),_.push(k),_.push(S)):(_.push(w),_.push(S),_.push(k))}return _}(this._vertexBuffer,t);const n=[],o=t.length;for(let h=0;h<o;h+=3){const g=[t[h+0],t[h+1],t[h+2]],_=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let x=1/0,w=1/0,S=-1/0,k=-1/0;for(let X=0;X<3;X++){const Q=_[2*X],ne=_[2*X+1];x=Math.min(x,Q),S=Math.max(S,Q),w=Math.min(w,ne),k=Math.max(k,ne)}if(x===S||w===k)continue;const M=Math.floor(x/this._granularityCellSize),j=Math.ceil(S/this._granularityCellSize),G=Math.floor(w/this._granularityCellSize),q=Math.ceil(k/this._granularityCellSize);if(M!==j||G!==q)for(let X=G;X<q;X++){const Q=this._scanlineGenerateVertexRingForCellRow(X,_,g);bm(this._vertexBuffer,Q,n)}else n.push(...g)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const h=t*this._granularityCellSize,g=h+this._granularityCellSize,_=[];for(let x=0;x<3;x++){const w=n[2*x],S=n[2*x+1],k=n[2*(x+1)%6],M=n[(2*(x+1)+1)%6],j=n[2*(x+2)%6],G=n[(2*(x+2)+1)%6],q=k-w,X=M-S,Q=q===0,ne=X===0,be=(h-S)/X,he=(g-S)/X,V=Math.min(be,he),J=Math.max(be,he);if(!ne&&(V>=1||J<=0)||ne&&(S<h||S>g)){M>=h&&M<=g&&_.push(o[(x+1)%3]);continue}!ne&&V>0&&_.push(this._vertexToIndex(w+q*V,S+X*V));const pe=w+q*Math.max(V,0),Ne=w+q*Math.min(J,1);Q||this._generateIntraEdgeVertices(_,w,S,k,M,pe,Ne),!ne&&J<1&&_.push(this._vertexToIndex(w+q*J,S+X*J)),(ne||M>=h&&M<=g)&&_.push(o[(x+1)%3]),!ne&&(M<=h||M>=g)&&this._generateInterEdgeVertices(_,w,S,k,M,j,G,Ne,h,g)}return _}_generateIntraEdgeVertices(t,n,o,h,g,_,x){const w=h-n,S=g-o,k=S===0,M=k?Math.min(n,h):Math.min(_,x),j=k?Math.max(n,h):Math.max(_,x),G=Math.floor(M/this._granularityCellSize)+1,q=Math.ceil(j/this._granularityCellSize)-1;if(k?n<h:_<x)for(let X=G;X<=q;X++){const Q=X*this._granularityCellSize;t.push(this._vertexToIndex(Q,o+S*(Q-n)/w))}else for(let X=q;X>=G;X--){const Q=X*this._granularityCellSize;t.push(this._vertexToIndex(Q,o+S*(Q-n)/w))}}_generateInterEdgeVertices(t,n,o,h,g,_,x,w,S,k){const M=g-o,j=_-h,G=x-g,q=(S-g)/G,X=(k-g)/G,Q=Math.min(q,X),ne=Math.max(q,X),be=h+j*Q;let he=Math.floor(Math.min(be,w)/this._granularityCellSize)+1,V=Math.ceil(Math.max(be,w)/this._granularityCellSize)-1,J=w<be;const pe=G===0;if(pe&&(x===S||x===k))return;if(pe||Q>=1||ne<=0){const Xe=o-x,je=_+(n-_)*Math.min((S-x)/Xe,(k-x)/Xe);he=Math.floor(Math.min(je,w)/this._granularityCellSize)+1,V=Math.ceil(Math.max(je,w)/this._granularityCellSize)-1,J=w<je}const Ne=M>0?k:S;if(J)for(let Xe=he;Xe<=V;Xe++)t.push(this._vertexToIndex(Xe*this._granularityCellSize,Ne));else for(let Xe=V;Xe>=he;Xe--)t.push(this._vertexToIndex(Xe*this._granularityCellSize,Ne))}_generateOutline(t){const n=[];for(const o of t){const h=zo(o,this._granularity,!0),g=this._pointArrayToIndices(h),_=[];for(let x=1;x<g.length;x++)_.push(g[x-1]),_.push(g[x]);n.push(_)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===Il&&(t[n+1]=-32767),o===wu&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,h,g,_){h>g!=(_===Il)?(t.push(n),t.push(o),t.push(this._vertexToIndex(h,_)),t.push(o),t.push(this._vertexToIndex(g,_)),t.push(this._vertexToIndex(h,_))):(t.push(o),t.push(n),t.push(this._vertexToIndex(h,_)),t.push(this._vertexToIndex(g,_)),t.push(o),t.push(this._vertexToIndex(h,_)))}_fillPoles(t,n,o){const h=this._vertexBuffer,g=jt,_=t.length;for(let x=2;x<_;x+=3){const w=t[x-2],S=t[x-1],k=t[x],M=h[2*w],j=h[2*w+1],G=h[2*S],q=h[2*S+1],X=h[2*k],Q=h[2*k+1];n&&(j===0&&q===0&&this._generatePoleQuad(t,w,S,M,G,Il),q===0&&Q===0&&this._generatePoleQuad(t,S,k,G,X,Il),Q===0&&j===0&&this._generatePoleQuad(t,k,w,X,M,Il)),o&&(j===g&&q===g&&this._generatePoleQuad(t,w,S,M,G,wu),q===g&&Q===g&&this._generatePoleQuad(t,S,k,G,X,wu),Q===g&&j===g&&this._generatePoleQuad(t,k,w,X,M,wu))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=function(x){const w=[],S=[];for(const k of x)if(k.length!==0){k!==x[0]&&w.push(S.length/2);for(let M=0;M<k.length;M++)S.push(k[M].x),S.push(k[M].y)}return{flattened:S,holeIndices:w}}(t);let g;this._initializeVertices(o);try{const x=function(S,k,M=2){const j=k&&k.length,G=j?k[0]*M:S.length;let q=yd(S,0,G,M,!0);const X=[];if(!q||q.next===q.prev)return X;let Q,ne,be;if(j&&(q=function(he,V,J,pe){const Ne=[];for(let Xe=0,je=V.length;Xe<je;Xe++){const Ge=yd(he,V[Xe]*pe,Xe<je-1?V[Xe+1]*pe:he.length,pe,!1);Ge===Ge.next&&(Ge.steiner=!0),Ne.push(ym(Ge))}Ne.sort(mm);for(let Xe=0;Xe<Ne.length;Xe++)J=gm(Ne[Xe],J);return J}(S,k,q,M)),S.length>80*M){Q=1/0,ne=1/0;let he=-1/0,V=-1/0;for(let J=M;J<G;J+=M){const pe=S[J],Ne=S[J+1];pe<Q&&(Q=pe),Ne<ne&&(ne=Ne),pe>he&&(he=pe),Ne>V&&(V=Ne)}be=Math.max(he-Q,V-ne),be=be!==0?32767/be:0}return yu(q,X,M,Q,ne,be,0),X}(o,h),w=this._convertIndices(o,x);g=this._subdivideTrianglesScanline(w)}catch(x){console.error(x)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:_}}_convertIndices(t,n){const o=[];for(let h=0;h<n.length;h++)o.push(this._vertexToIndex(t[2*n[h]],t[2*n[h]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const h=t[o];n.push(this._vertexToIndex(h.x,h.y))}return n}}function Td(r,t,n,o=!0){return new xm(n,t).subdividePolygonInternal(r,o)}function zo(r,t,n=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],h=r[r.length-1],g=n&&(o.x!==h.x||o.y!==h.y);if(t<2)return g?[...r,r[0]]:[...r];const _=Math.floor(jt/t),x=[];x.push(new Te(r[0].x,r[0].y));const w=r.length,S=g?w:w-1;for(let k=0;k<S;k++){const M=r[k],j=k<w-1?r[k+1]:r[0],G=M.x,q=M.y,X=j.x,Q=j.y,ne=G!==X,be=q!==Q;if(!ne&&!be)continue;const he=X-G,V=Q-q,J=Math.abs(he),pe=Math.abs(V);let Ne=G,Xe=q;for(;;){const Ge=he>0?(Math.floor(Ne/_)+1)*_:(Math.ceil(Ne/_)-1)*_,Ke=V>0?(Math.floor(Xe/_)+1)*_:(Math.ceil(Xe/_)-1)*_,He=Math.abs(Ne-Ge),Qe=Math.abs(Xe-Ke),$e=Math.abs(Ne-X),gt=Math.abs(Xe-Q),Lt=ne?He/J:Number.POSITIVE_INFINITY,Mt=be?Qe/pe:Number.POSITIVE_INFINITY;if(($e<=He||!ne)&&(gt<=Qe||!be))break;if(Lt<Mt&&ne||!be){Ne=Ge,Xe+=V*Lt;const Tt=new Te(Ne,Math.round(Xe));x[x.length-1].x===Tt.x&&x[x.length-1].y===Tt.y||x.push(Tt)}else{Ne+=he*Mt,Xe=Ke;const Tt=new Te(Math.round(Ne),Xe);x[x.length-1].x===Tt.x&&x[x.length-1].y===Tt.y||x.push(Tt)}}const je=new Te(X,Q);x[x.length-1].x===je.x&&x[x.length-1].y===je.y||x.push(je)}return x}function bm(r,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=r[2*t[0]];for(let w=1;w<t.length;w++){const S=r[2*t[w]];S<h&&(h=S,o=w)}const g=t.length;let _=o,x=(_+1)%g;for(;;){const w=_-1>=0?_-1:g-1,S=(x+1)%g,k=r[2*t[w]],M=r[2*t[S]],j=r[2*t[_]],G=r[2*t[_]+1],q=r[2*t[x]+1];let X=!1;if(k<M)X=!0;else if(k>M)X=!1;else{const Q=q-G,ne=-(r[2*t[x]]-j),be=G<q?1:-1;((k-j)*Q+(r[2*t[w]+1]-G)*ne)*be>((M-j)*Q+(r[2*t[S]+1]-G)*ne)*be&&(X=!0)}if(X){const Q=t[w],ne=t[_],be=t[x];Q!==ne&&Q!==be&&ne!==be&&n.push(be,ne,Q),_--,_<0&&(_=g-1)}else{const Q=t[S],ne=t[_],be=t[x];Q!==ne&&Q!==be&&ne!==be&&n.push(be,ne,Q),x++,x>=g&&(x=0)}if(w===S)break}}function Id(r,t,n,o,h,g,_,x,w){const S=h.length/2,k=_&&x&&w;if(S<di.MAX_VERTEX_ARRAY_LENGTH){const M=t.prepareSegment(S,n,o),j=M.vertexLength;for(let X=0;X<g.length;X+=3)o.emplaceBack(j+g[X],j+g[X+1],j+g[X+2]);let G,q;M.vertexLength+=S,M.primitiveLength+=g.length/3,k&&(q=_.prepareSegment(S,n,x),G=q.vertexLength,q.vertexLength+=S);for(let X=0;X<h.length;X+=2)r(h[X],h[X+1]);if(k)for(let X=0;X<w.length;X++){const Q=w[X];for(let ne=1;ne<Q.length;ne+=2)x.emplaceBack(G+Q[ne-1],G+Q[ne]);q.primitiveLength+=Q.length/2}}else(function(M,j,G,q,X,Q){const ne=[];for(let pe=0;pe<q.length/2;pe++)ne.push(-1);const be={count:0};let he=0,V=M.getOrCreateLatestSegment(j,G),J=V.vertexLength;for(let pe=2;pe<X.length;pe+=3){const Ne=X[pe-2],Xe=X[pe-1],je=X[pe];let Ge=ne[Ne]<he,Ke=ne[Xe]<he,He=ne[je]<he;V.vertexLength+((Ge?1:0)+(Ke?1:0)+(He?1:0))>di.MAX_VERTEX_ARRAY_LENGTH&&(V=M.createNewSegment(j,G),he=be.count,Ge=!0,Ke=!0,He=!0,J=0);const Qe=Tu(ne,q,Q,be,Ne,Ge,V),$e=Tu(ne,q,Q,be,Xe,Ke,V),gt=Tu(ne,q,Q,be,je,He,V);G.emplaceBack(J+Qe-he,J+$e-he,J+gt-he),V.primitiveLength++}})(t,n,o,h,g,r),k&&function(M,j,G,q,X,Q){const ne=[];for(let pe=0;pe<q.length/2;pe++)ne.push(-1);const be={count:0};let he=0,V=M.getOrCreateLatestSegment(j,G),J=V.vertexLength;for(let pe=0;pe<X.length;pe++){const Ne=X[pe];for(let Xe=1;Xe<X[pe].length;Xe+=2){const je=Ne[Xe-1],Ge=Ne[Xe];let Ke=ne[je]<he,He=ne[Ge]<he;V.vertexLength+((Ke?1:0)+(He?1:0))>di.MAX_VERTEX_ARRAY_LENGTH&&(V=M.createNewSegment(j,G),he=be.count,Ke=!0,He=!0,J=0);const Qe=Tu(ne,q,Q,be,je,Ke,V),$e=Tu(ne,q,Q,be,Ge,He,V);G.emplaceBack(J+Qe-he,J+$e-he),V.primitiveLength++}}}(_,n,x,h,w,r),t.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function Tu(r,t,n,o,h,g,_){if(g){const x=o.count;return n(t[2*h],t[2*h+1]),r[h]=o.count,o.count++,_.vertexLength++,x}return r[h]}class sh{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Be,this.indexArray=new Ci,this.indexArray2=new Ei,this.programConfigurations=new ea(t.layers,t.zoom),this.segments=new di,this.segments2=new di,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=th("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),_=[];for(const{feature:x,id:w,index:S,sourceLayerIndex:k}of t){const M=this.layers[0]._featureFilter.needGeometry,j=Ro(x,M);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom,{globalState:this.globalState}),j,o))continue;const G=g?h.evaluate(j,{},o,n.availableImages):void 0,q={id:w,properties:x.properties,type:x.type,sourceLayerIndex:k,index:S,geometry:M?j.geometry:Lo(x),patterns:{},sortKey:G};_.push(q)}g&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:S,sourceLayerIndex:k}=x;if(this.hasPattern){const M=ih("fill",this.layers,x,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(x,w,S,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[S].feature,w,S,k,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,h,g,_){for(const x of pa(n,500)){const w=Td(x,h,_.fill.getGranularityForZoomLevel(h.z)),S=this.layoutVertexArray;Id((k,M)=>{S.emplaceBack(k,M)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,h)}}let Sd,Ed;dt("FillBucket",sh,{omit:["layers","patternFeatures"]});var wm={get paint(){return Ed=Ed||new Qn({"fill-antialias":new _t(ve.paint_fill["fill-antialias"]),"fill-opacity":new zt(ve.paint_fill["fill-opacity"]),"fill-color":new zt(ve.paint_fill["fill-color"]),"fill-outline-color":new zt(ve.paint_fill["fill-outline-color"]),"fill-translate":new _t(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new yl(ve.paint_fill["fill-pattern"])})},get layout(){return Sd=Sd||new Qn({"fill-sort-key":new zt(ve.layout_fill["fill-sort-key"])})}};class Tm extends Rn{constructor(t){super(t,wm)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new sh(t)}queryRadius(){return ac(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:h}){return rd(oc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),n)}isTileClipped(){return!0}}const Im=Hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Sm=Hi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Em}=Im;var ah,kd,oh,Cd,lh,Pd,Md,hc={};function Ad(){if(kd)return ah;kd=1;var r=de();function t(h,g,_,x,w){this.properties={},this.extent=_,this.type=0,this._pbf=h,this._geometry=-1,this._keys=x,this._values=w,h.readFields(n,this,g)}function n(h,g,_){h==1?g.id=_.readVarint():h==2?function(x,w){for(var S=x.readVarint()+x.pos;x.pos<S;){var k=w._keys[x.readVarint()],M=w._values[x.readVarint()];w.properties[k]=M}}(_,g):h==3?g.type=_.readVarint():h==4&&(g._geometry=_.pos)}function o(h){for(var g,_,x=0,w=0,S=h.length,k=S-1;w<S;k=w++)x+=((_=h[k]).x-(g=h[w]).x)*(g.y+_.y);return x}return ah=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var g,_=h.readVarint()+h.pos,x=1,w=0,S=0,k=0,M=[];h.pos<_;){if(w<=0){var j=h.readVarint();x=7&j,w=j>>3}if(w--,x===1||x===2)S+=h.readSVarint(),k+=h.readSVarint(),x===1&&(g&&M.push(g),g=[]),g.push(new r(S,k));else{if(x!==7)throw new Error("unknown command "+x);g&&g.push(g[0].clone())}}return g&&M.push(g),M},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var g=h.readVarint()+h.pos,_=1,x=0,w=0,S=0,k=1/0,M=-1/0,j=1/0,G=-1/0;h.pos<g;){if(x<=0){var q=h.readVarint();_=7&q,x=q>>3}if(x--,_===1||_===2)(w+=h.readSVarint())<k&&(k=w),w>M&&(M=w),(S+=h.readSVarint())<j&&(j=S),S>G&&(G=S);else if(_!==7)throw new Error("unknown command "+_)}return[k,j,M,G]},t.prototype.toGeoJSON=function(h,g,_){var x,w,S=this.extent*Math.pow(2,_),k=this.extent*h,M=this.extent*g,j=this.loadGeometry(),G=t.types[this.type];function q(ne){for(var be=0;be<ne.length;be++){var he=ne[be];ne[be]=[360*(he.x+k)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+M)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(x=0;x<j.length;x++)X[x]=j[x][0];q(j=X);break;case 2:for(x=0;x<j.length;x++)q(j[x]);break;case 3:for(j=function(ne){var be=ne.length;if(be<=1)return[ne];for(var he,V,J=[],pe=0;pe<be;pe++){var Ne=o(ne[pe]);Ne!==0&&(V===void 0&&(V=Ne<0),V===Ne<0?(he&&J.push(he),he=[ne[pe]]):he.push(ne[pe]))}return he&&J.push(he),J}(j),x=0;x<j.length;x++)for(w=0;w<j[x].length;w++)q(j[x][w])}j.length===1?j=j[0]:G="Multi"+G;var Q={type:"Feature",geometry:{type:G,coordinates:j},properties:this.properties};return"id"in this&&(Q.id=this.id),Q},ah}function Ld(){if(Cd)return oh;Cd=1;var r=Ad();function t(o,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(n,this,h),this.length=this._features.length}function n(o,h,g){o===15?h.version=g.readVarint():o===1?h.name=g.readString():o===5?h.extent=g.readVarint():o===2?h._features.push(g.pos):o===3?h._keys.push(g.readString()):o===4&&h._values.push(function(_){for(var x=null,w=_.readVarint()+_.pos;_.pos<w;){var S=_.readVarint()>>3;x=S===1?_.readString():S===2?_.readFloat():S===3?_.readDouble():S===4?_.readVarint64():S===5?_.readVarint():S===6?_.readSVarint():S===7?_.readBoolean():null}return x}(g))}return oh=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var h=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,h,this.extent,this._keys,this._values)},oh}function Rd(){return Md||(Md=1,hc.VectorTile=function(){if(Pd)return lh;Pd=1;var r=Ld();function t(n,o,h){if(n===3){var g=new r(h,h.readVarint()+h.pos);g.length&&(o[g.name]=g)}}return lh=function(n,o){this.layers=n.readFields(t,{},o)},lh}(),hc.VectorTileFeature=Ad(),hc.VectorTileLayer=Ld()),hc}var Iu=Le(Rd());const km=Iu.VectorTileFeature.types,uh=Math.pow(2,13);function Su(r,t,n,o,h,g,_,x){r.emplaceBack(t,n,2*Math.floor(o*uh)+_,h*uh*2,g*uh*2,Math.round(x))}class ch{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new at,this.centroidVertexArray=new Re,this.indexArray=new Ci,this.programConfigurations=new ea(t.layers,t.zoom),this.segments=new di,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=th("fill-extrusion",this.layers,n);for(const{feature:h,id:g,index:_,sourceLayerIndex:x}of t){const w=this.layers[0]._featureFilter.needGeometry,S=Ro(h,w);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom,{globalState:this.globalState}),S,o))continue;const k={id:g,sourceLayerIndex:x,index:_,geometry:w?S.geometry:Lo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(ih("fill-extrusion",this.layers,k,this.zoom,n)):this.addFeature(k,k.geometry,_,o,{},n.subdivisionGranularity),n.featureIndex.insert(h,k.geometry,_,x,this.index,!0)}}addFeatures(t,n,o){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Em),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Sm.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,h,g,_){for(const x of pa(n,500)){const w={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(w,h,t,x,_);const k=this.layoutVertexArray.length-S,M=Math.floor(w.x/w.sampleCount),j=Math.floor(w.y/w.sampleCount);for(let G=0;G<k;G++)this.centroidVertexArray.emplaceBack(M,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,h)}processPolygon(t,n,o,h,g){if(h.length<1||Dd(h[0]))return;for(const M of h)M.length!==0&&Cm(t,M);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=g.fill.getGranularityForZoomLevel(n.z),w=km[o.type]==="Polygon";for(const M of h){if(M.length===0||Dd(M))continue;const j=zo(M,x,w);this._generateSideFaces(j,_)}if(!w)return;const S=Td(h,n,x,!1),k=this.layoutVertexArray;Id((M,j)=>{Su(k,M,j,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let h=1;h<t.length;h++){const g=t[h],_=t[h-1];if(Pm(g,_))continue;n.segment.vertexLength+4>di.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=g.sub(_)._perp()._unit(),w=_.dist(g);o+w>32768&&(o=0),Su(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,o),Su(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,o),o+=w,Su(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,0,o),Su(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,1,o);const S=n.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function Cm(r,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function Pm(r,t){return r.x===t.x&&(r.x<0||r.x>jt)||r.y===t.y&&(r.y<0||r.y>jt)}function Dd(r){return r.every(t=>t.x<0)||r.every(t=>t.x>jt)||r.every(t=>t.y<0)||r.every(t=>t.y>jt)}let zd;dt("FillExtrusionBucket",ch,{omit:["layers","features"]});var Mm={get paint(){return zd=zd||new Qn({"fill-extrusion-opacity":new _t(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yl(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Am extends Rn{constructor(t){super(t,Mm)}createBucket(t){return new ch(t)}queryRadius(){return ac(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:h,transform:g,pixelsToTileUnits:_,pixelPosMatrix:x}){const w=oc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,_),S=this.paint.get("fill-extrusion-height").evaluate(n,o),k=this.paint.get("fill-extrusion-base").evaluate(n,o),M=function(G,q){const X=[];for(const Q of G){const ne=[Q.x,Q.y,0,1];ui(ne,ne,q),X.push(new Te(ne[0]/ne[3],ne[1]/ne[3]))}return X}(w,x),j=function(G,q,X,Q){const ne=[],be=[],he=Q[8]*q,V=Q[9]*q,J=Q[10]*q,pe=Q[11]*q,Ne=Q[8]*X,Xe=Q[9]*X,je=Q[10]*X,Ge=Q[11]*X;for(const Ke of G){const He=[],Qe=[];for(const $e of Ke){const gt=$e.x,Lt=$e.y,Mt=Q[0]*gt+Q[4]*Lt+Q[12],Tt=Q[1]*gt+Q[5]*Lt+Q[13],ai=Q[2]*gt+Q[6]*Lt+Q[14],Wi=Q[3]*gt+Q[7]*Lt+Q[15],mn=ai+J,$n=Wi+pe,Zr=Mt+Ne,Tr=Tt+Xe,On=ai+je,qi=Wi+Ge,Sn=new Te((Mt+he)/$n,(Tt+V)/$n);Sn.z=mn/$n,He.push(Sn);const Fn=new Te(Zr/qi,Tr/qi);Fn.z=On/qi,Qe.push(Fn)}ne.push(He),be.push(Qe)}return[ne,be]}(h,k,S,x);return function(G,q,X){let Q=1/0;rd(X,q)&&(Q=Nd(X,q[0]));for(let ne=0;ne<q.length;ne++){const be=q[ne],he=G[ne];for(let V=0;V<be.length-1;V++){const J=be[V],pe=[J,be[V+1],he[V+1],he[V],J];nd(X,pe)&&(Q=Math.min(Q,Nd(X,pe)))}}return Q!==1/0&&Q}(j[0],j[1],M)}}function Eu(r,t){return r.x*t.x+r.y*t.y}function Nd(r,t){if(r.length===1){let n=0;const o=t[n++];let h;for(;!h||o.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){const g=t[n],_=r[0],x=h.sub(o),w=g.sub(o),S=_.sub(o),k=Eu(x,x),M=Eu(x,w),j=Eu(w,w),G=Eu(S,x),q=Eu(S,w),X=k*j-M*M,Q=(j*G-M*q)/X,ne=(k*q-M*G)/X,be=o.z*(1-Q-ne)+h.z*Q+g.z*ne;if(isFinite(be))return be}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Lm=Hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Rm}=Lm,Dm=Hi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:zm}=Dm,Nm=Iu.VectorTileFeature.types,Om=Math.cos(Math.PI/180*37.5),Od=Math.pow(2,14)/.5;class hh{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new it,this.layoutVertexArray2=new Ye,this.indexArray=new Ci,this.programConfigurations=new ea(t.layers,t.zoom),this.segments=new di,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=th("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),_=[];for(const{feature:x,id:w,index:S,sourceLayerIndex:k}of t){const M=this.layers[0]._featureFilter.needGeometry,j=Ro(x,M);if(!this.layers[0]._featureFilter.filter(new Fi(this.zoom,{globalState:this.globalState}),j,o))continue;const G=g?h.evaluate(j,{},o):void 0,q={id:w,properties:x.properties,type:x.type,sourceLayerIndex:k,index:S,geometry:M?j.geometry:Lo(x),patterns:{},sortKey:G};_.push(q)}g&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:S,sourceLayerIndex:k}=x;if(this.hasPattern){const M=ih("line",this.layers,x,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(x,w,S,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[S].feature,w,S,k,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,zm)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,h,g,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),S=x.get("line-cap"),k=x.get("line-miter-limit"),M=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const j of n)this.addLine(j,t,w,S,k,M,h,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,h)}addLine(t,n,o,h,g,_,x,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=zo(t,x?w.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<t.length-1;he++)this.totalDistance+=t[he].dist(t[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=Nm[n.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let M=0;for(;M<k-1&&t[M].equals(t[M+1]);)M++;if(k<(S?3:2))return;o==="bevel"&&(g=1.05);const j=this.overscaling<=16?122880/(512*this.overscaling):0,G=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let q,X,Q,ne,be;this.e1=this.e2=-1,S&&(q=t[k-2],be=t[M].sub(q)._unit()._perp());for(let he=M;he<k;he++){if(Q=he===k-1?S?t[M+1]:void 0:t[he+1],Q&&t[he].equals(Q))continue;be&&(ne=be),q&&(X=q),q=t[he],be=Q?Q.sub(q)._unit()._perp():ne,ne=ne||be;let V=ne.add(be);V.x===0&&V.y===0||V._unit();const J=ne.x*be.x+ne.y*be.y,pe=V.x*be.x+V.y*be.y,Ne=pe!==0?1/pe:1/0,Xe=2*Math.sqrt(2-2*pe),je=pe<Om&&X&&Q,Ge=ne.x*be.y-ne.y*be.x>0;if(je&&he>M){const Qe=q.dist(X);if(Qe>2*j){const $e=q.sub(q.sub(X)._mult(j/Qe)._round());this.updateDistance(X,$e),this.addCurrentVertex($e,ne,0,0,G),X=$e}}const Ke=X&&Q;let He=Ke?o:S?"butt":h;if(Ke&&He==="round"&&(Ne<_?He="miter":Ne<=2&&(He="fakeround")),He==="miter"&&Ne>g&&(He="bevel"),He==="bevel"&&(Ne>2&&(He="flipbevel"),Ne<g&&(He="miter")),X&&this.updateDistance(X,q),He==="miter")V._mult(Ne),this.addCurrentVertex(q,V,0,0,G);else if(He==="flipbevel"){if(Ne>100)V=be.mult(-1);else{const Qe=Ne*ne.add(be).mag()/ne.sub(be).mag();V._perp()._mult(Qe*(Ge?-1:1))}this.addCurrentVertex(q,V,0,0,G),this.addCurrentVertex(q,V.mult(-1),0,0,G)}else if(He==="bevel"||He==="fakeround"){const Qe=-Math.sqrt(Ne*Ne-1),$e=Ge?Qe:0,gt=Ge?0:Qe;if(X&&this.addCurrentVertex(q,ne,$e,gt,G),He==="fakeround"){const Lt=Math.round(180*Xe/Math.PI/20);for(let Mt=1;Mt<Lt;Mt++){let Tt=Mt/Lt;if(Tt!==.5){const Wi=Tt-.5;Tt+=Tt*Wi*(Tt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Wi*Wi+(.848013+J*(.215638*J-1.06021)))}const ai=be.sub(ne)._mult(Tt)._add(ne)._unit()._mult(Ge?-1:1);this.addHalfVertex(q,ai.x,ai.y,!1,Ge,0,G)}}Q&&this.addCurrentVertex(q,be,-$e,-gt,G)}else if(He==="butt")this.addCurrentVertex(q,V,0,0,G);else if(He==="square"){const Qe=X?1:-1;this.addCurrentVertex(q,V,Qe,Qe,G)}else He==="round"&&(X&&(this.addCurrentVertex(q,ne,0,0,G),this.addCurrentVertex(q,ne,1,1,G,!0)),Q&&(this.addCurrentVertex(q,be,-1,-1,G,!0),this.addCurrentVertex(q,be,0,0,G)));if(je&&he<k-1){const Qe=q.dist(Q);if(Qe>2*j){const $e=q.add(Q.sub(q)._mult(j/Qe)._round());this.updateDistance(q,$e),this.addCurrentVertex($e,be,0,0,G),q=$e}}}}addCurrentVertex(t,n,o,h,g,_=!1){const x=n.y*h-n.x,w=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,g),this.addHalfVertex(t,x,w,_,!0,-h,g),this.distance>Od/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,h,g,_))}addHalfVertex({x:t,y:n},o,h,g,_,x,w){const S=.5*(this.lineClips?this.scaledDistance*(Od-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,k,this.e2),w.primitiveLength++),_?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Fd,Bd;dt("LineBucket",hh,{omit:["layers","patternFeatures"]});var jd={get paint(){return Bd=Bd||new Qn({"line-opacity":new zt(ve.paint_line["line-opacity"]),"line-color":new zt(ve.paint_line["line-color"]),"line-translate":new _t(ve.paint_line["line-translate"]),"line-translate-anchor":new _t(ve.paint_line["line-translate-anchor"]),"line-width":new zt(ve.paint_line["line-width"]),"line-gap-width":new zt(ve.paint_line["line-gap-width"]),"line-offset":new zt(ve.paint_line["line-offset"]),"line-blur":new zt(ve.paint_line["line-blur"]),"line-dasharray":new lu(ve.paint_line["line-dasharray"]),"line-pattern":new yl(ve.paint_line["line-pattern"]),"line-gradient":new Eo(ve.paint_line["line-gradient"])})},get layout(){return Fd=Fd||new Qn({"line-cap":new _t(ve.layout_line["line-cap"]),"line-join":new zt(ve.layout_line["line-join"]),"line-miter-limit":new _t(ve.layout_line["line-miter-limit"]),"line-round-limit":new _t(ve.layout_line["line-round-limit"]),"line-sort-key":new zt(ve.layout_line["line-sort-key"])})}};class Fm extends zt{possiblyEvaluate(t,n){return n=new Fi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,h){return n=yt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,h)}}let dc;class Bm extends Rn{constructor(t){super(t,jd),this.gradientVersion=0,dc||(dc=new Fm(jd.paint.properties["line-width"].specification),dc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=dc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new hh(t)}queryRadius(t){const n=t,o=Ud(gu("line-width",this,n),gu("line-gap-width",this,n)),h=gu("line-offset",this,n);return o/2+Math.abs(h)+ac(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:h,transform:g,pixelsToTileUnits:_}){const x=oc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,_),w=_/2*Ud(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),S=this.paint.get("line-offset").evaluate(n,o);return S&&(h=function(k,M){const j=[];for(let G=0;G<k.length;G++){const q=k[G],X=[];for(let Q=0;Q<q.length;Q++){const ne=q[Q-1],be=q[Q],he=q[Q+1],V=Q===0?new Te(0,0):be.sub(ne)._unit()._perp(),J=Q===q.length-1?new Te(0,0):he.sub(be)._unit()._perp(),pe=V._add(J)._unit(),Ne=pe.x*J.x+pe.y*J.y;Ne!==0&&pe._mult(1/Ne),X.push(pe._mult(M)._add(be))}j.push(X)}return j}(h,S*_)),function(k,M,j){for(let G=0;G<M.length;G++){const q=M[G];if(k.length>=3){for(let X=0;X<q.length;X++)if(bl(k,q[X]))return!0}if(Jp(k,q,j))return!0}return!1}(x,h,w)}isTileClipped(){return!0}}function Ud(r,t){return t>0?t+2*r:r}const jm=Hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Um=Hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vm=Hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Hi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vd=Hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gm=Hi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qm(r,t,n){return r.sections.forEach(o=>{o.text=function(h,g,_){const x=g.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),Xs.applyArabicShaping&&(h=Xs.applyArabicShaping(h)),h}(o.text,t,n)}),r}Hi([{name:"triangle",components:3,type:"Uint16"}]),Hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Hi([{type:"Float32",name:"offsetX"}]),Hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Hi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ku={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Gd,dh,qd,In=24,fh={};function $m(){return Gd||(Gd=1,fh.read=function(r,t,n,o,h){var g,_,x=8*h-o-1,w=(1<<x)-1,S=w>>1,k=-7,M=n?h-1:0,j=n?-1:1,G=r[t+M];for(M+=j,g=G&(1<<-k)-1,G>>=-k,k+=x;k>0;g=256*g+r[t+M],M+=j,k-=8);for(_=g&(1<<-k)-1,g>>=-k,k+=o;k>0;_=256*_+r[t+M],M+=j,k-=8);if(g===0)g=1-S;else{if(g===w)return _?NaN:1/0*(G?-1:1);_+=Math.pow(2,o),g-=S}return(G?-1:1)*_*Math.pow(2,g-o)},fh.write=function(r,t,n,o,h,g){var _,x,w,S=8*g-h-1,k=(1<<S)-1,M=k>>1,j=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=o?0:g-1,q=o?1:-1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,_=k):(_=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-_))<1&&(_--,w*=2),(t+=_+M>=1?j/w:j*Math.pow(2,1-M))*w>=2&&(_++,w/=2),_+M>=k?(x=0,_=k):_+M>=1?(x=(t*w-1)*Math.pow(2,h),_+=M):(x=t*Math.pow(2,M-1)*Math.pow(2,h),_=0));h>=8;r[n+G]=255&x,G+=q,x/=256,h-=8);for(_=_<<h|x,S+=h;S>0;r[n+G]=255&_,G+=q,_/=256,S-=8);r[n+G-q]|=128*X}),fh}function $d(){if(qd)return dh;qd=1,dh=t;var r=$m();function t(V){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(V)?V:new Uint8Array(V||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=4294967296,o=1/n,h=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function g(V){return V.type===t.Bytes?V.readVarint()+V.pos:V.pos+1}function _(V,J,pe){return pe?4294967296*J+(V>>>0):4294967296*(J>>>0)+(V>>>0)}function x(V,J,pe){var Ne=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));pe.realloc(Ne);for(var Xe=pe.pos-1;Xe>=V;Xe--)pe.buf[Xe+Ne]=pe.buf[Xe]}function w(V,J){for(var pe=0;pe<V.length;pe++)J.writeVarint(V[pe])}function S(V,J){for(var pe=0;pe<V.length;pe++)J.writeSVarint(V[pe])}function k(V,J){for(var pe=0;pe<V.length;pe++)J.writeFloat(V[pe])}function M(V,J){for(var pe=0;pe<V.length;pe++)J.writeDouble(V[pe])}function j(V,J){for(var pe=0;pe<V.length;pe++)J.writeBoolean(V[pe])}function G(V,J){for(var pe=0;pe<V.length;pe++)J.writeFixed32(V[pe])}function q(V,J){for(var pe=0;pe<V.length;pe++)J.writeSFixed32(V[pe])}function X(V,J){for(var pe=0;pe<V.length;pe++)J.writeFixed64(V[pe])}function Q(V,J){for(var pe=0;pe<V.length;pe++)J.writeSFixed64(V[pe])}function ne(V,J){return(V[J]|V[J+1]<<8|V[J+2]<<16)+16777216*V[J+3]}function be(V,J,pe){V[pe]=J,V[pe+1]=J>>>8,V[pe+2]=J>>>16,V[pe+3]=J>>>24}function he(V,J){return(V[J]|V[J+1]<<8|V[J+2]<<16)+(V[J+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(V,J,pe){for(pe=pe||this.length;this.pos<pe;){var Ne=this.readVarint(),Xe=Ne>>3,je=this.pos;this.type=7&Ne,V(Xe,J,this),this.pos===je&&this.skip(Ne)}return J},readMessage:function(V,J){return this.readFields(V,J,this.readVarint()+this.pos)},readFixed32:function(){var V=ne(this.buf,this.pos);return this.pos+=4,V},readSFixed32:function(){var V=he(this.buf,this.pos);return this.pos+=4,V},readFixed64:function(){var V=ne(this.buf,this.pos)+ne(this.buf,this.pos+4)*n;return this.pos+=8,V},readSFixed64:function(){var V=ne(this.buf,this.pos)+he(this.buf,this.pos+4)*n;return this.pos+=8,V},readFloat:function(){var V=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,V},readDouble:function(){var V=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,V},readVarint:function(V){var J,pe,Ne=this.buf;return J=127&(pe=Ne[this.pos++]),pe<128?J:(J|=(127&(pe=Ne[this.pos++]))<<7,pe<128?J:(J|=(127&(pe=Ne[this.pos++]))<<14,pe<128?J:(J|=(127&(pe=Ne[this.pos++]))<<21,pe<128?J:function(Xe,je,Ge){var Ke,He,Qe=Ge.buf;if(Ke=(112&(He=Qe[Ge.pos++]))>>4,He<128||(Ke|=(127&(He=Qe[Ge.pos++]))<<3,He<128)||(Ke|=(127&(He=Qe[Ge.pos++]))<<10,He<128)||(Ke|=(127&(He=Qe[Ge.pos++]))<<17,He<128)||(Ke|=(127&(He=Qe[Ge.pos++]))<<24,He<128)||(Ke|=(1&(He=Qe[Ge.pos++]))<<31,He<128))return _(Xe,Ke,je);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(pe=Ne[this.pos]))<<28,V,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var V=this.readVarint();return V%2==1?(V+1)/-2:V/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var V=this.readVarint()+this.pos,J=this.pos;return this.pos=V,V-J>=12&&h?function(pe,Ne,Xe){return h.decode(pe.subarray(Ne,Xe))}(this.buf,J,V):function(pe,Ne,Xe){for(var je="",Ge=Ne;Ge<Xe;){var Ke,He,Qe,$e=pe[Ge],gt=null,Lt=$e>239?4:$e>223?3:$e>191?2:1;if(Ge+Lt>Xe)break;Lt===1?$e<128&&(gt=$e):Lt===2?(192&(Ke=pe[Ge+1]))==128&&(gt=(31&$e)<<6|63&Ke)<=127&&(gt=null):Lt===3?(He=pe[Ge+2],(192&(Ke=pe[Ge+1]))==128&&(192&He)==128&&((gt=(15&$e)<<12|(63&Ke)<<6|63&He)<=2047||gt>=55296&&gt<=57343)&&(gt=null)):Lt===4&&(He=pe[Ge+2],Qe=pe[Ge+3],(192&(Ke=pe[Ge+1]))==128&&(192&He)==128&&(192&Qe)==128&&((gt=(15&$e)<<18|(63&Ke)<<12|(63&He)<<6|63&Qe)<=65535||gt>=1114112)&&(gt=null)),gt===null?(gt=65533,Lt=1):gt>65535&&(gt-=65536,je+=String.fromCharCode(gt>>>10&1023|55296),gt=56320|1023&gt),je+=String.fromCharCode(gt),Ge+=Lt}return je}(this.buf,J,V)},readBytes:function(){var V=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,V);return this.pos=V,J},readPackedVarint:function(V,J){if(this.type!==t.Bytes)return V.push(this.readVarint(J));var pe=g(this);for(V=V||[];this.pos<pe;)V.push(this.readVarint(J));return V},readPackedSVarint:function(V){if(this.type!==t.Bytes)return V.push(this.readSVarint());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readSVarint());return V},readPackedBoolean:function(V){if(this.type!==t.Bytes)return V.push(this.readBoolean());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readBoolean());return V},readPackedFloat:function(V){if(this.type!==t.Bytes)return V.push(this.readFloat());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readFloat());return V},readPackedDouble:function(V){if(this.type!==t.Bytes)return V.push(this.readDouble());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readDouble());return V},readPackedFixed32:function(V){if(this.type!==t.Bytes)return V.push(this.readFixed32());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readFixed32());return V},readPackedSFixed32:function(V){if(this.type!==t.Bytes)return V.push(this.readSFixed32());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readSFixed32());return V},readPackedFixed64:function(V){if(this.type!==t.Bytes)return V.push(this.readFixed64());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readFixed64());return V},readPackedSFixed64:function(V){if(this.type!==t.Bytes)return V.push(this.readSFixed64());var J=g(this);for(V=V||[];this.pos<J;)V.push(this.readSFixed64());return V},skip:function(V){var J=7&V;if(J===t.Varint)for(;this.buf[this.pos++]>127;);else if(J===t.Bytes)this.pos=this.readVarint()+this.pos;else if(J===t.Fixed32)this.pos+=4;else{if(J!==t.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(V,J){this.writeVarint(V<<3|J)},realloc:function(V){for(var J=this.length||16;J<this.pos+V;)J*=2;if(J!==this.length){var pe=new Uint8Array(J);pe.set(this.buf),this.buf=pe,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(V){this.realloc(4),be(this.buf,V,this.pos),this.pos+=4},writeSFixed32:function(V){this.realloc(4),be(this.buf,V,this.pos),this.pos+=4},writeFixed64:function(V){this.realloc(8),be(this.buf,-1&V,this.pos),be(this.buf,Math.floor(V*o),this.pos+4),this.pos+=8},writeSFixed64:function(V){this.realloc(8),be(this.buf,-1&V,this.pos),be(this.buf,Math.floor(V*o),this.pos+4),this.pos+=8},writeVarint:function(V){(V=+V||0)>268435455||V<0?function(J,pe){var Ne,Xe;if(J>=0?(Ne=J%4294967296|0,Xe=J/4294967296|0):(Xe=~(-J/4294967296),4294967295^(Ne=~(-J%4294967296))?Ne=Ne+1|0:(Ne=0,Xe=Xe+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");pe.realloc(10),function(je,Ge,Ke){Ke.buf[Ke.pos++]=127&je|128,je>>>=7,Ke.buf[Ke.pos++]=127&je|128,je>>>=7,Ke.buf[Ke.pos++]=127&je|128,je>>>=7,Ke.buf[Ke.pos++]=127&je|128,Ke.buf[Ke.pos]=127&(je>>>=7)}(Ne,0,pe),function(je,Ge){var Ke=(7&je)<<4;Ge.buf[Ge.pos++]|=Ke|((je>>>=3)?128:0),je&&(Ge.buf[Ge.pos++]=127&je|((je>>>=7)?128:0),je&&(Ge.buf[Ge.pos++]=127&je|((je>>>=7)?128:0),je&&(Ge.buf[Ge.pos++]=127&je|((je>>>=7)?128:0),je&&(Ge.buf[Ge.pos++]=127&je|((je>>>=7)?128:0),je&&(Ge.buf[Ge.pos++]=127&je)))))}(Xe,pe)}(V,this):(this.realloc(4),this.buf[this.pos++]=127&V|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=V>>>7&127))))},writeSVarint:function(V){this.writeVarint(V<0?2*-V-1:2*V)},writeBoolean:function(V){this.writeVarint(!!V)},writeString:function(V){V=String(V),this.realloc(4*V.length),this.pos++;var J=this.pos;this.pos=function(Ne,Xe,je){for(var Ge,Ke,He=0;He<Xe.length;He++){if((Ge=Xe.charCodeAt(He))>55295&&Ge<57344){if(!Ke){Ge>56319||He+1===Xe.length?(Ne[je++]=239,Ne[je++]=191,Ne[je++]=189):Ke=Ge;continue}if(Ge<56320){Ne[je++]=239,Ne[je++]=191,Ne[je++]=189,Ke=Ge;continue}Ge=Ke-55296<<10|Ge-56320|65536,Ke=null}else Ke&&(Ne[je++]=239,Ne[je++]=191,Ne[je++]=189,Ke=null);Ge<128?Ne[je++]=Ge:(Ge<2048?Ne[je++]=Ge>>6|192:(Ge<65536?Ne[je++]=Ge>>12|224:(Ne[je++]=Ge>>18|240,Ne[je++]=Ge>>12&63|128),Ne[je++]=Ge>>6&63|128),Ne[je++]=63&Ge|128)}return je}(this.buf,V,this.pos);var pe=this.pos-J;pe>=128&&x(J,pe,this),this.pos=J-1,this.writeVarint(pe),this.pos+=pe},writeFloat:function(V){this.realloc(4),r.write(this.buf,V,this.pos,!0,23,4),this.pos+=4},writeDouble:function(V){this.realloc(8),r.write(this.buf,V,this.pos,!0,52,8),this.pos+=8},writeBytes:function(V){var J=V.length;this.writeVarint(J),this.realloc(J);for(var pe=0;pe<J;pe++)this.buf[this.pos++]=V[pe]},writeRawMessage:function(V,J){this.pos++;var pe=this.pos;V(J,this);var Ne=this.pos-pe;Ne>=128&&x(pe,Ne,this),this.pos=pe-1,this.writeVarint(Ne),this.pos+=Ne},writeMessage:function(V,J,pe){this.writeTag(V,t.Bytes),this.writeRawMessage(J,pe)},writePackedVarint:function(V,J){J.length&&this.writeMessage(V,w,J)},writePackedSVarint:function(V,J){J.length&&this.writeMessage(V,S,J)},writePackedBoolean:function(V,J){J.length&&this.writeMessage(V,j,J)},writePackedFloat:function(V,J){J.length&&this.writeMessage(V,k,J)},writePackedDouble:function(V,J){J.length&&this.writeMessage(V,M,J)},writePackedFixed32:function(V,J){J.length&&this.writeMessage(V,G,J)},writePackedSFixed32:function(V,J){J.length&&this.writeMessage(V,q,J)},writePackedFixed64:function(V,J){J.length&&this.writeMessage(V,X,J)},writePackedSFixed64:function(V,J){J.length&&this.writeMessage(V,Q,J)},writeBytesField:function(V,J){this.writeTag(V,t.Bytes),this.writeBytes(J)},writeFixed32Field:function(V,J){this.writeTag(V,t.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(V,J){this.writeTag(V,t.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(V,J){this.writeTag(V,t.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(V,J){this.writeTag(V,t.Fixed64),this.writeSFixed64(J)},writeVarintField:function(V,J){this.writeTag(V,t.Varint),this.writeVarint(J)},writeSVarintField:function(V,J){this.writeTag(V,t.Varint),this.writeSVarint(J)},writeStringField:function(V,J){this.writeTag(V,t.Bytes),this.writeString(J)},writeFloatField:function(V,J){this.writeTag(V,t.Fixed32),this.writeFloat(J)},writeDoubleField:function(V,J){this.writeTag(V,t.Fixed64),this.writeDouble(J)},writeBooleanField:function(V,J){this.writeVarintField(V,!!J)}},dh}var Ga,ph=Le($d());function Zm(r,t,n){r===1&&n.readMessage(Xm,t)}function Xm(r,t,n){if(r===3){const{id:o,bitmap:h,width:g,height:_,left:x,top:w,advance:S}=n.readMessage(Ym,{});t.push({id:o,bitmap:new _u({width:g+6,height:_+6},h),metrics:{width:g,height:_,left:x,top:w,advance:S}})}}function Ym(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}function Zd(r){let t=0,n=0;for(const _ of r)t+=_.w*_.h,n=Math.max(n,_.w);r.sort((_,x)=>x.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let h=0,g=0;for(const _ of r)for(let x=o.length-1;x>=0;x--){const w=o[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const S=o.pop();x<o.length&&(o[x]=S)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(o.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}class mh{constructor(t,{pixelRatio:n,version:o,stretchX:h,stretchY:g,content:_,textFitWidth:x,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=_,this.version=o,this.textFitWidth=x,this.textFitHeight=w}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xd{constructor(t,n){const o={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,o,g),this.addImages(n,h,g);const{w:_,h:x}=Zd(g),w=new wr({width:_||1,height:x||1});for(const S in t){const k=t[S],M=o[S].paddedRect;wr.copy(k.data,w,{x:0,y:0},{x:M.x+1,y:M.y+1},k.data)}for(const S in n){const k=n[S],M=h[S].paddedRect,j=M.x+1,G=M.y+1,q=k.data.width,X=k.data.height;wr.copy(k.data,w,{x:0,y:0},{x:j,y:G},k.data),wr.copy(k.data,w,{x:0,y:X-1},{x:j,y:G-1},{width:q,height:1}),wr.copy(k.data,w,{x:0,y:0},{x:j,y:G+X},{width:q,height:1}),wr.copy(k.data,w,{x:q-1,y:0},{x:j-1,y:G},{width:1,height:X}),wr.copy(k.data,w,{x:0,y:0},{x:j+q,y:G},{width:1,height:X})}this.image=w,this.iconPositions=o,this.patternPositions=h}addImages(t,n,o){for(const h in t){const g=t[h],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};o.push(_),n[h]=new mh(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[h,g]=t.tl;o.update(n.data,void 0,{x:h,y:g})}}dt("ImagePosition",mh),dt("ImageAtlas",Xd),A.an=void 0,(Ga=A.an||(A.an={}))[Ga.none=0]="none",Ga[Ga.horizontal=1]="horizontal",Ga[Ga.vertical=2]="vertical",Ga[Ga.horizontalOnly=3]="horizontalOnly";class Cu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const h=new Cu;return h.scale=t||1,h.fontStack=n,h.verticalAlign=o||"bottom",h}static forImage(t,n){const o=new Cu;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class Sl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Sl;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?o.addImageSection(g):o.addTextSection(g,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const h=t.charCodeAt(o+1)||null,g=t.charCodeAt(o-1)||null;n+=h&&su(h)&&!ku[t[o+1]]||g&&su(g)&&!ku[t[o-1]]||!ku[t[o]]?t[o]:ku[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&pc[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&pc[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Sl;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,o=0;for(let h=0;h<this.length();h++){const g=this.getSection(h);if(g.imageName){const _=t[g.imageName];if(!_)continue;const x=_.displaySize;n=Math.max(n,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(Cu.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void nn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Cu.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):nn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fc(r,t,n,o,h,g,_,x,w,S,k,M,j,G,q){const X=Sl.fromFeature(r,h);let Q;M===A.an.vertical&&X.verticalizePunctuation();const{processBidirectionalText:ne,processStyledBidirectionalText:be}=Xs;if(ne&&X.sections.length===1){Q=[];const J=ne(X.toString(),gh(X,S,g,t,o,G));for(const pe of J){const Ne=new Sl;Ne.text=pe,Ne.sections=X.sections;for(let Xe=0;Xe<pe.length;Xe++)Ne.sectionIndex.push(0);Q.push(Ne)}}else if(be){Q=[];const J=be(X.text,X.sectionIndex,gh(X,S,g,t,o,G));for(const pe of J){const Ne=new Sl;Ne.text=pe[0],Ne.sectionIndex=pe[1],Ne.sections=X.sections,Q.push(Ne)}}else Q=function(J,pe){const Ne=[],Xe=J.text;let je=0;for(const Ge of pe)Ne.push(J.substring(je,Ge)),je=Ge;return je<Xe.length&&Ne.push(J.substring(je,Xe.length)),Ne}(X,gh(X,S,g,t,o,G));const he=[],V={positionedLines:he,text:X.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(J,pe,Ne,Xe,je,Ge,Ke,He,Qe,$e,gt,Lt){let Mt=0,Tt=0,ai=0,Wi=0;const mn=He==="right"?1:He==="left"?0:.5,$n=In/Lt;let Zr=0;for(const qi of je){qi.trim();const Sn=qi.getMaxScale(),Fn={positionedGlyphs:[],lineOffset:0};J.positionedLines[Zr]=Fn;const Bn=Fn.positionedGlyphs;let cr=0;if(!qi.length()){Tt+=Ge,++Zr;continue}const Xr=Jm(Xe,qi,$n);for(let Ir=0;Ir<qi.length();Ir++){const gn=qi.getSection(Ir),kn=qi.getSectionIndex(Ir),Cn=qi.getCharCode(Ir),hn=Qm(Qe,gt,Cn);let Ni;if(gn.imageName){if(J.iconsInText=!0,gn.scale=gn.scale*$n,Ni=tg(gn,hn,Sn,Xr,Xe),!Ni)continue;cr=Math.max(cr,Ni.imageOffset)}else if(Ni=eg(gn,Cn,hn,Xr,pe,Ne),!Ni)continue;const{rect:Rs,metrics:Pl,baselineOffset:Ds}=Ni;Bn.push({glyph:Cn,imageName:gn.imageName,x:Mt,y:Tt+Ds+-17,vertical:hn,scale:gn.scale,fontStack:gn.fontStack,sectionIndex:kn,metrics:Pl,rect:Rs}),hn?(J.verticalizable=!0,Mt+=(gn.imageName?Pl.advance:In)*gn.scale+$e):Mt+=Pl.advance*gn.scale+$e}Bn.length!==0&&(ai=Math.max(Mt-$e,ai),ig(Bn,0,Bn.length-1,mn)),Mt=0,Fn.lineOffset=Math.max(cr,(Sn-1)*In);const En=Ge*Sn+cr;Tt+=En,Wi=Math.max(En,Wi),++Zr}const{horizontalAlign:Tr,verticalAlign:On}=_h(Ke);(function(qi,Sn,Fn,Bn,cr,Xr,En,Ir,gn){const kn=(Sn-Fn)*cr;let Cn=0;Cn=Xr!==En?-Ir*Bn- -17:-Bn*gn*En+.5*En;for(const hn of qi)for(const Ni of hn.positionedGlyphs)Ni.x+=kn,Ni.y+=Cn})(J.positionedLines,mn,Tr,On,ai,Wi,Ge,Tt,je.length),J.top+=-On*Tt,J.bottom=J.top+Tt,J.left+=-Tr*ai,J.right=J.left+ai}(V,t,n,o,Q,_,x,w,M,S,j,q),!function(J){for(const pe of J)if(pe.positionedGlyphs.length!==0)return!1;return!0}(he)&&V}const pc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Wm={40:!0};function Yd(r,t,n,o,h,g){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*In/g+h:0}{const _=n[t.fontStack],x=_&&_[r];return x?x.metrics.advance*t.scale+h:0}}function Hd(r,t,n,o){const h=Math.pow(r-t,2);return o?r<t?h/2:2*h:h+Math.abs(n)*n}function Km(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Wd(r,t,n,o,h,g){let _=null,x=Hd(t,n,h,g);for(const w of o){const S=Hd(t-w.x,n,h,g)+w.badness;S<=x&&(_=w,x=S)}return{index:r,x:t,priorBreak:_,badness:x}}function Kd(r){return r?Kd(r.priorBreak).concat(r.index):[]}function gh(r,t,n,o,h,g){if(!r)return[];const _=[],x=function(M,j,G,q,X,Q){let ne=0;for(let be=0;be<M.length();be++){const he=M.getSection(be);ne+=Yd(M.getCharCode(be),he,q,X,j,Q)}return ne/Math.max(1,Math.ceil(ne/G))}(r,t,n,o,h,g),w=r.text.indexOf("")>=0;let S=0;for(let M=0;M<r.length();M++){const j=r.getSection(M),G=r.getCharCode(M);if(pc[G]||(S+=Yd(G,j,o,h,t,g)),M<r.length()-1){const q=!((k=G)<11904)&&(!!ni["CJK Compatibility Forms"](k)||!!ni["CJK Compatibility"](k)||!!ni["CJK Strokes"](k)||!!ni["CJK Symbols and Punctuation"](k)||!!ni["Enclosed CJK Letters and Months"](k)||!!ni["Halfwidth and Fullwidth Forms"](k)||!!ni["Ideographic Description Characters"](k)||!!ni["Vertical Forms"](k)||ru.test(String.fromCodePoint(k)));(Hm[G]||q||j.imageName||M!==r.length()-2&&Wm[r.getCharCode(M+1)])&&_.push(Wd(M+1,S,x,_,Km(G,r.getCharCode(M+1),q&&w),!1))}}var k;return Kd(Wd(r.length(),S,x,_,0,!0))}function _h(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Jm(r,t,n){const o=t.getMaxScale()*In,{maxImageWidth:h,maxImageHeight:g}=t.getMaxImageSize(r),_=Math.max(o,g*n);return{verticalLineContentWidth:Math.max(o,h*n),horizontalLineContentHeight:_}}function Jd(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function Qm(r,t,n){return!(r===A.an.horizontal||!t&&!ml(n)||t&&(pc[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function eg(r,t,n,o,h,g){const _=g[r.fontStack],x=function(S,k,M,j){if(S&&S.rect)return S;const G=k[M.fontStack],q=G&&G[j];return q?{rect:null,metrics:q.metrics}:null}(_&&_[t],h,r,t);if(x===null)return null;let w;if(n)w=o.verticalLineContentWidth-r.scale*In;else{const S=Jd(r.verticalAlign);w=(o.horizontalLineContentHeight-r.scale*In)*S}return{rect:x.rect,metrics:x.metrics,baselineOffset:w}}function tg(r,t,n,o,h){const g=h[r.imageName];if(!g)return null;const _=g.paddedRect,x=g.displaySize,w={width:x[0],height:x[1],left:1,top:-3,advance:t?x[1]:x[0]};let S;if(t)S=o.verticalLineContentWidth-x[1]*r.scale;else{const k=Jd(r.verticalAlign);S=(o.horizontalLineContentHeight-x[1]*r.scale)*k}return{rect:_,metrics:w,baselineOffset:S,imageOffset:(t?x[0]:x[1])*r.scale-In*n}}function ig(r,t,n,o){if(o===0)return;const h=r[n],g=(r[n].x+h.metrics.advance*h.scale)*o;for(let _=t;_<=n;_++)r[_].x-=g}function ng(r,t,n){const{horizontalAlign:o,verticalAlign:h}=_h(n),g=t[0]-r.displaySize[0]*o,_=t[1]-r.displaySize[1]*h;return{image:r,top:_,bottom:_+r.displaySize[1],left:g,right:g+r.displaySize[0]}}function Qd(r){var t,n;let o=r.left,h=r.top,g=r.right-o,_=r.bottom-h;const x=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",S=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(w==="proportional"){if(x==="stretchOnly"&&g/_<S||x==="proportional"){const k=Math.ceil(_*S);o*=k/g,g=k}}else if(x==="proportional"&&w==="stretchOnly"&&S!==0&&g/_>S){const k=Math.ceil(g/S);h*=k/_,_=k}return{x1:o,y1:h,x2:o+g,y2:h+_}}function ef(r,t,n,o,h,g){const _=r.image;let x;if(_.content){const Q=_.content,ne=_.pixelRatio||1;x=[Q[0]/ne,Q[1]/ne,_.displaySize[0]-Q[2]/ne,_.displaySize[1]-Q[3]/ne]}const w=t.left*g,S=t.right*g;let k,M,j,G;n==="width"||n==="both"?(G=h[0]+w-o[3],M=h[0]+S+o[1]):(G=h[0]+(w+S-_.displaySize[0])/2,M=G+_.displaySize[0]);const q=t.top*g,X=t.bottom*g;return n==="height"||n==="both"?(k=h[1]+q-o[0],j=h[1]+X+o[2]):(k=h[1]+(q+X-_.displaySize[1])/2,j=k+_.displaySize[1]),{image:_,top:k,right:M,bottom:j,left:G,collisionPadding:x}}const ba=128,qa=32640;function tf(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Fi(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=n;let g=0;for(;g<o.length&&o[g]<=r;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<r+1;)_++;_=Math.min(o.length-1,_);const x=o[g],w=o[_];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:n.evaluate(new Fi(x)),maxSize:n.evaluate(new Fi(w)),interpolationType:h}}}function yh(r,t,n){let o="never";const h=r.get(t);return h?o=h:r.get(n)&&(o="always"),o}const rg=Iu.VectorTileFeature.types,sg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mc(r,t,n,o,h,g,_,x,w,S,k,M,j){const G=x?Math.min(qa,Math.round(x[0])):0,q=x?Math.min(qa,Math.round(x[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*h),g,_,(G<<1)+(w?1:0),q,16*S,16*k,256*M,256*j)}function vh(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function ag(r){for(const t of r.sections)if(au(t.text))return!0;return!1}class xh{constructor(t){this.layoutVertexArray=new Wt,this.indexArray=new Ci,this.programConfigurations=t,this.segments=new di,this.dynamicLayoutVertexArray=new xi,this.opacityVertexArray=new Vi,this.hasVisibleVertices=!1,this.placedSymbolArray=new ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Um.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,sg,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}dt("SymbolBuffers",xh);class bh{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new di,this.collisionVertexArray=new Gi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Vm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}dt("CollisionBuffers",bh);class El{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tf(this.zoom,n["text-size"]),this.iconSizeData=tf(this.zoom,n["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=yh(o,"text-overlap","text-allow-overlap")!=="never"||yh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>A.an[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new xh(new ea(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new xh(new ea(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new oe,this.lineVertexArray=new ge,this.symbolInstances=new fe,this.textAnchorOffsets=new ue}calculateGlyphDependencies(t,n,o,h,g){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||h)&&g){const x=ku[t.charAt(_)];x&&(n[x.charCodeAt(0)]=!0)}}populate(t,n,o){const h=this.layers[0],g=h.layout,_=g.get("text-font"),x=g.get("text-field"),w=g.get("icon-image"),S=(x.value.kind!=="constant"||x.value.value instanceof yn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),k=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,M=g.get("symbol-sort-key");if(this.features=[],!S&&!k)return;const j=n.iconDependencies,G=n.glyphDependencies,q=n.availableImages,X=new Fi(this.zoom,{globalState:this.globalState});for(const{feature:Q,id:ne,index:be,sourceLayerIndex:he}of t){const V=h._featureFilter.needGeometry,J=Ro(Q,V);if(!h._featureFilter.filter(X,J,o))continue;let pe,Ne;if(V||(J.geometry=Lo(Q)),S){const je=h.getValueAndResolveTokens("text-field",J,o,q),Ge=yn.factory(je),Ke=this.hasRTLText=this.hasRTLText||ag(Ge);(!Ke||Xs.getRTLTextPluginStatus()==="unavailable"||Ke&&Xs.isParsed())&&(pe=qm(Ge,h,J))}if(k){const je=h.getValueAndResolveTokens("icon-image",J,o,q);Ne=je instanceof vn?je:vn.fromString(je)}if(!pe&&!Ne)continue;const Xe=this.sortFeaturesByKey?M.evaluate(J,{},o):void 0;if(this.features.push({id:ne,text:pe,icon:Ne,index:be,sourceLayerIndex:he,geometry:J.geometry,properties:Q.properties,type:rg[Q.type],sortKey:Xe}),Ne&&(j[Ne.name]=!0),pe){const je=_.evaluate(J,{},o).join(","),Ge=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.an.vertical)>=0;for(const Ke of pe.sections)if(Ke.image)j[Ke.image.name]=!0;else{const He=nu(pe.toString()),Qe=Ke.fontStack||je,$e=G[Qe]=G[Qe]||{};this.calculateGlyphDependencies(Ke.text,$e,Ge,this.allowVerticalPlacement,He)}}}g.get("symbol-placement")==="line"&&(this.features=function(Q){const ne={},be={},he=[];let V=0;function J(je){he.push(Q[je]),V++}function pe(je,Ge,Ke){const He=be[je];return delete be[je],be[Ge]=He,he[He].geometry[0].pop(),he[He].geometry[0]=he[He].geometry[0].concat(Ke[0]),He}function Ne(je,Ge,Ke){const He=ne[Ge];return delete ne[Ge],ne[je]=He,he[He].geometry[0].shift(),he[He].geometry[0]=Ke[0].concat(he[He].geometry[0]),He}function Xe(je,Ge,Ke){const He=Ke?Ge[0][Ge[0].length-1]:Ge[0][0];return`${je}:${He.x}:${He.y}`}for(let je=0;je<Q.length;je++){const Ge=Q[je],Ke=Ge.geometry,He=Ge.text?Ge.text.toString():null;if(!He){J(je);continue}const Qe=Xe(He,Ke),$e=Xe(He,Ke,!0);if(Qe in be&&$e in ne&&be[Qe]!==ne[$e]){const gt=Ne(Qe,$e,Ke),Lt=pe(Qe,$e,he[gt].geometry);delete ne[Qe],delete be[$e],be[Xe(He,he[Lt].geometry,!0)]=Lt,he[gt].geometry=null}else Qe in be?pe(Qe,$e,Ke):$e in ne?Ne(Qe,$e,Ke):(J(je),ne[Qe]=V-1,be[$e]=V-1)}return he.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ne)=>Q.sortKey-ne.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]);const _={};for(let x=t.segment+1;x<n.length;x++)_[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:h},x<n.length-1&&(h+=n[x+1].dist(n[x]));for(let x=t.segment||0;x>=0;x--)_[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:g},x>0&&(g+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const w=_[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,h,g,_,x,w,S,k,M,j){const G=t.indexArray,q=t.layoutVertexArray,X=t.segments.prepareSegment(4*n.length,q,G,this.canOverlap?_.sortKey:void 0),Q=this.glyphOffsetArray.length,ne=X.vertexLength,be=this.allowVerticalPlacement&&x===A.an.vertical?Math.PI/2:0,he=_.text&&_.text.sections;for(let V=0;V<n.length;V++){const{tl:J,tr:pe,bl:Ne,br:Xe,tex:je,pixelOffsetTL:Ge,pixelOffsetBR:Ke,minFontScaleX:He,minFontScaleY:Qe,glyphOffset:$e,isSDF:gt,sectionIndex:Lt}=n[V],Mt=X.vertexLength,Tt=$e[1];mc(q,w.x,w.y,J.x,Tt+J.y,je.x,je.y,o,gt,Ge.x,Ge.y,He,Qe),mc(q,w.x,w.y,pe.x,Tt+pe.y,je.x+je.w,je.y,o,gt,Ke.x,Ge.y,He,Qe),mc(q,w.x,w.y,Ne.x,Tt+Ne.y,je.x,je.y+je.h,o,gt,Ge.x,Ke.y,He,Qe),mc(q,w.x,w.y,Xe.x,Tt+Xe.y,je.x+je.w,je.y+je.h,o,gt,Ke.x,Ke.y,He,Qe),vh(t.dynamicLayoutVertexArray,w,be),G.emplaceBack(Mt,Mt+2,Mt+1),G.emplaceBack(Mt+1,Mt+2,Mt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),V!==n.length-1&&Lt===n[V+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,_,_.index,{},j,he&&he[Lt])}t.placedSymbolArray.emplaceBack(w.x,w.y,Q,this.glyphOffsetArray.length-Q,ne,S,k,w.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],x,0,!1,0,M)}_addCollisionDebugVertex(t,n,o,h,g,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,h,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,h,g,_,x){const w=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),S=w.vertexLength,k=g.layoutVertexArray,M=g.collisionVertexArray,j=x.anchorX,G=x.anchorY;this._addCollisionDebugVertex(k,M,_,j,G,new Te(t,n)),this._addCollisionDebugVertex(k,M,_,j,G,new Te(o,n)),this._addCollisionDebugVertex(k,M,_,j,G,new Te(o,h)),this._addCollisionDebugVertex(k,M,_,j,G,new Te(t,h)),w.vertexLength+=4;const q=g.indexArray;q.emplaceBack(S,S+1),q.emplaceBack(S+1,S+2),q.emplaceBack(S+2,S+3),q.emplaceBack(S+3,S),w.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,h){for(let g=t;g<n;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bh(Si,Vd.members,Ei),this.iconCollisionBox=new bh(Si,Vd.members,Ei);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,h,g,_,x,w,S){const k={};for(let M=n;M<o;M++){const j=t.get(M);k.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},k.textFeatureIndex=j.featureIndex;break}for(let M=h;M<g;M++){const j=t.get(M);k.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},k.verticalTextFeatureIndex=j.featureIndex;break}for(let M=_;M<x;M++){const j=t.get(M);k.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},k.iconFeatureIndex=j.featureIndex;break}for(let M=w;M<S;M++){const j=t.get(M);k.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},k.verticalIconFeatureIndex=j.featureIndex;break}return k}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),h=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+2,g+1),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),h=[],g=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(n*w.anchorX+o*w.anchorY)),g.push(w.featureIndex)}return _.sort((x,w)=>h[x]-h[w]||g[w]-g[x]),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((h,g,_)=>{h>=0&&_.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let nf,rf;dt("SymbolBucket",El,{omit:["layers","collisionBoxArray","features","compareText"]}),El.MAX_GLYPHS=65535,El.addDynamicAttributes=vh;var wh={get paint(){return rf=rf||new Qn({"icon-opacity":new zt(ve.paint_symbol["icon-opacity"]),"icon-color":new zt(ve.paint_symbol["icon-color"]),"icon-halo-color":new zt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(ve.paint_symbol["text-opacity"]),"text-color":new zt(ve.paint_symbol["text-color"],{runtimeType:An,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new zt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new zt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(ve.paint_symbol["text-halo-blur"]),"text-translate":new _t(ve.paint_symbol["text-translate"]),"text-translate-anchor":new _t(ve.paint_symbol["text-translate-anchor"])})},get layout(){return nf=nf||new Qn({"symbol-placement":new _t(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(ve.layout_symbol["icon-size"]),"icon-text-fit":new _t(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(ve.layout_symbol["icon-image"]),"icon-rotate":new zt(ve.layout_symbol["icon-rotate"]),"icon-padding":new zt(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(ve.layout_symbol["icon-offset"]),"icon-anchor":new zt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(ve.layout_symbol["text-rotation-alignment"]),"text-field":new zt(ve.layout_symbol["text-field"]),"text-font":new zt(ve.layout_symbol["text-font"]),"text-size":new zt(ve.layout_symbol["text-size"]),"text-max-width":new zt(ve.layout_symbol["text-max-width"]),"text-line-height":new _t(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new zt(ve.layout_symbol["text-justify"]),"text-radial-offset":new zt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new zt(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new zt(ve.layout_symbol["text-anchor"]),"text-max-angle":new _t(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(ve.layout_symbol["text-writing-mode"]),"text-rotate":new zt(ve.layout_symbol["text-rotate"]),"text-padding":new _t(ve.layout_symbol["text-padding"]),"text-keep-upright":new _t(ve.layout_symbol["text-keep-upright"]),"text-transform":new zt(ve.layout_symbol["text-transform"]),"text-offset":new zt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new _t(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(ve.layout_symbol["text-ignore-placement"]),"text-optional":new _t(ve.layout_symbol["text-optional"])})}};class sf{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Dr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dt("FormatSectionOverride",sf,{omit:["defaultValue"]});class gc extends Rn{constructor(t){super(t,wh)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const g of o)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,h){const g=this.layout.get(t).evaluate(n,{},o,h),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||nl(_.value)||!g?g:function(x,w){return w.replace(/{([^{}]+)}/g,(S,k)=>x&&k in x?String(x[k]):"")}(n.properties,g)}createBucket(t){return new El(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of wh.paint.overridableProperties){if(!gc.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new sf(n),h=new il(o,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new mo("source",h):new sl("composite",h,n.value.zoomStops),this.paint._values[t]=new cs(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&gc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),h=wh.paint.properties[n];let g=!1;const _=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof yn)_(o.value.value.sections);else if(o.value.kind==="source"){const x=S=>{g||(S instanceof dn&&bt(S.value)===ys?_(S.value.sections):S instanceof Vs?_(S.sections):S.eachChild(x))},w=o.value;w._styleExpression&&x(w._styleExpression.expression)}return g}}let af;var og={get paint(){return af=af||new Qn({"background-color":new _t(ve.paint_background["background-color"]),"background-pattern":new lu(ve.paint_background["background-pattern"]),"background-opacity":new _t(ve.paint_background["background-opacity"])})}};class lg extends Rn{constructor(t){super(t,og)}}let of;var ug={get paint(){return of=of||new Qn({"raster-opacity":new _t(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(ve.paint_raster["raster-saturation"]),"raster-contrast":new _t(ve.paint_raster["raster-contrast"]),"raster-resampling":new _t(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(ve.paint_raster["raster-fade-duration"])})}};class cg extends Rn{constructor(t){super(t,ug)}}class hg extends Rn{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class dg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fg={once:!0},Th=63710088e-1;class $a{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $a(vi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,h=t.lat*n,g=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return Th*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof $a)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new $a(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new $a(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lf=2*Math.PI*Th;function uf(r){return lf*Math.cos(r*Math.PI/180)}function cf(r){return(180+r)/360}function hf(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function df(r,t){return r/uf(t)}function Ih(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function ff(r,t){return r*uf(Ih(t))}class Pu{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=$a.convert(t);return new Pu(cf(o.lng),hf(o.lat),df(n,o.lat))}toLngLat(){return new $a(360*this.x-180,Ih(this.y))}toAltitude(){return ff(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lf*(t=Ih(this.y),1/Math.cos(t*Math.PI/180));var t}}function pf(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Sh{constructor(t,n,o){if(!function(h,g,_){return!(h<0||h>25||_<0||_>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=kl(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const h=(_=this.y,x=this.z,w=pf(256*(g=this.x),256*(_=Math.pow(2,x)-_-1),x),S=pf(256*(g+1),256*(_+1),x),w[0]+","+w[1]+","+S[0]+","+S[1]);var g,_,x,w,S;const k=function(M,j,G){let q,X="";for(let Q=M;Q>0;Q--)q=1<<Q-1,X+=(j&q?1:0)+(G&q?2:0);return X}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Te((t.x*n-this.x)*jt,(t.y*n-this.y)*jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mf{constructor(t,n){this.wrap=t,this.canonical=n,this.key=kl(t,n.z,n.z,n.x,n.y)}}class $r{constructor(t,n,o,h,g){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Sh(o,+h,+g),this.key=kl(n,t,o,h,g)}clone(){return new $r(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new $r(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $r(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?kl(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):kl(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new $r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new $r(n,this.wrap,n,o,h),new $r(n,this.wrap,n,o+1,h),new $r(n,this.wrap,n,o,h+1),new $r(n,this.wrap,n,o+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new $r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new $r(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Pu(t.x-this.wrap,t.y))}}function kl(r,t,n,o,h){(r*=2)<0&&(r=-1*r-1);const g=1<<n;return(g*g*r+g*h+o).toString(36)+n.toString(36)+t.toString(36)}dt("CanonicalTileID",Sh),dt("OverscaledTileID",$r,{omit:["terrainRttPosMatrix32f"]});class No{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new No;return n.extend(t(new Te(this.minX,this.minY))),n.extend(t(new Te(this.maxX,this.minY))),n.extend(t(new Te(this.minX,this.maxY))),n.extend(t(new Te(this.maxX,this.maxY))),n}static fromPoints(t){const n=new No;for(const o of t)n.extend(o);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class gf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class _f{constructor(t,n,o,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class yf{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ba(jt,16,0),this.grid3D=new Ba(jt,16,0),this.featureIndexArray=new Fe,this.promoteId=n}insert(t,n,o,h,g,_){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,g);const w=_?this.grid3D:this.grid;for(let S=0;S<n.length;S++){const k=n[S],M=[1/0,1/0,-1/0,-1/0];for(let j=0;j<k.length;j++){const G=k[j];M[0]=Math.min(M[0],G.x),M[1]=Math.min(M[1],G.y),M[2]=Math.max(M[2],G.x),M[3]=Math.max(M[3],G.y)}M[0]<jt&&M[1]<jt&&M[2]>=0&&M[3]>=0&&w.insert(x,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Iu.VectorTile(new ph(this.rawTileData)).layers,this.sourceLayerCoder=new gf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,h){this.loadVTLayers();const g=t.params,_=jt/t.tileSize/t.scale,x=$s(g.filter),w=t.queryGeometry,S=t.queryPadding*_,k=No.fromPoints(w),M=this.grid.query(k.minX-S,k.minY-S,k.maxX+S,k.maxY+S),j=No.fromPoints(t.cameraQueryGeometry).expandBy(S),G=this.grid3D.query(j.minX,j.minY,j.maxX,j.maxY,(Q,ne,be,he)=>function(V,J,pe,Ne,Xe){for(const Ge of V)if(J<=Ge.x&&pe<=Ge.y&&Ne>=Ge.x&&Xe>=Ge.y)return!0;const je=[new Te(J,pe),new Te(J,Xe),new Te(Ne,Xe),new Te(Ne,pe)];if(V.length>2){for(const Ge of je)if(bl(V,Ge))return!0}for(let Ge=0;Ge<V.length-1;Ge++)if(em(V[Ge],V[Ge+1],je))return!0;return!1}(t.cameraQueryGeometry,Q-S,ne-S,be+S,he+S));for(const Q of G)M.push(Q);M.sort(pg);const q={};let X;for(let Q=0;Q<M.length;Q++){const ne=M[Q];if(ne===X)continue;X=ne;const be=this.featureIndexArray.get(ne);let he=null;this.loadMatchingFeature(q,be.bucketIndex,be.sourceLayerIndex,be.featureIndex,x,g.layers,g.availableImages,n,o,h,(V,J,pe)=>(he||(he=Lo(V)),J.queryIntersectsFeature({queryGeometry:w,feature:V,featureState:pe,geometry:he,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return q}loadMatchingFeature(t,n,o,h,g,_,x,w,S,k,M){const j=this.bucketLayerIDs[n];if(_&&!j.some(Q=>_.has(Q)))return;const G=this.sourceLayerCoder.decode(o),q=this.vtLayers[G].feature(h);if(g.needGeometry){const Q=Ro(q,!0);if(!g.filter(new Fi(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!g.filter(new Fi(this.tileID.overscaledZ),q))return;const X=this.getId(q,G);for(let Q=0;Q<j.length;Q++){const ne=j[Q];if(_&&!_.has(ne))continue;const be=w[ne];if(!be)continue;let he={};X&&k&&(he=k.getState(be.sourceLayer||"_geojsonTileLayer",X));const V=yt({},S[ne]);V.paint=vf(V.paint,be.paint,q,he,x),V.layout=vf(V.layout,be.layout,q,he,x);const J=!M||M(q,be,he);if(!J)continue;const pe=new _f(q,this.z,this.x,this.y,X);pe.layer=V;let Ne=t[ne];Ne===void 0&&(Ne=t[ne]=[]),Ne.push({featureIndex:h,feature:pe,intersectionZ:J})}}lookupSymbolFeatures(t,n,o,h,g,_,x,w){const S={};this.loadVTLayers();const k=$s(g);for(const M of t)this.loadMatchingFeature(S,o,h,M,k,_,x,w,n);return S}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function vf(r,t,n,o,h){return ci(r,(g,_)=>{const x=t instanceof _l?t.get(_):null;return x&&x.evaluate?x.evaluate(n,o,h):x})}function pg(r,t){return t-r}function xf(r,t,n,o,h){const g=[];for(let _=0;_<r.length;_++){const x=r[_];let w;for(let S=0;S<x.length-1;S++){let k=x[S],M=x[S+1];k.x<t&&M.x<t||(k.x<t?k=new Te(t,k.y+(t-k.x)/(M.x-k.x)*(M.y-k.y))._round():M.x<t&&(M=new Te(t,k.y+(t-k.x)/(M.x-k.x)*(M.y-k.y))._round()),k.y<n&&M.y<n||(k.y<n?k=new Te(k.x+(n-k.y)/(M.y-k.y)*(M.x-k.x),n)._round():M.y<n&&(M=new Te(k.x+(n-k.y)/(M.y-k.y)*(M.x-k.x),n)._round()),k.x>=o&&M.x>=o||(k.x>=o?k=new Te(o,k.y+(o-k.x)/(M.x-k.x)*(M.y-k.y))._round():M.x>=o&&(M=new Te(o,k.y+(o-k.x)/(M.x-k.x)*(M.y-k.y))._round()),k.y>=h&&M.y>=h||(k.y>=h?k=new Te(k.x+(h-k.y)/(M.y-k.y)*(M.x-k.x),h)._round():M.y>=h&&(M=new Te(k.x+(h-k.y)/(M.y-k.y)*(M.x-k.x),h)._round()),w&&k.equals(w[w.length-1])||(w=[k],g.push(w)),w.push(M)))))}}return g}dt("FeatureIndex",yf,{omit:["rawTileData","sourceLayerCoder"]});class Za extends Te{constructor(t,n,o,h){super(t,n),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new Za(this.x,this.y,this.angle,this.segment)}}function bf(r,t,n,o,h){if(t.segment===void 0||n===0)return!0;let g=t,_=t.segment+1,x=0;for(;x>-n/2;){if(_--,_<0)return!1;x-=r[_].dist(g),g=r[_]}x+=r[_].dist(r[_+1]),_++;const w=[];let S=0;for(;x<n/2;){const k=r[_],M=r[_+1];if(!M)return!1;let j=r[_-1].angleTo(k)-k.angleTo(M);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:j}),S+=j;x-w[0].distance>o;)S-=w.shift().angleDelta;if(S>h)return!1;_++,x+=k.dist(M)}return!0}function wf(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function Tf(r,t,n){return r?.6*t*n:0}function If(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function mg(r,t,n,o,h,g){const _=Tf(n,h,g),x=If(n,o)*g;let w=0;const S=wf(r)/2;for(let k=0;k<r.length-1;k++){const M=r[k],j=r[k+1],G=M.dist(j);if(w+G>S){const q=(S-w)/G,X=Ai.number(M.x,j.x,q),Q=Ai.number(M.y,j.y,q),ne=new Za(X,Q,j.angleTo(M),k);return ne._round(),!_||bf(r,ne,x,_,t)?ne:void 0}w+=G}}function gg(r,t,n,o,h,g,_,x,w){const S=Tf(o,g,_),k=If(o,h),M=k*_,j=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return t-M<t/4&&(t=M+t/4),Sf(r,j?t/2*x%t:(k/2+2*g)*_*x%t,t,S,n,M,j,!1,w)}function Sf(r,t,n,o,h,g,_,x,w){const S=g/2,k=wf(r);let M=0,j=t-n,G=[];for(let q=0;q<r.length-1;q++){const X=r[q],Q=r[q+1],ne=X.dist(Q),be=Q.angleTo(X);for(;j+n<M+ne;){j+=n;const he=(j-M)/ne,V=Ai.number(X.x,Q.x,he),J=Ai.number(X.y,Q.y,he);if(V>=0&&V<w&&J>=0&&J<w&&j-S>=0&&j+S<=k){const pe=new Za(V,J,be,q);pe._round(),o&&!bf(r,pe,g,o,h)||G.push(pe)}}M+=ne}return x||G.length||_||(G=Sf(r,M/2,n,o,h,g,_,!0,w)),G}function Ef(r,t,n,o){const h=[],g=r.image,_=g.pixelRatio,x=g.paddedRect.w-2,w=g.paddedRect.h-2;let S={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const k=g.stretchX||[[0,x]],M=g.stretchY||[[0,w]],j=($e,gt)=>$e+gt[1]-gt[0],G=k.reduce(j,0),q=M.reduce(j,0),X=x-G,Q=w-q;let ne=0,be=G,he=0,V=q,J=0,pe=X,Ne=0,Xe=Q;if(g.content&&o){const $e=g.content,gt=$e[2]-$e[0],Lt=$e[3]-$e[1];(g.textFitWidth||g.textFitHeight)&&(S=Qd(r)),ne=_c(k,0,$e[0]),he=_c(M,0,$e[1]),be=_c(k,$e[0],$e[2]),V=_c(M,$e[1],$e[3]),J=$e[0]-ne,Ne=$e[1]-he,pe=gt-be,Xe=Lt-V}const je=S.x1,Ge=S.y1,Ke=S.x2-je,He=S.y2-Ge,Qe=($e,gt,Lt,Mt)=>{const Tt=yc($e.stretch-ne,be,Ke,je),ai=vc($e.fixed-J,pe,$e.stretch,G),Wi=yc(gt.stretch-he,V,He,Ge),mn=vc(gt.fixed-Ne,Xe,gt.stretch,q),$n=yc(Lt.stretch-ne,be,Ke,je),Zr=vc(Lt.fixed-J,pe,Lt.stretch,G),Tr=yc(Mt.stretch-he,V,He,Ge),On=vc(Mt.fixed-Ne,Xe,Mt.stretch,q),qi=new Te(Tt,Wi),Sn=new Te($n,Wi),Fn=new Te($n,Tr),Bn=new Te(Tt,Tr),cr=new Te(ai/_,mn/_),Xr=new Te(Zr/_,On/_),En=t*Math.PI/180;if(En){const kn=Math.sin(En),Cn=Math.cos(En),hn=[Cn,-kn,kn,Cn];qi._matMult(hn),Sn._matMult(hn),Bn._matMult(hn),Fn._matMult(hn)}const Ir=$e.stretch+$e.fixed,gn=gt.stretch+gt.fixed;return{tl:qi,tr:Sn,bl:Bn,br:Fn,tex:{x:g.paddedRect.x+1+Ir,y:g.paddedRect.y+1+gn,w:Lt.stretch+Lt.fixed-Ir,h:Mt.stretch+Mt.fixed-gn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:Xr,minFontScaleX:pe/_/Ke,minFontScaleY:Xe/_/He,isSDF:n}};if(o&&(g.stretchX||g.stretchY)){const $e=kf(k,X,G),gt=kf(M,Q,q);for(let Lt=0;Lt<$e.length-1;Lt++){const Mt=$e[Lt],Tt=$e[Lt+1];for(let ai=0;ai<gt.length-1;ai++)h.push(Qe(Mt,gt[ai],Tt,gt[ai+1]))}}else h.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function _c(r,t,n){let o=0;for(const h of r)o+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return o}function kf(r,t,n){const o=[{fixed:-1,stretch:0}];for(const[h,g]of r){const _=o[o.length-1];o.push({fixed:h-_.stretch,stretch:_.stretch}),o.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return o.push({fixed:t+1,stretch:n}),o}function yc(r,t,n,o){return r/t*n+o}function vc(r,t,n,o){return r-t*n/o}dt("Anchor",Za);class xc{constructor(t,n,o,h,g,_,x,w,S,k){var M;if(this.boxStartIndex=t.length,S){let j=_.top,G=_.bottom;const q=_.collisionPadding;q&&(j-=q[1],G+=q[3]);let X=G-j;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const j=!((M=_.image)===null||M===void 0)&&M.content&&(_.image.textFitWidth||_.image.textFitHeight)?Qd(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};j.y1=j.y1*x-w[0],j.y2=j.y2*x+w[2],j.x1=j.x1*x-w[3],j.x2=j.x2*x+w[1];const G=_.collisionPadding;if(G&&(j.x1-=G[0]*x,j.y1-=G[1]*x,j.x2+=G[2]*x,j.y2+=G[3]*x),k){const q=new Te(j.x1,j.y1),X=new Te(j.x2,j.y1),Q=new Te(j.x1,j.y2),ne=new Te(j.x2,j.y2),be=k*Math.PI/180;q._rotate(be),X._rotate(be),Q._rotate(be),ne._rotate(be),j.x1=Math.min(q.x,X.x,Q.x,ne.x),j.x2=Math.max(q.x,X.x,Q.x,ne.x),j.y1=Math.min(q.y,X.y,Q.y,ne.y),j.y2=Math.max(q.y,X.y,Q.y,ne.y)}t.emplaceBack(n.x,n.y,j.x1,j.y1,j.x2,j.y2,o,h,g)}this.boxEndIndex=t.length}}class _g{constructor(t=[],n=(o,h)=>o<h?-1:o>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,h=n[t];for(;t>0;){const g=t-1>>1,_=n[g];if(o(h,_)>=0)break;n[t]=_,t=g}n[t]=h}_down(t){const{data:n,compare:o}=this,h=this.length>>1,g=n[t];for(;t<h;){let _=1+(t<<1);const x=_+1;if(x<this.length&&o(n[x],n[_])<0&&(_=x),o(n[_],g)>=0)break;n[t]=n[_],t=_}n[t]=g}}function yg(r,t=1,n=!1){const o=No.fromPoints(r[0]),h=Math.min(o.width(),o.height());let g=h/2;const _=new _g([],vg),{minX:x,minY:w,maxX:S,maxY:k}=o;if(h===0)return new Te(x,w);for(let G=x;G<S;G+=h)for(let q=w;q<k;q+=h)_.push(new Cl(G+g,q+g,g,r));let M=function(G){let q=0,X=0,Q=0;const ne=G[0];for(let be=0,he=ne.length,V=he-1;be<he;V=be++){const J=ne[be],pe=ne[V],Ne=J.x*pe.y-pe.x*J.y;X+=(J.x+pe.x)*Ne,Q+=(J.y+pe.y)*Ne,q+=3*Ne}return new Cl(X/q,Q/q,0,G)}(r),j=_.length;for(;_.length;){const G=_.pop();(G.d>M.d||!M.d)&&(M=G,n&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,j)),G.max-M.d<=t||(g=G.h/2,_.push(new Cl(G.p.x-g,G.p.y-g,g,r)),_.push(new Cl(G.p.x+g,G.p.y-g,g,r)),_.push(new Cl(G.p.x-g,G.p.y+g,g,r)),_.push(new Cl(G.p.x+g,G.p.y+g,g,r)),j+=4)}return n&&(console.log(`num probes: ${j}`),console.log(`best distance: ${M.d}`)),M.p}function vg(r,t){return t.max-r.max}function Cl(r,t,n,o){this.p=new Te(r,t),this.h=n,this.d=function(h,g){let _=!1,x=1/0;for(let w=0;w<g.length;w++){const S=g[w];for(let k=0,M=S.length,j=M-1;k<M;j=k++){const G=S[k],q=S[j];G.y>h.y!=q.y>h.y&&h.x<(q.x-G.x)*(h.y-G.y)/(q.y-G.y)+G.x&&(_=!_),x=Math.min(x,sd(h,G,q))}}return(_?1:-1)*Math.sqrt(x)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var qn;A.aD=void 0,(qn=A.aD||(A.aD={}))[qn.center=1]="center",qn[qn.left=2]="left",qn[qn.right=3]="right",qn[qn.top=4]="top",qn[qn.bottom=5]="bottom",qn[qn["top-left"]=6]="top-left",qn[qn["top-right"]=7]="top-right",qn[qn["bottom-left"]=8]="bottom-left",qn[qn["bottom-right"]=9]="bottom-right";const Eh=Number.POSITIVE_INFINITY;function Cf(r,t){return t[1]!==Eh?function(n,o,h){let g=0,_=0;switch(o=Math.abs(o),h=Math.abs(h),n){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(n){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(r,t[0],t[1]):function(n,o){let h=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":g=_-7;break;case"bottom-right":case"bottom-left":g=7-_;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(n){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=o;break;case"right":h=-o}return[h,g]}(r,t[0])}function Pf(r,t,n){var o;const h=r.layout,g=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(g){const x=g.values,w=[];for(let S=0;S<x.length;S+=2){const k=w[S]=x[S],M=x[S+1].map(j=>j*In);k.startsWith("top")?M[1]-=7:k.startsWith("bottom")&&(M[1]+=7),w[S+1]=M}return new Yt(w)}const _=h.get("text-variable-anchor");if(_){let x;x=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},n)*In,Eh]:h.get("text-offset").evaluate(t,{},n).map(S=>S*In);const w=[];for(const S of _)w.push(S,Cf(S,x));return new Yt(w)}return null}function kh(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xg(r,t,n,o,h,g,_,x,w,S,k,M){let j=g.textMaxSize.evaluate(t,{});j===void 0&&(j=_);const G=r.layers[0].layout,q=G.get("icon-offset").evaluate(t,{},k),X=Af(n.horizontal),Q=_/24,ne=r.tilePixelRatio*Q,be=r.tilePixelRatio*j/24,he=r.tilePixelRatio*x,V=r.tilePixelRatio*G.get("symbol-spacing"),J=G.get("text-padding")*r.tilePixelRatio,pe=function(Lt,Mt,Tt,ai=1){const Wi=Lt.get("icon-padding").evaluate(Mt,{},Tt),mn=Wi&&Wi.values;return[mn[0]*ai,mn[1]*ai,mn[2]*ai,mn[3]*ai]}(G,t,k,r.tilePixelRatio),Ne=G.get("text-max-angle")/180*Math.PI,Xe=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",je=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",Ge=G.get("symbol-placement"),Ke=V/2,He=G.get("icon-text-fit");let Qe;o&&He!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Qe=ef(o,n.vertical,He,G.get("icon-text-fit-padding"),q,Q)),X&&(o=ef(o,X,He,G.get("icon-text-fit-padding"),q,Q)));const $e=k?M.line.getGranularityForZoomLevel(k.z):1,gt=(Lt,Mt)=>{Mt.x<0||Mt.x>=jt||Mt.y<0||Mt.y>=jt||function(Tt,ai,Wi,mn,$n,Zr,Tr,On,qi,Sn,Fn,Bn,cr,Xr,En,Ir,gn,kn,Cn,hn,Ni,Rs,Pl,Ds,Tg){const Ml=Tt.addToLineVertexArray(ai,Wi);let Oo,Al,Ll,Rl,zf=0,Nf=0,Of=0,Ff=0,zh=-1,Nh=-1;const wa={};let Bf=ur("");if(Tt.allowVerticalPlacement&&mn.vertical){const tr=On.layout.get("text-rotate").evaluate(Ni,{},Ds)+90;Ll=new xc(qi,ai,Sn,Fn,Bn,mn.vertical,cr,Xr,En,tr),Tr&&(Rl=new xc(qi,ai,Sn,Fn,Bn,Tr,gn,kn,En,tr))}if($n){const tr=On.layout.get("icon-rotate").evaluate(Ni,{}),Yr=On.layout.get("icon-text-fit")!=="none",Fo=Ef($n,tr,Pl,Yr),Ns=Tr?Ef(Tr,tr,Pl,Yr):void 0;Al=new xc(qi,ai,Sn,Fn,Bn,$n,gn,kn,!1,tr),zf=4*Fo.length;const Bo=Tt.iconSizeData;let ta=null;Bo.kind==="source"?(ta=[ba*On.layout.get("icon-size").evaluate(Ni,{})],ta[0]>qa&&nn(`${Tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Bo.kind==="composite"&&(ta=[ba*Rs.compositeIconSizes[0].evaluate(Ni,{},Ds),ba*Rs.compositeIconSizes[1].evaluate(Ni,{},Ds)],(ta[0]>qa||ta[1]>qa)&&nn(`${Tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,Fo,ta,hn,Cn,Ni,A.an.none,ai,Ml.lineStartIndex,Ml.lineLength,-1,Ds),zh=Tt.icon.placedSymbolArray.length-1,Ns&&(Nf=4*Ns.length,Tt.addSymbols(Tt.icon,Ns,ta,hn,Cn,Ni,A.an.vertical,ai,Ml.lineStartIndex,Ml.lineLength,-1,Ds),Nh=Tt.icon.placedSymbolArray.length-1)}const jf=Object.keys(mn.horizontal);for(const tr of jf){const Yr=mn.horizontal[tr];if(!Oo){Bf=ur(Yr.text);const Ns=On.layout.get("text-rotate").evaluate(Ni,{},Ds);Oo=new xc(qi,ai,Sn,Fn,Bn,Yr,cr,Xr,En,Ns)}const Fo=Yr.positionedLines.length===1;if(Of+=Mf(Tt,ai,Yr,Zr,On,En,Ni,Ir,Ml,mn.vertical?A.an.horizontal:A.an.horizontalOnly,Fo?jf:[tr],wa,zh,Rs,Ds),Fo)break}mn.vertical&&(Ff+=Mf(Tt,ai,mn.vertical,Zr,On,En,Ni,Ir,Ml,A.an.vertical,["vertical"],wa,Nh,Rs,Ds));const Ig=Oo?Oo.boxStartIndex:Tt.collisionBoxArray.length,Sg=Oo?Oo.boxEndIndex:Tt.collisionBoxArray.length,Eg=Ll?Ll.boxStartIndex:Tt.collisionBoxArray.length,kg=Ll?Ll.boxEndIndex:Tt.collisionBoxArray.length,Cg=Al?Al.boxStartIndex:Tt.collisionBoxArray.length,Pg=Al?Al.boxEndIndex:Tt.collisionBoxArray.length,Mg=Rl?Rl.boxStartIndex:Tt.collisionBoxArray.length,Ag=Rl?Rl.boxEndIndex:Tt.collisionBoxArray.length;let zs=-1;const wc=(tr,Yr)=>tr&&tr.circleDiameter?Math.max(tr.circleDiameter,Yr):Yr;zs=wc(Oo,zs),zs=wc(Ll,zs),zs=wc(Al,zs),zs=wc(Rl,zs);const Uf=zs>-1?1:0;Uf&&(zs*=Tg/In),Tt.glyphOffsetArray.length>=El.MAX_GLYPHS&&nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ni.sortKey!==void 0&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,Ni.sortKey);const Lg=Pf(On,Ni,Ds),[Rg,Dg]=function(tr,Yr){const Fo=tr.length,Ns=Yr==null?void 0:Yr.values;if((Ns==null?void 0:Ns.length)>0)for(let Bo=0;Bo<Ns.length;Bo+=2){const ta=Ns[Bo+1];tr.emplaceBack(A.aD[Ns[Bo]],ta[0],ta[1])}return[Fo,tr.length]}(Tt.textAnchorOffsets,Lg);Tt.symbolInstances.emplaceBack(ai.x,ai.y,wa.right>=0?wa.right:-1,wa.center>=0?wa.center:-1,wa.left>=0?wa.left:-1,wa.vertical||-1,zh,Nh,Bf,Ig,Sg,Eg,kg,Cg,Pg,Mg,Ag,Sn,Of,Ff,zf,Nf,Uf,0,cr,zs,Rg,Dg)}(r,Mt,Lt,n,o,h,Qe,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,ne,[J,J,J,J],Xe,w,he,pe,je,q,t,g,S,k,_)};if(Ge==="line")for(const Lt of xf(t.geometry,0,0,jt,jt)){const Mt=zo(Lt,$e),Tt=gg(Mt,V,Ne,n.vertical||X,o,24,be,r.overscaling,jt);for(const ai of Tt)X&&bg(r,X.text,Ke,ai)||gt(Mt,ai)}else if(Ge==="line-center"){for(const Lt of t.geometry)if(Lt.length>1){const Mt=zo(Lt,$e),Tt=mg(Mt,Ne,n.vertical||X,o,24,be);Tt&&gt(Mt,Tt)}}else if(t.type==="Polygon")for(const Lt of pa(t.geometry,0)){const Mt=yg(Lt,16);gt(zo(Lt[0],$e,!0),new Za(Mt.x,Mt.y,0))}else if(t.type==="LineString")for(const Lt of t.geometry){const Mt=zo(Lt,$e);gt(Mt,new Za(Mt[0].x,Mt[0].y,0))}else if(t.type==="Point")for(const Lt of t.geometry)for(const Mt of Lt)gt([Mt],new Za(Mt.x,Mt.y,0))}function Mf(r,t,n,o,h,g,_,x,w,S,k,M,j,G,q){const X=function(be,he,V,J,pe,Ne,Xe,je){const Ge=J.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,Ke=[];for(const He of he.positionedLines)for(const Qe of He.positionedGlyphs){if(!Qe.rect)continue;const $e=Qe.rect||{};let gt=4,Lt=!0,Mt=1,Tt=0;const ai=(pe||je)&&Qe.vertical,Wi=Qe.metrics.advance*Qe.scale/2;if(je&&he.verticalizable&&(Tt=He.lineOffset/2-(Qe.imageName?-(In-Qe.metrics.width*Qe.scale)/2:(Qe.scale-1)*In)),Qe.imageName){const kn=Xe[Qe.imageName];Lt=kn.sdf,Mt=kn.pixelRatio,gt=1/Mt}const mn=pe?[Qe.x+Wi,Qe.y]:[0,0];let $n=pe?[0,0]:[Qe.x+Wi+V[0],Qe.y+V[1]-Tt],Zr=[0,0];ai&&(Zr=$n,$n=[0,0]);const Tr=Qe.metrics.isDoubleResolution?2:1,On=(Qe.metrics.left-gt)*Qe.scale-Wi+$n[0],qi=(-Qe.metrics.top-gt)*Qe.scale+$n[1],Sn=On+$e.w/Tr*Qe.scale/Mt,Fn=qi+$e.h/Tr*Qe.scale/Mt,Bn=new Te(On,qi),cr=new Te(Sn,qi),Xr=new Te(On,Fn),En=new Te(Sn,Fn);if(ai){const kn=new Te(-Wi,Wi- -17),Cn=-Math.PI/2,hn=12-Wi,Ni=new Te(22-hn,-(Qe.imageName?hn:0)),Rs=new Te(...Zr);Bn._rotateAround(Cn,kn)._add(Ni)._add(Rs),cr._rotateAround(Cn,kn)._add(Ni)._add(Rs),Xr._rotateAround(Cn,kn)._add(Ni)._add(Rs),En._rotateAround(Cn,kn)._add(Ni)._add(Rs)}if(Ge){const kn=Math.sin(Ge),Cn=Math.cos(Ge),hn=[Cn,-kn,kn,Cn];Bn._matMult(hn),cr._matMult(hn),Xr._matMult(hn),En._matMult(hn)}const Ir=new Te(0,0),gn=new Te(0,0);Ke.push({tl:Bn,tr:cr,bl:Xr,br:En,tex:$e,writingMode:he.writingMode,glyphOffset:mn,sectionIndex:Qe.sectionIndex,isSDF:Lt,pixelOffsetTL:Ir,pixelOffsetBR:gn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,n,x,h,g,_,o,r.allowVerticalPlacement),Q=r.textSizeData;let ne=null;Q.kind==="source"?(ne=[ba*h.layout.get("text-size").evaluate(_,{})],ne[0]>qa&&nn(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Q.kind==="composite"&&(ne=[ba*G.compositeTextSizes[0].evaluate(_,{},q),ba*G.compositeTextSizes[1].evaluate(_,{},q)],(ne[0]>qa||ne[1]>qa)&&nn(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,X,ne,x,g,_,S,t,w.lineStartIndex,w.lineLength,j,q);for(const be of k)M[be]=r.text.placedSymbolArray.length-1;return 4*X.length}function Af(r){for(const t in r)return r[t];return null}function bg(r,t,n,o){const h=r.compareText;if(t in h){const g=h[t];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<n)return!0}else h[t]=[];return h[t].push(o),!1}const Lf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ch{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=Lf[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Ch(x,_,g,t)}constructor(t,n=64,o=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Lf.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ph(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:x}=this,w=[0,g.length-1,0],S=[];for(;w.length;){const k=w.pop()||0,M=w.pop()||0,j=w.pop()||0;if(M-j<=x){for(let Q=j;Q<=M;Q++){const ne=_[2*Q],be=_[2*Q+1];ne>=t&&ne<=o&&be>=n&&be<=h&&S.push(g[Q])}continue}const G=j+M>>1,q=_[2*G],X=_[2*G+1];q>=t&&q<=o&&X>=n&&X<=h&&S.push(g[G]),(k===0?t<=q:n<=X)&&(w.push(j),w.push(G-1),w.push(1-k)),(k===0?o>=q:h>=X)&&(w.push(G+1),w.push(M),w.push(1-k))}return S}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:_}=this,x=[0,h.length-1,0],w=[],S=o*o;for(;x.length;){const k=x.pop()||0,M=x.pop()||0,j=x.pop()||0;if(M-j<=_){for(let Q=j;Q<=M;Q++)Df(g[2*Q],g[2*Q+1],t,n)<=S&&w.push(h[Q]);continue}const G=j+M>>1,q=g[2*G],X=g[2*G+1];Df(q,X,t,n)<=S&&w.push(h[G]),(k===0?t-o<=q:n-o<=X)&&(x.push(j),x.push(G-1),x.push(1-k)),(k===0?t+o>=q:n+o>=X)&&(x.push(G+1),x.push(M),x.push(1-k))}return w}}function Ph(r,t,n,o,h,g){if(h-o<=n)return;const _=o+h>>1;Rf(r,t,_,o,h,g),Ph(r,t,n,o,_-1,1-g),Ph(r,t,n,_+1,h,1-g)}function Rf(r,t,n,o,h,g){for(;h>o;){if(h-o>600){const S=h-o+1,k=n-o+1,M=Math.log(S),j=.5*Math.exp(2*M/3),G=.5*Math.sqrt(M*j*(S-j)/S)*(k-S/2<0?-1:1);Rf(r,t,n,Math.max(o,Math.floor(n-k*j/S+G)),Math.min(h,Math.floor(n+(S-k)*j/S+G)),g)}const _=t[2*n+g];let x=o,w=h;for(Mu(r,t,o,n),t[2*h+g]>_&&Mu(r,t,o,h);x<w;){for(Mu(r,t,x,w),x++,w--;t[2*x+g]<_;)x++;for(;t[2*w+g]>_;)w--}t[2*o+g]===_?Mu(r,t,o,w):(w++,Mu(r,t,w,h)),w<=n&&(o=w+1),n<=w&&(h=w-1)}}function Mu(r,t,n,o){Mh(r,n,o),Mh(t,2*n,2*o),Mh(t,2*n+1,2*o+1)}function Mh(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function Df(r,t,n,o){const h=r-n,g=t-o;return h*h+g*g}var Ah;A.cw=void 0,(Ah=A.cw||(A.cw={})).create="create",Ah.load="load",Ah.fullLoad="fullLoad";let bc=null,Au=[];const Lh=1e3/60,Rh="loadTime",Dh="fullLoadTime",wg={mark(r){performance.mark(r)},frame(r){const t=r;bc!=null&&Au.push(t-bc),bc=t},clearMetrics(){bc=null,Au=[],performance.clearMeasures(Rh),performance.clearMeasures(Dh);for(const r in A.cw)performance.clearMarks(A.cw[r])},getPerformanceMetrics(){performance.measure(Rh,A.cw.create,A.cw.load),performance.measure(Dh,A.cw.create,A.cw.fullLoad);const r=performance.getEntriesByName(Rh)[0].duration,t=performance.getEntriesByName(Dh)[0].duration,n=Au.length,o=1/(Au.reduce((g,_)=>g+_,0)/n/1e3),h=Au.filter(g=>g>Lh).reduce((g,_)=>g+(_-Lh)/Lh,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};A.$=jt,A.A=lt,A.B=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},A.C=Ai,A.D=_t,A.E=Ze,A.F=Fi,A.G=fl,A.H=function(r){if(Kr==null){const t=r.navigator?r.navigator.userAgent:null;Kr=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Kr},A.I=mh,A.J=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new dg(()=>this.process()),this.subscription=ir(this.target,"message",n=>this.receive(n),!1),this.globalScope=Je(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=t?ir(t.signal,"abort",()=>{g==null||g.unsubscribe(),delete this.resolveRejects[h];const w={id:h,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},fg):null;this.resolveRejects[h]={resolve:w=>{g==null||g.unsubscribe(),n(w)},reject:w=>{g==null||g.unsubscribe(),o(w)}};const _=[],x=Object.assign(Object.assign({},r),{id:h,sourceMapId:this.mapId,origin:location.origin,data:To(r.data,_)});this.target.postMessage(x,{transfer:_})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Je(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return u(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[r];return delete this.resolveRejects[r],h?void(t.error?h.reject(ja(t.error)):h.resolve(ja(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ja(t.data),o=new AbortController;this.abortControllers[r]=o;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,h)}catch(h){this.completeTask(r,h)}})}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const h={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?To(t):null,data:To(n,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.K=W,A.L=function(){var r=new lt(16);return lt!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},A.M=function(r,t,n){var o,h,g,_,x,w,S,k,M,j,G,q,X=n[0],Q=n[1],ne=n[2];return t===r?(r[12]=t[0]*X+t[4]*Q+t[8]*ne+t[12],r[13]=t[1]*X+t[5]*Q+t[9]*ne+t[13],r[14]=t[2]*X+t[6]*Q+t[10]*ne+t[14],r[15]=t[3]*X+t[7]*Q+t[11]*ne+t[15]):(h=t[1],g=t[2],_=t[3],x=t[4],w=t[5],S=t[6],k=t[7],M=t[8],j=t[9],G=t[10],q=t[11],r[0]=o=t[0],r[1]=h,r[2]=g,r[3]=_,r[4]=x,r[5]=w,r[6]=S,r[7]=k,r[8]=M,r[9]=j,r[10]=G,r[11]=q,r[12]=o*X+x*Q+M*ne+t[12],r[13]=h*X+w*Q+j*ne+t[13],r[14]=g*X+S*Q+G*ne+t[14],r[15]=_*X+k*Q+q*ne+t[15]),r},A.N=function(r,t,n){var o=n[0],h=n[1],g=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*h,r[5]=t[5]*h,r[6]=t[6]*h,r[7]=t[7]*h,r[8]=t[8]*g,r[9]=t[9]*g,r[10]=t[10]*g,r[11]=t[11]*g,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},A.O=function(r,t,n){var o=t[0],h=t[1],g=t[2],_=t[3],x=t[4],w=t[5],S=t[6],k=t[7],M=t[8],j=t[9],G=t[10],q=t[11],X=t[12],Q=t[13],ne=t[14],be=t[15],he=n[0],V=n[1],J=n[2],pe=n[3];return r[0]=he*o+V*x+J*M+pe*X,r[1]=he*h+V*w+J*j+pe*Q,r[2]=he*g+V*S+J*G+pe*ne,r[3]=he*_+V*k+J*q+pe*be,r[4]=(he=n[4])*o+(V=n[5])*x+(J=n[6])*M+(pe=n[7])*X,r[5]=he*h+V*w+J*j+pe*Q,r[6]=he*g+V*S+J*G+pe*ne,r[7]=he*_+V*k+J*q+pe*be,r[8]=(he=n[8])*o+(V=n[9])*x+(J=n[10])*M+(pe=n[11])*X,r[9]=he*h+V*w+J*j+pe*Q,r[10]=he*g+V*S+J*G+pe*ne,r[11]=he*_+V*k+J*q+pe*be,r[12]=(he=n[12])*o+(V=n[13])*x+(J=n[14])*M+(pe=n[15])*X,r[13]=he*h+V*w+J*j+pe*Q,r[14]=he*g+V*S+J*G+pe*ne,r[15]=he*_+V*k+J*q+pe*be,r},A.P=Te,A.Q=function(r,t){const n={};for(let o=0;o<t.length;o++){const h=t[o];h in r&&(n[h]=r[h])}return n},A.R=wr,A.S=$a,A.T=eh,A.U=hf,A.V=cf,A.W=nt,A.X=ft,A.Y=ms,A.Z=$r,A._=u,A.a=Y,A.a$=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r},A.a0=Pu,A.a1=No,A.a2=25,A.a3=Sh,A.a4=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of r){const h=window.document.createElement("source");Me(o)||(t.crossOrigin="Anonymous"),h.src=o,t.appendChild(h)}})},A.a5=et,A.a6=function(){return me++},A.a7=te,A.a8=El,A.a9=$s,A.aA=In,A.aB=yi,A.aC=function(r,t,n,o,h=!1){if(!n[0]&&!n[1])return[0,0];const g=h?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(g){const _=Math.sin(g),x=Math.cos(g);n=[n[0]*x-n[1]*_,n[0]*_+n[1]*x]}return[h?n[0]:yi(t,n[0],r.zoom),h?n[1]:yi(t,n[1],r.zoom)]},A.aE=yh,A.aF=kh,A.aG=_h,A.aH=Ch,A.aI=Hi,A.aJ=cc,A.aK=Re,A.aL=di,A.aM=Ci,A.aN=vi,A.aO=At,A.aP=ff,A.aQ=li,A.aR=ri,A.aS=function(r){var t=new lt(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},A.aT=function(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r},A.aU=function(r,t){var n=t[0],o=t[1],h=t[2],g=n*n+o*o+h*h;return g>0&&(g=1/Math.sqrt(g)),r[0]=t[0]*g,r[1]=t[1]*g,r[2]=t[2]*g,r},A.aV=ut,A.aW=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},A.aX=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},A.aY=oi,A.aZ=function(r,t,n){const o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return o===0?null:(-(r[0]*n[0]+r[1]*n[1]+r[2]*n[2])-n[3])/o},A.a_=Ht,A.aa=Ro,A.ab=_f,A.ac=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,h,g)=>{const _=h||g;return t[o]=!_||_.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},A.ad=Mn,A.ae=function(r){return Math.pow(2,r)},A.af=Ft,A.ag=ji,A.ah=85.051129,A.ai=df,A.aj=function(r){return Math.log(r)/Math.LN2},A.ak=function(r){var t=r[0],n=r[1];return t*t+n*n},A.al=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},A.am=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:_}=r,x=h?ji(Ln.interpolationFactor(h,t,g,_),0,1):0;r.kind==="camera"?o=Ai.number(r.minSize,r.maxSize,x):n=x}return{uSizeT:n,uSize:o}},A.ao=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:h}){return r.kind==="source"?o/ba:r.kind==="composite"?Ai.number(o/ba,h/ba,n):t},A.ap=function(r,t){var n=t[0],o=t[1],h=t[2],g=t[3],_=t[4],x=t[5],w=t[6],S=t[7],k=t[8],M=t[9],j=t[10],G=t[11],q=t[12],X=t[13],Q=t[14],ne=t[15],be=n*x-o*_,he=n*w-h*_,V=n*S-g*_,J=o*w-h*x,pe=o*S-g*x,Ne=h*S-g*w,Xe=k*X-M*q,je=k*Q-j*q,Ge=k*ne-G*q,Ke=M*Q-j*X,He=M*ne-G*X,Qe=j*ne-G*Q,$e=be*Qe-he*He+V*Ke+J*Ge-pe*je+Ne*Xe;return $e?(r[0]=(x*Qe-w*He+S*Ke)*($e=1/$e),r[1]=(h*He-o*Qe-g*Ke)*$e,r[2]=(X*Ne-Q*pe+ne*J)*$e,r[3]=(j*pe-M*Ne-G*J)*$e,r[4]=(w*Ge-_*Qe-S*je)*$e,r[5]=(n*Qe-h*Ge+g*je)*$e,r[6]=(Q*V-q*Ne-ne*he)*$e,r[7]=(k*Ne-j*V+G*he)*$e,r[8]=(_*He-x*Ge+S*Xe)*$e,r[9]=(o*Ge-n*He-g*Xe)*$e,r[10]=(q*pe-X*V+ne*be)*$e,r[11]=(M*V-k*pe-G*be)*$e,r[12]=(x*je-_*Ke-w*Xe)*$e,r[13]=(n*Ke-o*je+h*Xe)*$e,r[14]=(X*he-q*J-Q*be)*$e,r[15]=(k*J-M*he+j*be)*$e,r):null},A.aq=xt,A.ar=function(r){return Math.hypot(r[0],r[1])},A.as=function(r){return r[0]=0,r[1]=0,r},A.at=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r},A.au=vh,A.av=ui,A.aw=function(r,t,n,o){const h=t.y-r.y,g=t.x-r.x,_=o.y-n.y,x=o.x-n.x,w=_*g-x*h;if(w===0)return null;const S=(x*(r.y-n.y)-_*(r.x-n.x))/w;return new Te(r.x+S*g,r.y+S*h)},A.ax=xf,A.ay=nd,A.az=function(r){let t=1/0,n=1/0,o=-1/0,h=-1/0;for(const g of r)t=Math.min(t,g.x),n=Math.min(n,g.y),o=Math.max(o,g.x),h=Math.max(h,g.y);return[t,n,o,h]},A.b=Rr,A.b$=Gm,A.b0=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},A.b1=mf,A.b2=kl,A.b3=function(r,t,n,o,h){var g,_=1/Math.tan(t/2);return r[0]=_/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=_,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+o)*(g=1/(o-h)),r[14]=2*h*o*g):(r[10]=-1,r[14]=-2*o),r},A.b4=function(r){var t=new lt(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},A.b5=function(r,t,n){var o=Math.sin(n),h=Math.cos(n),g=t[0],_=t[1],x=t[2],w=t[3],S=t[4],k=t[5],M=t[6],j=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=g*h+S*o,r[1]=_*h+k*o,r[2]=x*h+M*o,r[3]=w*h+j*o,r[4]=S*h-g*o,r[5]=k*h-_*o,r[6]=M*h-x*o,r[7]=j*h-w*o,r},A.b6=function(r,t,n){var o=Math.sin(n),h=Math.cos(n),g=t[4],_=t[5],x=t[6],w=t[7],S=t[8],k=t[9],M=t[10],j=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=g*h+S*o,r[5]=_*h+k*o,r[6]=x*h+M*o,r[7]=w*h+j*o,r[8]=S*h-g*o,r[9]=k*h-_*o,r[10]=M*h-x*o,r[11]=j*h-w*o,r},A.b7=function(){const r=new Float32Array(16);return Ft(r),r},A.b8=function(){const r=new Float64Array(16);return Ft(r),r},A.b9=function(){return new Float64Array(16)},A.bA=function(r){return r[0]=0,r[1]=0,r[2]=0,r},A.bB=function(r,t,n,o){const h=Math.sqrt(r*r+t*t),g=Math.sqrt(n*n+o*o);r/=h,t/=h,n/=g,o/=g;const _=Math.acos(r*n+t*o);return-t*n+r*o>0?_:-_},A.bC=function(r,t){const n=Ot(r,2*Math.PI),o=Ot(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},A.bD=function(){const r={},t=ve.$version;for(const n in ve.$root){const o=ve.$root[n];if(o.required){let h=null;h=n==="version"?t:o.type==="array"?[]:{},h!=null&&(r[n]=h)}}return r},A.bE=iu,A.bF=xe,A.bG=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},A.bH=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=qe(r[n],t[r[n].ref]));return r},A.bI=function(r){if(r.type==="custom")return new hg(r);switch(r.type){case"background":return new lg(r);case"circle":return new im(r);case"color-relief":return new lm(r);case"fill":return new Tm(r);case"fill-extrusion":return new Am(r);case"heatmap":return new rm(r);case"hillshade":return new am(r);case"line":return new Bm(r);case"raster":return new cg(r);case"symbol":return new gc(r)}},A.bJ=tn,A.bK=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!ct(r.version,t.version))return[{command:"setStyle",args:[t]}];ct(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),ct(r.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),ct(r.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),ct(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),ct(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),ct(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),ct(r.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),ct(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),ct(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),ct(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),ct(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),ct(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),ct(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),ct(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},h=[];(function(_,x,w,S){let k;for(k in x=x||{},_=_||{})Object.prototype.hasOwnProperty.call(_,k)&&(Object.prototype.hasOwnProperty.call(x,k)||wi(k,w,S));for(k in x)Object.prototype.hasOwnProperty.call(x,k)&&(Object.prototype.hasOwnProperty.call(_,k)?ct(_[k],x[k])||(_[k].type==="geojson"&&x[k].type==="geojson"&&hi(_,x,k)?St(w,{command:"setGeoJSONSourceData",args:[k,x[k].data]}):mi(k,x,w,S)):Dt(k,x,w))})(r.sources,t.sources,h,o);const g=[];r.layers&&r.layers.forEach(_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):g.push(_)}),n=n.concat(h),function(_,x,w){x=x||[];const S=(_=_||[]).map(Qt),k=x.map(Qt),M=_.reduce(Zi,{}),j=x.reduce(Zi,{}),G=S.slice(),q=Object.create(null);let X,Q,ne,be,he;for(let V=0,J=0;V<S.length;V++)X=S[V],Object.prototype.hasOwnProperty.call(j,X)?J++:(St(w,{command:"removeLayer",args:[X]}),G.splice(G.indexOf(X,J),1));for(let V=0,J=0;V<k.length;V++)X=k[k.length-1-V],G[G.length-1-V]!==X&&(Object.prototype.hasOwnProperty.call(M,X)?(St(w,{command:"removeLayer",args:[X]}),G.splice(G.lastIndexOf(X,G.length-J),1)):J++,be=G[G.length-V],St(w,{command:"addLayer",args:[j[X],be]}),G.splice(G.length-V,0,X),q[X]=!0);for(let V=0;V<k.length;V++)if(X=k[V],Q=M[X],ne=j[X],!q[X]&&!ct(Q,ne))if(ct(Q.source,ne.source)&&ct(Q["source-layer"],ne["source-layer"])&&ct(Q.type,ne.type)){for(he in Pt(Q.layout,ne.layout,w,X,null,"setLayoutProperty"),Pt(Q.paint,ne.paint,w,X,null,"setPaintProperty"),ct(Q.filter,ne.filter)||St(w,{command:"setFilter",args:[X,ne.filter]}),ct(Q.minzoom,ne.minzoom)&&ct(Q.maxzoom,ne.maxzoom)||St(w,{command:"setLayerZoomRange",args:[X,ne.minzoom,ne.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Pt(Q[he],ne[he],w,X,he.slice(6),"setPaintProperty"):ct(Q[he],ne[he])||St(w,{command:"setLayerProperty",args:[X,he,ne[he]]}));for(he in ne)Object.prototype.hasOwnProperty.call(ne,he)&&!Object.prototype.hasOwnProperty.call(Q,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Pt(Q[he],ne[he],w,X,he.slice(6),"setPaintProperty"):ct(Q[he],ne[he])||St(w,{command:"setLayerProperty",args:[X,he,ne[he]]}))}else St(w,{command:"removeLayer",args:[X]}),be=G[G.lastIndexOf(X)+1],St(w,{command:"addLayer",args:[ne,be]})}(g,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},A.bL=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},A.bM=ci,A.bN=Yn,A.bO=class extends zi{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},A.bP=sc,A.bQ=class extends zi{constructor(r,t){super(r,t),this.current=Xc}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},A.bR=pn,A.bS=class extends zi{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},A.bT=class extends zi{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},A.bU=wt,A.bV=function(r,t){var n=Math.sin(t),o=Math.cos(t);return r[0]=o,r[1]=n,r[2]=0,r[3]=-n,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},A.bW=function(r,t,n){var o=t[0],h=t[1],g=t[2];return r[0]=o*n[0]+h*n[3]+g*n[6],r[1]=o*n[1]+h*n[4]+g*n[7],r[2]=o*n[2]+h*n[5]+g*n[8],r},A.bX=function(r,t,n,o,h,g,_){var x=1/(t-n),w=1/(o-h),S=1/(g-_);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*S,r[11]=0,r[12]=(t+n)*x,r[13]=(h+o)*w,r[14]=(_+g)*S,r[15]=1,r},A.bY=class extends zi{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(4*r.length);for(let n=0;n<r.length;n++)t[4*n]=r[n].r,t[4*n+1]=r[n].g,t[4*n+2]=r[n].b,t[4*n+3]=r[n].a;this.gl.uniform4fv(this.location,t)}}},A.bZ=class extends zi{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(r);this.gl.uniform1fv(this.location,t)}}},A.b_=class extends l{},A.ba=function(r,t,n){const o=new Float64Array(4);return gi(o,r,t-90,n),o},A.bb=function(r,t,n,o){var h,g,_,x,w,S=t[0],k=t[1],M=t[2],j=t[3],G=n[0],q=n[1],X=n[2],Q=n[3];return(g=S*G+k*q+M*X+j*Q)<0&&(g=-g,G=-G,q=-q,X=-X,Q=-Q),1-g>rt?(h=Math.acos(g),_=Math.sin(h),x=Math.sin((1-o)*h)/_,w=Math.sin(o*h)/_):(x=1-o,w=o),r[0]=x*S+w*G,r[1]=x*k+w*q,r[2]=x*M+w*X,r[3]=x*j+w*Q,r},A.bc=function(r){const t=new Float64Array(9);var n,o,h,g,_,x,w,S,k,M,j,G,q,X,Q,ne,be,he;M=(h=(o=r)[0])*(w=h+h),j=(g=o[1])*w,q=(_=o[2])*w,X=_*(S=g+g),ne=(x=o[3])*w,be=x*S,he=x*(k=_+_),(n=t)[0]=1-(G=g*S)-(Q=_*k),n[3]=j-he,n[6]=q+be,n[1]=j+he,n[4]=1-M-Q,n[7]=X-ne,n[2]=q-be,n[5]=X+ne,n[8]=1-M-G;const V=At(-Math.asin(ji(t[2],-1,1)));let J,pe;return Math.hypot(t[5],t[8])<.001?(J=0,pe=-At(Math.atan2(t[3],t[4]))):(J=At(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),pe=At(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:J,pitch:V+90,bearing:pe}},A.bd=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},A.be=Ut,A.bf=er,A.bg=Il,A.bh=wu,A.bi=Tl,A.bj=Bi,A.bk=hr,A.bl=$t,A.bm=function(r,t,n,o,h){return Bi(o,h,ji((r-t)/(n-t),0,1))},A.bn=Ot,A.bo=function(){return new Float64Array(3)},A.bp=function(r,t,n,o){return r[0]=t[0]+n[0]*o,r[1]=t[1]+n[1]*o,r[2]=t[2]+n[2]*o,r},A.bq=gi,A.br=function(r,t,n){var o=n[0],h=n[1],g=n[2],_=t[0],x=t[1],w=t[2],S=h*w-g*x,k=g*_-o*w,M=o*x-h*_,j=h*M-g*k,G=g*S-o*M,q=o*k-h*S,X=2*n[3];return k*=X,M*=X,G*=2,q*=2,r[0]=_+(S*=X)+(j*=2),r[1]=x+k+G,r[2]=w+M+q,r},A.bs=function(r,t,n){const o=(h=[r[0],r[1],r[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((k=h[8])*(_=h[4])-(x=h[5])*(S=h[7]))+h[1]*(-k*(g=h[3])+x*(w=h[6]))+h[2]*(S*g-_*w);var h,g,_,x,w,S,k;if(o===0)return null;const M=ut([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),j=ut([],[n[0],n[1],n[2]],[r[0],r[1],r[2]]),G=ut([],[r[0],r[1],r[2]],[t[0],t[1],t[2]]),q=li([],M,-r[3]);return ri(q,q,li([],j,-t[3])),ri(q,q,li([],G,-n[3])),li(q,q,1/o),q},A.bt=Th,A.bu=function(){return new Float64Array(4)},A.bv=function(r,t,n,o){var h=[],g=[];return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],g[0]=h[0]*Math.cos(o)-h[1]*Math.sin(o),g[1]=h[0]*Math.sin(o)+h[1]*Math.cos(o),g[2]=h[2],r[0]=g[0]+n[0],r[1]=g[1]+n[1],r[2]=g[2]+n[2],r},A.bw=function(r,t,n,o){var h=[],g=[];return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],g[0]=h[0],g[1]=h[1]*Math.cos(o)-h[2]*Math.sin(o),g[2]=h[1]*Math.sin(o)+h[2]*Math.cos(o),r[0]=g[0]+n[0],r[1]=g[1]+n[1],r[2]=g[2]+n[2],r},A.bx=function(r,t,n,o){var h=[],g=[];return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],g[0]=h[2]*Math.sin(o)+h[0]*Math.cos(o),g[1]=h[1],g[2]=h[2]*Math.cos(o)-h[0]*Math.sin(o),r[0]=g[0]+n[0],r[1]=g[1]+n[1],r[2]=g[2]+n[2],r},A.by=function(r,t,n){var o=Math.sin(n),h=Math.cos(n),g=t[0],_=t[1],x=t[2],w=t[3],S=t[8],k=t[9],M=t[10],j=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=g*h-S*o,r[1]=_*h-k*o,r[2]=x*h-M*o,r[3]=w*h-j*o,r[8]=g*o+S*h,r[9]=_*o+k*h,r[10]=x*o+M*h,r[11]=w*o+j*h,r},A.bz=function(r,t){const n=Ot(r,360),o=Ot(t,360),h=o-n,g=o>n?h-360:h+360;return Math.abs(h)<Math.abs(g)?h:g},A.c=ke,A.c0=class extends m{},A.c1=Qc,A.c2=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},A.c3=fd,A.c4=function(r,t,n){var o=t[0],h=t[1],g=t[2],_=n[3]*o+n[7]*h+n[11]*g+n[15];return r[0]=(n[0]*o+n[4]*h+n[8]*g+n[12])/(_=_||1),r[1]=(n[1]*o+n[5]*h+n[9]*g+n[13])/_,r[2]=(n[2]*o+n[6]*h+n[10]*g+n[14])/_,r},A.c5=class extends uu{},A.c6=class extends R{},A.c7=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},A.c8=function(r,t){var n=r[0],o=r[1],h=r[2],g=r[3],_=r[4],x=r[5],w=r[6],S=r[7],k=r[8],M=r[9],j=r[10],G=r[11],q=r[12],X=r[13],Q=r[14],ne=r[15],be=t[0],he=t[1],V=t[2],J=t[3],pe=t[4],Ne=t[5],Xe=t[6],je=t[7],Ge=t[8],Ke=t[9],He=t[10],Qe=t[11],$e=t[12],gt=t[13],Lt=t[14],Mt=t[15];return Math.abs(n-be)<=rt*Math.max(1,Math.abs(n),Math.abs(be))&&Math.abs(o-he)<=rt*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(h-V)<=rt*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(g-J)<=rt*Math.max(1,Math.abs(g),Math.abs(J))&&Math.abs(_-pe)<=rt*Math.max(1,Math.abs(_),Math.abs(pe))&&Math.abs(x-Ne)<=rt*Math.max(1,Math.abs(x),Math.abs(Ne))&&Math.abs(w-Xe)<=rt*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(S-je)<=rt*Math.max(1,Math.abs(S),Math.abs(je))&&Math.abs(k-Ge)<=rt*Math.max(1,Math.abs(k),Math.abs(Ge))&&Math.abs(M-Ke)<=rt*Math.max(1,Math.abs(M),Math.abs(Ke))&&Math.abs(j-He)<=rt*Math.max(1,Math.abs(j),Math.abs(He))&&Math.abs(G-Qe)<=rt*Math.max(1,Math.abs(G),Math.abs(Qe))&&Math.abs(q-$e)<=rt*Math.max(1,Math.abs(q),Math.abs($e))&&Math.abs(X-gt)<=rt*Math.max(1,Math.abs(X),Math.abs(gt))&&Math.abs(Q-Lt)<=rt*Math.max(1,Math.abs(Q),Math.abs(Lt))&&Math.abs(ne-Mt)<=rt*Math.max(1,Math.abs(ne),Math.abs(Mt))},A.c9=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},A.cA=function(r){delete Y.REGISTERED_PROTOCOLS[r]},A.cB=function(r,t){const n={};for(let h=0;h<r.length;h++){const g=t&&t[r[h].id]||ll(r[h]);t&&(t[r[h].id]=g);let _=n[g];_||(_=n[g]=[]),_.push(r[h])}const o=[];for(const h in n)o.push(n[h]);return o},A.cC=dt,A.cD=gf,A.cE=yf,A.cF=Xd,A.cG=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=jt/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new Fi(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Fi(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Fi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:k}=r.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Fi(S),r.canonical),o["text-size"].possiblyEvaluate(new Fi(k),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:k}=r.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Fi(S),r.canonical),o["icon-size"].possiblyEvaluate(new Fi(k),r.canonical)]}const g=n.get("text-line-height")*In,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),w=n.get("text-size");for(const S of r.bucket.features){const k=n.get("text-font").evaluate(S,{},r.canonical).join(","),M=w.evaluate(S,{},r.canonical),j=h.layoutTextSize.evaluate(S,{},r.canonical),G=h.layoutIconSize.evaluate(S,{},r.canonical),q={horizontal:{},vertical:void 0},X=S.text;let Q,ne=[0,0];if(X){const V=X.toString(),J=n.get("text-letter-spacing").evaluate(S,{},r.canonical)*In,pe=Ju(V)?J:0,Ne=n.get("text-anchor").evaluate(S,{},r.canonical),Xe=Pf(t,S,r.canonical);if(!Xe){const He=n.get("text-radial-offset").evaluate(S,{},r.canonical);ne=He?Cf(Ne,[He*In,Eh]):n.get("text-offset").evaluate(S,{},r.canonical).map(Qe=>Qe*In)}let je=_?"center":n.get("text-justify").evaluate(S,{},r.canonical);const Ge=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(S,{},r.canonical)*In:1/0,Ke=()=>{r.bucket.allowVerticalPlacement&&nu(V)&&(q.vertical=fc(X,r.glyphMap,r.glyphPositions,r.imagePositions,k,Ge,g,Ne,"left",pe,ne,A.an.vertical,!0,j,M))};if(!_&&Xe){const He=new Set;if(je==="auto")for(let $e=0;$e<Xe.values.length;$e+=2)He.add(kh(Xe.values[$e]));else He.add(je);let Qe=!1;for(const $e of He)if(!q.horizontal[$e])if(Qe)q.horizontal[$e]=q.horizontal[0];else{const gt=fc(X,r.glyphMap,r.glyphPositions,r.imagePositions,k,Ge,g,"center",$e,pe,ne,A.an.horizontal,!1,j,M);gt&&(q.horizontal[$e]=gt,Qe=gt.positionedLines.length===1)}Ke()}else{je==="auto"&&(je=kh(Ne));const He=fc(X,r.glyphMap,r.glyphPositions,r.imagePositions,k,Ge,g,Ne,je,pe,ne,A.an.horizontal,!1,j,M);He&&(q.horizontal[je]=He),Ke(),nu(V)&&_&&x&&(q.vertical=fc(X,r.glyphMap,r.glyphPositions,r.imagePositions,k,Ge,g,Ne,je,pe,ne,A.an.vertical,!1,j,M))}}let be=!1;if(S.icon&&S.icon.name){const V=r.imageMap[S.icon.name];V&&(Q=ng(r.imagePositions[S.icon.name],n.get("icon-offset").evaluate(S,{},r.canonical),n.get("icon-anchor").evaluate(S,{},r.canonical)),be=!!V.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=be:r.bucket.sdfIcons!==be&&nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(V.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const he=Af(q.horizontal)||q.vertical;r.bucket.iconsInText=!!he&&he.iconsInText,(he||Q)&&xg(r.bucket,S,q,Q,r.imageMap,h,j,G,ne,be,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},A.cH=hh,A.cI=sh,A.cJ=ch,A.cK=Iu,A.cL=ph,A.cM=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},A.cN=function(r,t,n,o,h){return u(this,void 0,void 0,function*(){if(ft())try{return yield ms(r,t,n,o,h)}catch{}return function(g,_,x,w,S){const k=g.width,M=g.height;Vt&&pr||(Vt=new OffscreenCanvas(k,M),pr=Vt.getContext("2d",{willReadFrequently:!0})),Vt.width=k,Vt.height=M,pr.drawImage(g,0,0,k,M);const j=pr.getImageData(_,x,w,S);return pr.clearRect(0,0,k,M),j.data}(r,t,n,o,h)})},A.cO=gd,A.cP=Le,A.cQ=de,A.cR=Rd,A.cS=$d,A.cT=rl,A.cU=Xs,A.ca=r=>r.type==="symbol",A.cb=r=>r.type==="circle",A.cc=r=>r.type==="heatmap",A.cd=r=>r.type==="line",A.ce=r=>r.type==="fill",A.cf=r=>r.type==="fill-extrusion",A.cg=r=>r.type==="hillshade",A.ch=r=>r.type==="color-relief",A.ci=r=>r.type==="raster",A.cj=r=>r.type==="background",A.ck=r=>r.type==="custom",A.cl=dr,A.cm=function(r,t,n){const o=bi(t.x-n.x,t.y-n.y),h=bi(r.x-n.x,r.y-n.y);var g,_;return At(Math.atan2(o[0]*h[1]-o[1]*h[0],(g=o)[0]*(_=h)[0]+g[1]*_[1]))},A.cn=ze,A.co=function(r,t){return si[t]&&(r instanceof MouseEvent||r instanceof WheelEvent)},A.cp=function(r,t){return gs[t]&&"touches"in r},A.cq=function(r){return gs[r]||si[r]},A.cr=function(r,t,n){var o=t[0],h=t[1];return r[0]=n[0]*o+n[4]*h+n[12],r[1]=n[1]*o+n[5]*h+n[13],r},A.cs=function(r,t){const{x:n,y:o}=Pu.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},A.ct=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},A.cu=class extends Hs{},A.cv=wg,A.cx=function(r){return r.message===Nt},A.cy=ce,A.cz=function(r,t){Y.REGISTERED_PROTOCOLS[r]=t},A.d=Me,A.e=yt,A.f=r=>u(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),A.g=H,A.h=r=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=fr})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(h):fr}),A.i=Je,A.j=(r,t)=>Ee(yt(r,{type:"json"}),t),A.k=Pe,A.l=Ue,A.m=Ee,A.n=(r,t)=>Ee(yt(r,{type:"arrayBuffer"}),t),A.o=function(r){return new ph(r).readFields(Zm,[])},A.p=Zd,A.q=_u,A.r=Qn,A.s=ir,A.t=ou,A.u=ni,A.v=ve,A.w=nn,A.x=Uc,A.y=bo,A.z=Fa}),B("worker",["./shared"],function(A){class u{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,H){for(const ce of Y){this._layerConfigs[ce.id]=ce;const xe=this._layers[ce.id]=A.bI(ce);xe._featureFilter=A.a9(xe.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of H)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const W=A.cB(Object.values(this._layerConfigs),this.keyCache);for(const ce of W){const xe=ce.map(Pe=>this._layers[Pe.id]),Ee=xe[0];if(Ee.visibility==="none")continue;const Me=Ee.source||"";let Ie=this.familiesBySource[Me];Ie||(Ie=this.familiesBySource[Me]={});const Ve=Ee.sourceLayer||"_geojsonTileLayer";let Ue=Ie[Ve];Ue||(Ue=Ie[Ve]=[]),Ue.push(xe)}}}class Le{constructor(Y){const H={},W=[];for(const Me in Y){const Ie=Y[Me],Ve=H[Me]={};for(const Ue in Ie){const Pe=Ie[+Ue];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const Ze={x:0,y:0,w:Pe.bitmap.width+2,h:Pe.bitmap.height+2};W.push(Ze),Ve[Ue]={rect:Ze,metrics:Pe.metrics}}}const{w:ce,h:xe}=A.p(W),Ee=new A.q({width:ce||1,height:xe||1});for(const Me in Y){const Ie=Y[Me];for(const Ve in Ie){const Ue=Ie[+Ve];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Pe=H[Me][Ve].rect;A.q.copy(Ue.bitmap,Ee,{x:0,y:0},{x:Pe.x+1,y:Pe.y+1},Ue.bitmap)}}this.image=Ee,this.positions=H}}A.cC("GlyphAtlas",Le);class Ae{constructor(Y){this.tileID=new A.Z(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[],this.globalState=Y.globalState}parse(Y,H,W,ce,xe){return A._(this,void 0,void 0,function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new A.a7;const Ee=new A.cD(Object.keys(Y.layers).sort()),Me=new A.cE(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const Ie={},Ve={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W,subdivisionGranularity:xe},Ue=H.familiesBySource[this.source];for(const Pt in Ue){const Qt=Y.layers[Pt];if(!Qt)continue;Qt.version===1&&A.w(`Vector tile source "${this.source}" layer "${Pt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zi=Ee.encode(Pt),et=[];for(let ln=0;ln<Qt.length;ln++){const Ri=Qt.feature(ln),Ji=Me.getId(Ri,Pt);et.push({feature:Ri,id:Ji,index:ln,sourceLayerIndex:Zi})}for(const ln of Ue[Pt]){const Ri=ln[0];Ri.source!==this.source&&A.w(`layer.source = ${Ri.source} does not equal this.source = ${this.source}`),Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(_e(ln,this.zoom,W),(Ie[Ri.id]=Ri.createBucket({index:Me.bucketLayerIDs.length,layers:ln,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zi,sourceID:this.source,globalState:this.globalState})).populate(et,Ve,this.tileID.canonical),Me.bucketLayerIDs.push(ln.map(Ji=>Ji.id)))}}const Pe=A.bM(Ve.glyphDependencies,Pt=>Object.keys(Pt).map(Number));this.inFlightDependencies.forEach(Pt=>Pt==null?void 0:Pt.abort()),this.inFlightDependencies=[];let Ze=Promise.resolve({});if(Object.keys(Pe).length){const Pt=new AbortController;this.inFlightDependencies.push(Pt),Ze=ce.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},Pt)}const ve=Object.keys(Ve.iconDependencies);let st=Promise.resolve({});if(ve.length){const Pt=new AbortController;this.inFlightDependencies.push(Pt),st=ce.sendAsync({type:"GI",data:{icons:ve,source:this.source,tileID:this.tileID,type:"icons"}},Pt)}const qe=Object.keys(Ve.patternDependencies);let ct=Promise.resolve({});if(qe.length){const Pt=new AbortController;this.inFlightDependencies.push(Pt),ct=ce.sendAsync({type:"GI",data:{icons:qe,source:this.source,tileID:this.tileID,type:"patterns"}},Pt)}const[St,Dt,wi]=yield Promise.all([Ze,st,ct]),mi=new Le(St),hi=new A.cF(Dt,wi);for(const Pt in Ie){const Qt=Ie[Pt];Qt instanceof A.a8?(_e(Qt.layers,this.zoom,W),A.cG({bucket:Qt,glyphMap:St,glyphPositions:mi.positions,imageMap:Dt,imagePositions:hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ve.subdivisionGranularity})):Qt.hasPattern&&(Qt instanceof A.cH||Qt instanceof A.cI||Qt instanceof A.cJ)&&(_e(Qt.layers,this.zoom,W),Qt.addFeatures(Ve,this.tileID.canonical,hi.patternPositions))}return this.status="done",{buckets:Object.values(Ie).filter(Pt=>!Pt.isEmpty()),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mi.image,imageAtlas:hi,glyphMap:this.returnDependencies?St:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?mi.positions:null}})}}function _e(ke,Y,H){const W=new A.F(Y);for(const ce of ke)ce.recalculate(W,H)}class de{constructor(Y,H,W){this.actor=Y,this.layerIndex=H,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Y,H){return A._(this,void 0,void 0,function*(){const W=yield A.n(Y.request,H);try{return{vectorTile:new A.cK.VectorTile(new A.cL(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(ce){const xe=new Uint8Array(W.data);let Ee=`Unable to parse the tile at ${Y.request.url}, `;throw Ee+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.message}`,new Error(Ee)}})}loadTile(Y){return A._(this,void 0,void 0,function*(){const H=Y.uid,W=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new A.cM(Y.request),ce=new Ae(Y);this.loading[H]=ce;const xe=new AbortController;ce.abort=xe;try{const Ee=yield this.loadVectorTile(Y,xe);if(delete this.loading[H],!Ee)return null;const Me=Ee.rawData,Ie={};Ee.expires&&(Ie.expires=Ee.expires),Ee.cacheControl&&(Ie.cacheControl=Ee.cacheControl);const Ve={};if(W){const Pe=W.finish();Pe&&(Ve.resourceTiming=JSON.parse(JSON.stringify(Pe)))}ce.vectorTile=Ee.vectorTile;const Ue=ce.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);this.loaded[H]=ce,this.fetching[H]={rawTileData:Me,cacheControl:Ie,resourceTiming:Ve};try{const Pe=yield Ue;return A.e({rawTileData:Me.slice(0)},Pe,Ie,Ve)}finally{delete this.fetching[H]}}catch(Ee){throw delete this.loading[H],ce.status="done",this.loaded[H]=ce,Ee}})}reloadTile(Y){return A._(this,void 0,void 0,function*(){const H=Y.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[H];if(W.showCollisionBoxes=Y.showCollisionBoxes,W.globalState=Y.globalState,W.status==="parsing"){const ce=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);let xe;if(this.fetching[H]){const{rawTileData:Ee,cacheControl:Me,resourceTiming:Ie}=this.fetching[H];delete this.fetching[H],xe=A.e({rawTileData:Ee.slice(0)},ce,Me,Ie)}else xe=ce;return xe}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity)})}abortTile(Y){return A._(this,void 0,void 0,function*(){const H=this.loading,W=Y.uid;H&&H[W]&&H[W].abort&&(H[W].abort.abort(),delete H[W])})}removeTile(Y){return A._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]})}}class we{constructor(){this.loaded={}}loadTile(Y){return A._(this,void 0,void 0,function*(){const{uid:H,encoding:W,rawImageData:ce,redFactor:xe,greenFactor:Ee,blueFactor:Me,baseShift:Ie}=Y,Ve=ce.width+2,Ue=ce.height+2,Pe=A.b(ce)?new A.R({width:Ve,height:Ue},yield A.cN(ce,-1,-1,Ve,Ue)):ce,Ze=new A.cO(H,Pe,W,xe,Ee,Me,Ie);return this.loaded=this.loaded||{},this.loaded[H]=Ze,Ze})}removeTile(Y){const H=this.loaded,W=Y.uid;H&&H[W]&&delete H[W]}}var ae,Te,ot=function(){if(Te)return ae;function ke(H,W){if(H.length!==0){Y(H[0],W);for(var ce=1;ce<H.length;ce++)Y(H[ce],!W)}}function Y(H,W){for(var ce=0,xe=0,Ee=0,Me=H.length,Ie=Me-1;Ee<Me;Ie=Ee++){var Ve=(H[Ee][0]-H[Ie][0])*(H[Ie][1]+H[Ee][1]),Ue=ce+Ve;xe+=Math.abs(ce)>=Math.abs(Ve)?ce-Ue+Ve:Ve-Ue+ce,ce=Ue}ce+xe>=0!=!!W&&H.reverse()}return Te=1,ae=function H(W,ce){var xe,Ee=W&&W.type;if(Ee==="FeatureCollection")for(xe=0;xe<W.features.length;xe++)H(W.features[xe],ce);else if(Ee==="GeometryCollection")for(xe=0;xe<W.geometries.length;xe++)H(W.geometries[xe],ce);else if(Ee==="Feature")H(W.geometry,ce);else if(Ee==="Polygon")ke(W.coordinates,ce);else if(Ee==="MultiPolygon")for(xe=0;xe<W.coordinates.length;xe++)ke(W.coordinates[xe],ce);return W}}(),pt=A.cP(ot);const Ct=A.cK.VectorTileFeature.prototype.toGeoJSON;class vt{constructor(Y){this._feature=Y,this.extent=A.$,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const H of this._feature.geometry)Y.push([new A.P(H[0],H[1])]);return Y}{const Y=[];for(const H of this._feature.geometry){const W=[];for(const ce of H)W.push(new A.P(ce[0],ce[1]));Y.push(W)}return Y}}toGeoJSON(Y,H,W){return Ct.call(this,Y,H,W)}}class nt{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=A.$,this.length=Y.length,this._features=Y}feature(Y){return new vt(this._features[Y])}}var ft,rt,lt,wt={exports:{}},Ft=function(){if(lt)return wt.exports;lt=1;var ke=A.cS(),Y=function(){if(rt)return ft;rt=1;var Ue=A.cQ(),Pe=A.cR().VectorTileFeature;function Ze(st,qe){this.options=qe||{},this.features=st,this.length=st.length}function ve(st,qe){this.id=typeof st.id=="number"?st.id:void 0,this.type=st.type,this.rawGeometry=st.type===1?[st.geometry]:st.geometry,this.properties=st.tags,this.extent=qe||4096}return ft=Ze,Ze.prototype.feature=function(st){return new ve(this.features[st],this.options.extent)},ve.prototype.loadGeometry=function(){var st=this.rawGeometry;this.geometry=[];for(var qe=0;qe<st.length;qe++){for(var ct=st[qe],St=[],Dt=0;Dt<ct.length;Dt++)St.push(new Ue(ct[Dt][0],ct[Dt][1]));this.geometry.push(St)}return this.geometry},ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var st=this.geometry,qe=1/0,ct=-1/0,St=1/0,Dt=-1/0,wi=0;wi<st.length;wi++)for(var mi=st[wi],hi=0;hi<mi.length;hi++){var Pt=mi[hi];qe=Math.min(qe,Pt.x),ct=Math.max(ct,Pt.x),St=Math.min(St,Pt.y),Dt=Math.max(Dt,Pt.y)}return[qe,St,ct,Dt]},ve.prototype.toGeoJSON=Pe.prototype.toGeoJSON,ft}();function H(Ue){var Pe=new ke;return function(Ze,ve){for(var st in Ze.layers)ve.writeMessage(3,W,Ze.layers[st])}(Ue,Pe),Pe.finish()}function W(Ue,Pe){var Ze;Pe.writeVarintField(15,Ue.version||1),Pe.writeStringField(1,Ue.name||""),Pe.writeVarintField(5,Ue.extent||4096);var ve={keys:[],values:[],keycache:{},valuecache:{}};for(Ze=0;Ze<Ue.length;Ze++)ve.feature=Ue.feature(Ze),Pe.writeMessage(2,ce,ve);var st=ve.keys;for(Ze=0;Ze<st.length;Ze++)Pe.writeStringField(3,st[Ze]);var qe=ve.values;for(Ze=0;Ze<qe.length;Ze++)Pe.writeMessage(4,Ve,qe[Ze])}function ce(Ue,Pe){var Ze=Ue.feature;Ze.id!==void 0&&Pe.writeVarintField(1,Ze.id),Pe.writeMessage(2,xe,Ue),Pe.writeVarintField(3,Ze.type),Pe.writeMessage(4,Ie,Ze)}function xe(Ue,Pe){var Ze=Ue.feature,ve=Ue.keys,st=Ue.values,qe=Ue.keycache,ct=Ue.valuecache;for(var St in Ze.properties){var Dt=Ze.properties[St],wi=qe[St];if(Dt!==null){wi===void 0&&(ve.push(St),qe[St]=wi=ve.length-1),Pe.writeVarint(wi);var mi=typeof Dt;mi!=="string"&&mi!=="boolean"&&mi!=="number"&&(Dt=JSON.stringify(Dt));var hi=mi+":"+Dt,Pt=ct[hi];Pt===void 0&&(st.push(Dt),ct[hi]=Pt=st.length-1),Pe.writeVarint(Pt)}}}function Ee(Ue,Pe){return(Pe<<3)+(7&Ue)}function Me(Ue){return Ue<<1^Ue>>31}function Ie(Ue,Pe){for(var Ze=Ue.loadGeometry(),ve=Ue.type,st=0,qe=0,ct=Ze.length,St=0;St<ct;St++){var Dt=Ze[St],wi=1;ve===1&&(wi=Dt.length),Pe.writeVarint(Ee(1,wi));for(var mi=ve===3?Dt.length-1:Dt.length,hi=0;hi<mi;hi++){hi===1&&ve!==1&&Pe.writeVarint(Ee(2,mi-1));var Pt=Dt[hi].x-st,Qt=Dt[hi].y-qe;Pe.writeVarint(Me(Pt)),Pe.writeVarint(Me(Qt)),st+=Pt,qe+=Qt}ve===3&&Pe.writeVarint(Ee(7,1))}}function Ve(Ue,Pe){var Ze=typeof Ue;Ze==="string"?Pe.writeStringField(1,Ue):Ze==="boolean"?Pe.writeBooleanField(7,Ue):Ze==="number"&&(Ue%1!=0?Pe.writeDoubleField(3,Ue):Ue<0?Pe.writeSVarintField(6,Ue):Pe.writeVarintField(5,Ue))}return wt.exports=H,wt.exports.fromVectorTileJs=H,wt.exports.fromGeojsonVt=function(Ue,Pe){Pe=Pe||{};var Ze={};for(var ve in Ue)Ze[ve]=new Y(Ue[ve].features,Pe),Ze[ve].name=ve,Ze[ve].version=Pe.version,Ze[ve].extent=Pe.extent;return H({layers:Ze})},wt.exports.GeoJSONWrapper=Y,wt.exports}(),It=A.cP(Ft);const oi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ke=>ke},Xt=Math.fround||(ri=new Float32Array(1),ke=>(ri[0]=+ke,ri[0]));var ri;class li{constructor(Y){this.options=Object.assign(Object.create(oi),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:H,minZoom:W,maxZoom:ce}=this.options;H&&console.time("total time");const xe=`prepare ${Y.length} points`;H&&console.time(xe),this.points=Y;const Ee=[];for(let Ie=0;Ie<Y.length;Ie++){const Ve=Y[Ie];if(!Ve.geometry)continue;const[Ue,Pe]=Ve.geometry.coordinates,Ze=Xt(Ht(Ue)),ve=Xt(ui(Pe));Ee.push(Ze,ve,1/0,Ie,-1,1),this.options.reduce&&Ee.push(0)}let Me=this.trees[ce+1]=this._createTree(Ee);H&&console.timeEnd(xe);for(let Ie=ce;Ie>=W;Ie--){const Ve=+Date.now();Me=this.trees[Ie]=this._createTree(this._cluster(Me,Ie)),H&&console.log("z%d: %d clusters in %dms",Ie,Me.numItems,+Date.now()-Ve)}return H&&console.timeEnd("total time"),this}getClusters(Y,H){let W=((Y[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,Y[1]));let xe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)W=-180,xe=180;else if(W>xe){const Pe=this.getClusters([W,ce,180,Ee],H),Ze=this.getClusters([-180,ce,xe,Ee],H);return Pe.concat(Ze)}const Me=this.trees[this._limitZoom(H)],Ie=Me.range(Ht(W),ui(Ee),Ht(xe),ui(ce)),Ve=Me.data,Ue=[];for(const Pe of Ie){const Ze=this.stride*Pe;Ue.push(Ve[Ze+5]>1?ut(Ve,Ze,this.clusterProps):this.points[Ve[Ze+3]])}return Ue}getChildren(Y){const H=this._getOriginId(Y),W=this._getOriginZoom(Y),ce="No cluster with the specified id.",xe=this.trees[W];if(!xe)throw new Error(ce);const Ee=xe.data;if(H*this.stride>=Ee.length)throw new Error(ce);const Me=this.options.radius/(this.options.extent*Math.pow(2,W-1)),Ie=xe.within(Ee[H*this.stride],Ee[H*this.stride+1],Me),Ve=[];for(const Ue of Ie){const Pe=Ue*this.stride;Ee[Pe+4]===Y&&Ve.push(Ee[Pe+5]>1?ut(Ee,Pe,this.clusterProps):this.points[Ee[Pe+3]])}if(Ve.length===0)throw new Error(ce);return Ve}getLeaves(Y,H,W){const ce=[];return this._appendLeaves(ce,Y,H=H||10,W=W||0,0),ce}getTile(Y,H,W){const ce=this.trees[this._limitZoom(Y)],xe=Math.pow(2,Y),{extent:Ee,radius:Me}=this.options,Ie=Me/Ee,Ve=(W-Ie)/xe,Ue=(W+1+Ie)/xe,Pe={features:[]};return this._addTileFeatures(ce.range((H-Ie)/xe,Ve,(H+1+Ie)/xe,Ue),ce.data,H,W,xe,Pe),H===0&&this._addTileFeatures(ce.range(1-Ie/xe,Ve,1,Ue),ce.data,xe,W,xe,Pe),H===xe-1&&this._addTileFeatures(ce.range(0,Ve,Ie/xe,Ue),ce.data,-1,W,xe,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(Y){let H=this._getOriginZoom(Y)-1;for(;H<=this.options.maxZoom;){const W=this.getChildren(Y);if(H++,W.length!==1)break;Y=W[0].properties.cluster_id}return H}_appendLeaves(Y,H,W,ce,xe){const Ee=this.getChildren(H);for(const Me of Ee){const Ie=Me.properties;if(Ie&&Ie.cluster?xe+Ie.point_count<=ce?xe+=Ie.point_count:xe=this._appendLeaves(Y,Ie.cluster_id,W,ce,xe):xe<ce?xe++:Y.push(Me),Y.length===W)break}return xe}_createTree(Y){const H=new A.aH(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<Y.length;W+=this.stride)H.add(Y[W],Y[W+1]);return H.finish(),H.data=Y,H}_addTileFeatures(Y,H,W,ce,xe,Ee){for(const Me of Y){const Ie=Me*this.stride,Ve=H[Ie+5]>1;let Ue,Pe,Ze;if(Ve)Ue=Bt(H,Ie,this.clusterProps),Pe=H[Ie],Ze=H[Ie+1];else{const qe=this.points[H[Ie+3]];Ue=qe.properties;const[ct,St]=qe.geometry.coordinates;Pe=Ht(ct),Ze=ui(St)}const ve={type:1,geometry:[[Math.round(this.options.extent*(Pe*xe-W)),Math.round(this.options.extent*(Ze*xe-ce))]],tags:Ue};let st;st=Ve||this.options.generateId?H[Ie+3]:this.points[H[Ie+3]].id,st!==void 0&&(ve.id=st),Ee.features.push(ve)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,H){const{radius:W,extent:ce,reduce:xe,minPoints:Ee}=this.options,Me=W/(ce*Math.pow(2,H)),Ie=Y.data,Ve=[],Ue=this.stride;for(let Pe=0;Pe<Ie.length;Pe+=Ue){if(Ie[Pe+2]<=H)continue;Ie[Pe+2]=H;const Ze=Ie[Pe],ve=Ie[Pe+1],st=Y.within(Ie[Pe],Ie[Pe+1],Me),qe=Ie[Pe+5];let ct=qe;for(const St of st){const Dt=St*Ue;Ie[Dt+2]>H&&(ct+=Ie[Dt+5])}if(ct>qe&&ct>=Ee){let St,Dt=Ze*qe,wi=ve*qe,mi=-1;const hi=(Pe/Ue<<5)+(H+1)+this.points.length;for(const Pt of st){const Qt=Pt*Ue;if(Ie[Qt+2]<=H)continue;Ie[Qt+2]=H;const Zi=Ie[Qt+5];Dt+=Ie[Qt]*Zi,wi+=Ie[Qt+1]*Zi,Ie[Qt+4]=hi,xe&&(St||(St=this._map(Ie,Pe,!0),mi=this.clusterProps.length,this.clusterProps.push(St)),xe(St,this._map(Ie,Qt)))}Ie[Pe+4]=hi,Ve.push(Dt/ct,wi/ct,1/0,hi,-1,ct),xe&&Ve.push(mi)}else{for(let St=0;St<Ue;St++)Ve.push(Ie[Pe+St]);if(ct>1)for(const St of st){const Dt=St*Ue;if(!(Ie[Dt+2]<=H)){Ie[Dt+2]=H;for(let wi=0;wi<Ue;wi++)Ve.push(Ie[Dt+wi])}}}}return Ve}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,H,W){if(Y[H+5]>1){const Ee=this.clusterProps[Y[H+6]];return W?Object.assign({},Ee):Ee}const ce=this.points[Y[H+3]].properties,xe=this.options.map(ce);return W&&xe===ce?Object.assign({},xe):xe}}function ut(ke,Y,H){return{type:"Feature",id:ke[Y+3],properties:Bt(ke,Y,H),geometry:{type:"Point",coordinates:[(W=ke[Y],360*(W-.5)),Li(ke[Y+1])]}};var W}function Bt(ke,Y,H){const W=ke[Y+5],ce=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,xe=ke[Y+6],Ee=xe===-1?{}:Object.assign({},H[xe]);return Object.assign(Ee,{cluster:!0,cluster_id:ke[Y+3],point_count:W,point_count_abbreviated:ce})}function Ht(ke){return ke/360+.5}function ui(ke){const Y=Math.sin(ke*Math.PI/180),H=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return H<0?0:H>1?1:H}function Li(ke){const Y=(180-360*ke)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function gi(ke,Y,H,W){let ce=W;const xe=Y+(H-Y>>1);let Ee,Me=H-Y;const Ie=ke[Y],Ve=ke[Y+1],Ue=ke[H],Pe=ke[H+1];for(let Ze=Y+3;Ze<H;Ze+=3){const ve=xt(ke[Ze],ke[Ze+1],Ie,Ve,Ue,Pe);if(ve>ce)Ee=Ze,ce=ve;else if(ve===ce){const st=Math.abs(Ze-xe);st<Me&&(Ee=Ze,Me=st)}}ce>W&&(Ee-Y>3&&gi(ke,Y,Ee,W),ke[Ee+2]=ce,H-Ee>3&&gi(ke,Ee,H,W))}function xt(ke,Y,H,W,ce,xe){let Ee=ce-H,Me=xe-W;if(Ee!==0||Me!==0){const Ie=((ke-H)*Ee+(Y-W)*Me)/(Ee*Ee+Me*Me);Ie>1?(H=ce,W=xe):Ie>0&&(H+=Ee*Ie,W+=Me*Ie)}return Ee=ke-H,Me=Y-W,Ee*Ee+Me*Me}function bi(ke,Y,H,W){const ce={id:ke??null,type:Y,geometry:H,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")jt(ce,H);else if(Y==="Polygon")jt(ce,H[0]);else if(Y==="MultiLineString")for(const xe of H)jt(ce,xe);else if(Y==="MultiPolygon")for(const xe of H)jt(ce,xe[0]);return ce}function jt(ke,Y){for(let H=0;H<Y.length;H+=3)ke.minX=Math.min(ke.minX,Y[H]),ke.minY=Math.min(ke.minY,Y[H+1]),ke.maxX=Math.max(ke.maxX,Y[H]),ke.maxY=Math.max(ke.maxY,Y[H+1])}function yi(ke,Y,H,W){if(!Y.geometry)return;const ce=Y.geometry.coordinates;if(ce&&ce.length===0)return;const xe=Y.geometry.type,Ee=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let Me=[],Ie=Y.id;if(H.promoteId?Ie=Y.properties[H.promoteId]:H.generateId&&(Ie=W||0),xe==="Point")Ot(ce,Me);else if(xe==="MultiPoint")for(const Ve of ce)Ot(Ve,Me);else if(xe==="LineString")Bi(ce,Me,Ee,!1);else if(xe==="MultiLineString"){if(H.lineMetrics){for(const Ve of ce)Me=[],Bi(Ve,Me,Ee,!1),ke.push(bi(Ie,"LineString",Me,Y.properties));return}hr(ce,Me,Ee,!1)}else if(xe==="Polygon")hr(ce,Me,Ee,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Ve of Y.geometry.geometries)yi(ke,{id:Ie,geometry:Ve,properties:Y.properties},H,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ve of ce){const Ue=[];hr(Ve,Ue,Ee,!0),Me.push(Ue)}}ke.push(bi(Ie,xe,Me,Y.properties))}function Ot(ke,Y){Y.push(dr(ke[0]),ze(ke[1]),0)}function Bi(ke,Y,H,W){let ce,xe,Ee=0;for(let Ie=0;Ie<ke.length;Ie++){const Ve=dr(ke[Ie][0]),Ue=ze(ke[Ie][1]);Y.push(Ve,Ue,0),Ie>0&&(Ee+=W?(ce*Ue-Ve*xe)/2:Math.sqrt(Math.pow(Ve-ce,2)+Math.pow(Ue-xe,2))),ce=Ve,xe=Ue}const Me=Y.length-3;Y[2]=1,gi(Y,0,Me,H),Y[Me+2]=1,Y.size=Math.abs(Ee),Y.start=0,Y.end=Y.size}function hr(ke,Y,H,W){for(let ce=0;ce<ke.length;ce++){const xe=[];Bi(ke[ce],xe,H,W),Y.push(xe)}}function dr(ke){return ke/360+.5}function ze(ke){const Y=Math.sin(ke*Math.PI/180),H=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return H<0?0:H>1?1:H}function ji(ke,Y,H,W,ce,xe,Ee,Me){if(W/=Y,xe>=(H/=Y)&&Ee<W)return ke;if(Ee<H||xe>=W)return null;const Ie=[];for(const Ve of ke){const Ue=Ve.geometry;let Pe=Ve.type;const Ze=ce===0?Ve.minX:Ve.minY,ve=ce===0?Ve.maxX:Ve.maxY;if(Ze>=H&&ve<W){Ie.push(Ve);continue}if(ve<H||Ze>=W)continue;let st=[];if(Pe==="Point"||Pe==="MultiPoint")vi(Ue,st,H,W,ce);else if(Pe==="LineString")yt(Ue,st,H,W,ce,!1,Me.lineMetrics);else if(Pe==="MultiLineString")ci(Ue,st,H,W,ce,!1);else if(Pe==="Polygon")ci(Ue,st,H,W,ce,!0);else if(Pe==="MultiPolygon")for(const qe of Ue){const ct=[];ci(qe,ct,H,W,ce,!0),ct.length&&st.push(ct)}if(st.length){if(Me.lineMetrics&&Pe==="LineString"){for(const qe of st)Ie.push(bi(Ve.id,Pe,qe,Ve.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(st.length===1?(Pe="LineString",st=st[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=st.length===3?"Point":"MultiPoint"),Ie.push(bi(Ve.id,Pe,st,Ve.tags))}}return Ie.length?Ie:null}function vi(ke,Y,H,W,ce){for(let xe=0;xe<ke.length;xe+=3){const Ee=ke[xe+ce];Ee>=H&&Ee<=W&&Yn(Y,ke[xe],ke[xe+1],ke[xe+2])}}function yt(ke,Y,H,W,ce,xe,Ee){let Me=me(ke);const Ie=ce===0?tn:ps;let Ve,Ue,Pe=ke.start;for(let ct=0;ct<ke.length-3;ct+=3){const St=ke[ct],Dt=ke[ct+1],wi=ke[ct+2],mi=ke[ct+3],hi=ke[ct+4],Pt=ce===0?St:Dt,Qt=ce===0?mi:hi;let Zi=!1;Ee&&(Ve=Math.sqrt(Math.pow(St-mi,2)+Math.pow(Dt-hi,2))),Pt<H?Qt>H&&(Ue=Ie(Me,St,Dt,mi,hi,H),Ee&&(Me.start=Pe+Ve*Ue)):Pt>W?Qt<W&&(Ue=Ie(Me,St,Dt,mi,hi,W),Ee&&(Me.start=Pe+Ve*Ue)):Yn(Me,St,Dt,wi),Qt<H&&Pt>=H&&(Ue=Ie(Me,St,Dt,mi,hi,H),Zi=!0),Qt>W&&Pt<=W&&(Ue=Ie(Me,St,Dt,mi,hi,W),Zi=!0),!xe&&Zi&&(Ee&&(Me.end=Pe+Ve*Ue),Y.push(Me),Me=me(ke)),Ee&&(Pe+=Ve)}let Ze=ke.length-3;const ve=ke[Ze],st=ke[Ze+1],qe=ce===0?ve:st;qe>=H&&qe<=W&&Yn(Me,ve,st,ke[Ze+2]),Ze=Me.length-3,xe&&Ze>=3&&(Me[Ze]!==Me[0]||Me[Ze+1]!==Me[1])&&Yn(Me,Me[0],Me[1],Me[2]),Me.length&&Y.push(Me)}function me(ke){const Y=[];return Y.size=ke.size,Y.start=ke.start,Y.end=ke.end,Y}function ci(ke,Y,H,W,ce,xe){for(const Ee of ke)yt(Ee,Y,H,W,ce,xe,!1)}function Yn(ke,Y,H,W){ke.push(Y,H,W)}function tn(ke,Y,H,W,ce,xe){const Ee=(xe-Y)/(W-Y);return Yn(ke,xe,H+(ce-H)*Ee,1),Ee}function ps(ke,Y,H,W,ce,xe){const Ee=(xe-H)/(ce-H);return Yn(ke,Y+(W-Y)*Ee,xe,1),Ee}function nn(ke,Y){const H=[];for(let W=0;W<ke.length;W++){const ce=ke[W],xe=ce.type;let Ee;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Ee=Hn(ce.geometry,Y);else if(xe==="MultiLineString"||xe==="Polygon"){Ee=[];for(const Me of ce.geometry)Ee.push(Hn(Me,Y))}else if(xe==="MultiPolygon"){Ee=[];for(const Me of ce.geometry){const Ie=[];for(const Ve of Me)Ie.push(Hn(Ve,Y));Ee.push(Ie)}}H.push(bi(ce.id,xe,Ee,ce.tags))}return H}function Hn(ke,Y){const H=[];H.size=ke.size,ke.start!==void 0&&(H.start=ke.start,H.end=ke.end);for(let W=0;W<ke.length;W+=3)H.push(ke[W]+Y,ke[W+1],ke[W+2]);return H}function Je(ke,Y){if(ke.transformed)return ke;const H=1<<ke.z,W=ke.x,ce=ke.y;for(const xe of ke.features){const Ee=xe.geometry,Me=xe.type;if(xe.geometry=[],Me===1)for(let Ie=0;Ie<Ee.length;Ie+=2)xe.geometry.push(Kr(Ee[Ie],Ee[Ie+1],Y,H,W,ce));else for(let Ie=0;Ie<Ee.length;Ie++){const Ve=[];for(let Ue=0;Ue<Ee[Ie].length;Ue+=2)Ve.push(Kr(Ee[Ie][Ue],Ee[Ie][Ue+1],Y,H,W,ce));xe.geometry.push(Ve)}}return ke.transformed=!0,ke}function Kr(ke,Y,H,W,ce,xe){return[Math.round(H*(ke*W-ce)),Math.round(H*(Y*W-xe))]}function Rr(ke,Y,H,W,ce){const xe=Y===ce.maxZoom?0:ce.tolerance/((1<<Y)*ce.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:ke.length,source:null,x:H,y:W,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Me of ke)fr(Ee,Me,xe,ce);return Ee}function fr(ke,Y,H,W){const ce=Y.geometry,xe=Y.type,Ee=[];if(ke.minX=Math.min(ke.minX,Y.minX),ke.minY=Math.min(ke.minY,Y.minY),ke.maxX=Math.max(ke.maxX,Y.maxX),ke.maxY=Math.max(ke.maxY,Y.maxY),xe==="Point"||xe==="MultiPoint")for(let Me=0;Me<ce.length;Me+=3)Ee.push(ce[Me],ce[Me+1]),ke.numPoints++,ke.numSimplified++;else if(xe==="LineString")ms(Ee,ce,ke,H,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Me=0;Me<ce.length;Me++)ms(Ee,ce[Me],ke,H,xe==="Polygon",Me===0);else if(xe==="MultiPolygon")for(let Me=0;Me<ce.length;Me++){const Ie=ce[Me];for(let Ve=0;Ve<Ie.length;Ve++)ms(Ee,Ie[Ve],ke,H,!0,Ve===0)}if(Ee.length){let Me=Y.tags||null;if(xe==="LineString"&&W.lineMetrics){Me={};for(const Ve in Y.tags)Me[Ve]=Y.tags[Ve];Me.mapbox_clip_start=ce.start/ce.size,Me.mapbox_clip_end=ce.end/ce.size}const Ie={geometry:Ee,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Me};Y.id!==null&&(Ie.id=Y.id),ke.features.push(Ie)}}function ms(ke,Y,H,W,ce,xe){const Ee=W*W;if(W>0&&Y.size<(ce?Ee:W))return void(H.numPoints+=Y.length/3);const Me=[];for(let Ie=0;Ie<Y.length;Ie+=3)(W===0||Y[Ie+2]>Ee)&&(H.numSimplified++,Me.push(Y[Ie],Y[Ie+1])),H.numPoints++;ce&&function(Ie,Ve){let Ue=0;for(let Pe=0,Ze=Ie.length,ve=Ze-2;Pe<Ze;ve=Pe,Pe+=2)Ue+=(Ie[Pe]-Ie[ve])*(Ie[Pe+1]+Ie[ve+1]);if(Ue>0===Ve)for(let Pe=0,Ze=Ie.length;Pe<Ze/2;Pe+=2){const ve=Ie[Pe],st=Ie[Pe+1];Ie[Pe]=Ie[Ze-2-Pe],Ie[Pe+1]=Ie[Ze-1-Pe],Ie[Ze-2-Pe]=ve,Ie[Ze-1-Pe]=st}}(Me,xe),ke.push(Me)}const Vt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class pr{constructor(Y,H){const W=(H=this.options=function(xe,Ee){for(const Me in Ee)xe[Me]=Ee[Me];return xe}(Object.create(Vt),H)).debug;if(W&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let ce=function(xe,Ee){const Me=[];if(xe.type==="FeatureCollection")for(let Ie=0;Ie<xe.features.length;Ie++)yi(Me,xe.features[Ie],Ee,Ie);else yi(Me,xe.type==="Feature"?xe:{geometry:xe},Ee);return Me}(Y,H);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(xe,Ee){const Me=Ee.buffer/Ee.extent;let Ie=xe;const Ve=ji(xe,1,-1-Me,Me,0,-1,2,Ee),Ue=ji(xe,1,1-Me,2+Me,0,-1,2,Ee);return(Ve||Ue)&&(Ie=ji(xe,1,-Me,1+Me,0,-1,2,Ee)||[],Ve&&(Ie=nn(Ve,1).concat(Ie)),Ue&&(Ie=Ie.concat(nn(Ue,-1)))),Ie}(ce,H),ce.length&&this.splitTile(ce,0,0,0),W&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,H,W,ce,xe,Ee,Me){const Ie=[Y,H,W,ce],Ve=this.options,Ue=Ve.debug;for(;Ie.length;){ce=Ie.pop(),W=Ie.pop(),H=Ie.pop(),Y=Ie.pop();const Pe=1<<H,Ze=ir(H,W,ce);let ve=this.tiles[Ze];if(!ve&&(Ue>1&&console.time("creation"),ve=this.tiles[Ze]=Rr(Y,H,W,ce,Ve),this.tileCoords.push({z:H,x:W,y:ce}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,W,ce,ve.numFeatures,ve.numPoints,ve.numSimplified),console.timeEnd("creation"));const Zi=`z${H}`;this.stats[Zi]=(this.stats[Zi]||0)+1,this.total++}if(ve.source=Y,xe==null){if(H===Ve.indexMaxZoom||ve.numPoints<=Ve.indexMaxPoints)continue}else{if(H===Ve.maxZoom||H===xe)continue;if(xe!=null){const Zi=xe-H;if(W!==Ee>>Zi||ce!==Me>>Zi)continue}}if(ve.source=null,Y.length===0)continue;Ue>1&&console.time("clipping");const st=.5*Ve.buffer/Ve.extent,qe=.5-st,ct=.5+st,St=1+st;let Dt=null,wi=null,mi=null,hi=null,Pt=ji(Y,Pe,W-st,W+ct,0,ve.minX,ve.maxX,Ve),Qt=ji(Y,Pe,W+qe,W+St,0,ve.minX,ve.maxX,Ve);Y=null,Pt&&(Dt=ji(Pt,Pe,ce-st,ce+ct,1,ve.minY,ve.maxY,Ve),wi=ji(Pt,Pe,ce+qe,ce+St,1,ve.minY,ve.maxY,Ve),Pt=null),Qt&&(mi=ji(Qt,Pe,ce-st,ce+ct,1,ve.minY,ve.maxY,Ve),hi=ji(Qt,Pe,ce+qe,ce+St,1,ve.minY,ve.maxY,Ve),Qt=null),Ue>1&&console.timeEnd("clipping"),Ie.push(Dt||[],H+1,2*W,2*ce),Ie.push(wi||[],H+1,2*W,2*ce+1),Ie.push(mi||[],H+1,2*W+1,2*ce),Ie.push(hi||[],H+1,2*W+1,2*ce+1)}}getTile(Y,H,W){Y=+Y,H=+H,W=+W;const ce=this.options,{extent:xe,debug:Ee}=ce;if(Y<0||Y>24)return null;const Me=1<<Y,Ie=ir(Y,H=H+Me&Me-1,W);if(this.tiles[Ie])return Je(this.tiles[Ie],xe);Ee>1&&console.log("drilling down to z%d-%d-%d",Y,H,W);let Ve,Ue=Y,Pe=H,Ze=W;for(;!Ve&&Ue>0;)Ue--,Pe>>=1,Ze>>=1,Ve=this.tiles[ir(Ue,Pe,Ze)];return Ve&&Ve.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Ue,Pe,Ze),console.time("drilling down")),this.splitTile(Ve.source,Ue,Pe,Ze,Y,H,W),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ie]?Je(this.tiles[Ie],xe):null):null}}function ir(ke,Y,H){return 32*((1<<ke)*H+Y)+ke}function Mn(ke,Y){return Y?ke.properties[Y]:ke.id}function At(ke,Y){if(ke==null)return!0;if(ke.type==="Feature")return Mn(ke,Y)!=null;if(ke.type==="FeatureCollection"){const H=new Set;for(const W of ke.features){const ce=Mn(W,Y);if(ce==null||H.has(ce))return!1;H.add(ce)}return!0}return!1}function gs(ke,Y){const H=new Map;if(ke!=null)if(ke.type==="Feature")H.set(Mn(ke,Y),ke);else for(const W of ke.features)H.set(Mn(W,Y),W);return H}class si extends de{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Y,H){return A._(this,void 0,void 0,function*(){const W=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ce)return null;const xe=new nt(ce.features);let Ee=It(xe);return Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),{vectorTile:xe,rawData:Ee.buffer}})}loadData(Y){return A._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const W=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new A.cM(Y.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Y,this._pendingRequest),this._geoJSONIndex=Y.cluster?new li(function({superclusterOptions:Ee,clusterProperties:Me}){if(!Me||!Ee)return Ee;const Ie={},Ve={},Ue={accumulated:null,zoom:0},Pe={properties:null},Ze=Object.keys(Me);for(const ve of Ze){const[st,qe]=Me[ve],ct=A.cT(qe),St=A.cT(typeof st=="string"?[st,["accumulated"],["get",ve]]:st);Ie[ve]=ct.value,Ve[ve]=St.value}return Ee.map=ve=>{Pe.properties=ve;const st={};for(const qe of Ze)st[qe]=Ie[qe].evaluate(Ue,Pe);return st},Ee.reduce=(ve,st)=>{Pe.properties=st;for(const qe of Ze)Ue.accumulated=ve[qe],ve[qe]=Ve[qe].evaluate(Ue,Pe)},Ee}(Y)).load((yield this._pendingData).features):(ce=yield this._pendingData,new pr(ce,Y.geojsonVtOptions)),this.loaded={};const xe={};if(W){const Ee=W.finish();Ee&&(xe.resourceTiming={},xe.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ee)))}return xe}catch(xe){if(delete this._pendingRequest,A.cx(xe))return{abandoned:!0};throw xe}var ce})}getData(){return A._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Y){const H=this.loaded;return H&&H[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadAndProcessGeoJSON(Y,H){return A._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(Y,H);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(pt(W,!0),Y.filter){const ce=A.cT(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(Ee=>ce.value.evaluate({zoom:0},Ee))}}return W})}loadGeoJSON(Y,H){return A._(this,void 0,void 0,function*(){const{promoteId:W}=Y;if(Y.request){const ce=yield A.j(Y.request,H);return this._dataUpdateable=At(ce.data,W)?gs(ce.data,W):void 0,ce.data}if(typeof Y.data=="string")try{const ce=JSON.parse(Y.data);return this._dataUpdateable=At(ce,W)?gs(ce,W):void 0,ce}catch{throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`)}if(!Y.dataDiff)throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Y.source}`);return function(ce,xe,Ee){var Me,Ie,Ve,Ue;if(xe.removeAll&&ce.clear(),xe.remove)for(const Pe of xe.remove)ce.delete(Pe);if(xe.add)for(const Pe of xe.add){const Ze=Mn(Pe,Ee);Ze!=null&&ce.set(Ze,Pe)}if(xe.update)for(const Pe of xe.update){let Ze=ce.get(Pe.id);if(Ze==null)continue;const ve=!Pe.removeAllProperties&&(((Me=Pe.removeProperties)===null||Me===void 0?void 0:Me.length)>0||((Ie=Pe.addOrUpdateProperties)===null||Ie===void 0?void 0:Ie.length)>0);if((Pe.newGeometry||Pe.removeAllProperties||ve)&&(Ze=Object.assign({},Ze),ce.set(Pe.id,Ze),ve&&(Ze.properties=Object.assign({},Ze.properties))),Pe.newGeometry&&(Ze.geometry=Pe.newGeometry),Pe.removeAllProperties)Ze.properties={};else if(((Ve=Pe.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0)for(const st of Pe.removeProperties)Object.prototype.hasOwnProperty.call(Ze.properties,st)&&delete Ze.properties[st];if(((Ue=Pe.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:st,value:qe}of Pe.addOrUpdateProperties)Ze.properties[st]=qe}}(this._dataUpdateable,Y.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Y){return A._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}class Nt{constructor(Y){this.self=Y,this.actor=new A.J(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,W)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=W},this.self.addProtocol=A.cz,this.self.removeProtocol=A.cA,this.self.registerRTLTextPlugin=H=>{A.cU.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,W)=>this._getDEMWorkerSource(H,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(H,W)=>A._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(H,W)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(H,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(H,W)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(H,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(H,W)=>A._(this,void 0,void 0,function*(){return this._getWorkerSource(H,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(H,W)=>this._getWorkerSource(H,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(H,W)=>this._getWorkerSource(H,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(H,W)=>this._getWorkerSource(H,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(H,W)=>this._getWorkerSource(H,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(H,W)=>this._getWorkerSource(H,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(H,W)=>this._getWorkerSource(H,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(H,W)=>A._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][W.type]||!this.workerSources[H][W.type][W.source])return;const ce=this.workerSources[H][W.type][W.source];delete this.workerSources[H][W.type][W.source],ce.removeSource!==void 0&&ce.removeSource(W)})),this.actor.registerMessageHandler("RM",H=>A._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,W)=>A._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(H,W)=>this._syncRTLPluginState(H,W)),this.actor.registerMessageHandler("IS",(H,W)=>A._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(H,W)=>this._setImages(H,W)),this.actor.registerMessageHandler("UL",(H,W)=>A._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(H,W)=>A._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(W)}))}_setImages(Y,H){return A._(this,void 0,void 0,function*(){this.availableImages[Y]=H;for(const W in this.workerSources[Y]){const ce=this.workerSources[Y][W];for(const xe in ce)ce[xe].availableImages=H}})}_syncRTLPluginState(Y,H){return A._(this,void 0,void 0,function*(){return yield A.cU.syncState(H,this.self.importScripts)})}_getAvailableImages(Y){let H=this.availableImages[Y];return H||(H=[]),H}_getLayerIndex(Y){let H=this.layerIndexes[Y];return H||(H=this.layerIndexes[Y]=new u),H}_getWorkerSource(Y,H,W){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][H]||(this.workerSources[Y][H]={}),!this.workerSources[Y][H][W]){const ce={sendAsync:(xe,Ee)=>(xe.targetMapId=Y,this.actor.sendAsync(xe,Ee))};switch(H){case"vector":this.workerSources[Y][H][W]=new de(ce,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][H][W]=new si(ce,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][H][W]=new this.externalWorkerSourceTypes[H](ce,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][H][W]}_getDEMWorkerSource(Y,H){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][H]||(this.demWorkerSources[Y][H]=new we),this.demWorkerSources[Y][H]}}return A.i(self)&&(self.worker=new Nt(self)),Nt}),B("index",["exports","./shared"],function(A,u){var Le="5.6.0";function Ae(){var p=new u.A(4);return u.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}let _e,de;const we={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(p,e,i){const l=requestAnimationFrame(m=>{c(),e(m)}),{unsubscribe:c}=u.s(p.signal,"abort",()=>{c(),cancelAnimationFrame(l),i(u.c())},!1)},frameAsync(p){return new Promise((e,i)=>{this.frame(p,e,i)})},getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,i.drawImage(p,0,0,p.width,p.height),i},resolveURL:p=>(_e||(_e=document.createElement("a")),_e.href=p,_e.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(de==null&&(de=matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}};class ae{static testProp(e){if(!ae.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in ae.docStyle)return e[i];return e[0]}static create(e,i,l){const c=window.document.createElement(e);return i!==void 0&&(c.className=i),l&&l.appendChild(c),c}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){ae.docStyle&&ae.selectProp&&(ae.userSelect=ae.docStyle[ae.selectProp],ae.docStyle[ae.selectProp]="none")}static enableDrag(){ae.docStyle&&ae.selectProp&&(ae.docStyle[ae.selectProp]=ae.userSelect)}static setTransform(e,i){e.style[ae.transformProp]=i}static addEventListener(e,i,l,c={}){e.addEventListener(i,l,"passive"in c?c:c.capture)}static removeEventListener(e,i,l,c={}){e.removeEventListener(i,l,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ae.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ae.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ae.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,l){const c=i.boundingClientRect;return new u.P((l.clientX-c.left)/i.x-e.clientLeft,(l.clientY-c.top)/i.y-e.clientTop)}static mousePos(e,i){const l=ae.getScale(e);return ae.getPoint(e,l,i)}static touchPos(e,i){const l=[],c=ae.getScale(e);for(let m=0;m<i.length;m++)l.push(ae.getPoint(e,c,i[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=i.querySelectorAll("script");for(const c of l)c.remove();return ae.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const l=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const l of i)ae.removeAttributes(l),ae.clean(l)}static removeAttributes(e){for(const{name:i,value:l}of e.attributes)ae.isPossiblyDangerous(i,l)&&e.removeAttribute(i)}}ae.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ae.selectProp=ae.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ae.transformProp=ae.testProp(["transform","WebkitTransform"]);const Te={supported:!1,testSupport:function(p){!Ct&&pt&&(vt?nt(p):ot=p)}};let ot,pt,Ct=!1,vt=!1;function nt(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,pt),p.isContextLost())return;Te.supported=!0}catch{}p.deleteTexture(e),Ct=!0}var ft;typeof document<"u"&&(pt=document.createElement("img"),pt.onload=()=>{ot&&nt(ot),ot=null,vt=!0},pt.onerror=()=>{Ct=!0,ot=null},pt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,i,l,c;p.resetRequestQueue=()=>{e=[],i=0,l=0,c={}},p.addThrottleControl=T=>{const E=l++;return c[E]=T,E},p.removeThrottleControl=T=>{delete c[T],y()},p.getImage=(T,E,C=!0)=>new Promise((z,R)=>{Te.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),u.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:C,state:"queued",onError:U=>{R(U)},onSuccess:U=>{z(U)}}),y()});const m=T=>u._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:E,supportImageRefresh:C,onError:z,onSuccess:R,abortController:U}=T,Z=C===!1&&!u.i(self)&&!u.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((ie,se)=>ie&&se==="accept",!0));i++;const te=Z?b(E,U):u.m(E,U);try{const ie=yield te;delete T.abortController,T.state="completed",ie.data instanceof HTMLImageElement||u.b(ie.data)?R(ie):ie.data&&R({data:yield(ee=ie.data,typeof createImageBitmap=="function"?u.f(ee):u.h(ee)),cacheControl:ie.cacheControl,expires:ie.expires})}catch(ie){delete T.abortController,z(ie)}finally{i--,y()}var ee}),y=()=>{const T=(()=>{for(const E of Object.keys(c))if(c[E]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=i;E<T&&e.length>0;E++){const C=e.shift();C.abortController.signal.aborted?E--:m(C)}},b=(T,E)=>new Promise((C,z)=>{const R=new Image,U=T.url,Z=T.credentials;Z&&Z==="include"?R.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!u.d(U))&&(R.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{R.src="",z(u.c())}),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,C({data:R})},R.onerror=()=>{R.onerror=R.onload=null,E.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=U})}(ft||(ft={})),ft.resetRequestQueue();class rt{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function lt(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const i=[];for(const{id:l,url:c}of p){const m=`${l}${c}`;i.indexOf(m)===-1&&(i.push(m),e.push({id:l,url:c}))}}return e}function wt(p,e,i){try{const l=new URL(p);return l.pathname+=`${e}${i}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${p}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Ft(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class It extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:l}of this.requestors)l(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const l=i.spriteData;i.data=new u.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let l=!0;const c=i.data||i.spriteData;return this._validateStretch(i.stretchX,c&&c.width)||(this.fire(new u.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(i.stretchY,c&&c.height)||(this.fire(new u.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(i.content,i)||(this.fire(new u.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,i){if(!e)return!0;let l=0;for(const c of e){if(c[0]<l||c[1]<c[0]||i<c[1])return!1;l=c[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const l=i.spriteData,c=l&&l.width||i.data.width,m=l&&l.height||i.data.height;return!(e[0]<0||c<e[0]||e[1]<0||m<e[1]||e[2]<0||c<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,l=!0){const c=this.getImage(e);if(l&&(c.data.width!==i.data.width||c.data.height!==i.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=c.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,l)=>{let c=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(c=!1);this.isLoaded()||c?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const l of e){let c=this.getImage(l);c||(this.fire(new u.l("styleimagemissing",{id:l})),c=this.getImage(l)),c?i[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:u.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],l=this.getImage(e);if(!l)return null;if(i&&i.position.version===l.version)return i.position;if(i)i.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new u.I(c,l);this.patterns[e]={bin:c,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.T(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:i,h:l}=u.p(e),c=this.atlasImage;c.resize({width:i||1,height:l||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],b=y.x+1,T=y.y+1,E=this.getImage(m).data,C=E.width,z=E.height;u.R.copy(E,c,{x:0,y:0},{x:b,y:T},{width:C,height:z}),u.R.copy(E,c,{x:0,y:z-1},{x:b,y:T-1},{width:C,height:1}),u.R.copy(E,c,{x:0,y:0},{x:b,y:T+z},{width:C,height:1}),u.R.copy(E,c,{x:C-1,y:0},{x:b-1,y:T},{width:1,height:z}),u.R.copy(E,c,{x:0,y:0},{x:b+C,y:T},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const l=this.getImage(i);l||u.w(`Image with ID: "${i}" was not found`),Ft(l)&&this.updateImage(i,l)}}}const oi=1e20;function Xt(p,e,i,l,c,m,y,b,T){for(let E=e;E<e+l;E++)ri(p,i*m+E,m,c,y,b,T);for(let E=i;E<i+c;E++)ri(p,E*m+e,1,l,y,b,T)}function ri(p,e,i,l,c,m,y){m[0]=0,y[0]=-1e20,y[1]=oi,c[0]=p[e];for(let b=1,T=0,E=0;b<l;b++){c[b]=p[e+b*i];const C=b*b;do{const z=m[T];E=(c[b]-c[z]+C-z*z)/(b-z)/2}while(E<=y[T]&&--T>-1);T++,m[T]=b,y[T]=E,y[T+1]=oi}for(let b=0,T=0;b<l;b++){for(;y[T+1]<b;)T++;const E=m[T],C=b-E;p[e+b*i]=c[E]+C*C}}class li{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,function*(){const i=[];for(const m in e)for(const y of e[m])i.push(this._getAndCacheGlyphsPromise(m,y));const l=yield Promise.all(i),c={};for(const{stack:m,id:y,glyph:b}of l)c[m]||(c[m]={}),c[m][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(e,i){return u._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=l.glyphs[i];if(c!==void 0)return{stack:e,id:i,glyph:c};if(c=this._tinySDF(l,e,i),c)return l.glyphs[i]=c,{stack:e,id:i,glyph:c};const m=Math.floor(i/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:e,id:i,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const b=li.loadGlyphRange(e,m,this.url,this.requestManager);l.requests[m]=b}const y=yield l.requests[m];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=y[+b]);return l.ranges[m]=!0,{stack:e,id:i,glyph:y[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||u.u["CJK Unified Ideographs"](e)||u.u["Hangul Syllables"](e)||u.u.Hiragana(e)||u.u.Katakana(e)||u.u["CJK Symbols and Punctuation"](e)||u.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,l){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let b="400";/bold/i.test(i)?b="900":/medium/i.test(i)?b="500":/light/i.test(i)&&(b="200"),m=e.tinySDF=new li.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const y=m.draw(String.fromCharCode(l));return{id:l,bitmap:new u.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}li.loadGlyphRange=function(p,e,i,l){return u._(this,void 0,void 0,function*(){const c=256*e,m=c+255,y=l.transformRequest(i.replace("{fontstack}",p).replace("{range}",`${c}-${m}`),"Glyphs"),b=yield u.n(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${m}`);const T={};for(const E of u.o(b.data))T[E.id]=E;return T})},li.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const b=this.size=p+4*e,T=this._createCanvas(b),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${m} ${p}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(p),y=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),E=b+2*this.buffer,C=T+2*this.buffer,z=Math.max(E*C,0),R=new Uint8ClampedArray(z),U={data:R,width:E,height:C,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||T===0)return U;const{ctx:Z,buffer:te,gridInner:ee,gridOuter:ie}=this;Z.clearRect(te,te,b,T),Z.fillText(p,te,te+y);const se=Z.getImageData(te,te,b,T);ie.fill(oi,0,z),ee.fill(0,0,z);for(let fe=0;fe<T;fe++)for(let oe=0;oe<b;oe++){const ge=se.data[4*(fe*b+oe)+3]/255;if(ge===0)continue;const ye=(fe+te)*E+oe+te;if(ge===1)ie[ye]=0,ee[ye]=oi;else{const ue=.5-ge;ie[ye]=ue>0?ue*ue:0,ee[ye]=ue<0?ue*ue:0}}Xt(ie,0,0,E,C,E,this.f,this.v,this.z),Xt(ee,te,te,b,T,E,this.f,this.v,this.z);for(let fe=0;fe<z;fe++){const oe=Math.sqrt(ie[fe])-Math.sqrt(ee[fe]);R[fe]=Math.round(255-255*(oe/this.radius+this.cutoff))}return U}};class ut{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,i){return u.B(e.expression.evaluate(i))}interpolate(e,i,l){return{x:u.C.number(e.x,i.x,l),y:u.C.number(e.y,i.y,l),z:u.C.number(e.z,i.z,l)}}}let Bt;class Ht extends u.E{constructor(e){super(),Bt=Bt||new u.r({anchor:new u.D(u.v.light.anchor),position:new ut,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.t(Bt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(u.x,e,i))for(const l in e){const c=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,l){return(!l||l.validate!==!1)&&u.y(this,e.call(u.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const ui=new u.r({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class Li extends u.E{constructor(e){super(),this._transitionable=new u.t(ui),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.F(0))}setSky(e,i={}){if(!this._validate(u.G,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const c=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,l={}){return(l==null?void 0:l.validate)!==!1&&u.y(this,e.call(u.z,u.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class gi{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const l=e.join(",")+String(i);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,i)),this.dashEntry[l]}getDashRanges(e,i,l){const c=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,b=!0;c.push({left:m,right:y,isDash:b,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){b=!b;const C=e[E];m=T*l,T+=C,y=T*l,c.push({left:m,right:y,isDash:b,zeroLength:C===0})}return c}addRoundDash(e,i,l){const c=i/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let b=0,T=e[b];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++b]);const C=Math.abs(E-T.left),z=Math.abs(E-T.right),R=Math.min(C,z);let U;const Z=m/l*(c+1);if(T.isDash){const te=c-Math.abs(Z);U=Math.sqrt(R*R+te*te)}else U=c-Math.sqrt(R*R+Z*Z);this.data[y+E]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const T=e[b],E=e[b+1];T.zeroLength?e.splice(b,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(b,1))}const i=e[0],l=e[e.length-1];i.isDash===l.isDash&&(i.left=l.left-this.width,l.right=i.right+this.width);const c=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const T=Math.abs(b-y.left),E=Math.abs(b-y.right),C=Math.min(T,E);this.data[c+b]=Math.max(0,Math.min(255,(y.isDash?C:-C)+128))}}addDash(e,i){const l=i?7:0,c=2*l+1;if(this.nextRow+c>this.height)return u.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<e.length;b++)m+=e[b];if(m!==0){const b=this.width/m,T=this.getDashRanges(e,this.width,b);i?this.addRoundDash(T,b,l):this.addRegularDash(T)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=c,this.dirty=!0,y}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const xt="maplibre_preloaded_worker_pool";class bi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<bi.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xt]}numActive(){return Object.keys(this.active).length}}const jt=Math.floor(we.hardwareConcurrency/2);let yi,Ot;function Bi(){return yi||(yi=new bi),yi}bi.workerCount=u.H(globalThis)?Math.max(Math.min(jt,3),1):1;class hr{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const l=this.workerPool.acquire(i);for(let c=0;c<l.length;c++){const m=new u.J(l[c],i);m.name=`Worker ${c}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const l=[];for(const c of this.actors)l.push(c.sendAsync({type:e,data:i}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const l of this.actors)l.registerMessageHandler(e,i)}}function dr(){return Ot||(Ot=new hr(Bi(),u.K),Ot.registerMessageHandler("GR",(p,e,i)=>u.m(e,i))),Ot}function ze(p,e){const i=u.L();return u.M(i,i,[1,1,0]),u.N(i,i,[.5*p.width,.5*p.height,1]),p.calculatePosMatrix?u.O(i,i,p.calculatePosMatrix(e.toUnwrapped())):i}function ji(p,e,i,l,c,m,y){var b;const T=function(R,U,Z){if(R)for(const te of R){const ee=U[te];if(ee&&ee.source===Z&&ee.type==="fill-extrusion")return!0}else for(const te in U){const ee=U[te];if(ee.source===Z&&ee.type==="fill-extrusion")return!0}return!1}((b=c==null?void 0:c.layers)!==null&&b!==void 0?b:null,e,p.id),E=m.maxPitchScaleFactor(),C=p.tilesIn(l,E,T);C.sort(vi);const z=[];for(const R of C)z.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,i,p._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,c,m,E,ze(p.transform,R.tileID),y?(U,Z)=>y(R.tileID,U,Z):void 0)});return function(R,U){for(const Z in R)for(const te of R[Z])yt(te,U);return R}(function(R){const U={},Z={};for(const te of R){const ee=te.queryResults,ie=te.wrappedTileID,se=Z[ie]=Z[ie]||{};for(const fe in ee){const oe=ee[fe],ge=se[fe]=se[fe]||{},ye=U[fe]=U[fe]||[];for(const ue of oe)ge[ue.featureIndex]||(ge[ue.featureIndex]=!0,ye.push(ue))}}return U}(z),p)}function vi(p,e){const i=p.tileID,l=e.tileID;return i.overscaledZ-l.overscaledZ||i.canonical.y-l.canonical.y||i.wrap-l.wrap||i.canonical.x-l.canonical.x}function yt(p,e){const i=p.feature,l=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=l}function me(p,e,i){return u._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield u.j(e.transformRequest(p.url,"Source"),i)).data:yield we.frameAsync(i),!l)return null;const c=u.Q(u.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(c.vectorLayerIds=l.vector_layers.map(m=>m.id)),c})}class ci{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.S?new u.S(e.lng,e.lat):u.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.S?new u.S(e.lng,e.lat):u.S.convert(e),this}extend(e){const i=this._sw,l=this._ne;let c,m;if(e instanceof u.S)c=e,m=e;else{if(!(e instanceof ci))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ci.convert(e)):this.extend(u.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.S.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return i||l?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new u.S(c.lng,c.lat),this._ne=new u.S(m.lng,m.lat)),this}getCenter(){return new u.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.S(this.getWest(),this.getNorth())}getSouthEast(){return new u.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=u.S.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(e){return e instanceof ci?e:e&&new ci(e)}static fromLngLat(e,i=0){const l=360*i/40075017,c=l/Math.cos(Math.PI/180*e.lat);return new ci(new u.S(e.lng-c,e.lat-l),new u.S(e.lng+c,e.lat+l))}adjustAntiMeridian(){const e=new u.S(this._sw.lng,this._sw.lat),i=new u.S(this._ne.lng,this._ne.lat);return new ci(e,e.lng>i.lng?new u.S(i.lng+360,i.lat):i)}}class Yn{constructor(e,i,l){this.bounds=ci.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),l=Math.floor(u.V(this.bounds.getWest())*i),c=Math.floor(u.U(this.bounds.getNorth())*i),m=Math.ceil(u.V(this.bounds.getEast())*i),y=Math.ceil(u.U(this.bounds.getSouth())*i);return e.x>=l&&e.x<m&&e.y>=c&&e.y<y}}class tn extends u.E{constructor(e,i,l,c){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.Q(i,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield me(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Yn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};l.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,y)=>{e.reloadPromise={resolve:m,reject:y}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:c,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ps extends u.E{constructor(e,i,l,c){super(),this.id=e,this.dispatcher=l,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},i),u.e(this,u.Q(i,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield me(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(u.e(this,i),i.bounds&&(this.tileBounds=new Yn(i.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new u.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield ft.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const c=this.map.painter.context,m=c.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new u.T(c,y,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class nn extends ps{constructor(e,i,l,c){super(e,i,l,c),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return u._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield ft.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const m=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const y=u.b(m)&&u.W()?m:yield this.readImageNow(m),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.X()){const i=e.width+2,l=e.height+2;try{return new u.R({width:i,height:l},yield u.Y(e,-1,-1,i,l))}catch{}}return we.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,l=Math.pow(2,i.z),c=(i.x-1+l)%l,m=i.x===0?e.wrap-1:e.wrap,y=(i.x+1+l)%l,b=i.x+1===l?e.wrap+1:e.wrap,T={};return T[new u.Z(e.overscaledZ,m,i.z,c,i.y).key]={backfilled:!1},T[new u.Z(e.overscaledZ,b,i.z,y,i.y).key]={backfilled:!1},i.y>0&&(T[new u.Z(e.overscaledZ,m,i.z,c,i.y-1).key]={backfilled:!1},T[new u.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},T[new u.Z(e.overscaledZ,b,i.z,y,i.y-1).key]={backfilled:!1}),i.y+1<l&&(T[new u.Z(e.overscaledZ,m,i.z,c,i.y+1).key]={backfilled:!1},T[new u.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},T[new u.Z(e.overscaledZ,b,i.z,y,i.y+1).key]={backfilled:!1}),T}unloadTile(e){return u._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Hn extends u.E{constructor(e,i,l,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(c),this._data=i.data,this._options=u.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:u.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:u.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(u.$/this.tileSize)}_getClusterMaxZoom(e){const i=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||u.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${i}"`),i}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return u._(this,void 0,void 0,function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(i=>i.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return u._(this,void 0,void 0,function*(){const e=new ci,i=yield this.getData();let l;switch(i.type){case"FeatureCollection":l=i.features.map(c=>this.getCoordinatesFromGeometry(c.geometry)).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(i.geometry);break;default:l=this.getCoordinatesFromGeometry(i)}if(l.length==0)return e;for(let c=0;c<l.length-1;c+=2)e.extend([l[c],l[c+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:l}})}_updateWorkerData(e){return u._(this,void 0,void 0,function*(){const i=u.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(we.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new u.l("dataabort",{dataType:"source"}));let c=null;l.resourceTiming&&l.resourceTiming[this.id]&&(c=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&u.e(m,{resourceTiming:c}),this.fire(new u.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new u.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new u.l("dataabort",{dataType:"source"}));this.fire(new u.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return u._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:i,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,i==="RT")})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Je extends u.E{constructor(e,i,l,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=i}load(e){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield ft.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new u.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(u.a0.fromLngLat);var l;return this.tileID=function(c){const m=u.a1.fromPoints(c),y=m.width(),b=m.height(),T=Math.max(y,b),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),C=Math.pow(2,E);return new u.a3(E,Math.floor((m.minX+m.maxX)/2*C),Math.floor((m.minY+m.maxY)/2*C))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(c=>this.tileID.getTilePoint(c)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new u.T(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:i,minY:l,maxX:c,maxY:m}=u.a1.fromPoints(e),y={};for(let b=0;b<=u.a2;b++){const T=Math.pow(2,b),E=Math.floor(i*T),C=Math.floor(l*T),z=Math.floor(c*T),R=Math.floor(m*T);y[b]={minTileX:E,minTileY:C,maxTileX:z,maxTileY:R}}return y}}class Kr extends Je{constructor(e,i,l,c){super(e,i,l,c),this.roundZoom=!0,this.type="video",this.options=i}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield u.a4(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new u.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new u.k(new u.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new u.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Rr extends Je{constructor(e,i,l,c){super(e,i,l,c),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new u.k(new u.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.k(new u.a5(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new u.k(new u.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new u.k(new u.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.k(new u.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,l=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.T(i,this.canvas,l.RGBA,{premultiply:!0});let c=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,c=!0)}c&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const fr={},ms=p=>{switch(p){case"geojson":return Hn;case"image":return Je;case"raster":return ps;case"raster-dem":return nn;case"vector":return tn;case"video":return Kr;case"canvas":return Rr}return fr[p]},Vt="RTLPluginLoaded";class pr extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=dr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,function*(i,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=we.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.l(Vt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ir=null;function Mn(){return ir||(ir=new pr),ir}class At{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=u.a6(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,m){const y={};if(!m)return y;for(const b of c){const T=b.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(E=>T.filter(C=>C.id===E)[0]));for(const E of T)y[E.id]=b}}return y}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const m=this.buckets[c];if(m instanceof u.a8){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const m=this.buckets[c];if(m instanceof u.a8&&m.hasRTLText){this.hasRTLText=!0,Mn().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const m=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new u.T(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new u.T(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,c,m,y,b,T,E,C,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:C,transform:T,params:b,queryPadding:this.queryPadding*E,getElevation:z},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const c=l.loadVTLayers(),m=i&&i.sourceLayer?i.sourceLayer:"",y=c._geojsonTileLayer||c[m];if(!y)return;const b=u.a9(i&&i.filter),{z:T,x:E,y:C}=this.tileID.canonical,z={z:T,x:E,y:C};for(let R=0;R<y.length;R++){const U=y.feature(R);if(b.needGeometry){const ee=u.aa(U,!0);if(!b.filter(new u.F(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!b.filter(new u.F(this.tileID.overscaledZ),U))continue;const Z=l.getId(U,m),te=new u.ab(U,T,E,C,Z);te.tile=z,e.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=u.ac(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let c=!1;if(this.expirationTime>l)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const m=this.expirationTime-i;m?this.expirationTime=l+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const m=this.buckets[c],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=l[y],T=e[y];if(!b||!T||Object.keys(T).length===0)continue;m.update(T,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=i&&i.style&&i.style.getLayer(c);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<we.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=we.now()+e}setDependencies(e,i){const l={};for(const c of i)l[c]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const c=this.dependencies[l];if(c){for(const m of i)if(c[m])return!0}}return!1}}class gs{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const m={value:i,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,c=i===void 0?0:this.data[l].indexOf(i),m=this.data[l][c];return this.data[l].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const c of this.data[l])e(c.value)||i.push(c);for(const l of i)this.remove(l.value.tileID,l)}}class si{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},u.e(this.stateChanges[e][c],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==c&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const m in this.state[e][c])l[m]||(this.deletedStates[e][c][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][m]===null&&delete this.deletedStates[e][c][m]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(l in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][l]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),c=u.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][i];if(m===null)return{};for(const y in m)delete c[y]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const m={};for(const y in this.stateChanges[c])this.state[c][y]||(this.state[c][y]={}),u.e(this.state[c][y],this.stateChanges[c][y]),m[y]=this.state[c][y];l[c]=m}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const m={};if(this.deletedStates[c]===null)for(const y in this.state[c])m[y]={},this.state[c][y]={};else for(const y in this.deletedStates[c]){if(this.deletedStates[c][y]===null)this.state[c][y]={};else for(const b of Object.keys(this.deletedStates[c][y]))delete this.state[c][y][b];m[y]=this.state[c][y]}l[c]=l[c]||{},u.e(l[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const c in e)e[c].setFeatureState(l,i)}}const Nt=89.25;function ke(p,e){const i=u.ag(e.lat,-85.051129,u.ah);return new u.P(u.V(e.lng)*p,u.U(i)*p)}function Y(p,e){return new u.a0(e.x/p,e.y/p).toLngLat()}function H(p){return p.cameraToCenterDistance*Math.min(.85*Math.tan(u.ad(90-p.pitch)),Math.tan(u.ad(Nt-p.pitch)))}function W(p,e){const i=p.canonical,l=e/u.ae(i.z),c=i.x+Math.pow(2,i.z)*p.wrap,m=u.af(new Float64Array(16));return u.M(m,m,[c*l,i.y*l,0]),u.N(m,m,[l/u.$,l/u.$,1]),m}function ce(p,e,i,l,c){const m=u.a0.fromLngLat(p,e),y=c*u.ai(1,p.lat),b=y*Math.cos(u.ad(i)),T=Math.sqrt(y*y-b*b),E=T*Math.sin(u.ad(-l)),C=T*Math.cos(u.ad(-l));return new u.a0(m.x+E,m.y+C,m.z+b)}function xe(p,e,i){const l=e.intersectsFrustum(p);if(!i||l===0)return l;const c=e.intersectsPlane(i);return c===0?0:l===2&&c===2?2:1}function Ee(p,e,i){let l=0;const c=(i-e)/10;for(let m=0;m<10;m++)l+=c*Math.pow(Math.cos(e+(m+.5)/10*(i-e)),p);return l}function Me(p,e){return function(i,l,c,m,y){const b=2*((p-1)/u.aj(Math.cos(u.ad(Nt-y))/Math.cos(u.ad(Nt)))-1),T=Math.acos(c/m),E=2*Ee(b-1,0,u.ad(y/2)),C=Math.min(u.ad(Nt),T+u.ad(y/2)),z=Ee(b-1,Math.min(C,T-u.ad(y/2)),C),R=Math.atan(l/c),U=Math.hypot(l,c);let Z=i;return Z+=u.aj(m/U/Math.max(.5,Math.cos(u.ad(y/2)))),Z+=b*u.aj(Math.cos(R))/2,Z-=u.aj(Math.max(1,z/E/e))/2,Z}}const Ie=Me(9.314,3);function Ve(p,e){const i=(e.roundZoom?Math.round:Math.floor)(p.zoom+u.aj(p.tileSize/e.tileSize));return Math.max(0,i)}function Ue(p,e){const i=p.getCameraFrustum(),l=p.getClippingPlane(),c=p.screenPointToMercatorCoordinate(p.getCameraPoint()),m=u.a0.fromLngLat(p.center,p.elevation);c.z=m.z+Math.cos(p.pitchInRadians)*p.cameraToCenterDistance/p.worldSize;const y=p.getCoveringTilesDetailsProvider(),b=y.allowVariableZoom(p,e),T=Ve(p,e),E=e.minzoom||0,C=e.maxzoom!==void 0?e.maxzoom:p.maxZoom,z=Math.min(Math.max(0,T),C),R=Math.pow(2,z),U=[R*c.x,R*c.y,0],Z=[R*m.x,R*m.y,0],te=Math.hypot(m.x-c.x,m.y-c.y),ee=Math.abs(m.z-c.z),ie=Math.hypot(te,ee),se=ge=>({zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),fe=[],oe=[];if(p.renderWorldCopies&&y.allowWorldCopies())for(let ge=1;ge<=3;ge++)fe.push(se(-ge)),fe.push(se(ge));for(fe.push(se(0));fe.length>0;){const ge=fe.pop(),ye=ge.x,ue=ge.y;let Se=ge.fullyVisible;const Fe={x:ye,y:ue,z:ge.zoom},Re=y.getTileBoundingVolume(Fe,ge.wrap,p.elevation,e);if(!Se){const it=xe(i,Re,l);if(it===0)continue;Se=it===2}const De=y.distanceToTile2d(c.x,c.y,Fe,Re);let Be=T;b&&(Be=(e.calculateTileZoom||Ie)(p.zoom+u.aj(p.tileSize/e.tileSize),De,ee,ie,p.fov)),Be=(e.roundZoom?Math.round:Math.floor)(Be),Be=Math.max(0,Be);const at=Math.min(Be,C);if(ge.wrap=y.getWrap(m,Fe,ge.wrap),ge.zoom>=at){if(ge.zoom<E)continue;const it=z-ge.zoom,Ye=U[0]-.5-(ye<<it),mt=U[1]-.5-(ue<<it),Wt=e.reparseOverscaled?Math.max(ge.zoom,Be):ge.zoom;oe.push({tileID:new u.Z(ge.zoom===C?Wt:ge.zoom,ge.wrap,ge.zoom,ye,ue),distanceSq:u.ak([Z[0]-.5-ye,Z[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(Ye*Ye+mt*mt)})}else for(let it=0;it<4;it++)fe.push({zoom:ge.zoom+1,x:(ye<<1)+it%2,y:(ue<<1)+(it>>1),wrap:ge.wrap,fullyVisible:Se})}return oe.sort((ge,ye)=>ge.distanceSq-ye.distanceSq).map(ge=>ge.tileID)}const Pe=u.a1.fromPoints([new u.P(0,0),new u.P(u.$,u.$)]);class Ze extends u.E{constructor(e,i,l){super(),this.id=e,this.dispatcher=l,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,m,y,b)=>{const T=new(ms(m.type))(c,m,y,b);if(T.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${T.id}`);return T})(e,i,l,this),this._tiles={},this._cache=new gs(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new si,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,l){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,l)}catch(c){e.state="errored",c.status!==404?this._source.fire(new u.k(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(ve).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&i.push(this._tiles[l]);return e?i.sort((l,c)=>{const m=l.tileID,y=c.tileID,b=new u.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),T=new u.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(ve).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)e?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return u._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),yield this._loadTile(l,e,i))})}_tileLoaded(e,i,l){e.timeAdded=we.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const m=i[c];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(c,m){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-c.tileID.canonical.x;const b=m.tileID.canonical.y-c.tileID.canonical.y,T=Math.pow(2,c.tileID.canonical.z),E=m.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,y,b),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,c){for(const m in this._tiles){let y=this._tiles[m];if(c[m]||!y.hasData()||y.tileID.overscaledZ<=i||y.tileID.overscaledZ>l)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>i+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(b=E)}let T=b;for(;T.overscaledZ>i;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]||e[T.canonical.key]){c[b.key]=b;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const c=e.scaledTo(l),m=this._getLoadedTile(c);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(i*l*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(m)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const c in this._tiles){const m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+i),l[m.tileID.key]=m}this._tiles=l;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,i,l,c,m,y){const b={},T={},E=Object.keys(e),C=we.now();for(const z of E){const R=e[z],U=this._tiles[z];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=C)continue;const Z=this.findLoadedParent(R,i),te=this.findLoadedSibling(R),ee=Z||te||null;ee&&(this._addTile(ee.tileID),b[ee.tileID.key]=ee.tileID),T[z]=R}this._retainLoadedChildren(T,c,l,e);for(const z in b)e[z]||(this._coveredTiles[z]=!0,e[z]=b[z]);if(y){const z={},R={};for(const U of m)this._tiles[U.key].hasData()?z[U.key]=U:R[U.key]=U;for(const U in R){const Z=R[U].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(z[Z[0].key]=e[Z[0].key]=Z[0],z[Z[1].key]=e[Z[1].key]=Z[1],z[Z[2].key]=e[Z[2].key]=Z[2],z[Z[3].key]=e[Z[3].key]=Z[3],delete R[U])}for(const U in R){const Z=R[U],te=this.findLoadedParent(Z,this._source.minzoom),ee=this.findLoadedSibling(Z),ie=te||ee||null;if(ie){z[ie.tileID.key]=e[ie.tileID.key]=ie.tileID;for(const se in z)z[se].isChildOf(ie.tileID)&&delete z[se]}}for(const U in this._tiles)z[U]||(this._coveredTiles[U]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new u.Z(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(l=Ue(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(C=>this._source.hasTile(C)))):l=[];const c=Ve(e,this._source),m=Math.max(c-Ze.maxOverzooming,this._source.minzoom),y=Math.max(c+Ze.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const z of l)if(z.canonical.z>this._source.minzoom){const R=z.scaledTo(z.canonical.z-1);C[R.key]=R;const U=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));C[U.key]=U}l=l.concat(Object.values(C))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new u.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,c);st(this._source.type)&&this._updateCoveredAndRetainedTiles(T,m,y,c,l,i);for(const C in T)this._tiles[C].clearFadeHold();const E=u.al(this._tiles,T);for(const C of E){const z=this._tiles[C];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var l;const c={},m={},y=Math.max(i-Ze.maxOverzooming,this._source.minzoom),b=Math.max(i+Ze.maxUnderzooming,this._source.minzoom),T={};for(const E of e){const C=this._addTile(E);c[E.key]=E,C.hasData()||i<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,i,b,c);for(const E of e){let C=this._tiles[E.key];if(C.hasData())continue;if(i+1>this._source.maxzoom){const R=E.children(this._source.maxzoom)[0],U=this.getTile(R);if(U&&U.hasData()){c[R.key]=R;continue}}else{const R=E.children(this._source.maxzoom);if(c[R[0].key]&&c[R[1].key]&&c[R[2].key]&&c[R[3].key])continue}let z=C.wasRequested();for(let R=E.overscaledZ-1;R>=y;--R){const U=E.scaledTo(R);if(m[U.key])break;if(m[U.key]=!0,C=this.getTile(U),!C&&z&&(C=this._addTile(U)),C){const Z=C.hasData();if((Z||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||z)&&(c[U.key]=U),z=C.wasRequested(),Z)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){l=this._loadedParentTiles[c.key];break}i.push(c.key);const m=c.scaledTo(c.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;c=m}for(const m of i)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,l=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=i;return i||(i=new At(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,l||this._source.fire(new u.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}refreshTiles(e){for(const i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&e.some(l=>l.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,l){const c=[],m=this.transform;if(!m)return c;const y=m.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?m.getCameraQueryGeometry(e):e,T=U=>m.screenPointToMercatorCoordinate(U,this.terrain),E=this.transformBbox(e,T,!y),C=this.transformBbox(b,T,!y),z=this.getIds(),R=u.a1.fromPoints(C);for(let U=0;U<z.length;U++){const Z=this._tiles[z[U]];if(Z.holdingForFade())continue;const te=y?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],ee=Math.pow(2,m.zoom-Z.tileID.overscaledZ),ie=i*Z.queryPadding*u.$/Z.tileSize/ee;for(const se of te){const fe=R.map(oe=>se.getTilePoint(new u.a0(oe.x,oe.y)));if(fe.expandBy(ie),fe.intersects(Pe)){const oe=E.map(ye=>se.getTilePoint(ye)),ge=C.map(ye=>se.getTilePoint(ye));c.push({tile:Z,tileID:y?se:se.unwrapTo(0),queryGeometry:oe,cameraQueryGeometry:ge,scale:ee})}}}return c}transformBbox(e,i,l){let c=e.map(i);if(l){const m=u.a1.fromPoints(e);m.shrinkBy(.001*Math.min(m.width(),m.height()));const y=m.map(i);u.a1.fromPoints(c).covers(y)||(c=c.map(b=>b.x>.5?new u.a0(b.x-1,b.y,b.z):b))}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(st(this._source.type)){const e=we.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const c=this._tiles[e];c&&c.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}}function ve(p,e){const i=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||l-i||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function st(p){return p==="raster"||p==="image"||p==="video"}Ze.maxOverzooming=10,Ze.maxUnderzooming=3;class qe{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ag(e,0,1);let i=1,l=this._distances[i];const c=e*this.paddedLength+this.padding;for(;l<c&&i<this._distances.length;)l=this._distances[++i];const m=i-1,y=this._distances[m],b=l-y,T=b>0?(c-y)/b:0;return this.points[m].mult(1-T).add(this.points[i].mult(T))}}function ct(p,e){let i=!0;return p==="always"||p!=="never"&&e!=="never"||(i=!1),i}class St{constructor(e,i,l){const c=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(i/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)c.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,l,c,m){this._forEachCell(i,l,c,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(m)}insertCircle(e,i,l,c){this._forEachCell(i-c,l-c,i+c,l+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(l),this.circles.push(c)}_insertBoxCell(e,i,l,c,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,i,l,c,m,y){this.circleCells[m].push(y)}_query(e,i,l,c,m,y,b){if(l<0||e>this.width||c<0||i>this.height)return[];const T=[];if(e<=0&&i<=0&&this.width<=l&&this.height<=c){if(m)return[{key:null,x1:e,y1:i,x2:l,y2:c}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const C=this.circles[3*E],z=this.circles[3*E+1],R=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:C-R,y1:z-R,x2:C+R,y2:z+R})}}else this._forEachCell(e,i,l,c,this._queryCell,T,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},b);return T}query(e,i,l,c){return this._query(e,i,l,c,!1,null)}hitTest(e,i,l,c,m,y){return this._query(e,i,l,c,!0,m,y).length>0}hitTestCircle(e,i,l,c,m){const y=e-l,b=e+l,T=i-l,E=i+l;if(b<0||y>this.width||E<0||T>this.height)return!1;const C=[];return this._forEachCell(y,T,b,E,this._queryCellCircle,C,{hitTest:!0,overlapMode:c,circle:{x:e,y:i,radius:l},seenUids:{box:{},circle:{}}},m),C.length>0}_queryCell(e,i,l,c,m,y,b,T){const{seenUids:E,hitTest:C,overlapMode:z}=b,R=this.boxCells[m];if(R!==null){const Z=this.bboxes;for(const te of R)if(!E.box[te]){E.box[te]=!0;const ee=4*te,ie=this.boxKeys[te];if(e<=Z[ee+2]&&i<=Z[ee+3]&&l>=Z[ee+0]&&c>=Z[ee+1]&&(!T||T(ie))&&(!C||!ct(z,ie.overlapMode))&&(y.push({key:ie,x1:Z[ee],y1:Z[ee+1],x2:Z[ee+2],y2:Z[ee+3]}),C))return!0}}const U=this.circleCells[m];if(U!==null){const Z=this.circles;for(const te of U)if(!E.circle[te]){E.circle[te]=!0;const ee=3*te,ie=this.circleKeys[te];if(this._circleAndRectCollide(Z[ee],Z[ee+1],Z[ee+2],e,i,l,c)&&(!T||T(ie))&&(!C||!ct(z,ie.overlapMode))){const se=Z[ee],fe=Z[ee+1],oe=Z[ee+2];if(y.push({key:ie,x1:se-oe,y1:fe-oe,x2:se+oe,y2:fe+oe}),C)return!0}}}return!1}_queryCellCircle(e,i,l,c,m,y,b,T){const{circle:E,seenUids:C,overlapMode:z}=b,R=this.boxCells[m];if(R!==null){const Z=this.bboxes;for(const te of R)if(!C.box[te]){C.box[te]=!0;const ee=4*te,ie=this.boxKeys[te];if(this._circleAndRectCollide(E.x,E.y,E.radius,Z[ee+0],Z[ee+1],Z[ee+2],Z[ee+3])&&(!T||T(ie))&&!ct(z,ie.overlapMode))return y.push(!0),!0}}const U=this.circleCells[m];if(U!==null){const Z=this.circles;for(const te of U)if(!C.circle[te]){C.circle[te]=!0;const ee=3*te,ie=this.circleKeys[te];if(this._circlesCollide(Z[ee],Z[ee+1],Z[ee+2],E.x,E.y,E.radius)&&(!T||T(ie))&&!ct(z,ie.overlapMode))return y.push(!0),!0}}}_forEachCell(e,i,l,c,m,y,b,T){const E=this._convertToXCellCoord(e),C=this._convertToYCellCoord(i),z=this._convertToXCellCoord(l),R=this._convertToYCellCoord(c);for(let U=E;U<=z;U++)for(let Z=C;Z<=R;Z++)if(m.call(this,e,i,l,c,this.xCellCount*Z+U,y,b,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,l,c,m,y){const b=c-e,T=m-i,E=l+y;return E*E>b*b+T*T}_circleAndRectCollide(e,i,l,c,m,y,b){const T=(y-c)/2,E=Math.abs(e-(c+T));if(E>T+l)return!1;const C=(b-m)/2,z=Math.abs(i-(m+C));if(z>C+l)return!1;if(E<=T||z<=C)return!0;const R=E-T,U=z-C;return R*R+U*U<=l*l}}function Dt(p,e,i){const l=u.L();if(!p){const{vecSouth:z,vecEast:R}=mi(e),U=Ae();U[0]=R[0],U[1]=R[1],U[2]=z[0],U[3]=z[1],c=U,(C=(y=(m=U)[0])*(E=m[3])-(T=m[2])*(b=m[1]))&&(c[0]=E*(C=1/C),c[1]=-b*C,c[2]=-T*C,c[3]=y*C),l[0]=U[0],l[1]=U[1],l[4]=U[2],l[5]=U[3]}var c,m,y,b,T,E,C;return u.N(l,l,[1/i,1/i,1]),l}function wi(p,e,i,l){if(p){const c=u.L();if(!e){const{vecSouth:m,vecEast:y}=mi(i);c[0]=y[0],c[1]=y[1],c[4]=m[0],c[5]=m[1]}return u.N(c,c,[l,l,1]),c}return i.pixelsToClipSpaceMatrix}function mi(p){const e=Math.cos(p.rollInRadians),i=Math.sin(p.rollInRadians),l=Math.cos(p.pitchInRadians),c=Math.cos(p.bearingInRadians),m=Math.sin(p.bearingInRadians),y=u.aq();y[0]=-c*l*i-m*e,y[1]=-m*l*i+c*e;const b=u.ar(y);b<1e-9?u.as(y):u.at(y,y,1/b);const T=u.aq();T[0]=c*l*e-m*i,T[1]=m*l*e+c*i;const E=u.ar(T);return E<1e-9?u.as(T):u.at(T,T,1/E),{vecEast:T,vecSouth:y}}function hi(p,e,i,l){let c;l?(c=[p,e,l(p,e),1],u.av(c,c,i)):(c=[p,e,0,1],ys(c,c,i));const m=c[3];return{point:new u.P(c[0]/m,c[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function Pt(p,e){return .5+p/e*.5}function Qt(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function Zi(p,e,i,l,c,m,y,b,T,E,C,z,R){const U=i?p.textSizeData:p.iconSizeData,Z=u.am(U,e.transform.zoom),te=[256/e.width*2+1,256/e.height*2+1],ee=i?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ee.clear();const ie=p.lineVertexArray,se=i?p.text.placedSymbolArray:p.icon.placedSymbolArray,fe=e.transform.width/e.transform.height;let oe=!1;for(let ge=0;ge<se.length;ge++){const ye=se.get(ge);if(ye.hidden||ye.writingMode===u.an.vertical&&!oe){zr(ye.numGlyphs,ee);continue}oe=!1;const ue=new u.P(ye.anchorX,ye.anchorY),Se={getElevation:R,pitchedLabelPlaneMatrix:l,lineVertexArray:ie,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ue,unwrappedTileID:T,width:E,height:C,translation:z},Fe=qt(ye.anchorX,ye.anchorY,Se);if(!Qt(Fe.point,te)){zr(ye.numGlyphs,ee);continue}const Re=Pt(e.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),De=u.ao(U,Z,ye),Be=m?De*e.transform.getPitchedTextCorrection(ye.anchorX,ye.anchorY,T)/Re:De*Re,at=Ri({projectionContext:Se,pitchedLabelPlaneMatrixInverse:c,symbol:ye,fontSize:Be,flip:!1,keepUpright:y,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:ee,aspectRatio:fe,rotateToLine:b});oe=at.useVertical,(at.notEnoughRoom||oe||at.needsFlipping&&Ri({projectionContext:Se,pitchedLabelPlaneMatrixInverse:c,symbol:ye,fontSize:Be,flip:!0,keepUpright:y,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:ee,aspectRatio:fe,rotateToLine:b}).notEnoughRoom)&&zr(ye.numGlyphs,ee)}i?p.text.dynamicLayoutVertexBuffer.updateData(ee):p.icon.dynamicLayoutVertexBuffer.updateData(ee)}function et(p,e,i,l,c,m,y,b){const T=m.glyphStartIndex+m.numGlyphs,E=m.lineStartIndex,C=m.lineStartIndex+m.lineLength,z=e.getoffsetX(m.glyphStartIndex),R=e.getoffsetX(T-1),U=jn(p*z,i,l,c,m.segment,E,C,b,y);if(!U)return null;const Z=jn(p*R,i,l,c,m.segment,E,C,b,y);return Z?b.projectionCache.anyProjectionOccluded?null:{first:U,last:Z}:null}function ln(p,e,i,l){return p===u.an.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*l?{useVertical:!0}:(p===u.an.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function Ri(p){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:l,fontSize:c,flip:m,keepUpright:y,glyphOffsetArray:b,dynamicLayoutVertexArray:T,aspectRatio:E,rotateToLine:C}=p,z=c/24,R=l.lineOffsetX*z,U=l.lineOffsetY*z;let Z;if(l.numGlyphs>1){const te=l.glyphStartIndex+l.numGlyphs,ee=l.lineStartIndex,ie=l.lineStartIndex+l.lineLength,se=et(z,b,R,U,m,l,C,e);if(!se)return{notEnoughRoom:!0};const fe=Gt(se.first.point.x,se.first.point.y,e,i),oe=Gt(se.last.point.x,se.last.point.y,e,i);if(y&&!m){const ge=ln(l.writingMode,fe,oe,E);if(ge)return ge}Z=[se.first];for(let ge=l.glyphStartIndex+1;ge<te-1;ge++){const ye=jn(z*b.getoffsetX(ge),R,U,m,l.segment,ee,ie,e,C);if(!ye)return{notEnoughRoom:!0};Z.push(ye)}Z.push(se.last)}else{if(y&&!m){const ee=tt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ie=l.lineStartIndex+l.segment+1,se=new u.P(e.lineVertexArray.getx(ie),e.lineVertexArray.gety(ie)),fe=tt(se.x,se.y,e),oe=fe.signedDistanceFromCamera>0?fe.point:Ji(e.tileAnchorPoint,se,ee,1,e),ge=Gt(ee.x,ee.y,e,i),ye=Gt(oe.x,oe.y,e,i),ue=ln(l.writingMode,ge,ye,E);if(ue)return ue}const te=jn(z*b.getoffsetX(l.glyphStartIndex),R,U,m,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,C);if(!te||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[te]}for(const te of Z)u.au(T,te.point,te.angle);return{}}function Ji(p,e,i,l,c){const m=p.add(p.sub(e)._unit()),y=tt(m.x,m.y,c).point,b=i.sub(y);return i.add(b._mult(l/b.mag()))}function Dr(p,e,i){const l=e.projectionCache;if(l.projections[p])return l.projections[p];const c=new u.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),m=tt(c.x,c.y,e);if(m.signedDistanceFromCamera>0)return l.projections[p]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const y=p-i.direction;return Ji(i.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),c,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function tt(p,e,i){const l=p+i.translation[0],c=e+i.translation[1];let m;return i.pitchWithMap?(m=hi(l,c,i.pitchedLabelPlaneMatrix,i.getElevation),m.isOccluded=!1):(m=i.transform.projectTileCoordinates(l,c,i.unwrappedTileID,i.getElevation),m.point.x=(.5*m.point.x+.5)*i.width,m.point.y=(.5*-m.point.y+.5)*i.height),m}function Gt(p,e,i,l){if(i.pitchWithMap){const c=[p,e,0,1];return u.av(c,c,l),i.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],i.unwrappedTileID,i.getElevation).point}return{x:p/i.width*2-1,y:e/i.height*2-1}}function qt(p,e,i){return i.transform.projectTileCoordinates(p,e,i.unwrappedTileID,i.getElevation)}function An(p,e,i){return p._unit()._perp()._mult(e*i)}function _s(p,e,i,l,c,m,y,b,T){if(b.projectionCache.offsets[p])return b.projectionCache.offsets[p];const E=i.add(e);if(p+T.direction<l||p+T.direction>=c)return b.projectionCache.offsets[p]=E,E;const C=Dr(p+T.direction,b,T),z=An(C.sub(i),y,T.direction),R=i.add(z),U=C.add(z);return b.projectionCache.offsets[p]=u.aw(m,E,R,U)||E,b.projectionCache.offsets[p]}function jn(p,e,i,l,c,m,y,b,T){const E=l?p-e:p+e;let C=E>0?1:-1,z=0;l&&(C*=-1,z=Math.PI),C<0&&(z+=Math.PI);let R,U=C>0?m+c:m+c+1;b.projectionCache.cachedAnchorPoint?R=b.projectionCache.cachedAnchorPoint:(R=tt(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=R);let Z,te,ee=R,ie=R,se=0,fe=0;const oe=Math.abs(E),ge=[];let ye;for(;se+fe<=oe;){if(U+=C,U<m||U>=y)return null;se+=fe,ie=ee,te=Z;const Fe={absOffsetX:oe,direction:C,distanceFromAnchor:se,previousVertex:ie};if(ee=Dr(U,b,Fe),i===0)ge.push(ie),ye=ee.sub(ie);else{let Re;const De=ee.sub(ie);Re=De.mag()===0?An(Dr(U+C,b,Fe).sub(ee),i,C):An(De,i,C),te||(te=ie.add(Re)),Z=_s(U,Re,ee,m,y,te,i,b,Fe),ge.push(te),ye=Z.sub(te)}fe=ye.mag()}const ue=ye._mult((oe-se)/fe)._add(te||ie),Se=z+Math.atan2(ee.y-ie.y,ee.x-ie.x);return ge.push(ue),{point:ue,angle:T?Se:0,path:ge}}const kt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function zr(p,e){for(let i=0;i<p;i++){const l=e.length;e.resize(l+4),e.float32.set(kt,3*l)}}function ys(p,e,i){const l=e[0],c=e[1];return p[0]=i[0]*l+i[4]*c+i[12],p[1]=i[1]*l+i[5]*c+i[13],p[3]=i[3]*l+i[7]*c+i[15],p}const Di=100;class Nr{constructor(e,i=new St(e.width+200,e.height+200,25),l=new St(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Di,this.screenBottomBoundary=e.height+Di,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,l,c,m,y,b,T,E,C,z,R){const U=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],m,C,R),Z=l*U.perspectiveRatio;let te;if(y||b)te=this._projectCollisionBox(e,Z,c,m,y,b,T,U,C,z,R);else{const ye=U.x+(z?z.x*Z:0),ue=U.y+(z?z.y*Z:0);te={allPointsOccluded:!1,box:[ye+e.x1*Z,ue+e.y1*Z,ye+e.x2*Z,ue+e.y2*Z]}}const[ee,ie,se,fe]=te.box,oe=y?te.allPointsOccluded:U.isOccluded;let ge=oe;return ge||(ge=U.perspectiveRatio<this.perspectiveRatioCutoff),ge||(ge=!this.isInsideGrid(ee,ie,se,fe)),ge||i!=="always"&&this.grid.hitTest(ee,ie,se,fe,i,E)?{box:[ee,ie,se,fe],placeable:!1,offscreen:!1,occluded:oe}:{box:[ee,ie,se,fe],placeable:!0,offscreen:this.isOffscreen(ee,ie,se,fe),occluded:oe}}placeCollisionCircles(e,i,l,c,m,y,b,T,E,C,z,R,U,Z){const te=[],ee=new u.P(i.anchorX,i.anchorY),ie=this.getPerspectiveRatio(ee.x,ee.y,y,Z),se=(E?m*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,y)/ie:m*ie)/u.aA,fe={getElevation:Z,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ee,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:U},oe=et(se,c,i.lineOffsetX*se,i.lineOffsetY*se,!1,i,!1,fe);let ge=!1,ye=!1,ue=!0;if(oe){const Se=.5*z*ie+R,Fe=new u.P(-100,-100),Re=new u.P(this.screenRightBoundary,this.screenBottomBoundary),De=new qe,Be=oe.first,at=oe.last;let it=[];for(let Wt=Be.path.length-1;Wt>=1;Wt--)it.push(Be.path[Wt]);for(let Wt=1;Wt<at.path.length;Wt++)it.push(at.path[Wt]);const Ye=2.5*Se;if(E){const Wt=this.projectPathToScreenSpace(it,fe);it=Wt.some(xi=>xi.signedDistanceFromCamera<=0)?[]:Wt.map(xi=>xi.point)}let mt=[];if(it.length>0){const Wt=it[0].clone(),xi=it[0].clone();for(let Vi=1;Vi<it.length;Vi++)Wt.x=Math.min(Wt.x,it[Vi].x),Wt.y=Math.min(Wt.y,it[Vi].y),xi.x=Math.max(xi.x,it[Vi].x),xi.y=Math.max(xi.y,it[Vi].y);mt=Wt.x>=Fe.x&&xi.x<=Re.x&&Wt.y>=Fe.y&&xi.y<=Re.y?[it]:xi.x<Fe.x||Wt.x>Re.x||xi.y<Fe.y||Wt.y>Re.y?[]:u.ax([it],Fe.x,Fe.y,Re.x,Re.y)}for(const Wt of mt){De.reset(Wt,.25*Se);let xi=0;xi=De.length<=.5*Se?1:Math.ceil(De.paddedLength/Ye)+1;for(let Vi=0;Vi<xi;Vi++){const Si=Vi/Math.max(xi-1,1),Gi=De.lerp(Si),Ci=Gi.x+Di,Ei=Gi.y+Di;te.push(Ci,Ei,Se,0);const Pi=Ci-Se,Dn=Ei-Se,di=Ci+Se,Tn=Ei+Se;if(ue=ue&&this.isOffscreen(Pi,Dn,di,Tn),ye=ye||this.isInsideGrid(Pi,Dn,di,Tn),e!=="always"&&this.grid.hitTestCircle(Ci,Ei,Se,e,C)&&(ge=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!T&&ge||!ye||ie<this.perspectiveRatioCutoff?[]:te,offscreen:ue,collisionDetected:ge}}projectPathToScreenSpace(e,i){const l=function(c,m){const y=u.L();return u.ap(y,m.pitchedLabelPlaneMatrix),c.map(b=>{const T=hi(b.x,b.y,y,m.getElevation),E=m.transform.projectTileCoordinates(T.point.x,T.point.y,m.unwrappedTileID,m.getElevation);return E.point.x=(.5*E.point.x+.5)*m.width,E.point.y=(.5*-E.point.y+.5)*m.height,E})}(e,i);return function(c){let m=0,y=0,b=0,T=0;for(let E=0;E<c.length;E++)c[E].isOccluded?(b=E+1,T=0):(T++,T>y&&(y=T,m=b));return c.slice(m,m+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[],l=new u.a1;for(const z of e){const R=new u.P(z.x+Di,z.y+Di);l.extend(R),i.push(R)}const{minX:c,minY:m,maxX:y,maxY:b}=l,T=this.grid.query(c,m,y,b).concat(this.ignoredGrid.query(c,m,y,b)),E={},C={};for(const z of T){const R=z.key;if(E[R.bucketInstanceId]===void 0&&(E[R.bucketInstanceId]={}),E[R.bucketInstanceId][R.featureIndex])continue;const U=[new u.P(z.x1,z.y1),new u.P(z.x2,z.y1),new u.P(z.x2,z.y2),new u.P(z.x1,z.y2)];u.ay(i,U)&&(E[R.bucketInstanceId][R.featureIndex]=!0,C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]=[]),C[R.bucketInstanceId].push(R.featureIndex))}return C}insertCollisionBox(e,i,l,c,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:y,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,l,c,m,y){const b=l?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:m,collisionGroupID:y,overlapMode:i};for(let E=0;E<e.length;E+=4)b.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,i,l,c,m){if(m){let y;c?(y=[e,i,c(e,i),1],u.av(y,y,m)):(y=[e,i,0,1],ys(y,y,m));const b=y[3];return{x:(y[0]/b+1)/2*this.transform.width+Di,y:(-y[1]/b+1)/2*this.transform.height+Di,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const y=this.transform.projectTileCoordinates(e,i,l,c);return{x:(y.point.x+1)/2*this.transform.width+Di,y:(1-y.point.y)/2*this.transform.height+Di,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,l,c){const m=this.transform.projectTileCoordinates(e,i,l,c);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,i,l,c){return l<Di||e>=this.screenRightBoundary||c<Di||i>this.screenBottomBoundary}isInsideGrid(e,i,l,c){return l>=0&&e<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=u.af([]);return u.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,l,c,m,y,b,T,E,C,z){let R=1,U=0,Z=0,te=1;const ee=e.anchorPointX+b[0],ie=e.anchorPointY+b[1];if(y&&!m){const it=this.projectAndGetPerspectiveRatio(ee+1,ie,c,E,z),Ye=it.x-T.x,mt=Math.atan((it.y-T.y)/Ye)+(Ye<0?Math.PI:0),Wt=Math.sin(mt),xi=Math.cos(mt);R=xi,U=Wt,Z=-Wt,te=xi}else if(!y&&m){const it=mi(this.transform);R=it.vecEast[0],U=it.vecEast[1],Z=it.vecSouth[0],te=it.vecSouth[1]}let se=T.x,fe=T.y,oe=i;m&&(se=ee,fe=ie,oe=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),oe*=this.transform.getPitchedTextCorrection(ee,ie,c),C||(oe*=u.ag(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),C&&(se+=R*C.x*oe+Z*C.y*oe,fe+=U*C.x*oe+te*C.y*oe);const ge=e.x1*oe,ye=e.x2*oe,ue=(ge+ye)/2,Se=e.y1*oe,Fe=e.y2*oe,Re=(Se+Fe)/2,De=[{offsetX:ge,offsetY:Se},{offsetX:ue,offsetY:Se},{offsetX:ye,offsetY:Se},{offsetX:ye,offsetY:Re},{offsetX:ye,offsetY:Fe},{offsetX:ue,offsetY:Fe},{offsetX:ge,offsetY:Fe},{offsetX:ge,offsetY:Re}];let Be=[];for(const{offsetX:it,offsetY:Ye}of De)Be.push(new u.P(se+R*it+Z*Ye,fe+U*it+te*Ye));let at=!1;if(m){const it=Be.map(Ye=>this.projectAndGetPerspectiveRatio(Ye.x,Ye.y,c,E,z));at=it.some(Ye=>!Ye.isOccluded),Be=it.map(Ye=>new u.P(Ye.x,Ye.y))}else at=!0;return{box:u.az(Be),allPointsOccluded:!at}}}class vs{constructor(e,i,l,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):c&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class mr{constructor(e,i,l,c,m){this.text=new vs(e?e.text:null,i,l,m),this.icon=new vs(e?e.icon:null,i,c,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fs{constructor(e,i,l){this.text=e,this.icon=i,this.skipFade=l}}class Wn{constructor(e,i,l,c,m){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=l,this.bucketIndex=c,this.tileID=m}}class fi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:l=>l.collisionGroupID===i}}return this.collisionGroups[e]}}function xs(p,e,i,l,c){const{horizontalAlign:m,verticalAlign:y}=u.aG(p);return new u.P(-(m-.5)*e+l[0]*c,-(y-.5)*i+l[1]*c)}class bs{constructor(e,i,l,c,m){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new Nr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new fi(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(l,c)=>i.getElevation(e,l,c):null}getBucketParts(e,i,l,c){const m=l.getBucket(i),y=l.latestFeatureIndex;if(!m||!y||i.id!==m.layerIds[0])return;const b=l.collisionBoxArray,T=m.layers[0].layout,E=m.layers[0].paint,C=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/u.$,R=l.tileID.toUnwrapped(),U=T.get("text-rotation-alignment")==="map",Z=u.aB(l,1,this.transform.zoom),te=u.aC(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),ee=u.aC(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),ie=Dt(U,this.transform,Z);this.retainedQueryData[m.bucketInstanceId]=new Wn(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,l.tileID);const se={bucket:m,layout:T,translationText:te,translationIcon:ee,unwrappedTileID:R,pitchedLabelPlaneMatrix:ie,scale:C,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:u.am(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(c)for(const fe of m.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:ge,symbolInstanceEnd:ye}=fe;e.push({sortKey:oe,symbolInstanceStart:ge,symbolInstanceEnd:ye,parameters:se})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:se})}attemptAnchorPlacement(e,i,l,c,m,y,b,T,E,C,z,R,U,Z,te,ee,ie,se,fe,oe){const ge=u.aD[e.textAnchor],ye=[e.textOffset0,e.textOffset1],ue=xs(ge,l,c,ye,m),Se=this.collisionIndex.placeCollisionBox(i,R,T,E,C,b,y,ee,z.predicate,fe,ue,oe);if((!se||this.collisionIndex.placeCollisionBox(se,R,T,E,C,b,y,ie,z.predicate,fe,ue,oe).placeable)&&Se.placeable){let Fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:ye,width:l,height:c,anchor:ge,textBoxScale:m,prevAnchor:Fe},this.markUsedJustification(Z,ge,U,te),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,te,U),this.placedOrientations[U.crossTileID]=te),{shift:ue,placedGlyphBoxes:Se}}}placeLayerBucketPart(e,i,l){const{bucket:c,layout:m,translationText:y,translationIcon:b,unwrappedTileID:T,pitchedLabelPlaneMatrix:E,textPixelRatio:C,holdingForFade:z,collisionBoxArray:R,partiallyEvaluatedTextSize:U,collisionGroup:Z}=e.parameters,te=m.get("text-optional"),ee=m.get("icon-optional"),ie=u.aE(m,"text-overlap","text-allow-overlap"),se=ie==="always",fe=u.aE(m,"icon-overlap","icon-allow-overlap"),oe=fe==="always",ge=m.get("text-rotation-alignment")==="map",ye=m.get("text-pitch-alignment")==="map",ue=m.get("icon-text-fit")!=="none",Se=m.get("symbol-z-order")==="viewport-y",Fe=se&&(oe||!c.hasIconData()||ee),Re=oe&&(se||!c.hasTextData()||te);!c.collisionArrays&&R&&c.deserializeCollisionBoxes(R);const De=this.retainedQueryData[c.bucketInstanceId].tileID,Be=this._getTerrainElevationFunc(De),at=this.transform.getFastPathSimpleProjectionMatrix(De),it=(Ye,mt,Wt)=>{var xi,Vi;if(i[Ye.crossTileID])return;if(z)return void(this.placements[Ye.crossTileID]=new Fs(!1,!1,!1));let Si=!1,Gi=!1,Ci=!0,Ei=null,Pi={box:null,placeable:!1,offscreen:null,occluded:!1},Dn={placeable:!1},di=null,Tn=null,zn=null,Ws=0,Ks=0,Js=0;mt.textFeatureIndex?Ws=mt.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(Ws=Ye.featureIndex),mt.verticalTextFeatureIndex&&(Ks=mt.verticalTextFeatureIndex);const hs=mt.textBox;if(hs){const ur=en=>{let zi=u.an.horizontal;if(c.allowVerticalPlacement&&!en&&this.prevPlacement){const er=this.prevPlacement.placedOrientations[Ye.crossTileID];er&&(this.placedOrientations[Ye.crossTileID]=er,zi=er,this.markUsedOrientation(c,zi,Ye))}return zi},qr=(en,zi)=>{if(c.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(const er of c.writingModes)if(er===u.an.vertical?(Pi=zi(),Dn=Pi):Pi=en(),Pi&&Pi.placeable)break}else Pi=en()},Qs=Ye.textAnchorOffsetStartIndex,xa=Ye.textAnchorOffsetEndIndex;if(xa===Qs){const en=(zi,er)=>{const pn=this.collisionIndex.placeCollisionBox(zi,ie,C,De,T,ye,ge,y,Z.predicate,Be,void 0,at);return pn&&pn.placeable&&(this.markUsedOrientation(c,er,Ye),this.placedOrientations[Ye.crossTileID]=er),pn};qr(()=>en(hs,u.an.horizontal),()=>{const zi=mt.verticalTextBox;return c.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&zi?en(zi,u.an.vertical):{box:null,offscreen:null}}),ur(Pi&&Pi.placeable)}else{let en=u.aD[(Vi=(xi=this.prevPlacement)===null||xi===void 0?void 0:xi.variableOffsets[Ye.crossTileID])===null||Vi===void 0?void 0:Vi.anchor];const zi=(pn,sc,Xc)=>{const du=pn.x2-pn.x1,Mo=pn.y2-pn.y1,Va=Ye.textBoxScale,As=ue&&fe==="never"?sc:null;let Nn=null,Ls=ie==="never"?1:2,fu="never";en&&Ls++;for(let ea=0;ea<Ls;ea++){for(let pu=Qs;pu<xa;pu++){const mu=c.textAnchorOffsets.get(pu);if(en&&mu.textAnchor!==en)continue;const Ao=this.attemptAnchorPlacement(mu,pn,du,Mo,Va,ge,ye,C,De,T,Z,fu,Ye,c,Xc,y,b,As,Be);if(Ao&&(Nn=Ao.placedGlyphBoxes,Nn&&Nn.placeable))return Si=!0,Ei=Ao.shift,Nn}en?en=null:fu=ie}return l&&!Nn&&(Nn={box:this.collisionIndex.placeCollisionBox(hs,"always",C,De,T,ye,ge,y,Z.predicate,Be,void 0,at).box,offscreen:!1,placeable:!1,occluded:!1}),Nn};qr(()=>zi(hs,mt.iconBox,u.an.horizontal),()=>{const pn=mt.verticalTextBox;return c.allowVerticalPlacement&&(!Pi||!Pi.placeable)&&Ye.numVerticalGlyphVertices>0&&pn?zi(pn,mt.verticalIconBox,u.an.vertical):{box:null,occluded:!0,offscreen:null}}),Pi&&(Si=Pi.placeable,Ci=Pi.offscreen);const er=ur(Pi&&Pi.placeable);if(!Si&&this.prevPlacement){const pn=this.prevPlacement.variableOffsets[Ye.crossTileID];pn&&(this.variableOffsets[Ye.crossTileID]=pn,this.markUsedJustification(c,pn.anchor,Ye,er))}}}if(di=Pi,Si=di&&di.placeable,Ci=di&&di.offscreen,Ye.useRuntimeCollisionCircles){const ur=c.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex),qr=u.ao(c.textSizeData,U,ur),Qs=m.get("text-padding");Tn=this.collisionIndex.placeCollisionCircles(ie,ur,c.lineVertexArray,c.glyphOffsetArray,qr,T,E,l,ye,Z.predicate,Ye.collisionCircleDiameter,Qs,y,Be),Tn.circles.length&&Tn.collisionDetected&&!l&&u.w("Collisions detected, but collision boxes are not shown"),Si=se||Tn.circles.length>0&&!Tn.collisionDetected,Ci=Ci&&Tn.offscreen}if(mt.iconFeatureIndex&&(Js=mt.iconFeatureIndex),mt.iconBox){const ur=qr=>this.collisionIndex.placeCollisionBox(qr,fe,C,De,T,ye,ge,b,Z.predicate,Be,ue&&Ei?Ei:void 0,at);Dn&&Dn.placeable&&mt.verticalIconBox?(zn=ur(mt.verticalIconBox),Gi=zn.placeable):(zn=ur(mt.iconBox),Gi=zn.placeable),Ci=Ci&&zn.offscreen}const Co=te||Ye.numHorizontalGlyphVertices===0&&Ye.numVerticalGlyphVertices===0,Po=ee||Ye.numIconVertices===0;Co||Po?Po?Co||(Gi=Gi&&Si):Si=Gi&&Si:Gi=Si=Gi&&Si;const Ua=Gi&&zn.placeable;if(Si&&di.placeable&&this.collisionIndex.insertCollisionBox(di.box,ie,m.get("text-ignore-placement"),c.bucketInstanceId,Dn&&Dn.placeable&&Ks?Ks:Ws,Z.ID),Ua&&this.collisionIndex.insertCollisionBox(zn.box,fe,m.get("icon-ignore-placement"),c.bucketInstanceId,Js,Z.ID),Tn&&Si&&this.collisionIndex.insertCollisionCircles(Tn.circles,ie,m.get("text-ignore-placement"),c.bucketInstanceId,Ws,Z.ID),l&&this.storeCollisionData(c.bucketInstanceId,Wt,mt,di,zn,Tn),Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ye.crossTileID]=new Fs((Si||Fe)&&!(di!=null&&di.occluded),(Gi||Re)&&!(zn!=null&&zn.occluded),Ci||c.justReloaded),i[Ye.crossTileID]=!0};if(Se){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ye=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let mt=Ye.length-1;mt>=0;--mt){const Wt=Ye[mt];it(c.symbolInstances.get(Wt),c.collisionArrays[Wt],Wt)}}else for(let Ye=e.symbolInstanceStart;Ye<e.symbolInstanceEnd;Ye++)it(c.symbolInstances.get(Ye),c.collisionArrays[Ye],Ye);c.justReloaded=!1}storeCollisionData(e,i,l,c,m,y){if(l.textBox||l.iconBox){let b,T;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(i)?T=b.get(i):(T={text:null,icon:null},b.set(i,T)),l.textBox&&(T.text=c.box),l.iconBox&&(T.icon=m.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)b.push(y.circles[T+0]-Di),b.push(y.circles[T+1]-Di),b.push(y.circles[T+2]),b.push(y.collisionDetected?1:0)}}markUsedJustification(e,i,l,c){let m;m=c===u.an.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[u.aF(i)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:l.crossTileID)}markUsedOrientation(e,i,l){const c=i===u.an.horizontal||i===u.an.horizontalOnly?i:0,m=i===u.an.vertical?i:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=c;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let l=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const c=i?i.symbolFadeChange(e):1,m=i?i.opacities:{},y=i?i.variableOffsets:{},b=i?i.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],C=m[T];C?(this.opacities[T]=new mr(C,c,E.text,E.icon),l=l||E.text!==C.text.placed||E.icon!==C.icon.placed):(this.opacities[T]=new mr(null,c,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in m){const E=m[T];if(!this.opacities[T]){const C=new mr(E,c,!1,!1);C.isHidden()||(this.opacities[T]=C,l=l||E.text.placed||E.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in b)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=b[T]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const l={};for(const c of i){const m=c.getBucket(e);m&&c.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,c.tileID,l,c.collisionBoxArray)}}updateBucketOpacities(e,i,l,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],y=m.layout,b=new mr(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),E=y.get("icon-allow-overlap"),C=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=y.get("text-rotation-alignment")==="map",R=y.get("text-pitch-alignment")==="map",U=y.get("icon-text-fit")!=="none",Z=new mr(null,0,T&&(E||!e.hasIconData()||y.get("icon-optional")),E&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const te=(ie,se,fe)=>{for(let oe=0;oe<se/4;oe++)ie.opacityVertexArray.emplaceBack(fe);ie.hasVisibleVertices=ie.hasVisibleVertices||fe!==nr},ee=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ie=0;ie<e.symbolInstances.length;ie++){const se=e.symbolInstances.get(ie),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:oe,crossTileID:ge}=se;let ye=this.opacities[ge];l[ge]?ye=b:ye||(ye=Z,this.opacities[ge]=ye),l[ge]=!0;const ue=se.numIconVertices>0,Se=this.placedOrientations[se.crossTileID],Fe=Se===u.an.vertical,Re=Se===u.an.horizontal||Se===u.an.horizontalOnly;if(fe>0||oe>0){const Be=Sr(ye.text);te(e.text,fe,Fe?nr:Be),te(e.text,oe,Re?nr:Be);const at=ye.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(e.text.placedSymbolArray.get(mt).hidden=at||Fe?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=at||Re?1:0);const it=this.variableOffsets[se.crossTileID];it&&this.markUsedJustification(e,it.anchor,se,Se);const Ye=this.placedOrientations[se.crossTileID];Ye&&(this.markUsedJustification(e,"left",se,Ye),this.markUsedOrientation(e,Ye,se))}if(ue){const Be=Sr(ye.icon),at=!(U&&se.verticalPlacedIconSymbolIndex&&Fe);se.placedIconSymbolIndex>=0&&(te(e.icon,se.numIconVertices,at?Be:nr),e.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=ye.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(te(e.icon,se.numVerticalIconVertices,at?nr:Be),e.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}const De=ee&&ee.has(ie)?ee.get(ie):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Be=e.collisionArrays[ie];if(Be){let at=new u.P(0,0);if(Be.textBox||Be.verticalTextBox){let it=!0;if(C){const Ye=this.variableOffsets[ge];Ye?(at=xs(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textBoxScale),z&&at._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):it=!1}if(Be.textBox||Be.verticalTextBox){let Ye;Be.textBox&&(Ye=Fe),Be.verticalTextBox&&(Ye=Re),Or(e.textCollisionBox.collisionVertexArray,ye.text.placed,!it||Ye,De.text,at.x,at.y)}}if(Be.iconBox||Be.verticalIconBox){const it=!!(!Re&&Be.verticalIconBox);let Ye;Be.iconBox&&(Ye=it),Be.verticalIconBox&&(Ye=!it),Or(e.iconCollisionBox.collisionVertexArray,ye.icon.placed,Ye,De.icon,U?at.x:0,U?at.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const l=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Or(p,e,i,l,c,m){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-Di,b=l[1]-Di,T=l[2]-Di,E=l[3]-Di;p.emplaceBack(e?1:0,i?1:0,c||0,m||0,y,b),p.emplaceBack(e?1:0,i?1:0,c||0,m||0,T,b),p.emplaceBack(e?1:0,i?1:0,c||0,m||0,T,E),p.emplaceBack(e?1:0,i?1:0,c||0,m||0,y,E)}const Fr=Math.pow(2,25),Jr=Math.pow(2,24),Uo=Math.pow(2,17),Vo=Math.pow(2,16),Wa=Math.pow(2,9),ws=Math.pow(2,8),ra=Math.pow(2,1);function Sr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,i=Math.floor(127*p.opacity);return i*Fr+e*Jr+i*Uo+e*Vo+i*Wa+e*ws+i*ra+e}const nr=0;class Go{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,l,c,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(y,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,T)=>b.sortKey-T.sortKey));this._currentPartIndex<y.length;)if(i.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class Ts{constructor(e,i,l,c,m,y,b,T){this.placement=new bs(e,i,y,b,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,i,l){const c=we.now(),m=()=>!this._forceFullPlacement&&we.now()-c>2;for(;this._currentPlacementIndex>=0;){const y=i[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Go(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Bs=512/u.$/2;class Ka{constructor(e,i,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const c=new Map;for(let m=0;m<i.length;m++){const y=i.get(m),b=y.key,T=c.get(b);T?T.push(y):c.set(b,[y])}for(const[m,y]of c){const b={positions:y.map(T=>({x:Math.floor(T.anchorX*Bs),y:Math.floor(T.anchorY*Bs)})),crossTileIDs:y.map(T=>T.crossTileID)};if(b.positions.length>128){const T=new u.aH(b.positions.length,16,Uint16Array);for(const{x:E,y:C}of b.positions)T.add(E,C);T.finish(),delete b.positions,b.index=T}this._symbolsByKey[m]=b}}getScaledCoordinates(e,i){const{x:l,y:c,z:m}=this.tileID.canonical,{x:y,y:b,z:T}=i.canonical,E=Bs/Math.pow(2,T-m),C=(b*u.$+e.anchorY)*E,z=c*u.$*Bs;return{x:Math.floor((y*u.$+e.anchorX)*E-l*u.$*Bs),y:Math.floor(C-z)}}findMatches(e,i,l){const c=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const T=this.getScaledCoordinates(y,i);if(b.index){const E=b.index.range(T.x-c,T.y-c,T.x+c,T.y+c).sort();for(const C of E){const z=b.crossTileIDs[C];if(!l[z]){l[z]=!0,y.crossTileID=z;break}}}else if(b.positions)for(let E=0;E<b.positions.length;E++){const C=b.positions[E],z=b.crossTileIDs[E];if(Math.abs(C.x-T.x)<=c&&Math.abs(C.y-T.y)<=c&&!l[z]){l[z]=!0,y.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const l in this.indexes){const c=this.indexes[l],m={};for(const y in c){const b=c[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+i),m[b.tileID.key]=b}this.indexes[l]=m}this.lng=e}addBucket(e,i,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<i.symbolInstances.length;m++)i.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const b in y){const T=y[b];T.tileID.isChildOf(e)&&T.findMatches(i.symbolInstances,e,c)}else{const b=y[e.scaledTo(Number(m)).key];b&&b.findMatches(i.symbolInstances,e,c)}}for(let m=0;m<i.symbolInstances.length;m++){const y=i.symbolInstances.get(m);y.crossTileID||(y.crossTileID=l.generate(),c[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ka(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const l of i.getCrossTileIDsLists())for(const c of l)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let i=!1;for(const l in this.indexes){const c=this.indexes[l];for(const m in c)e[c[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,c[m]),delete c[m],i=!0)}return i}}class sa{constructor(){this.layerIndexes={},this.crossTileIDs=new Ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,l){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new qo);let m=!1;const y={};c.handleWrapJump(l);for(const b of i){const T=b.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,T,this.crossTileIDs)&&(m=!0),y[T.bucketInstanceId]=!0)}return c.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const i={};e.forEach(l=>{i[l]=!0});for(const l in this.layerIndexes)i[l]||delete this.layerIndexes[l]}}var Qr="void main() {fragColor=vec4(1.0);}";const gr={prelude:Kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Kt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Kt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kt(Qr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Kt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(textureSize(u_elevation_stops,0)[0]);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int num_elevation_stops=textureSize(u_elevation_stops,0)[0];int r=(num_elevation_stops-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(textureSize(u_color_stops,0)[0]);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Kt(Qr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Kt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Kt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Kt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Kt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Kt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Kt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Kt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Kt(p,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(c):c,b={};return{fragmentSource:p=p.replace(i,(T,E,C,z,R)=>(b[R]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${C} ${z} ${R};
#else
uniform ${C} ${z} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${C} ${z} ${R} = u_${R};
#endif
`)),vertexSource:e=e.replace(i,(T,E,C,z,R)=>{const U=z==="float"?"vec2":"vec4",Z=R.match(/color/)?"color":U;return b[R]?E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${C} ${U} a_${R};
out ${C} ${z} ${R};
#else
uniform ${C} ${z} u_${R};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${C} ${z} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${Z}(a_${R}, u_${R}_t);
#else
    ${C} ${z} ${R} = u_${R};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${C} ${U} a_${R};
#else
uniform ${C} ${z} u_${R};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${C} ${z} ${R} = a_${R};
#else
    ${C} ${z} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${C} ${z} ${R} = unpack_mix_${Z}(a_${R}, u_${R}_t);
#else
    ${C} ${z} ${R} = u_${R};
#endif
`}),staticAttributes:l,staticUniforms:y}}class Er{constructor(e,i,l){this.vertexBuffer=e,this.indexBuffer=i,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Br=u.aI([{name:"a_pos",type:"Int16",components:2}]);const jr="#define PROJECTION_MERCATOR",ki="mercator";class Ur{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ki}get shaderDefine(){return jr}get shaderPreludeCode(){return gr.projectionMercator}get vertexShaderPreludeCode(){return gr.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,l,c,m){if(this._cachedMesh)return this._cachedMesh;const y=new u.aK;y.emplaceBack(0,0),y.emplaceBack(u.$,0),y.emplaceBack(0,u.$),y.emplaceBack(u.$,u.$);const b=e.createVertexBuffer(y,Br.members),T=u.aL.simpleSegment(0,0,4,2),E=new u.aM;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const C=e.createIndexBuffer(E);return this._cachedMesh=new Er(b,C,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class rr{constructor(e=0,i=0,l=0,c=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(l)||l<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=l,this.right=c}interpolate(e,i,l){return i.top!=null&&e.top!=null&&(this.top=u.C.number(e.top,i.top,l)),i.bottom!=null&&e.bottom!=null&&(this.bottom=u.C.number(e.bottom,i.bottom,l)),i.left!=null&&e.left!=null&&(this.left=u.C.number(e.left,i.left,l)),i.right!=null&&e.right!=null&&(this.right=u.C.number(e.right,i.right,l)),this}getCenter(e,i){const l=u.ag((this.left+e-this.right)/2,0,e),c=u.ag((this.top+i-this.bottom)/2,0,i);return new u.P(l,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new rr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _r(p,e){if(!p.renderWorldCopies||p.lngRange)return;const i=e.lng-p.center.lng;e.lng+=i>180?-360:i<-180?360:0}function Ut(p){return Math.max(0,Math.floor(p))}class _n{constructor(e,i,l,c,m,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=c??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ut(this._zoom),this._scale=u.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new rr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Ut(this._zoom),this._scale=u.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new rr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=u.aN(e,-180,180)*Math.PI/180;var l,c,m,y,b,T,E,C,z;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=Ae(),l=this._rotationMatrix,m=-this._bearingInRadians,y=(c=this._rotationMatrix)[0],b=c[1],T=c[2],E=c[3],C=Math.sin(m),z=Math.cos(m),l[0]=y*z+T*C,l[1]=b*z+E*C,l[2]=y*-C+T*z,l[3]=b*-C+E*z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=u.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aO(this._fovInRadians)}setFov(e){e=u.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=u.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=u.ae(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,l){this._unmodified=!1,this._edgeInsets.interpolate(e,i,l),this._constrain(),this._calcMatrices()}resize(e,i,l=!0){this._width=e,this._height=i,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ci([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,u.ah])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{const{minX:l,minY:c,maxX:m,maxY:y}=u.a1.fromPoints(i).extend(e);return[new u.P(l,c),new u.P(m,c),new u.P(m,y),new u.P(l,y),new u.P(l,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=u.af(new Float64Array(16));u.N(e,e,[this._width/2,-this._height/2,1]),u.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=u.af(new Float64Array(16)),u.N(e,e,[1,-1,1]),u.M(e,e,[-1,-1,0]),u.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,l,c){const m=l!==void 0?l:this.bearing,y=c=c!==void 0?c:this.pitch,b=u.a0.fromLngLat(e,i),T=-Math.cos(u.ad(y)),E=Math.sin(u.ad(y)),C=E*Math.sin(u.ad(m)),z=-E*Math.cos(u.ad(m));let R=this.elevation;const U=i-R;let Z;T*U>=0||Math.abs(T)<.1?(Z=1e4,R=i+Z*T):Z=-U/T;let te,ee,ie=u.aP(1,b.y),se=0;do{if(se+=1,se>10)break;ee=Z/ie,te=new u.a0(b.x+C*ee,b.y+z*ee),ie=1/te.meterInMercatorCoordinateUnits()}while(Math.abs(Z-ee*ie)>1e-12);return{center:te.toLngLat(),elevation:R,zoom:u.aj(this.height/2/Math.tan(this.fovInRadians/2)/ee/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=u.ai(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/i,c=u.a0.fromLngLat(this.center,this.elevation),m=ce(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),u.aP(m.z,c.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=u.ai(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/u.$,1/i/u.$]}}class Is{constructor(e,i){this.min=e,this.max=i,this.center=u.aQ([],u.aR([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=u.aS(this.min),c=u.aS(this.max);for(let m=0;m<i.length;m++)l[m]=i[m]?this.min[m]:this.center[m],c[m]=i[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new Is(l,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let l=0;l<e.planes.length;l++){const c=this.intersectsPlane(e.planes[l]);if(c===0)return 0;c===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],l=e[3];for(let c=0;c<3;c++)e[c]>0?(i+=e[c]*this.min[c],l+=e[c]*this.max[c]):(l+=e[c]*this.min[c],i+=e[c]*this.max[c]);return i>=0?2:l<0?0:1}}class Qa{distanceToTile2d(e,i,l,c){const m=c.distanceX([e,i]),y=c.distanceY([e,i]);return Math.hypot(m,y)}getWrap(e,i,l){return l}getTileBoundingVolume(e,i,l,c){var m,y;let b=l,T=l;if(c!=null&&c.terrain){const C=new u.Z(e.z,i,e.z,e.x,e.y),z=c.terrain.getMinMaxElevation(C);b=(m=z.minElevation)!==null&&m!==void 0?m:l,T=(y=z.maxElevation)!==null&&y!==void 0?y:l}const E=1<<e.z;return new Is([i+e.x/E,e.y/E,b],[i+(e.x+1)/E,(e.y+1)/E,T])}allowVariableZoom(e,i){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=u.ag(78.5-l/2,0,60);return!!i.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class yn{constructor(e,i,l){this.points=e,this.planes=i,this.aabb=l}static fromInvProjectionMatrix(e,i=1,l=0,c,m){const y=m?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>function(U,Z,te,ee){const ie=u.av([],U,Z),se=1/ie[3]/te*ee;return u.aX(ie,ie,[se,se,1/ie[3],se])}(R,e,i,b));c&&function(R,U,Z,te){const ee=te?4:0,ie=te?0:4;let se=0;const fe=[],oe=[];for(let ue=0;ue<4;ue++){const Se=u.aT([],R[ue+ie],R[ue+ee]),Fe=u.aY(Se);u.aQ(Se,Se,1/Fe),fe.push(Fe),oe.push(Se)}for(let ue=0;ue<4;ue++){const Se=u.aZ(R[ue+ee],oe[ue],Z);se=Se!==null&&Se>=0?Math.max(se,Se):Math.max(se,fe[ue])}const ge=function(ue,Se){const Fe=u.aT([],ue[Se[0]],ue[Se[1]]),Re=u.aT([],ue[Se[2]],ue[Se[1]]),De=[0,0,0,0];return u.aU(De,u.aV([],Fe,Re)),De[3]=-u.aW(De,ue[Se[0]]),De}(R,U),ye=function(ue,Se){const Fe=u.a_(ue),Re=u.a$([],ue,1/Fe),De=u.aT([],Se,u.aQ([],Re,u.aW(Se,Re))),Be=u.a_(De);if(Be>0){const at=Math.sqrt(1-Re[3]*Re[3]),it=u.aQ([],Re,-Re[3]),Ye=u.aR([],it,u.aQ([],De,at/Be));return u.b0(Se,Ye)}return null}(Z,ge);if(ye!==null){const ue=ye/u.aW(oe[0],ge);se=Math.min(se,ue)}for(let ue=0;ue<4;ue++){const Se=Math.min(se,fe[ue]);R[ue+ie]=[R[ue+ee][0]+oe[ue][0]*Se,R[ue+ee][1]+oe[ue][1]*Se,R[ue+ee][2]+oe[ue][2]*Se,1]}}(T,y[0],c,m);const E=y.map(R=>{const U=u.aT([],T[R[0]],T[R[1]]),Z=u.aT([],T[R[2]],T[R[1]]),te=u.aU([],u.aV([],U,Z)),ee=-u.aW(te,T[R[1]]);return te.concat(ee)}),C=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const R of T)for(let U=0;U<3;U++)C[U]=Math.min(C[U],R[U]),z[U]=Math.max(z[U],R[U]);return new yn(T,E,new Is(C,z))}}class Xi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,l=!0){this._helper.resize(e,i,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,l,c,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new _n({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,b)=>this.getConstrained(y,b)},e,i,l,c,m),this._coveringTilesDetailsProvider=new Qa}clone(){const e=new Xi;return e.apply(this),e}apply(e,i,l){this._helper.apply(e,i,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new u.b1(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new u.P(0,0)),c=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,c.x,m.x,y.x)),T=Math.floor(Math.max(l.x,c.x,m.x,y.x)),E=1;for(let C=b-E;C<=T+E;C++)C!==0&&i.push(new u.b1(C,e))}return i}getCameraFrustum(){return yn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,i){const l=u.ai(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(i,l),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=u.a0.fromLngLat(e),b=new u.a0(y.x-(c.x-m.x),y.y-(c.y-m.y));this.setCenter(b==null?void 0:b.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(u.a0.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(u.a0.fromLngLat(e))}screenPointToLocation(e,i){var l;return(l=this.screenPointToMercatorCoordinate(e,i))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const l=i.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const l=i||0,c=[e.x,e.y,0,1],m=[e.x,e.y,1,1];u.av(c,c,this._pixelMatrixInverse),u.av(m,m,this._pixelMatrixInverse);const y=c[3],b=m[3],T=c[1]/y,E=m[1]/b,C=c[2]/y,z=m[2]/b,R=C===z?0:(l-C)/(z-C);return new u.a0(u.C.number(c[0]/y,m[0]/b,R)/this.worldSize,u.C.number(T,E,R)/this.worldSize,l)}coordinatePoint(e,i=0,l=this._pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,i,1];return u.av(c,c,l),new u.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this._helper._height/2-H(this));return new ci().extend(this.screenPointToLocation(new u.P(0,e))).extend(this.screenPointToLocation(new u.P(this._helper._width,e))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-H(this)}calculatePosMatrix(e,i=!1,l){var c;const m=(c=e.key)!==null&&c!==void 0?c:u.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=i?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(m)){const E=y.get(m);return l?E.f32:E.f64}const b=W(e,this.worldSize);u.O(b,i?this._alignedProjMatrix:this._viewProjMatrix,b);const T={f64:b,f32:new Float32Array(b)};return y.set(m,T),l?T.f32:T.f64}calculateFogMatrix(e){const i=e.key,l=this._fogMatrixCacheF32;if(l.has(i))return l.get(i);const c=W(e,this.worldSize);return u.O(c,this._fogMatrix,c),l.set(i,new Float32Array(c)),l.get(i)}getConstrained(e,i){i=u.ag(+i,this.minZoom,this.maxZoom);const l={center:new u.S(e.lng,e.lat),zoom:i};let c=this._helper._lngRange;this._helper._renderWorldCopies||c!==null||(c=[-179.9999999999,180-1e-10]);const m=this.tileSize*u.ae(l.zoom);let y=0,b=m,T=0,E=m,C=0,z=0;const{x:R,y:U}=this.size;if(this._helper._latRange){const fe=this._helper._latRange;y=u.U(fe[1])*m,b=u.U(fe[0])*m,b-y<U&&(C=U/(b-y))}c&&(T=u.aN(u.V(c[0])*m,0,m),E=u.aN(u.V(c[1])*m,0,m),E<T&&(E+=m),E-T<R&&(z=R/(E-T)));const{x:Z,y:te}=ke(m,e);let ee,ie;const se=Math.max(z||0,C||0);if(se){const fe=new u.P(z?(E+T)/2:Z,C?(b+y)/2:te);return l.center=Y(m,fe).wrap(),l.zoom+=u.aj(se),l}if(this._helper._latRange){const fe=U/2;te-fe<y&&(ie=y+fe),te+fe>b&&(ie=b-fe)}if(c){const fe=(T+E)/2;let oe=Z;this._helper._renderWorldCopies&&(oe=u.aN(Z,fe-m/2,fe+m/2));const ge=R/2;oe-ge<T&&(ee=T+ge),oe+ge>E&&(ee=E-ge)}if(ee!==void 0||ie!==void 0){const fe=new u.P(ee??Z,ie??te);l.center=Y(m,fe).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,i,l,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,c)}_calculateNearFarZIfNeeded(e,i,l){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-c*this._helper._pixelPerMeter/Math.cos(i),y=c<0?m:e,b=Math.PI/2+this.pitchInRadians,T=u.ad(this.fov)*(Math.abs(Math.cos(u.ad(this.roll)))*this.height+Math.abs(Math.sin(u.ad(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(T)*y/Math.sin(u.ag(Math.PI-b-T,.01,Math.PI-.01)),C=H(this),z=Math.atan(C/this._helper.cameraToCenterDistance),R=u.ad(.75),U=z>R?2*z*(.5+l.y/(2*C)):R,Z=Math.sin(U)*y/Math.sin(u.ag(Math.PI-b-U,.01,Math.PI-.01)),te=Math.min(E,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*te+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=ke(this.worldSize,this.center),l=i.x,c=i.y;this._helper._pixelPerMeter=u.ai(1,this.center.lat)*this.worldSize;const m=u.ad(Math.min(this.pitch,Nt)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let b;this._calculateNearFarZIfNeeded(y,m,e),b=new Float64Array(16),u.b3(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.ap(this._invProjMatrix,b),b[8]=2*-e.x/this._helper._width,b[9]=2*e.y/this._helper._height,this._projectionMatrix=u.b4(b),u.N(b,b,[1,-1,1]),u.M(b,b,[0,0,-this._helper.cameraToCenterDistance]),u.b5(b,b,-this.rollInRadians),u.b6(b,b,this.pitchInRadians),u.b5(b,b,-this.bearingInRadians),u.M(b,b,[-l,-c,0]),this._mercatorMatrix=u.N([],b,[this.worldSize,this.worldSize,this.worldSize]),u.N(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),u.M(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=u.ap([],b);const T=[0,0,-1,1];u.av(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),u.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,u.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.M(this._fogMatrix,this._fogMatrix,[-l,-c,0]),u.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const E=this._helper._width%2/2,C=this._helper._height%2/2,z=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),U=l-Math.round(l)+z*E+R*C,Z=c-Math.round(c)+z*C+R*E,te=new Float64Array(b);if(u.M(te,te,[U>.5?U-1:U,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=te,b=u.ap(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new u.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.av(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=u.ai(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const l=u.a0.fromLngLat(e),c=[l.x*this.worldSize,l.y*this.worldSize,i,1];return u.av(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){const{overscaledTileID:i,aligned:l,applyTerrainMatrix:c}=e,m=this._helper.getMercatorTileCoordinates(i),y=i?this.calculatePosMatrix(i,l,!0):null;let b;return b=i&&i.terrainRttPosMatrix32f&&c?i.terrainRttPosMatrix32f:y||u.b7(),{mainMatrix:b,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,l){return 1}transformLightDirection(e){return u.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,l,c){const m=this.calculatePosMatrix(l);let y;c?(y=[e,i,c(e,i),1],u.av(y,y,m)):(y=[e,i,0,1],ys(y,y,m));const b=y[3];return{point:new u.P(y[0]/b,y[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const l=u.a0.fromLngLat(e,i),c=l.meterInMercatorCoordinateUnits(),m=u.b8();return u.M(m,m,[l.x,l.y,l.z]),u.b5(m,m,Math.PI),u.b6(m,m,Math.PI/2),u.N(m,m,[-c,c,c]),m}getProjectionDataForCustomLayer(e=!0){const i=new u.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),c=W(i,this.worldSize);u.O(c,this._viewProjMatrix,c),l.tileMercatorCoords=[0,0,1,1];const m=[u.$,u.$,this.worldSize/this._helper.pixelsPerMeter],y=u.b9();return u.N(y,c,m),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function rn(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function un(p){if(p.useSlerp)if(p.k<1){const e=u.ba(p.startEulerAngles.roll,p.startEulerAngles.pitch,p.startEulerAngles.bearing),i=u.ba(p.endEulerAngles.roll,p.endEulerAngles.pitch,p.endEulerAngles.bearing),l=new Float64Array(4);u.bb(l,e,i,p.k);const c=u.bc(l);p.tr.setRoll(c.roll),p.tr.setPitch(c.pitch),p.tr.setBearing(c.bearing)}else p.tr.setRoll(p.endEulerAngles.roll),p.tr.setPitch(p.endEulerAngles.pitch),p.tr.setBearing(p.endEulerAngles.bearing);else p.tr.setRoll(u.C.number(p.startEulerAngles.roll,p.endEulerAngles.roll,p.k)),p.tr.setPitch(u.C.number(p.startEulerAngles.pitch,p.endEulerAngles.pitch,p.k)),p.tr.setBearing(u.C.number(p.startEulerAngles.bearing,p.endEulerAngles.bearing,p.k))}function Mi(p,e,i,l,c){const m=c.padding,y=ke(c.worldSize,i.getNorthWest()),b=ke(c.worldSize,i.getNorthEast()),T=ke(c.worldSize,i.getSouthEast()),E=ke(c.worldSize,i.getSouthWest()),C=u.ad(-l),z=y.rotate(C),R=b.rotate(C),U=T.rotate(C),Z=E.rotate(C),te=new u.P(Math.max(z.x,R.x,Z.x,U.x),Math.max(z.y,R.y,Z.y,U.y)),ee=new u.P(Math.min(z.x,R.x,Z.x,U.x),Math.min(z.y,R.y,Z.y,U.y)),ie=te.sub(ee),se=(c.width-(m.left+m.right+e.left+e.right))/ie.x,fe=(c.height-(m.top+m.bottom+e.top+e.bottom))/ie.y;if(fe<0||se<0)return void rn();const oe=Math.min(u.aj(c.scale*Math.min(se,fe)),p.maxZoom),ge=u.P.convert(p.offset),ye=new u.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(u.ad(l)),ue=ge.add(ye).mult(c.scale/u.ae(oe));return{center:Y(c.worldSize,y.add(T).div(2).sub(ue)),zoom:oe,bearing:l}}class pi{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,l){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,i,l,c,m){return Mi(e,i,l,c,m)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(u.S.convert(i.center))}handleEaseTo(e,i){const l=e.zoom,c=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},b=i.zoom!==void 0,T=!e.isPaddingEqual(i.padding);let E=!1;const C=b?+i.zoom:e.zoom;let z=e.centerPoint.add(i.offsetAsPoint);const R=e.screenPointToLocation(z),{center:U,zoom:Z}=e.getConstrained(u.S.convert(i.center||R),C??l);_r(e,U);const te=ke(e.worldSize,R),ee=ke(e.worldSize,U).sub(te),ie=u.ae(Z-l);return E=Z!==l,{easeFunc:se=>{if(E&&e.setZoom(u.C.number(l,Z,se)),u.bd(m,y)||un({startEulerAngles:m,endEulerAngles:y,tr:e,k:se,useSlerp:m.roll!=y.roll}),T&&(e.interpolatePadding(c,i.padding,se),z=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const fe=u.ae(e.zoom-l),oe=Z>l?Math.min(2,ie):Math.max(.5,ie),ge=Math.pow(oe,1-se),ye=Y(e.worldSize,te.add(ee.mult(se*ge)).mult(fe));e.setLocationAtPoint(e.renderWorldCopies?ye.wrap():ye,z)}},isZooming:E,elevationCenter:U}}handleFlyTo(e,i){const l=i.zoom!==void 0,c=e.zoom,m=e.getConstrained(u.S.convert(i.center||i.locationAtOffset),l?+i.zoom:c),y=m.center,b=m.zoom;_r(e,y);const T=ke(e.worldSize,i.locationAtOffset),E=ke(e.worldSize,y).sub(T),C=E.mag(),z=u.ae(b-c);let R;if(i.minZoom!==void 0){const U=Math.min(+i.minZoom,c,b),Z=e.getConstrained(y,U).zoom;R=u.ae(Z-c)}return{easeFunc:(U,Z,te,ee)=>{e.setZoom(U===1?b:c+u.aj(Z));const ie=U===1?y:Y(e.worldSize,T.add(E.mult(te)).mult(Z));e.setLocationAtPoint(e.renderWorldCopies?ie.wrap():ie,ee)},scaleOfZoom:z,targetCenter:y,scaleOfMinZoom:R,pixelPathLength:C}}}class Yt{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}Yt.Replace=[1,0],Yt.disabled=new Yt(Yt.Replace,u.be.transparent,[!1,!1,!1,!1]),Yt.unblended=new Yt(Yt.Replace,u.be.transparent,[!0,!0,!0,!0]),Yt.alphaBlended=new Yt([1,771],u.be.transparent,[!0,!0,!0,!0]);const vn=2305;class $t{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}$t.disabled=new $t(!1,1029,vn),$t.backCCW=new $t(!0,1029,vn),$t.frontCCW=new $t(!0,1028,vn);class Zt{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}Zt.ReadOnly=!1,Zt.ReadWrite=!0,Zt.disabled=new Zt(519,Zt.ReadOnly,[0,1]);const es=7680;class bt{constructor(e,i,l,c,m,y){this.test=e,this.ref=i,this.mask=l,this.fail=c,this.depthFail=m,this.pass=y}}bt.disabled=new bt({func:519,mask:0},0,0,es,es,es);const ts=new WeakMap;function dn(p){var e;if(ts.has(p))return ts.get(p);{const i=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ts.set(p,i),i}}class Ss{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,l=i.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const c=new u.aK;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const m=new u.aM;m.emplaceBack(0,1,2),this._fullscreenTriangle=new Er(i.createVertexBuffer(c,Br.members),i.createIndexBuffer(m),u.aL.simpleSegment(0,0,c.length,m.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),dn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const l=this._cachedRenderContext.context,c=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:u.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,c.TRIANGLES,Zt.disabled,bt.disabled,Yt.unblended,$t.disabled,((m,y)=>({u_input:m,u_output_expected:y}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&dn(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const m=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&dn(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ss._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const Kn=u.$/128;function eo(p,e){const i=p.granularity!==void 0?Math.max(p.granularity,1):1,l=i+(p.generateBorders?2:0),c=i+(p.extendToNorthPole||p.generateBorders?1:0)+(p.extendToSouthPole||p.generateBorders?1:0),m=l+1,y=c+1,b=p.generateBorders?-1:0,T=p.generateBorders||p.extendToNorthPole?-1:0,E=i+(p.generateBorders?1:0),C=i+(p.generateBorders||p.extendToSouthPole?1:0),z=m*y,R=l*c*6,U=m*y>65536;if(U&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=U||e==="32bit",te=new Int16Array(2*z);let ee=0;for(let fe=T;fe<=C;fe++)for(let oe=b;oe<=E;oe++){let ge=oe/i*u.$;oe===-1&&(ge=-64),oe===i+1&&(ge=u.$+Kn);let ye=fe/i*u.$;fe===-1&&(ye=p.extendToNorthPole?u.bg:-64),fe===i+1&&(ye=p.extendToSouthPole?u.bh:u.$+Kn),te[ee++]=ge,te[ee++]=ye}const ie=Z?new Uint32Array(R):new Uint16Array(R);let se=0;for(let fe=0;fe<c;fe++)for(let oe=0;oe<l;oe++){const ge=oe+1+fe*m,ye=oe+(fe+1)*m,ue=oe+1+(fe+1)*m;ie[se++]=oe+fe*m,ie[se++]=ye,ie[se++]=ge,ie[se++]=ge,ie[se++]=ye,ie[se++]=ue}return{vertices:te.buffer.slice(0),indices:ie.buffer.slice(0),uses32bitIndices:Z}}const yr=new u.aJ({fill:new u.bi(128,2),line:new u.bi(512,0),tile:new u.bi(128,32),stencil:new u.bi(128,1),circle:3});class kr{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return gr.projectionGlobe}get vertexShaderPreludeCode(){return gr.projectionMercator.vertexSource}get subdivisionGranularity(){return yr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Ss(e));const i=u.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(i,l),m=we.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=m);const y=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bk(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,l,c,m){const y=(m==="stencil"?yr.stencil:yr.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:i.y===0&&c,extendToSouthPole:i.y===(1<<i.z)-1&&c})}_getMesh(e,i){const l=this._getMeshKey(i);if(l in this._tileMeshCache)return this._tileMeshCache[l];const c=function(m,y){const b=eo(y,"16bit"),T=u.aK.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),E=u.aM.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Er(m.createVertexBuffer(T,Br.members),m.createIndexBuffer(E),u.aL.simpleSegment(0,0,T.length,E.length))}(e,i);return this._tileMeshCache[l]=c,c}recalculate(e){}hasTransition(){const e=we.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const aa=new u.r({type:new u.D(u.v.projection.type)});class oa extends u.E{constructor(e){super(),this._transitionable=new u.t(aa),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.F(0)),this._mercatorProjection=new Ur,this._verticalPerspectiveProjection=new kr}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof u.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,l,c,m){return this.currentProjection.getMeshFromTileID(e,i,l,c,m)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function xn(p){const e=vr(p.worldSize,p.center.lat);return 2*Math.PI*e}function bn(p,e,i,l,c){const m=1/(1<<c),y=e/u.$*m+l*m,b=u.bn((p/u.$*m+i*m)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,E=Math.cos(T),C=new Float64Array(3);return C[0]=Math.sin(b)*E,C[1]=Math.sin(T),C[2]=Math.cos(b)*E,C}function cn(p){return function(e,i){const l=Math.cos(i),c=new Float64Array(3);return c[0]=Math.sin(e)*l,c[1]=Math.sin(i),c[2]=Math.cos(e)*l,c}(p.lng*Math.PI/180,p.lat*Math.PI/180)}function vr(p,e){return p/(2*Math.PI)/Math.cos(e*Math.PI/180)}function js(p){const e=Math.asin(p[1])/Math.PI*180,i=Math.sqrt(p[0]*p[0]+p[2]*p[2]);if(i>1e-6){const l=p[0]/i,c=Math.acos(p[2]/i),m=(l>0?c:-c)/Math.PI*180;return new u.S(u.aN(m,-180,180),e)}return new u.S(0,e)}function xr(p){return Math.cos(p*Math.PI/180)}function Qi(p,e){const i=xr(p),l=xr(e);return u.aj(l/i)}function Un(p,e){const i=p.rotate(e.bearingInRadians),l=e.zoom+Qi(e.center.lat,0),c=u.bj(1/xr(e.center.lat),1/xr(Math.min(Math.abs(e.center.lat),60)),u.bm(l,7,3,0,1)),m=360/xn({worldSize:e.worldSize,center:{lat:e.center.lat}});return new u.S(e.center.lng-i.x*m*c,u.ag(e.center.lat+i.y*m,-85.051129,u.ah))}function Es(p){const e=.5*p,i=Math.sin(e),l=Math.cos(e);return Math.log(i+l)-Math.log(l-i)}function Us(p,e,i,l){const c=p.lat+i*l;if(Math.abs(i)>1){const m=(Math.sign(p.lat+i)!==Math.sign(p.lat)?-Math.abs(p.lat):Math.abs(p.lat))*Math.PI/180,y=Math.abs(p.lat+i)*Math.PI/180,b=Es(m+l*(y-m)),T=Es(m),E=Es(y);return new u.S(p.lng+e*((b-T)/(E-T)),c)}return new u.S(p.lng+e*l,c)}class jl{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,i,l,c){const m=`${e.z}_${e.x}_${e.y}_${c!=null&&c.terrain?"t":""}`,y=this._cache.get(m);if(y)return y;const b=this._cachePrevious.get(m);if(b)return this._cache.set(m,b),b;const T=this._boundingVolumeFactory(e,i,l,c);return this._cache.set(m,T),this._hadAnyChanges=!0,T}}class is{constructor(e,i,l,c){this.min=l,this.max=c,this.points=e,this.planes=i}static fromAabb(e,i){const l=[];for(let c=0;c<8;c++)l.push([1&~c?e[0]:i[0],(c>>1&1)==1?i[1]:e[1],(c>>2&1)==1?i[2]:e[2]]);return new is(l,[[-1,0,0,i[0]],[1,0,0,-e[0]],[0,-1,0,i[1]],[0,1,0,-e[1]],[0,0,-1,i[2]],[0,0,1,-e[2]]],e,i)}static fromCenterSizeAngles(e,i,l){const c=u.bq([],l[0],l[1],l[2]),m=u.br([],[i[0],0,0],c),y=u.br([],[0,i[1],0],c),b=u.br([],[0,0,i[2]],c),T=[...e],E=[...e];for(let z=0;z<8;z++)for(let R=0;R<3;R++){const U=e[R]+m[R]*(1&~z?-1:1)+y[R]*((z>>1&1)==1?1:-1)+b[R]*((z>>2&1)==1?1:-1);T[R]=Math.min(T[R],U),E[R]=Math.max(E[R],U)}const C=[];for(let z=0;z<8;z++){const R=[...e];u.aR(R,R,u.aQ([],m,1&~z?-1:1)),u.aR(R,R,u.aQ([],y,(z>>1&1)==1?1:-1)),u.aR(R,R,u.aQ([],b,(z>>2&1)==1?1:-1)),C.push(R)}return new is(C,[[...m,-u.aW(m,C[0])],[...y,-u.aW(y,C[0])],[...b,-u.aW(b,C[0])],[-m[0],-m[1],-m[2],-u.aW(m,C[7])],[-y[0],-y[1],-y[2],-u.aW(y,C[7])],[-b[0],-b[1],-b[2],-u.aW(b,C[7])]],T,E)}intersectsFrustum(e){let i=!0;const l=this.points.length,c=this.planes.length,m=e.planes.length,y=e.points.length;for(let b=0;b<m;b++){const T=e.planes[b];let E=0;for(let C=0;C<l;C++){const z=this.points[C];T[0]*z[0]+T[1]*z[1]+T[2]*z[2]+T[3]>=0&&E++}if(E===0)return 0;E<l&&(i=!1)}if(i)return 2;for(let b=0;b<c;b++){const T=this.planes[b];let E=0;for(let C=0;C<y;C++){const z=e.points[C];T[0]*z[0]+T[1]*z[1]+T[2]*z[2]+T[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(e){const i=this.points.length;let l=0;for(let c=0;c<i;c++){const m=this.points[c];e[0]*m[0]+e[1]*m[1]+e[2]*m[2]+e[3]>=0&&l++}return l===i?2:l===0?0:1}}function la(p,e,i){const l=p-e;return l<0?-l:Math.max(0,l-i)}function to(p,e,i,l,c){const m=p-i;let y;return y=m<0?Math.min(-m,1+m-c):m>1?Math.min(Math.max(m-c,0),1-m):0,Math.max(y,la(e,l,c))}class Ul{constructor(){this._boundingVolumeCache=new jl(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,i,l,c){const m=1<<l.z,y=1/m,b=l.x/m,T=l.y/m;let E=2;return E=Math.min(E,to(e,i,b,T,y)),E=Math.min(E,to(e,i,b+.5,-T-y,y)),E=Math.min(E,to(e,i,b+.5,2-T-y,y)),E}getWrap(e,i,l){const c=1<<i.z,m=1/c,y=i.x/c,b=la(e.x,y,m),T=la(e.x,y-1,m),E=la(e.x,y+1,m),C=Math.min(b,T,E);return C===E?1:C===T?-1:0}allowVariableZoom(e,i){return Ve(e,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,i,l,c){return this._boundingVolumeCache.getTileBoundingVolume(e,i,l,c)}_computeTileBoundingVolume(e,i,l,c){var m,y;let b=l,T=l;if(c!=null&&c.terrain){const E=new u.Z(e.z,i,e.z,e.x,e.y),C=c.terrain.getMinMaxElevation(E);b=(m=C.minElevation)!==null&&m!==void 0?m:l,T=(y=C.maxElevation)!==null&&y!==void 0?y:l}if(b/=u.bt,T/=u.bt,b+=1,T+=1,e.z<=0)return is.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return is.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{const E=[bn(0,0,e.x,e.y,e.z),bn(u.$,0,e.x,e.y,e.z),bn(u.$,u.$,e.x,e.y,e.z),bn(0,u.$,e.x,e.y,e.z)],C=[];for(const De of E)C.push(u.aQ([],De,T));if(T!==b)for(const De of E)C.push(u.aQ([],De,b));e.y===0&&C.push([0,1,0]),e.y===(1<<e.z)-1&&C.push([0,-1,0]);const z=[1,1,1],R=[-1,-1,-1];for(const De of C)for(let Be=0;Be<3;Be++)z[Be]=Math.min(z[Be],De[Be]),R[Be]=Math.max(R[Be],De[Be]);const U=bn(u.$/2,u.$/2,e.x,e.y,e.z),Z=u.aV([],[0,1,0],U);u.aU(Z,Z);const te=u.aV([],U,Z);u.aU(te,te);const ee=u.aV([],E[2],E[1]);u.aU(ee,ee);const ie=u.aV([],E[0],E[3]);u.aU(ie,ie),C.push(u.aQ([],U,T)),e.y>=(1<<e.z)/2&&C.push(u.aQ([],bn(u.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&C.push(u.aQ([],bn(u.$/2,u.$,e.x,e.y,e.z),T));const se=Ln(U,C),fe=Ln(te,C),oe=[-U[0],-U[1],-U[2],se.max],ge=[U[0],U[1],U[2],-se.min],ye=[-te[0],-te[1],-te[2],fe.max],ue=[te[0],te[1],te[2],-fe.min],Se=[...ee,0],Fe=[...ie,0],Re=[];return e.y===0?Re.push(u.bs(Fe,Se,oe),u.bs(Fe,Se,ge)):Re.push(u.bs(ye,Se,oe),u.bs(ye,Se,ge),u.bs(ye,Fe,oe),u.bs(ye,Fe,ge)),e.y===(1<<e.z)-1?Re.push(u.bs(Fe,Se,oe),u.bs(Fe,Se,ge)):Re.push(u.bs(ue,Se,oe),u.bs(ue,Se,ge),u.bs(ue,Fe,oe),u.bs(ue,Fe,ge)),new is(Re,[oe,ge,ye,ue,Se,Fe],z,R)}}}function Ln(p,e){let i=1/0,l=-1/0;for(const c of e){const m=u.aW(p,c);i=Math.min(i,m),l=Math.max(l,m)}return{min:i,max:l}}class sr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=u.bu(),this._projectionMatrix=u.b8(),this._globeViewProjMatrix32f=u.b7(),this._globeViewProjMatrixNoCorrection=u.b8(),this._globeViewProjMatrixNoCorrectionInverted=u.b8(),this._globeProjMatrixInverted=u.b8(),this._cameraPosition=u.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new _n({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new Ul}clone(){const e=new sr;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=u.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:l}=e,c=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,l=this.cameraToCenterDistance/e,c=Math.sin(i)*l,m=Math.cos(i)*l+1,y=1/Math.sqrt(c*c+m*m)*1;let b=-c,T=m;const E=Math.sqrt(b*b+T*T);b/=E,T/=E;const C=[0,b,T];u.bv(C,C,[0,0,0],-this.bearingInRadians),u.bw(C,C,[0,0,0],-1*this.center.lat*Math.PI/180),u.bx(C,C,[0,0,0],this.center.lng*Math.PI/180);const z=1/u.aY(C);return u.aQ(C,C,z),[...C,-y*z]}isLocationOccluded(e){return!this.isSurfacePointVisible(cn(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,c=Math.cos(l),m=[Math.sin(i)*c,Math.sin(l),Math.cos(i)*c],y=[m[2],0,-m[0]],b=[0,0,0];u.aV(b,y,m),u.aU(y,y),u.aU(b,b);const T=[0,0,0];return u.aU(T,[y[0]*e[0]+b[0]*e[1]+m[0]*e[2],y[1]*e[0]+b[1]*e[1]+m[1]*e[2],y[2]*e[0]+b[2]*e[1]+m[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,l){const c=function(b,T,E){const C=1/(1<<E.z);return new u.a0(b/u.$*C+E.x*C,T/u.$*C+E.y*C)}(e,i,l.canonical),m=(y=c.y,[u.bn(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,i,l,c){const m=l.canonical,y=bn(e,i,m.x,m.y,m.z),b=1+(c?c(e,i):0)/u.bt,T=[y[0]*b,y[1]*b,y[2]*b,1];u.av(T,T,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,C=E[0]*y[0]+E[1]*y[1]+E[2]*y[2]+E[3]<0;return{point:new u.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:C}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=vr(this.worldSize,this.center.lat),i=u.b9(),l=u.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),u.b3(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;i[8]=2*-c.x/this._helper._width,i[9]=2*c.y/this._helper._height,this._projectionMatrix=u.b4(i),this._globeProjMatrixInverted=u.b9(),u.ap(this._globeProjMatrixInverted,i),u.M(i,i,[0,0,-this.cameraToCenterDistance]),u.b5(i,i,this.rollInRadians),u.b6(i,i,-this.pitchInRadians),u.b5(i,i,this.bearingInRadians),u.M(i,i,[0,0,-e]);const m=u.bo();m[0]=e,m[1]=e,m[2]=e,u.b6(l,i,this.center.lat*Math.PI/180),u.by(l,l,-this.center.lng*Math.PI/180),u.N(l,l,m),this._globeViewProjMatrixNoCorrection=l,u.b6(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.by(i,i,-this.center.lng*Math.PI/180),u.N(i,i,m),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=u.b9(),u.ap(this._globeViewProjMatrixNoCorrectionInverted,l);const y=u.bo();this._cameraPosition=u.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,u.bv(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),u.bw(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),u.bv(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),u.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bw(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),u.bx(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const b=u.b4(this._globeViewProjMatrixNoCorrectionInverted);u.N(b,b,[1,1,-1]),this._cachedFrustum=yn.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){u.w("calculateFogMatrix is not supported on globe projection.");const i=u.b9();return u.af(i),i}getVisibleUnwrappedCoordinates(e){return[new u.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=cn(e);u.aQ(l,l,1+i/u.bt);const c=u.bu();return u.av(c,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,l=[new u.P(0,0),new u.P(e,0),new u.P(this.width,0),new u.P(this.width,i),new u.P(this.width,this.height),new u.P(e,this.height),new u.P(0,this.height),new u.P(0,i)],c=[];for(const z of l)c.push(this.unprojectScreenPoint(z));let m=0,y=0,b=0,T=0;const E=this.center;for(const z of c){const R=u.bz(E.lng,z.lng),U=u.bz(E.lat,z.lat);R<y&&(y=R),R>m&&(m=R),U<T&&(T=U),U>b&&(b=U)}const C=[E.lng+y,E.lat+T,E.lng+m,E.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(C[3]=90,C[0]=-180,C[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(C[1]=-90,C[0]=-180,C[2]=180),new ci(C)}getConstrained(e,i){const l=u.ag(e.lat,-85.051129,u.ah),c=u.ag(+i,this.minZoom+Qi(0,l),this.maxZoom);return{center:new u.S(e.lng,l),zoom:c}}calculateCenterFromCameraLngLatAlt(e,i,l,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,c)}setLocationAtPoint(e,i){const l=cn(this.unprojectScreenPoint(i)),c=cn(e),m=u.bo();u.bA(m);const y=u.bo();u.bx(y,l,m,-this.center.lng*Math.PI/180),u.bw(y,y,m,this.center.lat*Math.PI/180);const b=c[0]*c[0]+c[2]*c[2],T=y[0]*y[0];if(b<T)return;const E=Math.sqrt(b-T),C=-E,z=u.bB(c[0],c[2],y[0],E),R=u.bB(c[0],c[2],y[0],C),U=u.bo();u.bx(U,c,m,-z);const Z=u.bB(U[1],U[2],y[1],y[2]),te=u.bo();u.bx(te,c,m,-R);const ee=u.bB(te[1],te[2],y[1],y[2]),ie=.5*Math.PI,se=Z>=-ie&&Z<=ie,fe=ee>=-ie&&ee<=ie;let oe,ge;if(se&&fe){const Fe=this.center.lng*Math.PI/180,Re=this.center.lat*Math.PI/180;u.bC(z,Fe)+u.bC(Z,Re)<u.bC(R,Fe)+u.bC(ee,Re)?(oe=z,ge=Z):(oe=R,ge=ee)}else if(se)oe=z,ge=Z;else{if(!fe)return;oe=R,ge=ee}const ye=oe/Math.PI*180,ue=ge/Math.PI*180,Se=this.center.lat;this.setCenter(new u.S(ye,u.ag(ue,-90,90))),this.setZoom(this.zoom+Qi(Se,this.center.lat))}locationToScreenPoint(e,i){const l=cn(e);if(i){const c=i.getElevationForLngLatZoom(e,this._helper._tileZoom);u.aQ(l,l,1+c/u.bt)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const i=u.bu();return u.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new u.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const l=i.pointCoordinate(e);if(l)return l}return u.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var l;return(l=this.screenPointToMercatorCoordinate(e,i))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,i){const l=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,c)}getRayDirectionFromPixel(e){const i=u.bu();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,u.av(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const l=u.bo();l[0]=i[0]-this._cameraPosition[0],l[1]=i[1]-this._cameraPosition[1],l[2]=i[2]-this._cameraPosition[2];const c=u.bo();return u.aU(c,l),c}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=u.bu();return u.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const l=u.aW(e,i),c=u.bo(),m=u.bo();u.aQ(m,i,l),u.aT(c,e,m);const y=1-u.aW(c,c);if(y<0)return null;const b=u.aW(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),E=b/T,C=T;return{tMin:Math.min(E,C),tMax:Math.max(E,C)}}unprojectScreenPoint(e){const i=this._cameraPosition,l=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(i,l);if(c){const C=u.bo();u.aR(C,i,[l[0]*c.tMin,l[1]*c.tMin,l[2]*c.tMin]);const z=u.bo();return u.aU(z,C),js(z)}const m=this._cachedClippingPlane,y=m[0]*l[0]+m[1]*l[1]+m[2]*l[2],b=-u.b0(m,i)/y,T=u.bo();if(b>0)u.aR(T,i,[l[0]*b,l[1]*b,l[2]*b]);else{const C=u.bo();u.aR(C,i,[2*l[0],2*l[1],2*l[2]]);const z=u.b0(this._cachedClippingPlane,C);u.aT(T,C,[this._cachedClippingPlane[0]*z,this._cachedClippingPlane[1]*z,this._cachedClippingPlane[2]*z])}const E=function(C){const z=u.bo();return z[0]=C[0]*-C[3],z[1]=C[1]*-C[3],z[2]=C[2]*-C[3],{center:z,radius:Math.sqrt(1-C[3]*C[3])}}(m);return js(function(C,z,R){const U=u.bo();u.aT(U,R,C);const Z=u.bo();return u.bp(Z,C,U,z/u.a_(U)),Z}(E.center,E.radius,T))}getMatrixForModel(e,i){const l=u.S.convert(e),c=1/u.bt,m=u.b8();return u.by(m,m,l.lng/180*Math.PI),u.b6(m,m,-l.lat/180*Math.PI),u.M(m,m,[0,0,1+i/u.bt]),u.b6(m,m,.5*Math.PI),u.N(m,m,[c,c,c]),m}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new u.Z(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Ai{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,l){return this._helper.interpolatePadding(e,i,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,l=!0){this._helper.resize(e,i,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new _n({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new Xi,this._verticalPerspectiveTransform=new sr}clone(){const e=new Ai;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:i.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return u.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,l){const c=this._mercatorTransform.getPitchedTextCorrection(e,i,l),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,l);return u.bj(c,m,this._globeness)}projectTileCoordinates(e,i,l,c){return this.currentTransform.projectTileCoordinates(e,i,l,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,l,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,l,c)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=i.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Vn{get useGlobeControls(){return!0}handlePanInertia(e,i){const l=Un(e,i);return Math.abs(l.lng-i.center.lng)>180&&(l.lng=i.center.lng+179.5*Math.sign(l.lng-i.center.lng)),{easingCenter:l,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const l=e.around,c=i.screenPointToLocation(l);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const m=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const y=i.zoom-m;if(y===0)return;const b=u.bz(i.center.lng,c.lng),T=b/(Math.abs(b/180)+1),E=u.bz(i.center.lat,c.lat),C=i.getRayDirectionFromPixel(l),z=i.cameraPosition,R=-1*u.aW(z,C),U=u.bo();u.aR(U,z,[C[0]*R,C[1]*R,C[2]*R]);const Z=u.aY(U)-1,te=Math.exp(.5*-Math.max(Z-.3,0)),ee=vr(i.worldSize,i.center.lat)/Math.min(i.width,i.height),ie=u.bm(ee,.9,.5,1,.25),se=(1-u.ae(-y))*Math.min(te,ie),fe=i.center.lat,oe=i.zoom,ge=new u.S(i.center.lng+T*se,u.ag(i.center.lat+E*se,-85.051129,u.ah));i.setLocationAtPoint(c,l);const ye=i.center,ue=u.bm(Math.abs(b),45,85,0,1),Se=u.bm(ee,.75,.35,0,1),Fe=Math.pow(Math.max(ue,Se),.25),Re=u.bz(ye.lng,ge.lng),De=u.bz(ye.lat,ge.lat);i.setCenter(new u.S(ye.lng+Re*Fe,ye.lat+De*Fe).wrap()),i.setZoom(oe+Qi(fe,i.center.lat))}handleMapControlsPan(e,i,l){if(!e.panDelta)return;const c=i.center.lat,m=i.zoom;i.setCenter(Un(e.panDelta,i).wrap()),i.setZoom(m+Qi(c,i.center.lat))}cameraForBoxAndBearing(e,i,l,c,m){const y=Mi(e,i,l,c,m),b=i.left/m.width*2-1,T=(m.width-i.right)/m.width*2-1,E=i.top/m.height*-2+1,C=(m.height-i.bottom)/m.height*-2+1,z=u.bz(l.getWest(),l.getEast())<0,R=z?l.getEast():l.getWest(),U=z?l.getWest():l.getEast(),Z=Math.max(l.getNorth(),l.getSouth()),te=Math.min(l.getNorth(),l.getSouth()),ee=R+.5*u.bz(R,U),ie=Z+.5*u.bz(Z,te),se=m.clone();se.setCenter(y.center),se.setBearing(y.bearing),se.setPitch(0),se.setRoll(0),se.setZoom(y.zoom);const fe=se.modelViewProjectionMatrix,oe=[cn(l.getNorthWest()),cn(l.getNorthEast()),cn(l.getSouthWest()),cn(l.getSouthEast()),cn(new u.S(U,ie)),cn(new u.S(R,ie)),cn(new u.S(ee,Z)),cn(new u.S(ee,te))],ge=cn(y.center);let ye=Number.POSITIVE_INFINITY;for(const ue of oe)b<0&&(ye=Vn.getLesserNonNegativeNonNull(ye,Vn.solveVectorScale(ue,ge,fe,"x",b))),T>0&&(ye=Vn.getLesserNonNegativeNonNull(ye,Vn.solveVectorScale(ue,ge,fe,"x",T))),E>0&&(ye=Vn.getLesserNonNegativeNonNull(ye,Vn.solveVectorScale(ue,ge,fe,"y",E))),C<0&&(ye=Vn.getLesserNonNegativeNonNull(ye,Vn.solveVectorScale(ue,ge,fe,"y",C)));if(Number.isFinite(ye)&&ye!==0)return y.zoom=se.zoom+u.aj(ye),y;rn()}handleJumpToCenterZoom(e,i){const l=e.center.lat,c=e.getConstrained(i.center?u.S.convert(i.center):e.center,e.zoom).center;e.setCenter(c.wrap());const m=i.zoom!==void 0?+i.zoom:e.zoom+Qi(l,c.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,i){const l=e.zoom,c=e.center,m=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},T=i.zoom!==void 0,E=!e.isPaddingEqual(i.padding);let C=!1;const z=i.center?u.S.convert(i.center):c,R=e.getConstrained(z,l).center;_r(e,R);const U=e.clone();U.setCenter(R),U.setZoom(T?+i.zoom:l+Qi(c.lat,z.lat)),U.setBearing(i.bearing);const Z=new u.P(u.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),u.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));U.setLocationAtPoint(R,Z);const te=(i.offset&&i.offsetAsPoint.mag())>0?U.center:R,ee=T?+i.zoom:l+Qi(c.lat,te.lat),ie=l+Qi(c.lat,0),se=ee+Qi(te.lat,0),fe=u.bz(c.lng,te.lng),oe=u.bz(c.lat,te.lat),ge=u.ae(se-ie);return C=ee!==l,{easeFunc:ye=>{if(u.bd(y,b)||un({startEulerAngles:y,endEulerAngles:b,tr:e,k:ye,useSlerp:y.roll!=b.roll}),E&&e.interpolatePadding(m,i.padding,ye),i.around)u.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const ue=se>ie?Math.min(2,ge):Math.max(.5,ge),Se=Math.pow(ue,1-ye),Fe=Us(c,fe,oe,ye*Se);e.setCenter(Fe.wrap())}if(C){const ue=u.C.number(ie,se,ye)+Qi(0,e.center.lat);e.setZoom(ue)}},isZooming:C,elevationCenter:te}}handleFlyTo(e,i){const l=i.zoom!==void 0,c=e.center,m=e.zoom,y=e.padding,b=!e.isPaddingEqual(i.padding),T=e.getConstrained(u.S.convert(i.center||i.locationAtOffset),m).center,E=l?+i.zoom:e.zoom+Qi(e.center.lat,T.lat),C=e.clone();C.setCenter(T),C.setZoom(E),C.setBearing(i.bearing);const z=new u.P(u.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),u.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));C.setLocationAtPoint(T,z);const R=C.center;_r(e,R);const U=function(oe,ge,ye){const ue=cn(ge),Se=cn(ye),Fe=u.aW(ue,Se),Re=Math.acos(Fe),De=xn(oe);return Re/(2*Math.PI)*De}(e,c,R),Z=m+Qi(c.lat,0),te=E+Qi(R.lat,0),ee=u.ae(te-Z);let ie;if(typeof i.minZoom=="number"){const oe=+i.minZoom+Qi(R.lat,0),ge=Math.min(oe,Z,te)+Qi(0,R.lat),ye=e.getConstrained(R,ge).zoom+Qi(R.lat,0);ie=u.ae(ye-Z)}const se=u.bz(c.lng,R.lng),fe=u.bz(c.lat,R.lat);return{easeFunc:(oe,ge,ye,ue)=>{const Se=Us(c,se,fe,ye);b&&e.interpolatePadding(y,i.padding,oe);const Fe=oe===1?R:Se;e.setCenter(Fe.wrap());const Re=Z+u.aj(ge);e.setZoom(oe===1?E:Re+Qi(0,Fe.lat))},scaleOfZoom:ee,targetCenter:R,scaleOfMinZoom:ie,pixelPathLength:U}}static solveVectorScale(e,i,l,c,m){const y=c==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],E=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],C=i[0]*y[0]+i[1]*y[1]+i[2]*y[2],z=i[0]*b[0]+i[1]*b[1]+i[2]*b[2];return C+m*E===T+m*z||b[3]*(T-C)+y[3]*(z-E)+T*z==C*E?null:(C+y[3]-m*z-m*b[3])/(C-T-m*z+m*E)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class Ta{constructor(e){this._globe=e,this._mercatorCameraHelper=new pi,this._verticalPerspectiveCameraHelper=new Vn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,l){this.currentHelper.handleMapControlsPan(e,i,l)}cameraForBoxAndBearing(e,i,l,c,m){return this.currentHelper.cameraForBoxAndBearing(e,i,l,c,m)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const ua=(p,e)=>u.y(p,e&&e.filter(i=>i.identifier!=="source.canvas")),ns=u.bD();class Ia extends u.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const c=this.sourceCaches[l].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new hr(Bi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,c)=>this.getGlyphs(l,c)),this.dispatcher.registerMessageHandler("GI",(l,c)=>this.getImages(l,c)),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new li(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new gi(256,512),this.crossTileSymbolIndex=new sa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",u.bF()),Mn().on(Vt,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const c=this.sourceCaches[l.sourceId];if(!c)return;const m=c.getSource();if(m&&m.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===m.id&&this._validateLayer(b)}})}setGlobalStateProperty(e,i){var l,c,m;this._checkLoaded();const y=i===null?(m=(c=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||c===void 0?void 0:c.default)!==null&&m!==void 0?m:null:i;if(u.bG(y,this._globalState[e]))return this;this._globalState[e]=y;const b=this._findGlobalStateAffectedSources([e]);for(const T in this.sourceCaches)b.has(T)&&(this._reloadSource(T),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const i=[];for(const c in e)!u.bG(this._globalState[c],e[c].default)&&(i.push(c),this._globalState[c]=e[c].default);const l=this._findGlobalStateAffectedSources(i);for(const c in this.sourceCaches)l.has(c)&&(this._reloadSource(c),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const i=new Set;for(const l in this._layers){const c=this._layers[l],m=c.getLayoutAffectingGlobalStateRefs();for(const y of e)m.has(y)&&i.add(c.source)}return i}loadURL(e,i={},l){this.fire(new u.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;u.j(c,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,i,l)}).catch(y=>{this._loadStyleRequest=null,y&&!m.signal.aborted&&this.fire(new u.k(y))})}loadJSON(e,i={},l){this.fire(new u.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,l)}).catch(()=>{})}loadEmpty(){this.fire(new u.l("dataloading",{dataType:"style"})),this._load(ns,{validate:!1})}_load(e,i,l){var c,m,y;const b=i.transformStyle?i.transformStyle(l,e):e;if(!i.validate||!ua(this,u.z(b))){this._loaded=!0,this.stylesheet=b;for(const T in b.sources)this.addSource(T,b.sources[T],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new Ht(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new Li(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.setGlobalState((y=this.stylesheet.state)!==null&&y!==void 0?y:null),this.fire(new u.l("data",{dataType:"style"})),this.fire(new u.l("style.load"))}}_createLayers(){const e=u.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const l=u.bI(i);l.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=l}}_loadSprite(e,i=!1,l=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,y,b,T){return u._(this,void 0,void 0,function*(){const E=lt(m),C=b>1?"@2x":"",z={},R={};for(const{id:U,url:Z}of E){const te=y.transformRequest(wt(Z,C,".json"),"SpriteJSON");z[U]=u.j(te,T);const ee=y.transformRequest(wt(Z,C,".png"),"SpriteImage");R[U]=ft.getImage(ee,T)}return yield Promise.all([...Object.values(z),...Object.values(R)]),function(U,Z){return u._(this,void 0,void 0,function*(){const te={};for(const ee in U){te[ee]={};const ie=we.getImageCanvasContext((yield Z[ee]).data),se=(yield U[ee]).data;for(const fe in se){const{width:oe,height:ge,x:ye,y:ue,sdf:Se,pixelRatio:Fe,stretchX:Re,stretchY:De,content:Be,textFitWidth:at,textFitHeight:it}=se[fe];te[ee][fe]={data:null,pixelRatio:Fe,sdf:Se,stretchX:Re,stretchY:De,content:Be,textFitWidth:at,textFitHeight:it,spriteData:{width:oe,height:ge,x:ye,y:ue,context:ie}}}}return te})}(z,R)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const y in m){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(T=>!(T in m)):[];for(const T of b)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in m[y]){const E=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,m[y][T],!1):this.imageManager.addImage(E,m[y][T]),i&&(this._changedImages[E]=!0)}}}).catch(m=>{this._spriteRequest=null,c=m,this.fire(new u.k(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"})),l&&l(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const l=e.sourceLayer;if(!l)return;const c=i.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(l)===-1)&&this.fire(new u.k(new Error(`Source layer "${l}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?u.bJ(l):l);const c=[];for(const m of e)if(l[m]){const y=i?u.bJ(l[m]):l[m];c.push(y)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const l of i){const c=this._layers[l];c.type!=="custom"&&(e[l]=c.serialize())}return e}hasTransitions(){var e,i,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const c=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(c.length||m.length)&&this._updateWorkerLayers(c,m);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const c in this.sourceCaches){const m=this.sourceCaches[c];l[c]=m.used,m.used=!1}for(const c of this._order){const m=this._layers[c];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const c in l){const m=this.sourceCaches[c];!!l[c]!=!!m.used&&m.fire(new u.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new u.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var l;this._checkLoaded();const c=this.serialize();if(e=i.transformStyle?i.transformStyle(c,e):e,((l=i.validate)===null||l===void 0||l)&&ua(this,u.z(e)))return!1;(e=u.bJ(e)).layers=u.bH(e.layers);const m=u.bK(c,e),y=this._getOperationsToPerform(m);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],l=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":i.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":i.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setSky":i.push(()=>this.setSky.apply(this,c.args));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":i.push(()=>this.setGlobalState.apply(this,c.args));break;case"setTransition":i.push(()=>{});break;default:l.push(c.command)}return{operations:i,unimplemented:l}}addImage(e,i){if(this.getImage(e))return this.fire(new u.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(u.z.source,`sources.${e}`,i,null,l))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const c=this.sourceCaches[e]=new Ze(e,i,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new u.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new u.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,l={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new u.k(new Error(`Layer "${c}" already exists on this map.`)));let m;if(e.type==="custom"){if(ua(this,u.bL(e)))return;m=u.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=u.bJ(e),e=u.e(e,{source:c})),this._validate(u.z.layer,`layers.${c}`,e,{arrayIndex:-1},l))return;m=u.bI(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:c}})}const y=i?this._order.indexOf(i):this._order.length;if(i&&y===-1)this.fire(new u.k(new Error(`Cannot add layer "${c}" before non-existing layer "${i}".`)));else{if(this._order.splice(y,0,c),this._layerOrderChanged=!0,this._layers[c]=m,this._removedLayers[c]&&m.source&&m.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const l=this._order.indexOf(e);this._order.splice(l,1);const c=i?this._order.indexOf(i):this._order.length;i&&c===-1?this.fire(new u.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new u.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,l){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===i&&c.maxzoom===l||(i!=null&&(c.minzoom=i),l!=null&&(c.maxzoom=l),this._updateLayer(c)):this.fire(new u.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,l={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!u.bG(c.filter,i))return i==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(u.z.filter,`layers.${c.id}.filter`,i,null,l)||(c.setFilter(u.bJ(i)),this._updateLayer(c)))}else this.fire(new u.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.bJ(this.getLayer(e).filter)}setLayoutProperty(e,i,l,c={}){this._checkLoaded();const m=this.getLayer(e);m?u.bG(m.getLayoutProperty(i),l)||(m.setLayoutProperty(i,l,c),this._updateLayer(m)):this.fire(new u.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const l=this.getLayer(e);if(l)return l.getLayoutProperty(i);this.fire(new u.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,l,c={}){this._checkLoaded();const m=this.getLayer(e);m?u.bG(m.getPaintProperty(i),l)||(m.setPaintProperty(i,l,c)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new u.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const l=e.source,c=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new u.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&c?this.fire(new u.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||c?(e.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(c,e.id,i)):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const l=e.source,c=this.sourceCaches[l];if(c===void 0)return void this.fire(new u.k(new Error(`The source '${l}' does not exist in the map's style.`)));const m=c.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(y,e.id,i):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,l=e.sourceLayer,c=this.sourceCaches[i];if(c!==void 0)return c.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(l,e.id)):void this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.bM(this.sourceCaches,m=>m.serialize()),i=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,c=this.stylesheet;return u.bN({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:i,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=y=>this._layers[y].type==="fill-extrusion",l={},c=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(i(b)){l[b]=y;for(const T of e){const E=T[b];if(E)for(const C of E)c.push(C)}}}c.sort((y,b)=>b.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(i(b))for(let T=c.length-1;T>=0;T--){const E=c[T].feature;if(l[E.layer.id]<y)break;m.push(E),c.pop()}else for(const T of e){const E=T[b];if(E)for(const C of E)m.push(C.feature)}}return m}queryRenderedFeatures(e,i,l){i&&i.filter&&this._validate(u.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);const c={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new u.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of i.layers){const C=this._layers[E];if(!C)return this.fire(new u.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];c[C.source]=!0}}const m=[];i.availableImages=this._availableImages;const y=this._serializedAllLayers(),b=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,T=Object.assign(Object.assign({},i),{layers:b});for(const E in this.sourceCaches)i.layers&&!c[E]||m.push(ji(this.sourceCaches[E],this._layers,y,e,T,l,this.map.terrain?(C,z,R)=>this.map.terrain.getElevation(C,z,R):void 0));return this.placement&&m.push(function(E,C,z,R,U,Z,te){const ee={},ie=Z.queryRenderedSymbols(R),se=[];for(const fe of Object.keys(ie).map(Number))se.push(te[fe]);se.sort(vi);for(const fe of se){const oe=fe.featureIndex.lookupSymbolFeatures(ie[fe.bucketInstanceId],C,fe.bucketIndex,fe.sourceLayerIndex,U.filter,U.layers,U.availableImages,E);for(const ge in oe){const ye=ee[ge]=ee[ge]||[],ue=oe[ge];ue.sort((Se,Fe)=>{const Re=fe.featureSortOrder;if(Re){const De=Re.indexOf(Se.featureIndex);return Re.indexOf(Fe.featureIndex)-De}return Fe.featureIndex-Se.featureIndex});for(const Se of ue)ye.push(Se)}}return function(fe,oe,ge){for(const ye in fe)for(const ue of fe[ye])yt(ue,ge[oe[ye].source]);return fe}(ee,E,z)}(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,i){i&&i.filter&&this._validate(u.z.filter,"querySourceFeatures.filter",i.filter,null,i);const l=this.sourceCaches[e];return l?function(c,m){const y=c.getRenderableIds().map(E=>c.getTileByID(E)),b=[],T={};for(let E=0;E<y.length;E++){const C=y[E],z=C.tileID.canonical.key;T[z]||(T[z]=!0,C.querySourceFeatures(b,m))}return b}(l,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const y in e)if(!u.bG(e[y],l[y])){c=!0;break}if(!c)return;const m={now:we.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const l=this.getSky();let c=!1;if(!e&&!l)return;if(e&&!l)c=!0;else if(!e&&l)c=!0;else for(const y in e)if(!u.bG(e[y],l[y])){c=!0;break}if(!c)return;const m={now:we.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(m)}_setProjectionInternal(e){const i=function(l){if(Array.isArray(l)){const c=new oa({type:l});return{projection:c,transform:new Ai,cameraHelper:new Ta(c)}}switch(l){case"mercator":return{projection:new Ur,transform:new Xi,cameraHelper:new pi};case"globe":{const c=new oa({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new Ai,cameraHelper:new Ta(c)}}case"vertical-perspective":return{projection:new kr,transform:new sr,cameraHelper:new Vn};default:return u.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Ur,transform:new Xi,cameraHelper:new pi}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,i,l,c,m={}){return(!m||m.validate!==!1)&&ua(this,e.call(u.z,u.e({key:i,style:this.serialize(),value:l,styleSpec:u.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Mn().off(Vt,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const l=this.sourceCaches[i];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,l,c,m=!1){let y=!1,b=!1;const T={};for(const E of this._order){const C=this._layers[E];if(C.type!=="symbol")continue;if(!T[C.source]){const R=this.sourceCaches[C.source];T[C.source]=R.getRenderableIds(!0).map(U=>R.getTileByID(U)).sort((U,Z)=>Z.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(Z.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(C,T[C.source],e.center.lng);y=y||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(we.now(),e.zoom))&&(this.pauseablePlacement=new Ts(e,this.map.terrain,this._order,m,i,l,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(we.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const E of this._order){const C=this._layers[E];C.type==="symbol"&&this.placement.updateLayerOpacities(C,T[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(we.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return u._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[i.source];return c&&c.setDependencies(i.tileID.key,i.type,i.icons),l})}getGlyphs(e,i){return u._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(i.stacks),c=this.sourceCaches[i.source];return c&&c.setDependencies(i.tileID.key,i.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(u.z.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,l={},c){this._checkLoaded();const m=[{id:e,url:i}],y=[...lt(this.stylesheet.sprite),...m];this._validate(u.z.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,c))}removeSprite(e){this._checkLoaded();const i=lt(this.stylesheet.sprite);if(i.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;i.splice(i.findIndex(l=>l.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}else this.fire(new u.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return lt(this.stylesheet.sprite)}setSprite(e,i={},l){this._checkLoaded(),e&&this._validate(u.z.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var io=u.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $o{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,l,c,m,y,b,T,E){this.context=e;let C=this.boundPaintVertexBuffers.length!==c.length;for(let z=0;!C&&z<c.length;z++)this.boundPaintVertexBuffers[z]!==c[z]&&(C=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==l||C||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(i,l,c,m,y,b,T,E):(e.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,i,l,c,m,y,b,T){const E=e.numAttributes,C=this.context,z=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=c,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=T,i.enableAttributes(z,e);for(const R of l)R.enableAttributes(z,e);y&&y.enableAttributes(z,e),b&&b.enableAttributes(z,e),T&&T.enableAttributes(z,e),i.bind(),i.setVertexAttribPointers(z,e,m);for(const R of l)R.bind(),R.setVertexAttribPointers(z,e,m);y&&(y.bind(),y.setVertexAttribPointers(z,e,m)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,e,m)),T&&(T.bind(),T.setVertexAttribPointers(z,e,m)),C.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const br=(p,e,i,l,c)=>({u_texture:0,u_ele_delta:p,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):u.be.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:i?i.calculateFogBlendOpacity(l):0,u_horizon_color:i?i.properties.get("horizon-color"):u.be.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),Zo={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function wn(p){const e=[];for(let i=0;i<p.length;i++){if(p[i]===null)continue;const l=p[i].split(" ");e.push(l.pop())}return e}class rs{constructor(e,i,l,c,m,y,b,T,E=[]){const C=e.gl;this.program=C.createProgram();const z=wn(i.staticAttributes),R=l?l.getBinderAttributes():[],U=z.concat(R),Z=gr.prelude.staticUniforms?wn(gr.prelude.staticUniforms):[],te=b.staticUniforms?wn(b.staticUniforms):[],ee=i.staticUniforms?wn(i.staticUniforms):[],ie=l?l.getBinderUniforms():[],se=Z.concat(te).concat(ee).concat(ie),fe=[];for(const Re of se)fe.indexOf(Re)<0&&fe.push(Re);const oe=l?l.defines():[];dn(C)&&oe.unshift("#version 300 es"),m&&oe.push("#define OVERDRAW_INSPECTOR;"),y&&oe.push("#define TERRAIN3D;"),T&&oe.push(T),E&&oe.push(...E);let ge=oe.concat(gr.prelude.fragmentSource,b.fragmentSource,i.fragmentSource).join(`
`),ye=oe.concat(gr.prelude.vertexSource,b.vertexSource,i.vertexSource).join(`
`);dn(C)||(ge=function(Re){return Re.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ge),ye=function(Re){return Re.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ye));const ue=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ue,ge),C.compileShader(ue),!C.getShaderParameter(ue,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ue)}`);C.attachShader(this.program,ue);const Se=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Se,ye),C.compileShader(Se),!C.getShaderParameter(Se,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(Se)}`);C.attachShader(this.program,Se),this.attributes={};const Fe={};this.numAttributes=U.length;for(let Re=0;Re<this.numAttributes;Re++)U[Re]&&(C.bindAttribLocation(this.program,Re,U[Re]),this.attributes[U[Re]]=Re);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(Se),C.deleteShader(ue);for(let Re=0;Re<fe.length;Re++){const De=fe[Re];if(De&&!Fe[De]){const Be=C.getUniformLocation(this.program,De);Be&&(Fe[De]=Be)}}this.fixedUniforms=c(e,Fe),this.terrainUniforms=((Re,De)=>({u_depth:new u.bO(Re,De.u_depth),u_terrain:new u.bO(Re,De.u_terrain),u_terrain_dim:new u.bf(Re,De.u_terrain_dim),u_terrain_matrix:new u.bQ(Re,De.u_terrain_matrix),u_terrain_unpack:new u.bR(Re,De.u_terrain_unpack),u_terrain_exaggeration:new u.bf(Re,De.u_terrain_exaggeration)}))(e,Fe),this.projectionUniforms=((Re,De)=>({u_projection_matrix:new u.bQ(Re,De.u_projection_matrix),u_projection_tile_mercator_coords:new u.bR(Re,De.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.bR(Re,De.u_projection_clipping_plane),u_projection_transition:new u.bf(Re,De.u_projection_transition),u_projection_fallback_matrix:new u.bQ(Re,De.u_projection_fallback_matrix)}))(e,Fe),this.binderUniforms=l?l.getUniforms(e,Fe):[]}draw(e,i,l,c,m,y,b,T,E,C,z,R,U,Z,te,ee,ie,se,fe){const oe=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(c),e.setColorMode(m),e.setCullFace(y),T){e.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,T.depthTexture),e.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,T.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(T[ye])}if(E)for(const ye in E)this.projectionUniforms[Zo[ye]].set(E[ye]);if(b)for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(b[ye]);ee&&ee.setUniforms(e,this.binderUniforms,Z,{zoom:te});let ge=0;switch(i){case oe.LINES:ge=2;break;case oe.TRIANGLES:ge=3;break;case oe.LINE_STRIP:ge=1}for(const ye of U.get()){const ue=ye.vaos||(ye.vaos={});(ue[C]||(ue[C]=new $o)).bind(e,this,z,ee?ee.getPaintVertexBuffers():[],R,ye.vertexOffset,ie,se,fe),oe.drawElements(i,ye.primitiveLength*ge,oe.UNSIGNED_SHORT,ye.primitiveOffset*ge*2)}}}function Sa(p,e,i){const l=1/u.aB(i,1,e.transform.tileZoom),c=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,e.transform.tileZoom)/c,y=m*(i.tileID.canonical.x+i.tileID.wrap*c),b=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const Vs=(p,e,i,l)=>{const c=p.style.light,m=c.properties.get("position"),y=[m.x,m.y,m.z],b=u.bU();c.properties.get("anchor")==="viewport"&&u.bV(b,p.transform.bearingInRadians),u.bW(y,y,b);const T=p.transform.transformLightDirection(y),E=c.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:l}},Ea=(p,e,i,l,c,m,y)=>u.e(Vs(p,e,i,l),Sa(m,p,y),{u_height_factor:-Math.pow(2,c.overscaledZ)/y.tileSize/8}),ca=(p,e,i,l)=>u.e(Sa(e,p,i),{u_fill_translate:l}),ar=(p,e)=>({u_world:p,u_fill_translate:e}),Vl=(p,e,i,l,c)=>u.e(ca(p,e,i,c),{u_world:l}),no=(p,e,i,l,c)=>{const m=p.transform;let y,b,T=0;if(i.paint.get("circle-pitch-alignment")==="map"){const E=u.aB(e,1,m.zoom);y=!0,b=[E,E],T=E/(u.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else y=!1,b=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:T,u_translate:l}},ha=p=>({u_pixel_extrude_scale:[1/p.width,1/p.height]}),da=p=>({u_viewport_size:[p.width,p.height]}),Xo=(p,e=1)=>({u_color:p,u_overlay:0,u_overlay_scale:e}),fa=(p,e,i,l)=>{const c=u.aB(p,1,e)/(u.$*Math.pow(2,p.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:u.aB(p,1,e),u_intensity:i,u_globe_extrude_scale:c}},Yo=(p,e,i,l)=>{const c=u.L();u.bX(c,0,p.width,p.height,0,0,1);const m=p.context.gl;return{u_matrix:c,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:i,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Gs=(p,e,i)=>{const l=i.paint.get("hillshade-accent-color");let c;switch(i.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}const m=i.getIlluminationProperties();for(let y=0;y<m.directionRadians.length;y++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[y]+=p.transform.bearingInRadians);return{u_image:0,u_latrange:Wo(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:l,u_method:c,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},Ho=(p,e)=>{const i=e.stride,l=u.L();return u.bX(l,0,u.$,-8192,0,0,1),u.M(l,l,[0,-8192,0]),{u_matrix:l,u_image:1,u_dimension:[i,i],u_zoom:p.overscaledZ,u_unpack:e.getUnpackVector()}};function Wo(p,e){const i=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new u.a0(0,l/i).toLngLat().lat,new u.a0(0,(l+1)/i).toLngLat().lat]}const Ko=(p,e)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_opacity:p.paint.get("color-relief-opacity")}),ka=(p,e,i,l)=>{const c=p.transform;return{u_translation:ao(p,e,i),u_ratio:l/u.aB(e,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ro=(p,e,i,l,c)=>u.e(ka(p,e,i,l),{u_image:0,u_image_height:c}),Jo=(p,e,i,l,c)=>{const m=p.transform,y=so(e,m);return{u_translation:ao(p,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:l/u.aB(e,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[y,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Qo=(p,e,i,l,c,m)=>{const y=p.lineAtlas,b=so(e,p.transform),T=i.layout.get("line-cap")==="round",E=y.getDash(c.from,T),C=y.getDash(c.to,T),z=E.width*m.fromScale,R=C.width*m.toScale;return u.e(ka(p,e,i,l),{u_patternscale_a:[b/z,-E.height/2],u_patternscale_b:[b/R,-C.height/2],u_sdfgamma:y.width/(256*Math.min(z,R)*p.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:C.y,u_mix:m.t})};function so(p,e){return 1/u.aB(p,1,e.tileZoom)}function ao(p,e,i){return u.aC(p.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const ks=(p,e,i,l,c)=>{return{u_tl_parent:p,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=l.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:oo(l.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var m,y};function oo(p){p*=Math.PI/180;const e=Math.sin(p),i=Math.cos(p);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Ca=(p,e,i,l,c,m,y,b,T,E,C,z,R)=>{const U=y.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:U.width/U.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+C,u_pitch_with_map:+l,u_is_along_line:c,u_is_variable_anchor:m,u_texsize:z,u_texture:0,u_translation:E,u_pitched_scale:R}},Cs=(p,e,i,l,c,m,y,b,T,E,C,z,R,U)=>{const Z=y.transform;return u.e(Ca(p,e,i,l,c,m,y,b,T,E,C,z,U),{u_gamma_scale:l?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Gl=(p,e,i,l,c,m,y,b,T,E,C,z,R)=>u.e(Cs(p,e,i,l,c,m,y,b,T,E,!0,C,0,R),{u_texsize_icon:z,u_texture_icon:1}),pa=(p,e)=>({u_opacity:p,u_color:e}),lo=(p,e,i,l,c)=>u.e(function(m,y,b,T){const E=b.imageManager.getPattern(m.from.toString()),C=b.imageManager.getPattern(m.to.toString()),{width:z,height:R}=b.imageManager.getPixelSize(),U=Math.pow(2,T.tileID.overscaledZ),Z=T.tileSize*Math.pow(2,b.transform.tileZoom)/U,te=Z*(T.tileID.canonical.x+T.tileID.wrap*U),ee=Z*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:C.tl,u_pattern_br_b:C.br,u_texsize:[z,R],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:C.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/u.aB(T,1,b.transform.tileZoom),u_pixel_coord_upper:[te>>16,ee>>16],u_pixel_coord_lower:[65535&te,65535&ee]}}(i,c,e,l),{u_opacity:p}),el=(p,e)=>{},uo={fillExtrusion:(p,e)=>({u_lightpos:new u.bS(p,e.u_lightpos),u_lightpos_globe:new u.bS(p,e.u_lightpos_globe),u_lightintensity:new u.bf(p,e.u_lightintensity),u_lightcolor:new u.bS(p,e.u_lightcolor),u_vertical_gradient:new u.bf(p,e.u_vertical_gradient),u_opacity:new u.bf(p,e.u_opacity),u_fill_translate:new u.bT(p,e.u_fill_translate)}),fillExtrusionPattern:(p,e)=>({u_lightpos:new u.bS(p,e.u_lightpos),u_lightpos_globe:new u.bS(p,e.u_lightpos_globe),u_lightintensity:new u.bf(p,e.u_lightintensity),u_lightcolor:new u.bS(p,e.u_lightcolor),u_vertical_gradient:new u.bf(p,e.u_vertical_gradient),u_height_factor:new u.bf(p,e.u_height_factor),u_opacity:new u.bf(p,e.u_opacity),u_fill_translate:new u.bT(p,e.u_fill_translate),u_image:new u.bO(p,e.u_image),u_texsize:new u.bT(p,e.u_texsize),u_pixel_coord_upper:new u.bT(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(p,e.u_pixel_coord_lower),u_scale:new u.bS(p,e.u_scale),u_fade:new u.bf(p,e.u_fade)}),fill:(p,e)=>({u_fill_translate:new u.bT(p,e.u_fill_translate)}),fillPattern:(p,e)=>({u_image:new u.bO(p,e.u_image),u_texsize:new u.bT(p,e.u_texsize),u_pixel_coord_upper:new u.bT(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(p,e.u_pixel_coord_lower),u_scale:new u.bS(p,e.u_scale),u_fade:new u.bf(p,e.u_fade),u_fill_translate:new u.bT(p,e.u_fill_translate)}),fillOutline:(p,e)=>({u_world:new u.bT(p,e.u_world),u_fill_translate:new u.bT(p,e.u_fill_translate)}),fillOutlinePattern:(p,e)=>({u_world:new u.bT(p,e.u_world),u_image:new u.bO(p,e.u_image),u_texsize:new u.bT(p,e.u_texsize),u_pixel_coord_upper:new u.bT(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(p,e.u_pixel_coord_lower),u_scale:new u.bS(p,e.u_scale),u_fade:new u.bf(p,e.u_fade),u_fill_translate:new u.bT(p,e.u_fill_translate)}),circle:(p,e)=>({u_camera_to_center_distance:new u.bf(p,e.u_camera_to_center_distance),u_scale_with_map:new u.bO(p,e.u_scale_with_map),u_pitch_with_map:new u.bO(p,e.u_pitch_with_map),u_extrude_scale:new u.bT(p,e.u_extrude_scale),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_globe_extrude_scale:new u.bf(p,e.u_globe_extrude_scale),u_translate:new u.bT(p,e.u_translate)}),collisionBox:(p,e)=>({u_pixel_extrude_scale:new u.bT(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_viewport_size:new u.bT(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new u.bP(p,e.u_color),u_overlay:new u.bO(p,e.u_overlay),u_overlay_scale:new u.bf(p,e.u_overlay_scale)}),depth:el,clippingMask:el,heatmap:(p,e)=>({u_extrude_scale:new u.bf(p,e.u_extrude_scale),u_intensity:new u.bf(p,e.u_intensity),u_globe_extrude_scale:new u.bf(p,e.u_globe_extrude_scale)}),heatmapTexture:(p,e)=>({u_matrix:new u.bQ(p,e.u_matrix),u_world:new u.bT(p,e.u_world),u_image:new u.bO(p,e.u_image),u_color_ramp:new u.bO(p,e.u_color_ramp),u_opacity:new u.bf(p,e.u_opacity)}),hillshade:(p,e)=>({u_image:new u.bO(p,e.u_image),u_latrange:new u.bT(p,e.u_latrange),u_exaggeration:new u.bf(p,e.u_exaggeration),u_altitudes:new u.bZ(p,e.u_altitudes),u_azimuths:new u.bZ(p,e.u_azimuths),u_accent:new u.bP(p,e.u_accent),u_method:new u.bO(p,e.u_method),u_shadows:new u.bY(p,e.u_shadows),u_highlights:new u.bY(p,e.u_highlights)}),hillshadePrepare:(p,e)=>({u_matrix:new u.bQ(p,e.u_matrix),u_image:new u.bO(p,e.u_image),u_dimension:new u.bT(p,e.u_dimension),u_zoom:new u.bf(p,e.u_zoom),u_unpack:new u.bR(p,e.u_unpack)}),colorRelief:(p,e)=>({u_image:new u.bO(p,e.u_image),u_unpack:new u.bR(p,e.u_unpack),u_dimension:new u.bT(p,e.u_dimension),u_elevation_stops:new u.bO(p,e.u_elevation_stops),u_color_stops:new u.bO(p,e.u_color_stops),u_opacity:new u.bf(p,e.u_opacity)}),line:(p,e)=>({u_translation:new u.bT(p,e.u_translation),u_ratio:new u.bf(p,e.u_ratio),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bT(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_translation:new u.bT(p,e.u_translation),u_ratio:new u.bf(p,e.u_ratio),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bT(p,e.u_units_to_pixels),u_image:new u.bO(p,e.u_image),u_image_height:new u.bf(p,e.u_image_height)}),linePattern:(p,e)=>({u_translation:new u.bT(p,e.u_translation),u_texsize:new u.bT(p,e.u_texsize),u_ratio:new u.bf(p,e.u_ratio),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_image:new u.bO(p,e.u_image),u_units_to_pixels:new u.bT(p,e.u_units_to_pixels),u_scale:new u.bS(p,e.u_scale),u_fade:new u.bf(p,e.u_fade)}),lineSDF:(p,e)=>({u_translation:new u.bT(p,e.u_translation),u_ratio:new u.bf(p,e.u_ratio),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bT(p,e.u_units_to_pixels),u_patternscale_a:new u.bT(p,e.u_patternscale_a),u_patternscale_b:new u.bT(p,e.u_patternscale_b),u_sdfgamma:new u.bf(p,e.u_sdfgamma),u_image:new u.bO(p,e.u_image),u_tex_y_a:new u.bf(p,e.u_tex_y_a),u_tex_y_b:new u.bf(p,e.u_tex_y_b),u_mix:new u.bf(p,e.u_mix)}),raster:(p,e)=>({u_tl_parent:new u.bT(p,e.u_tl_parent),u_scale_parent:new u.bf(p,e.u_scale_parent),u_buffer_scale:new u.bf(p,e.u_buffer_scale),u_fade_t:new u.bf(p,e.u_fade_t),u_opacity:new u.bf(p,e.u_opacity),u_image0:new u.bO(p,e.u_image0),u_image1:new u.bO(p,e.u_image1),u_brightness_low:new u.bf(p,e.u_brightness_low),u_brightness_high:new u.bf(p,e.u_brightness_high),u_saturation_factor:new u.bf(p,e.u_saturation_factor),u_contrast_factor:new u.bf(p,e.u_contrast_factor),u_spin_weights:new u.bS(p,e.u_spin_weights),u_coords_top:new u.bR(p,e.u_coords_top),u_coords_bottom:new u.bR(p,e.u_coords_bottom)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new u.bO(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bO(p,e.u_is_size_feature_constant),u_size_t:new u.bf(p,e.u_size_t),u_size:new u.bf(p,e.u_size),u_camera_to_center_distance:new u.bf(p,e.u_camera_to_center_distance),u_pitch:new u.bf(p,e.u_pitch),u_rotate_symbol:new u.bO(p,e.u_rotate_symbol),u_aspect_ratio:new u.bf(p,e.u_aspect_ratio),u_fade_change:new u.bf(p,e.u_fade_change),u_label_plane_matrix:new u.bQ(p,e.u_label_plane_matrix),u_coord_matrix:new u.bQ(p,e.u_coord_matrix),u_is_text:new u.bO(p,e.u_is_text),u_pitch_with_map:new u.bO(p,e.u_pitch_with_map),u_is_along_line:new u.bO(p,e.u_is_along_line),u_is_variable_anchor:new u.bO(p,e.u_is_variable_anchor),u_texsize:new u.bT(p,e.u_texsize),u_texture:new u.bO(p,e.u_texture),u_translation:new u.bT(p,e.u_translation),u_pitched_scale:new u.bf(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new u.bO(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bO(p,e.u_is_size_feature_constant),u_size_t:new u.bf(p,e.u_size_t),u_size:new u.bf(p,e.u_size),u_camera_to_center_distance:new u.bf(p,e.u_camera_to_center_distance),u_pitch:new u.bf(p,e.u_pitch),u_rotate_symbol:new u.bO(p,e.u_rotate_symbol),u_aspect_ratio:new u.bf(p,e.u_aspect_ratio),u_fade_change:new u.bf(p,e.u_fade_change),u_label_plane_matrix:new u.bQ(p,e.u_label_plane_matrix),u_coord_matrix:new u.bQ(p,e.u_coord_matrix),u_is_text:new u.bO(p,e.u_is_text),u_pitch_with_map:new u.bO(p,e.u_pitch_with_map),u_is_along_line:new u.bO(p,e.u_is_along_line),u_is_variable_anchor:new u.bO(p,e.u_is_variable_anchor),u_texsize:new u.bT(p,e.u_texsize),u_texture:new u.bO(p,e.u_texture),u_gamma_scale:new u.bf(p,e.u_gamma_scale),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_is_halo:new u.bO(p,e.u_is_halo),u_translation:new u.bT(p,e.u_translation),u_pitched_scale:new u.bf(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new u.bO(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bO(p,e.u_is_size_feature_constant),u_size_t:new u.bf(p,e.u_size_t),u_size:new u.bf(p,e.u_size),u_camera_to_center_distance:new u.bf(p,e.u_camera_to_center_distance),u_pitch:new u.bf(p,e.u_pitch),u_rotate_symbol:new u.bO(p,e.u_rotate_symbol),u_aspect_ratio:new u.bf(p,e.u_aspect_ratio),u_fade_change:new u.bf(p,e.u_fade_change),u_label_plane_matrix:new u.bQ(p,e.u_label_plane_matrix),u_coord_matrix:new u.bQ(p,e.u_coord_matrix),u_is_text:new u.bO(p,e.u_is_text),u_pitch_with_map:new u.bO(p,e.u_pitch_with_map),u_is_along_line:new u.bO(p,e.u_is_along_line),u_is_variable_anchor:new u.bO(p,e.u_is_variable_anchor),u_texsize:new u.bT(p,e.u_texsize),u_texsize_icon:new u.bT(p,e.u_texsize_icon),u_texture:new u.bO(p,e.u_texture),u_texture_icon:new u.bO(p,e.u_texture_icon),u_gamma_scale:new u.bf(p,e.u_gamma_scale),u_device_pixel_ratio:new u.bf(p,e.u_device_pixel_ratio),u_is_halo:new u.bO(p,e.u_is_halo),u_translation:new u.bT(p,e.u_translation),u_pitched_scale:new u.bf(p,e.u_pitched_scale)}),background:(p,e)=>({u_opacity:new u.bf(p,e.u_opacity),u_color:new u.bP(p,e.u_color)}),backgroundPattern:(p,e)=>({u_opacity:new u.bf(p,e.u_opacity),u_image:new u.bO(p,e.u_image),u_pattern_tl_a:new u.bT(p,e.u_pattern_tl_a),u_pattern_br_a:new u.bT(p,e.u_pattern_br_a),u_pattern_tl_b:new u.bT(p,e.u_pattern_tl_b),u_pattern_br_b:new u.bT(p,e.u_pattern_br_b),u_texsize:new u.bT(p,e.u_texsize),u_mix:new u.bf(p,e.u_mix),u_pattern_size_a:new u.bT(p,e.u_pattern_size_a),u_pattern_size_b:new u.bT(p,e.u_pattern_size_b),u_scale_a:new u.bf(p,e.u_scale_a),u_scale_b:new u.bf(p,e.u_scale_b),u_pixel_coord_upper:new u.bT(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.bf(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_texture:new u.bO(p,e.u_texture),u_ele_delta:new u.bf(p,e.u_ele_delta),u_fog_matrix:new u.bQ(p,e.u_fog_matrix),u_fog_color:new u.bP(p,e.u_fog_color),u_fog_ground_blend:new u.bf(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.bf(p,e.u_fog_ground_blend_opacity),u_horizon_color:new u.bP(p,e.u_horizon_color),u_horizon_fog_blend:new u.bf(p,e.u_horizon_fog_blend),u_is_globe_mode:new u.bf(p,e.u_is_globe_mode)}),terrainDepth:(p,e)=>({u_ele_delta:new u.bf(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_texture:new u.bO(p,e.u_texture),u_terrain_coords_id:new u.bf(p,e.u_terrain_coords_id),u_ele_delta:new u.bf(p,e.u_ele_delta)}),projectionErrorMeasurement:(p,e)=>({u_input:new u.bf(p,e.u_input),u_output_expected:new u.bf(p,e.u_output_expected)}),atmosphere:(p,e)=>({u_sun_pos:new u.bS(p,e.u_sun_pos),u_atmosphere_blend:new u.bf(p,e.u_atmosphere_blend),u_globe_position:new u.bS(p,e.u_globe_position),u_globe_radius:new u.bf(p,e.u_globe_radius),u_inv_proj_matrix:new u.bQ(p,e.u_inv_proj_matrix)}),sky:(p,e)=>({u_sky_color:new u.bP(p,e.u_sky_color),u_horizon_color:new u.bP(p,e.u_horizon_color),u_horizon:new u.bT(p,e.u_horizon),u_horizon_normal:new u.bT(p,e.u_horizon_normal),u_sky_horizon_blend:new u.bf(p,e.u_sky_horizon_blend),u_sky_blend:new u.bf(p,e.u_sky_blend)})};class co{constructor(e,i,l){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ho{constructor(e,i,l,c){this.length=i.length,this.attributes=l,this.itemSize=i.bytesPerElement,this.dynamicDraw=c,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let l=0;l<this.attributes.length;l++){const c=i.attributes[this.attributes[l].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,i,l){for(let c=0;c<this.attributes.length;c++){const m=this.attributes[c],y=i.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[tl[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ti{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pa extends ti{getDefault(){return u.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Cr extends ti{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Gn extends ti{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class or extends ti{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class f extends ti{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class s extends ti{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class a extends ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class d extends ti{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class v extends ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class I extends ti{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class P extends ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class O extends ti{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class K extends ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class re extends ti{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ce extends ti{getDefault(){return u.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Oe extends ti{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class We extends ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class ht extends ti{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Et extends ti{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Rt extends ti{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Jt extends ti{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ei extends ti{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class _i extends ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ti extends ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fn extends ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ss extends ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ps extends ti{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class as extends ti{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const l=this.gl;dn(l)?l.bindVertexArray(e):(i=l.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ma extends ti{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ga extends ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class qs extends ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ms extends ti{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class fo extends Ms{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class os extends Ms{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ls extends Ms{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const ql="Framebuffer is not complete";class $l{constructor(e,i,l,c,m){this.context=e,this.width=i,this.height=l;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new fo(e,b),c)this.depthAttachment=m?new ls(e,b):new os(e,b);else if(m)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(ql)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class ii{constructor(e){var i,l;if(this.gl=e,this.clearColor=new Pa(this),this.clearDepth=new Cr(this),this.clearStencil=new Gn(this),this.colorMask=new or(this),this.depthMask=new f(this),this.stencilMask=new s(this),this.stencilFunc=new a(this),this.stencilOp=new d(this),this.stencilTest=new v(this),this.depthRange=new I(this),this.depthTest=new P(this),this.depthFunc=new O(this),this.blend=new K(this),this.blendFunc=new re(this),this.blendColor=new Ce(this),this.blendEquation=new Oe(this),this.cullFace=new We(this),this.cullFaceSide=new ht(this),this.frontFace=new Et(this),this.program=new Rt(this),this.activeTexture=new Jt(this),this.viewport=new ei(this),this.bindFramebuffer=new _i(this),this.bindRenderbuffer=new Ti(this),this.bindTexture=new fn(this),this.bindVertexBuffer=new ss(this),this.bindElementBuffer=new Ps(this),this.bindVertexArray=new as(this),this.pixelStoreUnpack=new ma(this),this.pixelStoreUnpackPremultiplyAlpha=new ga(this),this.pixelStoreUnpackFlipY=new qs(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),dn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new co(this,e,i)}createVertexBuffer(e,i,l){return new ho(this,e,i,l)}createRenderbuffer(e,i,l){const c=this.gl,m=c.createRenderbuffer();return this.bindRenderbuffer.set(m),c.renderbufferStorage(c.RENDERBUFFER,e,i,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,i,l,c){return new $l(this,e,i,l,c)}clear({color:e,depth:i,stencil:l}){const c=this.gl;let m=0;e&&(m|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(m|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),l!==void 0&&(m|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),c.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.bG(e.blendFunction,Yt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return dn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return dn(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let _a;function Fu(p,e,i,l,c){const m=p.context,y=p.transform,b=m.gl,T=p.useProgram("collisionBox"),E=[];let C=0,z=0;for(let ie=0;ie<l.length;ie++){const se=l[ie],fe=e.getTile(se).getBucket(i);if(!fe)continue;const oe=c?fe.textCollisionBox:fe.iconCollisionBox,ge=fe.collisionCircleArray;ge.length>0&&(E.push({circleArray:ge,circleOffset:z,coord:se}),C+=ge.length/4,z=C),oe&&T.draw(m,b.LINES,Zt.disabled,bt.disabled,p.colorModeForRenderPass(),$t.disabled,ha(p.transform),p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),y.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,p.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!c||!E.length)return;const R=p.useProgram("collisionCircle"),U=new u.b_;U.resize(4*C),U._trim();let Z=0;for(const ie of E)for(let se=0;se<ie.circleArray.length/4;se++){const fe=4*se,oe=ie.circleArray[fe+0],ge=ie.circleArray[fe+1],ye=ie.circleArray[fe+2],ue=ie.circleArray[fe+3];U.emplace(Z++,oe,ge,ye,ue,0),U.emplace(Z++,oe,ge,ye,ue,1),U.emplace(Z++,oe,ge,ye,ue,2),U.emplace(Z++,oe,ge,ye,ue,3)}(!_a||_a.length<2*C)&&(_a=function(ie){const se=2*ie,fe=new u.c0;fe.resize(se),fe._trim();for(let oe=0;oe<se;oe++){const ge=6*oe;fe.uint16[ge+0]=4*oe+0,fe.uint16[ge+1]=4*oe+1,fe.uint16[ge+2]=4*oe+2,fe.uint16[ge+3]=4*oe+2,fe.uint16[ge+4]=4*oe+3,fe.uint16[ge+5]=4*oe+0}return fe}(C));const te=m.createIndexBuffer(_a,!0),ee=m.createVertexBuffer(U,u.b$.members,!0);for(const ie of E){const se=da(p.transform);R.draw(m,b.TRIANGLES,Zt.disabled,bt.disabled,p.colorModeForRenderPass(),$t.disabled,se,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ie.coord),null,i.id,ee,te,u.aL.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,p.transform.zoom,null,null,null)}ee.destroy(),te.destroy()}const Bu=u.af(new Float32Array(16));function po(p,e,i,l,c,m){const{horizontalAlign:y,verticalAlign:b}=u.aG(p);return new u.P((-(y-.5)*e/c+l[0])*m,(-(b-.5)*i/c+l[1])*m)}function Fc(p,e,i,l,c,m){const y=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=l.mult(m);i||(b=b.rotate(-c));const T=y.add(b);return hi(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const b=tt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),T=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return p.add(l.rotate(T))}return p.add(l)}function Bc(p,e,i,l,c,m,y,b,T,E,C,z){const R=p.text.placedSymbolArray,U=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,te={};U.clear();for(let ee=0;ee<R.length;ee++){const ie=R.get(ee),se=ie.hidden||!ie.crossTileID||p.allowVerticalPlacement&&!ie.placedOrientation?null:l[ie.crossTileID];if(se){const fe=new u.P(ie.anchorX,ie.anchorY),oe={getElevation:z,width:c.width,height:c.height,pitchedLabelPlaneMatrix:m,pitchWithMap:i,transform:c,tileAnchorPoint:fe,translation:E,unwrappedTileID:C},ge=i?qt(fe.x,fe.y,oe):tt(fe.x,fe.y,oe),ye=Pt(c.cameraToCenterDistance,ge.signedDistanceFromCamera);let ue=u.ao(p.textSizeData,b,ie)*ye/u.aA;i&&(ue*=p.tilePixelRatio/y);const{width:Se,height:Fe,anchor:Re,textOffset:De,textBoxScale:Be}=se,at=po(Re,Se,Fe,De,Be,ue),it=c.getPitchedTextCorrection(fe.x+E[0],fe.y+E[1],C),Ye=Fc(ge.point,oe,e,at,-c.bearingInRadians,it),mt=p.allowVerticalPlacement&&ie.placedOrientation===u.an.vertical?Math.PI/2:0;for(let Wt=0;Wt<ie.numGlyphs;Wt++)u.au(U,Ye,mt);T&&ie.associatedIconIndex>=0&&(te[ie.associatedIconIndex]={shiftedAnchor:Ye,angle:mt})}else zr(ie.numGlyphs,U)}if(T){Z.clear();const ee=p.icon.placedSymbolArray;for(let ie=0;ie<ee.length;ie++){const se=ee.get(ie);if(se.hidden)zr(se.numGlyphs,Z);else{const fe=te[ie];if(fe)for(let oe=0;oe<se.numGlyphs;oe++)u.au(Z,fe.shiftedAnchor,fe.angle);else zr(se.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(U)}function ju(p,e,i){return i.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Uu(p,e,i,l,c,m,y,b,T,E,C,z,R){const U=p.context,Z=U.gl,te=p.transform,ee=b==="map",ie=T==="map",se=b!=="viewport"&&i.layout.get("symbol-placement")!=="point",fe=ee&&!ie&&!se,oe=!i.layout.get("symbol-sort-key").isConstant();let ge=!1;const ye=p.getDepthModeForSublayer(0,Zt.ReadOnly),ue=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[],Fe=te.getCircleRadiusCorrection();for(const Re of l){const De=e.getTile(Re),Be=De.getBucket(i);if(!Be)continue;const at=c?Be.text:Be.icon;if(!at||!at.segments.get().length||!at.hasVisibleVertices)continue;const it=at.programConfigurations.get(i.id),Ye=c||Be.sdfIcons,mt=c?Be.textSizeData:Be.iconSizeData,Wt=ie||te.pitch!==0,xi=p.useProgram(ju(Ye,c,Be),it),Vi=u.am(mt,te.zoom),Si=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Re);let Gi,Ci,Ei,Pi,Dn=[0,0],di=null;if(c)Ci=De.glyphAtlasTexture,Ei=Z.LINEAR,Gi=De.glyphAtlasTexture.size,Be.iconsInText&&(Dn=De.imageAtlasTexture.size,di=De.imageAtlasTexture,Pi=Wt||p.options.rotating||p.options.zooming||mt.kind==="composite"||mt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const en=i.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;Ci=De.imageAtlasTexture,Ei=Ye||p.options.rotating||p.options.zooming||en||Wt?Z.LINEAR:Z.NEAREST,Gi=De.imageAtlasTexture.size}const Tn=u.aB(De,1,p.transform.zoom),zn=Dt(ee,p.transform,Tn),Ws=u.L();u.ap(Ws,zn);const Ks=wi(ie,ee,p.transform,Tn),Js=u.aC(te,De,m,y),hs=te.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Co=ue&&Be.hasTextData(),Po=i.layout.get("icon-text-fit")!=="none"&&Co&&Be.hasIconData();if(se){const en=p.style.map.terrain?(er,pn)=>p.style.map.terrain.getElevation(Re,er,pn):null,zi=i.layout.get("text-rotation-alignment")==="map";Zi(Be,p,c,zn,Ws,ie,E,zi,Re.toUnwrapped(),te.width,te.height,Js,en)}const Ua=c&&ue||Po,ur=se||Ua?Bu:ie?zn:p.transform.clipSpaceToPixelsMatrix,qr=Ye&&i.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Qs;Qs=Ye?Be.iconsInText?Gl(mt.kind,Vi,fe,ie,se,Ua,p,ur,Ks,Js,Gi,Dn,Fe):Cs(mt.kind,Vi,fe,ie,se,Ua,p,ur,Ks,Js,c,Gi,0,Fe):Ca(mt.kind,Vi,fe,ie,se,Ua,p,ur,Ks,Js,c,Gi,Fe);const xa={program:xi,buffers:at,uniformValues:Qs,projectionData:hs,atlasTexture:Ci,atlasTextureIcon:di,atlasInterpolation:Ei,atlasInterpolationIcon:Pi,isSDF:Ye,hasHalo:qr};if(oe&&Be.canOverlap){ge=!0;const en=at.segments.get();for(const zi of en)Se.push({segments:new u.aL([zi]),sortKey:zi.sortKey,state:xa,terrainData:Si})}else Se.push({segments:at.segments,sortKey:0,state:xa,terrainData:Si})}ge&&Se.sort((Re,De)=>Re.sortKey-De.sortKey);for(const Re of Se){const De=Re.state;if(U.activeTexture.set(Z.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,Z.CLAMP_TO_EDGE),De.atlasTextureIcon&&(U.activeTexture.set(Z.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),De.isSDF){const Be=De.uniformValues;De.hasHalo&&(Be.u_is_halo=1,il(De.buffers,Re.segments,i,p,De.program,ye,C,z,Be,De.projectionData,Re.terrainData)),Be.u_is_halo=0}il(De.buffers,Re.segments,i,p,De.program,ye,C,z,De.uniformValues,De.projectionData,Re.terrainData)}}function il(p,e,i,l,c,m,y,b,T,E,C){const z=l.context;c.draw(z,z.gl.TRIANGLES,m,y,b,$t.backCCW,T,C,E,i.id,p.layoutVertexBuffer,p.indexBuffer,e,i.paint,l.transform.zoom,p.programConfigurations.get(i.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function nl(p,e,i,l,c){const m=p.context,y=m.gl,b=bt.disabled,T=new Yt([y.ONE,y.ONE],u.be.transparent,[!0,!0,!0,!0]),E=e.getBucket(i);if(!E)return;const C=l.key;let z=i.heatmapFbos.get(C);z||(z=mo(m,e.tileSize,e.tileSize),i.heatmapFbos.set(C,z)),m.bindFramebuffer.set(z.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:u.be.transparent});const R=E.programConfigurations.get(i.id),U=p.useProgram("heatmap",R,!c),Z=p.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),te=p.style.map.terrain.getTerrainData(l);U.draw(m,y.TRIANGLES,Zt.disabled,b,T,$t.disabled,fa(e,p.transform.zoom,i.paint.get("heatmap-intensity"),1),te,Z,i.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,i.paint,p.transform.zoom,R)}function rl(p,e,i,l,c){const m=p.context,y=m.gl,b=p.transform;m.setColorMode(p.colorModeForRenderPass());const T=sl(m,e),E=i.key,C=e.heatmapFbos.get(E);if(!C)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,C.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const z=b.getProjectionData({overscaledTileID:i,applyTerrainMatrix:c,applyGlobeMatrix:!l});p.useProgram("heatmapTexture").draw(m,y.TRIANGLES,Zt.disabled,bt.disabled,p.colorModeForRenderPass(),$t.disabled,Yo(p,e,0,1),null,z,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,b.zoom),C.destroy(),e.heatmapFbos.delete(E)}function mo(p,e,i){var l,c;const m=p.gl,y=m.createTexture();m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const b=(l=p.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,T=(c=p.RGBA16F)!==null&&c!==void 0?c:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,T,e,i,0,m.RGBA,b,null);const E=p.createFramebuffer(e,i,!1,!1);return E.colorAttachment.set(y),E}function sl(p,e){return e.colorRampTexture||(e.colorRampTexture=new u.T(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function Zl(p,e,i,l,c){if(!i||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let y=m[i.to.toString()],b=m[i.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const T=c.getPaintProperty(e);y=m[T],b=m[T]}y&&b&&p.setConstantPatternPositions(y,b)}function go(p,e,i,l,c,m,y,b){const T=p.context.gl,E="fill-pattern",C=i.paint.get(E),z=C&&C.constantOr(1),R=i.getCrossfadeParameters();let U,Z,te,ee,ie;const se=p.transform,fe=i.paint.get("fill-translate"),oe=i.paint.get("fill-translate-anchor");y?(Z=z&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=T.LINES):(Z=z?"fillPattern":"fill",U=T.TRIANGLES);const ge=C.constantOr(null);for(const ye of l){const ue=e.getTile(ye);if(z&&!ue.patternsLoaded())continue;const Se=ue.getBucket(i);if(!Se)continue;const Fe=Se.programConfigurations.get(i.id),Re=p.useProgram(Z,Fe),De=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ye);z&&(p.context.activeTexture.set(T.TEXTURE0),ue.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Fe.updatePaintBuffers(R)),Zl(Fe,E,ge,ue,i);const Be=se.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),at=u.aC(se,ue,fe,oe);if(y){ee=Se.indexBuffer2,ie=Se.segments2;const Ye=[T.drawingBufferWidth,T.drawingBufferHeight];te=Z==="fillOutlinePattern"&&z?Vl(p,R,ue,Ye,at):ar(Ye,at)}else ee=Se.indexBuffer,ie=Se.segments,te=z?ca(p,R,ue,at):{u_fill_translate:at};const it=p.stencilModeForClipping(ye);Re.draw(p.context,U,c,it,m,$t.backCCW,te,De,Be,i.id,Se.layoutVertexBuffer,ee,ie,i.paint,p.transform.zoom,Fe)}}function Ma(p,e,i,l,c,m,y,b){const T=p.context,E=T.gl,C="fill-extrusion-pattern",z=i.paint.get(C),R=z.constantOr(1),U=i.getCrossfadeParameters(),Z=i.paint.get("fill-extrusion-opacity"),te=z.constantOr(null),ee=p.transform;for(const ie of l){const se=e.getTile(ie),fe=se.getBucket(i);if(!fe)continue;const oe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ie),ge=fe.programConfigurations.get(i.id),ye=p.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ge);R&&(p.context.activeTexture.set(E.TEXTURE0),se.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ge.updatePaintBuffers(U));const ue=ee.getProjectionData({overscaledTileID:ie,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Zl(ge,C,te,se,i);const Se=u.aC(ee,se,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Fe=i.paint.get("fill-extrusion-vertical-gradient"),Re=R?Ea(p,Fe,Z,Se,ie,U,se):Vs(p,Fe,Z,Se);ye.draw(T,T.gl.TRIANGLES,c,m,y,$t.backCCW,Re,oe,ue,i.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,i.paint,p.transform.zoom,ge,p.style.map.terrain&&fe.centroidVertexBuffer)}}function Aa(p,e,i,l,c,m,y,b,T){var E;const C=p.style.projection,z=p.context,R=p.transform,U=z.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],te=p.useProgram("hillshade",null,!1,Z),ee=!p.options.moving;for(const ie of l){const se=e.getTile(ie),fe=se.fbo;if(!fe)continue;const oe=C.getMeshFromTileID(z,ie.canonical,b,!0,"raster"),ge=(E=p.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(ie);z.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,fe.colorAttachment.get());const ye=R.getProjectionData({overscaledTileID:ie,aligned:ee,applyGlobeMatrix:!T,applyTerrainMatrix:!0});te.draw(z,U.TRIANGLES,m,c[ie.overscaledZ],y,$t.backCCW,Gs(p,se,i),ge,ye,i.id,oe.vertexBuffer,oe.indexBuffer,oe.segments)}}function _o(p,e,i,l,c,m,y,b,T){var E;const C=p.style.projection,z=p.context,R=p.transform,U=z.gl,Z=p.useProgram("colorRelief"),te=!p.options.moving;let ee=!0;for(const ie of l){const se=e.getTile(ie),fe=se.dem;if(ee){const Fe=U.getParameter(U.MAX_TEXTURE_SIZE),{elevationTexture:Re,colorTexture:De}=i.getColorRampTextures(z,Fe,fe.getUnpackVector());z.activeTexture.set(U.TEXTURE1),Re.bind(U.NEAREST,U.CLAMP_TO_EDGE),z.activeTexture.set(U.TEXTURE4),De.bind(U.LINEAR,U.CLAMP_TO_EDGE),ee=!1}if(!fe||!fe.data)continue;const oe=fe.stride,ge=fe.getPixels();if(z.activeTexture.set(U.TEXTURE0),z.pixelStoreUnpackPremultiplyAlpha.set(!1),se.demTexture=se.demTexture||p.getTileTexture(oe),se.demTexture){const Fe=se.demTexture;Fe.update(ge,{premultiply:!1}),Fe.bind(U.LINEAR,U.CLAMP_TO_EDGE)}else se.demTexture=new u.T(z,ge,U.RGBA,{premultiply:!1}),se.demTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ye=C.getMeshFromTileID(z,ie.canonical,b,!0,"raster"),ue=(E=p.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(ie),Se=R.getProjectionData({overscaledTileID:ie,aligned:te,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Z.draw(z,U.TRIANGLES,m,c[ie.overscaledZ],y,$t.backCCW,Ko(i,se.dem),ue,Se,i.id,ye.vertexBuffer,ye.indexBuffer,ye.segments)}}const Xl=[new u.P(0,0),new u.P(u.$,0),new u.P(u.$,u.$),new u.P(0,u.$)];function $s(p,e,i,l,c,m,y,b,T=!1,E=!1){const C=l[l.length-1].overscaledZ,z=p.context,R=z.gl,U=p.useProgram("raster"),Z=p.transform,te=p.style.projection,ee=p.colorModeForRenderPass(),ie=!p.options.moving;for(const se of l){const fe=p.getDepthModeForSublayer(se.overscaledZ-C,i.paint.get("raster-opacity")===1?Zt.ReadWrite:Zt.ReadOnly,R.LESS),oe=e.getTile(se);oe.registerFadeDuration(i.paint.get("raster-fade-duration"));const ge=e.findLoadedParent(se,0),ye=e.findLoadedSibling(se),ue=jc(oe,ge||ye||null,e,i,p.transform,p.style.map.terrain);let Se,Fe;const Re=i.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;z.activeTexture.set(R.TEXTURE0),oe.texture.bind(Re,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(R.TEXTURE1),ge?(ge.texture.bind(Re,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Se=Math.pow(2,ge.tileID.overscaledZ-oe.tileID.overscaledZ),Fe=[oe.tileID.canonical.x*Se%1,oe.tileID.canonical.y*Se%1]):oe.texture.bind(Re,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&z.extTextureFilterAnisotropic&&p.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const De=p.style.map.terrain&&p.style.map.terrain.getTerrainData(se),Be=Z.getProjectionData({overscaledTileID:se,aligned:ie,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),at=ks(Fe||[0,0],Se||1,ue,i,b),it=te.getMeshFromTileID(z,se.canonical,m,y,"raster");U.draw(z,R.TRIANGLES,fe,c?c[se.overscaledZ]:bt.disabled,ee,T?$t.frontCCW:$t.backCCW,at,De,Be,i.id,it.vertexBuffer,it.indexBuffer,it.segments)}}function jc(p,e,i,l,c,m){const y=l.paint.get("raster-fade-duration");if(!m&&y>0){const b=we.now(),T=(b-p.timeAdded)/y,E=e?(b-e.timeAdded)/y:-1,C=i.getSource(),z=Ve(c,{tileSize:C.tileSize,roundZoom:C.roundZoom}),R=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),U=R&&p.refreshedUponExpiration?1:u.ag(R?T:1-E,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const Vu=new u.be(1,0,0,1),al=new u.be(0,1,0,1),Yl=new u.be(0,0,1,1),Gu=new u.be(1,0,1,1),qu=new u.be(0,1,1,1);function yo(p,e,i,l){ll(p,0,e+i/2,p.transform.width,i,l)}function ol(p,e,i,l){ll(p,e-i/2,0,i,p.transform.height,l)}function ll(p,e,i,l,c,m){const y=p.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*p.pixelRatio,i*p.pixelRatio,l*p.pixelRatio,c*p.pixelRatio),y.clear({color:m}),b.disable(b.SCISSOR_TEST)}function $u(p,e,i){const l=p.context,c=l.gl,m=p.useProgram("debug"),y=Zt.disabled,b=bt.disabled,T=p.colorModeForRenderPass(),E="$debug",C=p.style.map.terrain&&p.style.map.terrain.getTerrainData(i);l.activeTexture.set(c.TEXTURE0);const z=e.getTileByID(i.key).latestRawTileData,R=Math.floor((z&&z.byteLength||0)/1024),U=e.getTile(i).tileSize,Z=512/Math.min(U,512)*(i.overscaledZ/p.transform.zoom)*.5;let te=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(te+=` => ${i.overscaledZ}`),function(ie,se){ie.initDebugOverlayCanvas();const fe=ie.debugOverlayCanvas,oe=ie.context.gl,ge=ie.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,fe.width,fe.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(se,5,5),ge.strokeText(se,5,5),ie.debugOverlayTexture.update(fe),ie.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(p,`${te} ${R}kB`);const ee=p.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(l,c.TRIANGLES,y,b,Yt.alphaBlended,$t.disabled,Xo(u.be.transparent,Z),null,ee,E,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),m.draw(l,c.LINE_STRIP,y,b,T,$t.disabled,Xo(u.be.red),C,ee,E,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Yi(p,e,i,l){const{isRenderingGlobe:c}=l,m=p.context,y=m.gl,b=p.transform,T=p.colorModeForRenderPass(),E=p.getDepthModeFor3D(),C=p.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,p.width,p.height]);for(const z of i){const R=e.getTerrainMesh(z.tileID),U=p.renderToTexture.getTexture(z),Z=e.getTerrainData(z.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,U.texture);const te=e.getMeshFrameDelta(b.zoom),ee=b.calculateFogMatrix(z.tileID.toUnwrapped()),ie=br(te,ee,p.style.sky,b.pitch,c),se=b.getProjectionData({overscaledTileID:z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});C.draw(m,y.TRIANGLES,E,bt.disabled,T,$t.backCCW,ie,Z,se,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function Zs(p,e){if(!e.mesh){const i=new u.aK;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const l=new u.aM;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Er(p.createVertexBuffer(i,Br.members),p.createIndexBuffer(l),u.aL.simpleSegment(0,0,i.length,l.length))}return e.mesh}class Pr{constructor(e,i){this.context=new ii(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ze.maxUnderzooming+Ze.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sa}resize(e,i,l){if(this.width=Math.floor(e*l),this.height=Math.floor(i*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,i=new u.aK;i.emplaceBack(0,0),i.emplaceBack(u.$,0),i.emplaceBack(0,u.$),i.emplaceBack(u.$,u.$),this.tileExtentBuffer=e.createVertexBuffer(i,Br.members),this.tileExtentSegments=u.aL.simpleSegment(0,0,4,2);const l=new u.aK;l.emplaceBack(0,0),l.emplaceBack(u.$,0),l.emplaceBack(0,u.$),l.emplaceBack(u.$,u.$),this.debugBuffer=e.createVertexBuffer(l,Br.members),this.debugSegments=u.aL.simpleSegment(0,0,4,5);const c=new u.c5;c.emplaceBack(0,0,0,0),c.emplaceBack(u.$,0,u.$,0),c.emplaceBack(0,u.$,0,u.$),c.emplaceBack(u.$,u.$,u.$,u.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,io.members),this.rasterBoundsSegments=u.aL.simpleSegment(0,0,4,2);const m=new u.aK;m.emplaceBack(0,0),m.emplaceBack(u.$,0),m.emplaceBack(0,u.$),m.emplaceBack(u.$,u.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,Br.members),this.rasterBoundsSegmentsPosOnly=u.aL.simpleSegment(0,0,4,5);const y=new u.aK;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,Br.members),this.viewportSegments=u.aL.simpleSegment(0,0,4,2);const b=new u.c6;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const T=new u.aM;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const E=this.context.gl;this.stencilClearMode=new bt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new Er(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=u.L();u.bX(l,0,this.width,this.height,0,0,1),u.N(l,l,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const c={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,Zt.disabled,this.stencilClearMode,Yt.disabled,$t.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const c=this.context;c.setColorMode(Yt.disabled),c.setDepthMode(Zt.disabled);const m={};for(const y of i)m[y.key]=this.nextStencilID++;this._renderTileMasks(m,i,l,!0),this._renderTileMasks(m,i,l,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,i,l,c){const m=this.context,y=m.gl,b=this.style.projection,T=this.transform,E=this.useProgram("clippingMask");for(const C of i){const z=e[C.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),U=b.getMeshFromTileID(this.context,C.canonical,c,!0,"stencil"),Z=T.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!l,applyTerrainMatrix:!0});E.draw(m,y.TRIANGLES,Zt.disabled,new bt({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),Yt.disabled,l?$t.disabled:$t.backCCW,null,R,Z,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,l=this.style.projection,c=this.transform,m=this.useProgram("depth"),y=this.getDepthModeFor3D(),b=Ue(c,{tileSize:c.tileSize});for(const T of b){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),C=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),z=c.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,i.TRIANGLES,y,bt.disabled,Yt.disabled,$t.backCCW,null,E,z,"$clipping",C.vertexBuffer,C.indexBuffer,C.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new bt({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new bt({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),c=l[l.length-1].overscaledZ,m=l[0].overscaledZ-c+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let b=0;b<m;b++)y[b+c]=new bt({func:i.GEQUAL,mask:255},b+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=m,[y,l]}return[{[c]:bt.disabled},l]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),c=l[l.length-1].overscaledZ,m=l[0].overscaledZ-c+1;if(this.clearStencil(),m>1){const y={},b={};for(let T=0;T<m;T++)y[T+c]=new bt({func:i.GREATER,mask:255},m+1+T,255,i.KEEP,i.KEEP,i.REPLACE),b[T+c]=new bt({func:i.GREATER,mask:255},1+T,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*m+1,[y,b,l]}return this.nextStencilID=3,[{[c]:new bt({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[c]:new bt({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Yt([e.CONSTANT_COLOR,e.ONE],new u.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Yt.unblended:Yt.alphaBlended}getDepthModeForSublayer(e,i,l){if(!this.opaquePassEnabledForLayer())return Zt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Zt(l||this.context.gl.LEQUAL,i,[c,c])}getDepthModeFor3D(){return new Zt(this.context.gl.LEQUAL,Zt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var l,c;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(we.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,b={},T={},E={},C={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const R in y){const U=y[R];U.used&&U.prepare(this.context),b[R]=U.getVisibleCoordinates(!1),T[R]=b[R].slice().reverse(),E[R]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<m.length;R++)if(this.style._layers[m[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const R of m){const U=this.style._layers[R];if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const Z=T[U.source];(U.type==="custom"||Z.length)&&this.renderLayer(this,y[U.source],U,Z,C)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?u.be.black:u.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(R,U){const Z=R.context,te=Z.gl,ee=((ye,ue,Se)=>{const Fe=Math.cos(ue.rollInRadians),Re=Math.sin(ue.rollInRadians),De=H(ue),Be=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ye.properties.get("sky-color"),u_horizon_color:ye.properties.get("horizon-color"),u_horizon:[(ue.width/2-De*Re)*Se,(ue.height/2+De*Fe)*Se],u_horizon_normal:[-Re,Fe],u_sky_horizon_blend:ye.properties.get("sky-horizon-blend")*ue.height/2*Se,u_sky_blend:Be}})(U,R.style.map.transform,R.pixelRatio),ie=new Zt(te.LEQUAL,Zt.ReadWrite,[0,1]),se=bt.disabled,fe=R.colorModeForRenderPass(),oe=R.useProgram("sky"),ge=Zs(Z,U);oe.draw(Z,te.TRIANGLES,ie,se,fe,$t.disabled,ee,null,void 0,"sky",ge.vertexBuffer,ge.indexBuffer,ge.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[m[this.currentLayer]],U=y[R.source],Z=b[R.source];this._renderTileClippingMasks(R,Z,!1),this.renderLayer(this,U,R,Z,C)}this.renderPass="translucent";let z=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const R=this.style._layers[m[this.currentLayer]],U=y[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,C))continue;this.opaquePassEnabledForLayer()||z||(z=!0,C.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(R.type==="symbol"?E:T)[R.source];this._renderTileClippingMasks(R,b[R.source],!!this.renderToTexture),this.renderLayer(this,U,R,Z,C)}if(C.isRenderingGlobe&&function(R,U,Z){const te=R.context,ee=te.gl,ie=R.useProgram("atmosphere"),se=new Zt(ee.LEQUAL,Zt.ReadOnly,[0,1]),fe=R.transform,oe=function(Be,at){const it=Be.properties.get("position"),Ye=[-it.x,-it.y,-it.z],mt=u.af(new Float64Array(16));return Be.properties.get("anchor")==="map"&&(u.b5(mt,mt,at.rollInRadians),u.b6(mt,mt,-at.pitchInRadians),u.b5(mt,mt,at.bearingInRadians),u.b6(mt,mt,at.center.lat*Math.PI/180),u.by(mt,mt,-at.center.lng*Math.PI/180)),u.c4(Ye,Ye,mt),Ye}(Z,R.transform),ge=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ye=U.properties.get("atmosphere-blend")*ge.projectionTransition;if(ye===0)return;const ue=vr(fe.worldSize,fe.center.lat),Se=fe.inverseProjectionMatrix,Fe=new Float64Array(4);Fe[3]=1,u.av(Fe,Fe,fe.modelViewProjectionMatrix),Fe[0]/=Fe[3],Fe[1]/=Fe[3],Fe[2]/=Fe[3],Fe[3]=1,u.av(Fe,Fe,Se),Fe[0]/=Fe[3],Fe[1]/=Fe[3],Fe[2]/=Fe[3],Fe[3]=1;const Re=((Be,at,it,Ye,mt)=>({u_sun_pos:Be,u_atmosphere_blend:at,u_globe_position:it,u_globe_radius:Ye,u_inv_proj_matrix:mt}))(oe,ye,[Fe[0],Fe[1],Fe[2]],ue,Se),De=Zs(te,U);ie.draw(te,ee.TRIANGLES,se,bt.disabled,Yt.alphaBlended,$t.disabled,Re,null,null,"atmosphere",De.vertexBuffer,De.indexBuffer,De.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const R=function(U,Z){let te=null;const ee=Object.values(U._layers).flatMap(oe=>oe.source&&!oe.isHidden(Z)?[U.sourceCaches[oe.source]]:[]),ie=ee.filter(oe=>oe.getSource().type==="vector"),se=ee.filter(oe=>oe.getSource().type!=="vector"),fe=oe=>{(!te||te.getSource().maxzoom<oe.getSource().maxzoom)&&(te=oe)};return ie.forEach(oe=>fe(oe)),te||se.forEach(oe=>fe(oe)),te}(this.style,this.transform.zoom);R&&function(U,Z,te){for(let ee=0;ee<te.length;ee++)$u(U,Z,te[ee])}(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const U=R.transform.padding;yo(R,R.transform.height-(U.top||0),3,Vu),yo(R,U.bottom||0,3,al),ol(R,U.left||0,3,Yl),ol(R,R.transform.width-(U.right||0),3,Gu);const Z=R.transform.centerPoint;(function(te,ee,ie,se){ll(te,ee-1,ie-10,2,20,se),ll(te,ee-10,ie-1,20,2,se)})(R,Z.x,R.transform.height-Z.y,qu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!u.c7(i,l):!u.c8(i,l)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(u.c9(i,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,y){const b=m.context,T=b.gl,E=m.transform,C=Yt.unblended,z=new Zt(T.LEQUAL,Zt.ReadWrite,[0,1]),R=y.sourceCache.getRenderableTiles(),U=m.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:u.be.transparent,depth:1});for(const Z of R){const te=y.getTerrainMesh(Z.tileID),ee=y.getTerrainData(Z.tileID),ie=E.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),se={u_ele_delta:y.getMeshFrameDelta(E.zoom)};U.draw(b,T.TRIANGLES,z,bt.disabled,C,$t.backCCW,se,ee,ie,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,y){const b=m.context,T=b.gl,E=m.transform,C=Yt.unblended,z=new Zt(T.LEQUAL,Zt.ReadWrite,[0,1]),R=y.getCoordsTexture(),U=y.sourceCache.getRenderableTiles(),Z=m.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:u.be.transparent,depth:1}),y.coordsIndex=[];for(const te of U){const ee=y.getTerrainMesh(te.tileID),ie=y.getTerrainData(te.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,R.texture);const se={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(E.zoom)},fe=E.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(b,T.TRIANGLES,z,bt.disabled,C,$t.backCCW,se,ie,fe,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments),y.coordsIndex.push(te.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,i,l,c,m){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(c||[]).length)&&(this.id=l.id,u.ca(l)?function(y,b,T,E,C,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,U=bt.disabled,Z=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(te,ee,ie,se,fe,oe,ge,ye,ue){const Se=ee.transform,Fe=ee.style.map.terrain,Re=fe==="map",De=oe==="map";for(const Be of te){const at=se.getTile(Be),it=at.getBucket(ie);if(!it||!it.text||!it.text.segments.get().length)continue;const Ye=u.am(it.textSizeData,Se.zoom),mt=u.aB(at,1,ee.transform.zoom),Wt=Dt(Re,ee.transform,mt),xi=ie.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(Ye){const Vi=Math.pow(2,Se.zoom-at.tileID.overscaledZ),Si=Fe?(Gi,Ci)=>Fe.getElevation(Be,Gi,Ci):null;Bc(it,Re,De,ue,Se,Wt,Vi,Ye,xi,u.aC(Se,at,ge,ye),Be.toUnwrapped(),Si)}}}(E,y,T,b,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),C),T.paint.get("icon-opacity").constantOr(1)!==0&&Uu(y,b,T,E,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),U,Z,R),T.paint.get("text-opacity").constantOr(1)!==0&&Uu(y,b,T,E,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),U,Z,R),b.map.showCollisionBoxes&&(Fu(y,b,T,E,!0),Fu(y,b,T,E,!1))}(e,i,l,c,this.style.placement.variableOffsets,m):u.cb(l)?function(y,b,T,E,C){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:z}=C,R=T.paint.get("circle-opacity"),U=T.paint.get("circle-stroke-width"),Z=T.paint.get("circle-stroke-opacity"),te=!T.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(U.constantOr(1)===0||Z.constantOr(1)===0))return;const ee=y.context,ie=ee.gl,se=y.transform,fe=y.getDepthModeForSublayer(0,Zt.ReadOnly),oe=bt.disabled,ge=y.colorModeForRenderPass(),ye=[],ue=se.getCircleRadiusCorrection();for(let Se=0;Se<E.length;Se++){const Fe=E[Se],Re=b.getTile(Fe),De=Re.getBucket(T);if(!De)continue;const Be=T.paint.get("circle-translate"),at=T.paint.get("circle-translate-anchor"),it=u.aC(se,Re,Be,at),Ye=De.programConfigurations.get(T.id),mt=y.useProgram("circle",Ye),Wt=De.layoutVertexBuffer,xi=De.indexBuffer,Vi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Fe),Si={programConfiguration:Ye,program:mt,layoutVertexBuffer:Wt,indexBuffer:xi,uniformValues:no(y,Re,T,it,ue),terrainData:Vi,projectionData:se.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!z,applyTerrainMatrix:!0})};if(te){const Gi=De.segments.get();for(const Ci of Gi)ye.push({segments:new u.aL([Ci]),sortKey:Ci.sortKey,state:Si})}else ye.push({segments:De.segments,sortKey:0,state:Si})}te&&ye.sort((Se,Fe)=>Se.sortKey-Fe.sortKey);for(const Se of ye){const{programConfiguration:Fe,program:Re,layoutVertexBuffer:De,indexBuffer:Be,uniformValues:at,terrainData:it,projectionData:Ye}=Se.state;Re.draw(ee,ie.TRIANGLES,fe,oe,ge,$t.backCCW,at,it,Ye,T.id,De,Be,Se.segments,T.paint,y.transform.zoom,Fe)}}(e,i,l,c,m):u.cc(l)?function(y,b,T,E,C){if(T.paint.get("heatmap-opacity")===0)return;const z=y.context,{isRenderingToTexture:R,isRenderingGlobe:U}=C;if(y.style.map.terrain){for(const Z of E){const te=b.getTile(Z);b.hasRenderableParent(Z)||(y.renderPass==="offscreen"?nl(y,te,T,Z,U):y.renderPass==="translucent"&&rl(y,T,Z,R,U))}z.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(Z,te,ee,ie){const se=Z.context,fe=se.gl,oe=Z.transform,ge=bt.disabled,ye=new Yt([fe.ONE,fe.ONE],u.be.transparent,[!0,!0,!0,!0]);(function(ue,Se,Fe){const Re=ue.gl;ue.activeTexture.set(Re.TEXTURE1),ue.viewport.set([0,0,Se.width/4,Se.height/4]);let De=Fe.heatmapFbos.get(u.c1);De?(Re.bindTexture(Re.TEXTURE_2D,De.colorAttachment.get()),ue.bindFramebuffer.set(De.framebuffer)):(De=mo(ue,Se.width/4,Se.height/4),Fe.heatmapFbos.set(u.c1,De))})(se,Z,ee),se.clear({color:u.be.transparent});for(let ue=0;ue<ie.length;ue++){const Se=ie[ue];if(te.hasRenderableParent(Se))continue;const Fe=te.getTile(Se),Re=Fe.getBucket(ee);if(!Re)continue;const De=Re.programConfigurations.get(ee.id),Be=Z.useProgram("heatmap",De),at=oe.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),it=oe.getCircleRadiusCorrection();Be.draw(se,fe.TRIANGLES,Zt.disabled,ge,ye,$t.backCCW,fa(Fe,oe.zoom,ee.paint.get("heatmap-intensity"),it),null,at,ee.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,ee.paint,oe.zoom,De)}se.viewport.set([0,0,Z.width,Z.height])}(y,b,T,E):y.renderPass==="translucent"&&function(Z,te){const ee=Z.context,ie=ee.gl;ee.setColorMode(Z.colorModeForRenderPass());const se=te.heatmapFbos.get(u.c1);se&&(ee.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,se.colorAttachment.get()),ee.activeTexture.set(ie.TEXTURE1),sl(ee,te).bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(ee,ie.TRIANGLES,Zt.disabled,bt.disabled,Z.colorModeForRenderPass(),$t.disabled,Yo(Z,te,0,1),null,null,te.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,te.paint,Z.transform.zoom))}(y,T)}(e,i,l,c,m):u.cd(l)?function(y,b,T,E,C){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:z}=C,R=T.paint.get("line-opacity"),U=T.paint.get("line-width");if(R.constantOr(1)===0||U.constantOr(1)===0)return;const Z=y.getDepthModeForSublayer(0,Zt.ReadOnly),te=y.colorModeForRenderPass(),ee=T.paint.get("line-dasharray"),ie=T.paint.get("line-pattern"),se=ie.constantOr(1),fe=T.paint.get("line-gradient"),oe=T.getCrossfadeParameters(),ge=se?"linePattern":ee?"lineSDF":fe?"lineGradient":"line",ye=y.context,ue=ye.gl,Se=y.transform;let Fe=!0;for(const Re of E){const De=b.getTile(Re);if(se&&!De.patternsLoaded())continue;const Be=De.getBucket(T);if(!Be)continue;const at=Be.programConfigurations.get(T.id),it=y.context.program.get(),Ye=y.useProgram(ge,at),mt=Fe||Ye.program!==it,Wt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),xi=ie.constantOr(null);if(xi&&De.imageAtlas){const Ei=De.imageAtlas,Pi=Ei.patternPositions[xi.to.toString()],Dn=Ei.patternPositions[xi.from.toString()];Pi&&Dn&&at.setConstantPatternPositions(Pi,Dn)}const Vi=Se.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Si=Se.getPixelScale(),Gi=se?Jo(y,De,T,Si,oe):ee?Qo(y,De,T,Si,ee,oe):fe?ro(y,De,T,Si,Be.lineClipsArray.length):ka(y,De,T,Si);if(se)ye.activeTexture.set(ue.TEXTURE0),De.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),at.updatePaintBuffers(oe);else if(ee&&(mt||y.lineAtlas.dirty))ye.activeTexture.set(ue.TEXTURE0),y.lineAtlas.bind(ye);else if(fe){const Ei=Be.gradients[T.id];let Pi=Ei.texture;if(T.gradientVersion!==Ei.version){let Dn=256;if(T.stepInterpolant){const di=b.getSource().maxzoom,Tn=Re.canonical.z===di?Math.ceil(1<<y.transform.maxZoom-Re.canonical.z):1;Dn=u.ag(u.c2(Be.maxLineLength/u.$*1024*Tn),256,ye.maxTextureSize)}Ei.gradient=u.c3({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:Dn,image:Ei.gradient||void 0,clips:Be.lineClipsArray}),Ei.texture?Ei.texture.update(Ei.gradient):Ei.texture=new u.T(ye,Ei.gradient,ue.RGBA),Ei.version=T.gradientVersion,Pi=Ei.texture}ye.activeTexture.set(ue.TEXTURE0),Pi.bind(T.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}const Ci=y.stencilModeForClipping(Re);Ye.draw(ye,ue.TRIANGLES,Z,Ci,te,$t.disabled,Gi,Wt,Vi,T.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,T.paint,y.transform.zoom,at,Be.layoutVertexBuffer2),Fe=!1}}(e,i,l,c,m):u.ce(l)?function(y,b,T,E,C){const z=T.paint.get("fill-color"),R=T.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const{isRenderingToTexture:U}=C,Z=y.colorModeForRenderPass(),te=T.paint.get("fill-pattern"),ee=y.opaquePassEnabledForLayer()&&!te.constantOr(1)&&z.constantOr(u.be.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===ee){const ie=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?Zt.ReadWrite:Zt.ReadOnly);go(y,b,T,E,ie,Z,!1,U)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const ie=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Zt.ReadOnly);go(y,b,T,E,ie,Z,!0,U)}}(e,i,l,c,m):u.cf(l)?function(y,b,T,E,C){const z=T.paint.get("fill-extrusion-opacity");if(z===0)return;const{isRenderingToTexture:R}=C;if(y.renderPass==="translucent"){const U=new Zt(y.context.gl.LEQUAL,Zt.ReadWrite,y.depthRangeFor3D);if(z!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))Ma(y,b,T,E,U,bt.disabled,Yt.disabled,R),Ma(y,b,T,E,U,y.stencilModeFor3D(),y.colorModeForRenderPass(),R);else{const Z=y.colorModeForRenderPass();Ma(y,b,T,E,U,bt.disabled,Z,R)}}}(e,i,l,c,m):u.cg(l)?function(y,b,T,E,C){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:z}=C,R=y.context,U=y.style.projection.useSubdivision,Z=y.getDepthModeForSublayer(0,Zt.ReadOnly),te=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(ee,ie,se,fe,oe,ge,ye){const ue=ee.context,Se=ue.gl;for(const Fe of se){const Re=ie.getTile(Fe),De=Re.dem;if(!De||!De.data||!Re.needsHillshadePrepare)continue;const Be=De.dim,at=De.stride,it=De.getPixels();if(ue.activeTexture.set(Se.TEXTURE1),ue.pixelStoreUnpackPremultiplyAlpha.set(!1),Re.demTexture=Re.demTexture||ee.getTileTexture(at),Re.demTexture){const mt=Re.demTexture;mt.update(it,{premultiply:!1}),mt.bind(Se.NEAREST,Se.CLAMP_TO_EDGE)}else Re.demTexture=new u.T(ue,it,Se.RGBA,{premultiply:!1}),Re.demTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE);ue.activeTexture.set(Se.TEXTURE0);let Ye=Re.fbo;if(!Ye){const mt=new u.T(ue,{width:Be,height:Be,data:null},Se.RGBA);mt.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),Ye=Re.fbo=ue.createFramebuffer(Be,Be,!0,!1),Ye.colorAttachment.set(mt.texture)}ue.bindFramebuffer.set(Ye.framebuffer),ue.viewport.set([0,0,Be,Be]),ee.useProgram("hillshadePrepare").draw(ue,Se.TRIANGLES,oe,ge,ye,$t.disabled,Ho(Re.tileID,De),null,null,fe.id,ee.rasterBoundsBuffer,ee.quadTriangleIndexBuffer,ee.rasterBoundsSegments),Re.needsHillshadePrepare=!1}})(y,b,E,T,Z,bt.disabled,te),R.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(U){const[ee,ie,se]=y.stencilConfigForOverlapTwoPass(E);Aa(y,b,T,se,ee,Z,te,!1,z),Aa(y,b,T,se,ie,Z,te,!0,z)}else{const[ee,ie]=y.getStencilConfigForOverlapAndUpdateStencilID(E);Aa(y,b,T,ie,ee,Z,te,!1,z)}}(e,i,l,c,m):u.ch(l)?function(y,b,T,E,C){if(y.renderPass!=="translucent"||!E.length)return;const{isRenderingToTexture:z}=C,R=y.style.projection.useSubdivision,U=y.getDepthModeForSublayer(0,Zt.ReadOnly),Z=y.colorModeForRenderPass();if(R){const[te,ee,ie]=y.stencilConfigForOverlapTwoPass(E);_o(y,b,T,ie,te,U,Z,!1,z),_o(y,b,T,ie,ee,U,Z,!0,z)}else{const[te,ee]=y.getStencilConfigForOverlapAndUpdateStencilID(E);_o(y,b,T,ee,te,U,Z,!1,z)}}(e,i,l,c,m):u.ci(l)?function(y,b,T,E,C){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:z}=C,R=b.getSource(),U=y.style.projection.useSubdivision;if(R instanceof Je)$s(y,b,T,E,null,!1,!1,R.tileCoords,R.flippedWindingOrder,z);else if(U){const[Z,te,ee]=y.stencilConfigForOverlapTwoPass(E);$s(y,b,T,ee,Z,!1,!0,Xl,!1,z),$s(y,b,T,ee,te,!0,!0,Xl,!1,z)}else{const[Z,te]=y.getStencilConfigForOverlapAndUpdateStencilID(E);$s(y,b,T,te,Z,!1,!0,Xl,!1,z)}}(e,i,l,c,m):u.cj(l)?function(y,b,T,E,C){const z=T.paint.get("background-color"),R=T.paint.get("background-opacity");if(R===0)return;const{isRenderingToTexture:U}=C,Z=y.context,te=Z.gl,ee=y.style.projection,ie=y.transform,se=ie.tileSize,fe=T.paint.get("background-pattern");if(y.isPatternMissing(fe))return;const oe=!fe&&z.a===1&&R===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==oe)return;const ge=bt.disabled,ye=y.getDepthModeForSublayer(0,oe==="opaque"?Zt.ReadWrite:Zt.ReadOnly),ue=y.colorModeForRenderPass(),Se=y.useProgram(fe?"backgroundPattern":"background"),Fe=E||Ue(ie,{tileSize:se,terrain:y.style.map.terrain});fe&&(Z.activeTexture.set(te.TEXTURE0),y.imageManager.bind(y.context));const Re=T.getCrossfadeParameters();for(const De of Fe){const Be=ie.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),at=fe?lo(R,y,fe,{tileID:De,tileSize:se},Re):pa(R,z),it=y.style.map.terrain&&y.style.map.terrain.getTerrainData(De),Ye=ee.getMeshFromTileID(Z,De.canonical,!1,!0,"raster");Se.draw(Z,te.TRIANGLES,ye,ge,ue,$t.backCCW,at,it,Be,T.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}}(e,0,l,c,m):u.ck(l)&&function(y,b,T,E){const{isRenderingGlobe:C}=E,z=y.context,R=T.implementation,U=y.style.projection,Z=y.transform,te=Z.getProjectionDataForCustomLayer(C),ee={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:U.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${U.shaderPreludeCode.vertexSource}`,define:U.shaderDefine},defaultProjectionData:te},ie=R.renderingMode?R.renderingMode:"2d";if(y.renderPass==="offscreen"){const se=R.prerender;se&&(y.setCustomLayerDefaults(),z.setColorMode(y.colorModeForRenderPass()),se.call(R,z.gl,ee),z.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),z.setColorMode(y.colorModeForRenderPass()),z.setStencilMode(bt.disabled);const se=ie==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,Zt.ReadOnly);z.setDepthMode(se),R.render(z.gl,ee),z.setDirty(),y.setBaseState(),z.bindFramebuffer.set(null)}}(e,0,l,m))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!i||!l}useProgram(e,i,l=!1,c=[]){this.cache=this.cache||{};const m=!!this.style.map.terrain,y=this.style.projection,b=l?gr.projectionMercator:y.shaderPreludeCode,T=l?jr:y.shaderDefine,E=e+(i?i.cacheKey:"")+`/${l?ki:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[E]||(this.cache[E]=new rs(this.context,gr[e],i,uo[e],this._showOverdrawInspector,m,b,T,c)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function ul(p,e){let i,l=!1,c=null,m=null;const y=()=>{c=null,l&&(p.apply(m,i),c=setTimeout(y,e),l=!1)};return(...b)=>(l=!0,m=this,i=b,c||y(),c)}class vo{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:l,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const l=i.join("/");let c=l;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${l}`);let m=window.location.hash.replace(c,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let y=window.location.href.replace(/(#.+)?$/,m);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=ul(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,c),y=Math.round(i.lng*m)/m,b=Math.round(i.lat*m)/m,T=this._map.getBearing(),E=this._map.getPitch();let C="";if(C+=e?`/${y}/${b}/${l}`:`${l}/${b}/${y}`,(T||E)&&(C+="/"+Math.round(10*T)/10),E&&(C+=`/${Math.round(E)}`),this._hashName){const z=this._hashName;let R=!1;const U=window.location.hash.slice(1).split("&").map(Z=>{const te=Z.split("=")[0];return te===z?(R=!0,`${te}=${C}`):Z}).filter(Z=>Z);return R||U.push(`${z}=${C}`),`#${U.join("&")}`}return`#${C}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new u.S(+e[2],+e[1])}catch{return!1}const i=+e[0],l=+(e[3]||0),c=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&l>=-180&&l<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const La={linearity:.3,easing:u.cl(0,0,.3,1)},Ra=u.e({deceleration:2500,maxSpeed:1400},La),Hl=u.e({deceleration:20,maxSpeed:1400},La),xo=u.e({deceleration:1e3,maxSpeed:360},La),Wl=u.e({deceleration:1e3,maxSpeed:90},La),Zu=u.e({deceleration:1e3,maxSpeed:360},La);class Xu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:we.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=we.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)i.zoom+=m.zoomDelta||0,i.bearing+=m.bearingDelta||0,i.pitch+=m.pitchDelta||0,i.roll+=m.rollDelta||0,m.panDelta&&i.pan._add(m.panDelta),m.around&&(i.around=m.around),m.pinchAround&&(i.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(i.pan.mag()){const m=za(i.pan.mag(),l,u.e({},Ra,e||{})),y=i.pan.mult(m.amount/i.pan.mag()),b=this._map.cameraHelper.handlePanInertia(y,this._map.transform);c.center=b.easingCenter,c.offset=b.easingOffset,Da(c,m)}if(i.zoom){const m=za(i.zoom,l,Hl);c.zoom=this._map.transform.zoom+m.amount,Da(c,m)}if(i.bearing){const m=za(i.bearing,l,xo);c.bearing=this._map.transform.bearing+u.ag(m.amount,-179,179),Da(c,m)}if(i.pitch){const m=za(i.pitch,l,Wl);c.pitch=this._map.transform.pitch+m.amount,Da(c,m)}if(i.roll){const m=za(i.roll,l,Zu);c.roll=this._map.transform.roll+u.ag(m.amount,-179,179),Da(c,m)}if(c.zoom||c.bearing){const m=i.pinchAround===void 0?i.around:i.pinchAround;c.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),u.e(c,{noMoveStart:!0})}}function Da(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function za(p,e,i){const{maxSpeed:l,linearity:c,deceleration:m}=i,y=u.ag(p*c/(e/1e3),-l,l),b=Math.abs(y)/(m*c);return{easing:i.easing,duration:1e3*b,amount:y*(b/2)}}class lr extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l,c={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const m=ae.mousePos(i.getCanvas(),l),y=i.unproject(m);super(e,u.e({point:m,lngLat:y,originalEvent:l},c)),this._defaultPrevented=!1,this.target=i}}class Vr extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l){const c=e==="touchend"?l.changedTouches:l.touches,m=ae.touchPos(i.getCanvasContainer(),c),y=m.map(T=>i.unproject(T)),b=m.reduce((T,E,C,z)=>T.add(E.div(z.length)),new u.P(0,0));super(e,{points:m,point:b,lngLats:y,lngLat:i.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class Kl extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Yu{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Kl(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new lr(e.type,this._map,e))}mouseup(e){this._map.fire(new lr(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new lr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new lr(e.type,this._map,e))}mouseover(e){this._map.fire(new lr(e.type,this._map,e))}mouseout(e){this._map.fire(new lr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Vr(e.type,this._map,e))}touchmove(e){this._map.fire(new Vr(e.type,this._map,e))}touchend(e){this._map.fire(new Vr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Vr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hu{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new lr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new lr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Na{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(u.P.convert(e),this._map.terrain)}}class Jl{constructor(e,i){this._map=e,this._tr=new Na(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(ae.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const l=i;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=l,this._box||(this._box=ae.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(c.x,l.x),y=Math.max(c.x,l.x),b=Math.min(c.y,l.y),T=Math.max(c.y,l.y);ae.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=y-m+"px",this._box.style.height=T-b+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const l=this._startPos,c=i;if(this.reset(),ae.suppressClick(),l.x!==c.x||l.y!==c.y)return this._map.fire(new u.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ae.remove(this._box),this._box=null),ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new u.l(e,{originalEvent:i}))}}function cl(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const i={};for(let l=0;l<p.length;l++)i[p[l].identifier]=e[l];return i}class Wu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(c){const m=new u.P(0,0);for(const y of c)m._add(y);return m.div(c.length)}(i),this.touches=cl(l,i)))}touchmove(e,i,l){if(this.aborted||!this.centroid)return;const c=cl(l,i);for(const m in this.touches){const y=c[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,i,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class hl{constructor(e){this.singleTap=new Wu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,l){this.singleTap.touchstart(e,i,l)}touchmove(e,i,l){this.singleTap.touchmove(e,i,l)}touchend(e,i,l){const c=this.singleTap.touchend(e,i,l);if(c){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(c)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class dl{constructor(e){this._tr=new Na(e),this._zoomIn=new hl({numTouches:1,numTaps:2}),this._zoomOut=new hl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,l){this._zoomIn.touchstart(e,i,l),this._zoomOut.touchstart(e,i,l)}touchmove(e,i,l){this._zoomIn.touchmove(e,i,l),this._zoomOut.touchmove(e,i,l)}touchend(e,i,l){const c=this._zoomIn.touchend(e,i,l),m=this._zoomOut.touchend(e,i,l),y=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(c)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oa{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=Array.isArray(i)?i[0]:i;return!this._moved&&c.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(l,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ae.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Mr=0,Gr=2,Ku={[Mr]:1,[Gr]:2};class Jn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=ae.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,l){const c=Ku[l];return i.buttons===void 0||(i.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return ae.mouseButton(e)===this._eventButton}}class Fa{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Uc{constructor(e=new Jn({checkCorrectEvent:()=>!0}),i=new Fa){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,l){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const fl=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}};class Vc{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,l){return this._calculateTransform(e,i,l)}touchmove(e,i,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,i,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,l){this._calculateTransform(e,i,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,l){l.length>0&&(this._active=!0);const c=cl(l,i),m=new u.P(0,0),y=new u.P(0,0);let b=0;for(const E in c){const C=c[E],z=this._touches[E];z&&(m._add(C),y._add(C.sub(z)),b++,c[E]=C)}if(this._touches=c,this._shouldBePrevented(b)||!y.mag())return;const T=y.div(b);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,l){if(!this._firstTwoTouches)return;e.preventDefault();const[c,m]=this._firstTwoTouches,y=bo(l,i,c),b=bo(l,i,m);if(!y||!b)return;const T=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],T,e)}touchend(e,i,l){if(!this._firstTwoTouches)return;const[c,m]=this._firstTwoTouches,y=bo(l,i,c),b=bo(l,i,m);y&&b||(this._active&&ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function bo(p,e,i){for(let l=0;l<p.length;l++)if(p[l].identifier===i)return e[l]}function Ba(p,e){return Math.log(p/e)/Math.LN2}class us extends Ql{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ba(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ba(this._distance,l),pinchAround:i}}}function dt(p,e){return 180*p.angleWith(e)/Math.PI}class eu extends Ql{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,l){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dt(this._vector,c),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,l=dt(e,this._startVector);return Math.abs(l)<i}}function wo(p){return Math.abs(p.y)>Math.abs(p.x)}class tu extends Ql{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,l){super.touchstart(e,i,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,wo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,l){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,m=i.mag()>=2;if(!c&&!m)return;if(!c||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==i.y>0;return wo(e)&&wo(i)&&y}}const To={panStep:100,bearingStep:15,pitchStep:10};class ja{constructor(e){this._tr=new Na(e);const i=To;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,l=0,c=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,c=0),{cameraAnimation:b=>{const T=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:iu,zoom:i?Math.round(T.zoom)+i*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+c*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function iu(p){return p*(2-p)}const ni=4.000244140625,nu=1/450;class Ju{constructor(e,i){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Na(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nu}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=we.now(),c=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,i!==0&&i%ni==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=ae.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(u.S.convert(l.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>ni?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&T!==0&&(T=1/T);const E=typeof this._targetZoom!="number"?e.scale:u.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),u.aj(E*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,c=this._easing;let m,y=!1;if(this._type==="wheel"&&l&&c){const b=we.now()-this._lastWheelEventTime,T=Math.min((b+5)/200,1),E=c(T);m=u.C.number(l,i,E),T<1?this._frameId||(this._frameId=!0):y=!0}else m=i,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=u.cn;if(this._prevEase){const l=this._prevEase,c=(we.now()-l.start)/l.duration,m=l.easing(c+.01)-l.easing(c),y=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-y*y);i=u.cl(y,b,.25,1)}return this._prevEase={start:we.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class pl{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gc{constructor(e){this._tr=new Na(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qc{constructor(){this._tap=new hl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,l){if(!this._swipePoint)if(this._tapTime){const c=i[0],m=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(c)<30;m&&y?l.length>0&&(this._swipePoint=c,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,i,l)}touchmove(e,i,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const c=i[0],m=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,i,l)}touchend(e,i,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const c=this._tap.touchend(e,i,l);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ru{constructor(e,i,l){this._el=e,this._mousePan=i,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ml{constructor(e,i,l,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=l,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class su{constructor(e,i,l,c){this._el=e,this._touchZoom=i,this._touchRotate=l,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Qu{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ae.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=i,this._container.appendChild(c);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ae.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new u.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Io=p=>p.zoom||p.drag||p.roll||p.pitch||p.rotate;class $c extends u.l{}function au(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta||p.rollDelta}class Xs{constructor(e,i){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,m)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},T={},E={};for(const{handlerName:R,handler:U,allowed:Z}of this._handlers){if(!U.isEnabled())continue;let te;if(this._blockedByActive(E,Z,R))U.reset();else if(U[m||c.type]){if(u.co(c,m||c.type)){const ee=ae.mousePos(this._map.getCanvas(),c);te=U[m||c.type](c,ee)}else if(u.cp(c,m||c.type)){const ee=this._getMapTouches(c.touches),ie=ae.touchPos(this._map.getCanvas(),ee);te=U[m||c.type](c,ie,ee)}else u.cq(m||c.type)||(te=U[m||c.type](c));this.mergeHandlerResult(b,T,te,R,y),te&&te.needsRenderFrame&&this._triggerRenderFrame()}(te||U.isActive())&&(E[R]=U)}const C={};for(const R in this._previousActiveHandlers)E[R]||(C[R]=y);this._previousActiveHandlers=E,(Object.keys(C).length||au(b))&&(this._changes.push([b,T,C]),this._triggerRenderFrame()),(Object.keys(E).length||au(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=b;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xu(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,m,y]of this._listeners)ae.addEventListener(c,m,c===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,i,l]of this._listeners)ae.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const i=this._map,l=i.getCanvasContainer();this._add("mapEvent",new Yu(i,e));const c=i.boxZoom=new Jl(i,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const m=i.cooperativeGestures=new Qu(i,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const y=new dl(i),b=new Gc(i);i.doubleClickZoom=new pl(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const T=new qc;this._add("tapDragZoom",T);const E=i.touchPitch=new tu(i);this._add("touchPitch",E),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const C=()=>i.project(i.getCenter()),z=function({enable:oe,clickTolerance:ge,aroundCenter:ye=!0,minPixelCenterThreshold:ue=100,rotateDegreesPerPixelMoved:Se=.8},Fe){const Re=new Jn({checkCorrectEvent:De=>ae.mouseButton(De)===0&&De.ctrlKey||ae.mouseButton(De)===2&&!De.ctrlKey});return new Oa({clickTolerance:ge,move:(De,Be)=>{const at=Fe();if(ye&&Math.abs(at.y-De.y)>ue)return{bearingDelta:u.cm(new u.P(De.x,Be.y),Be,at)};let it=(Be.x-De.x)*Se;return ye&&Be.y<at.y&&(it=-it),{bearingDelta:it}},moveStateManager:Re,enable:oe,assignEvents:fl})}(e,C),R=function({enable:oe,clickTolerance:ge,pitchDegreesPerPixelMoved:ye=-.5}){const ue=new Jn({checkCorrectEvent:Se=>ae.mouseButton(Se)===0&&Se.ctrlKey||ae.mouseButton(Se)===2});return new Oa({clickTolerance:ge,move:(Se,Fe)=>({pitchDelta:(Fe.y-Se.y)*ye}),moveStateManager:ue,enable:oe,assignEvents:fl})}(e),U=function({enable:oe,clickTolerance:ge,rollDegreesPerPixelMoved:ye=.3},ue){const Se=new Jn({checkCorrectEvent:Fe=>ae.mouseButton(Fe)===2&&Fe.ctrlKey});return new Oa({clickTolerance:ge,move:(Fe,Re)=>{const De=ue();let Be=(Re.x-Fe.x)*ye;return Re.y<De.y&&(Be=-Be),{rollDelta:Be}},moveStateManager:Se,enable:oe,assignEvents:fl})}(e,C);i.dragRotate=new ml(e,z,R,U),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",U,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const Z=function({enable:oe,clickTolerance:ge}){const ye=new Jn({checkCorrectEvent:ue=>ae.mouseButton(ue)===0&&!ue.ctrlKey});return new Oa({clickTolerance:ge,move:(ue,Se)=>({around:Se,panDelta:Se.sub(ue)}),activateOnStart:!0,moveStateManager:ye,enable:oe,assignEvents:fl})}(e),te=new Vc(e,i);i.dragPan=new ru(l,Z,te),this._add("mousePan",Z),this._add("touchPan",te,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const ee=new eu,ie=new us;i.touchZoomRotate=new su(l,ie,ee,T),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const se=i.scrollZoom=new Ju(i,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const fe=i.keyboard=new ja(i);this._add("keyboard",fe),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new Hu(i))}_add(e,i,l){this._handlers.push({handlerName:e,handler:i,allowed:l}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Io(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,l){for(const c in e)if(c!==l&&(!i||i.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const l of e)this._el.contains(l.target)&&i.push(l);return i}mergeHandlerResult(e,i,l,c,m){if(!l)return;u.e(e,l);const y={handlerName:c,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(i.zoom=y),l.panDelta!==void 0&&(i.drag=y),l.rollDelta!==void 0&&(i.roll=y),l.pitchDelta!==void 0&&(i.pitch=y),l.bearingDelta!==void 0&&(i.rotate=y)}_applyChanges(){const e={},i={},l={};for(const[c,m,y]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),u.e(i,m),u.e(l,y);this._updateMapTransform(e,i,l),this._changes=[]}_updateMapTransform(e,i,l){const c=this._map,m=c._getTransformForUpdate(),y=c.terrain;if(!(au(e)||y&&this._terrainMovement))return this._fireEvents(i,l,!0);c._stop(!0);let{panDelta:b,zoomDelta:T,bearingDelta:E,pitchDelta:C,rollDelta:z,around:R,pinchAround:U}=e;U!==void 0&&(R=U),R=R||c.transform.centerPoint,y&&!m.isPointOnMapSurface(R)&&(R=m.centerPoint);const Z={panDelta:b,zoomDelta:T,rollDelta:z,pitchDelta:C,bearingDelta:E,around:R};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(R)&&(R=m.centerPoint);const te=R.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(b?R.sub(b):R);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,m),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(b))):this._map.cameraHelper.handleMapControlsPan(Z,m,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Z,m,te))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,m),this._map.cameraHelper.handleMapControlsPan(Z,m,te)),c._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,l,!0)}_fireEvents(e,i,l){const c=Io(this._eventsInProgress),m=Io(e),y={};for(const z in e){const{originalEvent:R}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=R),this._eventsInProgress[z]=e[z]}!c&&m&&this._fireEvent("movestart",m.originalEvent);for(const z in y)this._fireEvent(z,y[z]);m&&this._fireEvent("move",m.originalEvent);for(const z in e){const{originalEvent:R}=e[z];this._fireEvent(z,R)}const b={};let T;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:U}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],T=i[R]||U,b[`${z}end`]=T)}for(const z in b)this._fireEvent(z,b[z]);const E=Io(this._eventsInProgress),C=(c||m)&&!E;if(C&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(z)}if(l&&C){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!z||!z.essential&&we.prefersReducedMotion?(this._map.fire(new u.l("moveend",{originalEvent:T})),R(this._map.getBearing())&&this._map.resetNorth()):(R(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new u.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new $c("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Fi extends u.E{constructor(e,i,l){super(),this._renderFrameCallback=()=>{const c=Math.min((we.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new u.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,l){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},i),l)}panTo(e,i,l){return this.easeTo(u.e({center:e},i),l)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,l){return this.easeTo(u.e({zoom:e},i),l)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new u.l("movestart",i)).fire(new u.l("move",i)).fire(new u.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,l){return this.easeTo(u.e({bearing:e},i),l)}resetNorth(e,i){return this.rotateTo(0,u.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=ci.convert(e).adjustAntiMeridian();const l=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,i)}_cameraForBoxAndBearing(e,i,l,c){const m={top:0,bottom:0,right:0,left:0};if(typeof(c=u.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const E=c.padding;c.padding={top:E,bottom:E,right:E,left:E}}const y=u.e(m,c.padding);c.padding=y;const b=this.transform,T=new ci(e,i);return this.cameraHelper.cameraForBoxAndBearing(c,y,T,l,b)}fitBounds(e,i,l){return this._fitInternal(this.cameraForBounds(e,i),i,l)}fitScreenCoordinates(e,i,l,c,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(e)),this.transform.screenPointToLocation(u.P.convert(i)),l,c),c,m)}_fitInternal(e,i,l){return e?(delete(i=u.e(e,i)).padding,i.linear?this.easeTo(i,l):this.flyTo(i,l)):this}jumpTo(e,i){this.stop();const l=this._getTransformForUpdate();let c=!1,m=!1,y=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==b;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(c=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(m=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new u.l("movestart",i)).fire(new u.l("move",i)),T&&this.fire(new u.l("zoomstart",i)).fire(new u.l("zoom",i)).fire(new u.l("zoomend",i)),c&&this.fire(new u.l("rotatestart",i)).fire(new u.l("rotate",i)).fire(new u.l("rotateend",i)),m&&this.fire(new u.l("pitchstart",i)).fire(new u.l("pitch",i)).fire(new u.l("pitchend",i)),y&&this.fire(new u.l("rollstart",i)).fire(new u.l("roll",i)).fire(new u.l("rollend",i)),this.fire(new u.l("moveend",i))}calculateCameraOptionsFromTo(e,i,l,c=0){const m=u.a0.fromLngLat(e,i),y=u.a0.fromLngLat(l,c),b=y.x-m.x,T=y.y-m.y,E=y.z-m.z,C=Math.hypot(b,T,E);if(C===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(b,T),R=u.aj(this.transform.cameraToCenterDistance/C/this.transform.tileSize),U=180*Math.atan2(b,-T)/Math.PI;let Z=180*Math.acos(z/C)/Math.PI;return Z=E<0?90-Z:90+Z,{center:y.toLngLat(),elevation:c,zoom:R,pitch:Z,bearing:U}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,l,c,m){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,i,l,c);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:c,roll:m}}easeTo(e,i){this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.cn},e)).animate===!1||!e.essential&&we.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),c=this.getBearing(),m=l.pitch,y=l.roll,b="bearing"in e?this._normalizeBearing(e.bearing,c):c,T="pitch"in e?+e.pitch:m,E="roll"in e?this._normalizeBearing(e.roll,y):y,C="padding"in e?e.padding:l.padding,z=u.P.convert(e.offset);let R,U;e.around&&(R=u.S.convert(e.around),U=l.locationToScreenPoint(R));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},te=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:T,roll:E,padding:C,around:R,aroundPoint:U,offsetAsPoint:z,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==b,this._pitching=this._pitching||T!==m,this._rolling=this._rolling||E!==y,this._padding=!l.isPaddingEqual(C),this._zooming=this._zooming||te.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,Z),this.terrain&&this._prepareElevation(te.elevationCenter),this._ease(ee=>{te.easeFunc(ee),this.terrain&&!e.freezeElevation&&this._updateElevation(ee),this._applyUpdatedTransform(l),this._fireMoveEvents(i)},ee=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,ee)},e),this}_prepareEase(e,i,l={}){this._moving=!0,i||l.moving||this.fire(new u.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new u.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new u.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new u.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new u.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(i-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(u.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),l=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(l<c){const m=this.calculateCameraOptionsFromTo(i,c,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&i.push(c=>this.transformCameraUpdate(c)),!i.length)return;const l=e.clone();for(const c of i){const m=l.clone(),{center:y,zoom:b,roll:T,pitch:E,bearing:C,elevation:z}=c(m);y&&m.setCenter(y),z!==void 0&&m.setElevation(z),b!==void 0&&m.setZoom(b),T!==void 0&&m.setRoll(T),E!==void 0&&m.setPitch(E),C!==void 0&&m.setBearing(C),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new u.l("move",e)),this._zooming&&this.fire(new u.l("zoom",e)),this._rotating&&this.fire(new u.l("rotate",e)),this._pitching&&this.fire(new u.l("pitch",e)),this._rolling&&this.fire(new u.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const l=this._zooming,c=this._rotating,m=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new u.l("zoomend",e)),c&&this.fire(new u.l("rotateend",e)),m&&this.fire(new u.l("pitchend",e)),y&&this.fire(new u.l("rollend",e)),this.fire(new u.l("moveend",e))}flyTo(e,i){if(!e.essential&&we.prefersReducedMotion){const Be=u.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Be,i)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.cn},e);const l=this._getTransformForUpdate(),c=l.bearing,m=l.pitch,y=l.roll,b=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,c):c,E="pitch"in e?+e.pitch:m,C="roll"in e?this._normalizeBearing(e.roll,y):y,z="padding"in e?e.padding:l.padding,R=u.P.convert(e.offset);let U=l.centerPoint.add(R);const Z=l.screenPointToLocation(U),te=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:E,roll:C,padding:z,locationAtOffset:Z,offsetAsPoint:R,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ee=e.curve;const ie=Math.max(l.width,l.height),se=ie/te.scaleOfZoom,fe=te.pixelPathLength;typeof te.scaleOfMinZoom=="number"&&(ee=Math.sqrt(ie/te.scaleOfMinZoom/fe*2));const oe=ee*ee;function ge(Be){const at=(se*se-ie*ie+(Be?-1:1)*oe*oe*fe*fe)/(2*(Be?se:ie)*oe*fe);return Math.log(Math.sqrt(at*at+1)-at)}function ye(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function ue(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const Se=ge(!1);let Fe=function(Be){return ue(Se)/ue(Se+ee*Be)},Re=function(Be){return ie*((ue(Se)*(ye(at=Se+ee*Be)/ue(at))-ye(Se))/oe)/fe;var at},De=(ge(!0)-Se)/ee;if(Math.abs(fe)<2e-6||!isFinite(De)){if(Math.abs(ie-se)<1e-6)return this.easeTo(e,i);const Be=se<ie?-1:1;De=Math.abs(Math.log(se/ie))/ee,Re=()=>0,Fe=at=>Math.exp(Be*ee*at)}return e.duration="duration"in e?+e.duration:1e3*De/("screenSpeed"in e?+e.screenSpeed/ee:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==T,this._pitching=E!==m,this._rolling=C!==y,this._padding=!l.isPaddingEqual(z),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(te.targetCenter),this._ease(Be=>{const at=Be*De,it=1/Fe(at),Ye=Re(at);this._rotating&&l.setBearing(u.C.number(c,T,Be)),this._pitching&&l.setPitch(u.C.number(m,E,Be)),this._rolling&&l.setRoll(u.C.number(y,C,Be)),this._padding&&(l.interpolatePadding(b,z,Be),U=l.centerPoint.add(R)),te.easeFunc(Be,it,Ye,U),this.terrain&&!e.freezeElevation&&this._updateElevation(Be),this._applyUpdatedTransform(l),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,i)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,i,l){l.animate===!1||l.duration===0?(e(1),i()):(this._easeStart=we.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=u.aN(e,-180,180);const l=Math.abs(e-i);return Math.abs(e-360-i)<l&&(e-=360),Math.abs(e+360-i)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.S.convert(e),this.transform.tileZoom):null}}const So={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class gl{constructor(e=So){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ae.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ae.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ae.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ae.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const l=this._map._getUIString(`AttributionControl.${i}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const i=this._map.style.sourceCaches;for(const c in i){const m=i[c];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,m)=>c.length-m.length),e=e.filter((c,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(c)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=ae.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ou{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ae.create("div","maplibregl-ctrl");const i=ae.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ae.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ec{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,l=i?this._queue.concat(i):this._queue;for(const c of l)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const l of i)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var tc=u.aI([{name:"a_pos3d",type:"Int16",components:3}]);class Zc extends u.E{constructor(e){super(),this._lastTilesetChange=we.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const l={};for(const c of Ue(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),u.bX(c.terrainRttPosMatrix32f,0,u.$,u.$,0,0,1),this._tiles[c.key]=new At(c,this.tileSize),this._lastTilesetChange=we.now());for(const c in this._tiles)l[c]||delete this._tiles[c]}freeRtt(e){for(const i in this._tiles){const l=this._tiles[i];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const l of this._renderableTilesKeys){const c=this._tiles[l].tileID,m=e.clone(),y=u.b9();if(c.canonical.equals(e.canonical))u.bX(y,0,u.$,u.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){const b=c.canonical.z-e.canonical.z,T=c.canonical.x-(c.canonical.x>>b<<b),E=c.canonical.y-(c.canonical.y>>b<<b),C=u.$>>b;u.bX(y,0,C,C,0,0,1),u.M(y,y,[-T*C,-E*C,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{const b=e.canonical.z-c.canonical.z,T=e.canonical.x-(e.canonical.x>>b<<b),E=e.canonical.y-(e.canonical.y>>b<<b),C=u.$>>b;u.bX(y,0,u.$,u.$,0,0,1),u.M(y,y,[T*C,E*C,0]),u.N(y,y,[1/2**b,1/2**b,0])}}m.terrainRttPosMatrix32f=new Float32Array(y),i[l]=m}return i}_getTerrainCoordsForTileRanges(e,i){const l={};for(const c of this._renderableTilesKeys){const m=this._tiles[c].tileID;if(!this._isWithinTileRanges(m,i))continue;const y=e.clone(),b=u.b9();if(m.canonical.z===e.canonical.z){const T=e.canonical.x-m.canonical.x,E=e.canonical.y-m.canonical.y;u.bX(b,0,u.$,u.$,0,0,1),u.M(b,b,[T*u.$,E*u.$,0])}else if(m.canonical.z>e.canonical.z){const T=m.canonical.z-e.canonical.z,E=m.canonical.x-(m.canonical.x>>T<<T),C=m.canonical.y-(m.canonical.y>>T<<T),z=e.canonical.x-(m.canonical.x>>T),R=e.canonical.y-(m.canonical.y>>T),U=u.$>>T;u.bX(b,0,U,U,0,0,1),u.M(b,b,[-E*U+z*u.$,-C*U+R*u.$,0])}else{const T=e.canonical.z-m.canonical.z,E=e.canonical.x-(e.canonical.x>>T<<T),C=e.canonical.y-(e.canonical.y>>T<<T),z=(e.canonical.x>>T)-m.canonical.x,R=(e.canonical.y>>T)-m.canonical.y,U=u.$<<T;u.bX(b,0,U,U,0,0,1),u.M(b,b,[E*u.$+z*U,C*u.$+R*U,0])}y.terrainRttPosMatrix32f=new Float32Array(b),l[c]=y}return l}getSourceTile(e,i){const l=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>l.maxzoom&&(c=l.maxzoom),c<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&i)for(;c>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(c--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class cs{constructor(e,i,l){this._meshCache={},this.painter=e,this.sourceCache=new Zc(i),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,l,c=u.$){var m;if(!(i>=0&&i<c&&l>=0&&l<c))return 0;const y=this.getTerrainData(e),b=(m=y.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const T=u.cr([],[i/c*u.$,l/c*u.$],y.u_terrain_matrix),E=[T[0]*b.dim,T[1]*b.dim],C=Math.floor(E[0]),z=Math.floor(E[1]),R=E[0]-C,U=E[1]-z;return b.get(C,z)*(1-R)*(1-U)+b.get(C+1,z)*R*(1-U)+b.get(C,z+1)*(1-R)*U+b.get(C+1,z+1)*R*U}getElevationForLngLatZoom(e,i){if(!u.cs(i,e.wrap()))return 0;const{tileID:l,mercatorX:c,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(l,c%u.$,m%u.$,u.$)}getElevation(e,i,l,c=u.$){return this.getDEMElevation(e,i,l,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,m=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new u.T(c,m,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new u.T(c,new u.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.af([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const c=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new u.T(c,i.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),i.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const l=i&&i+i.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const c=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?m=e.canonical.z-c:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),b=e.canonical.y-(e.canonical.y>>m<<m),T=u.ct(new Float64Array(16),[1/(u.$<<m),1/(u.$<<m),0]);u.M(T,T,[y*u.$,b*u.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,l=i.width/devicePixelRatio,c=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new u.T(i.context,{width:l,height:c,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new u.T(i.context,{width:l,height:c,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(l,c,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,l,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)i[y+0]=255&b,i[y+1]=255&m,i[y+2]=b>>8<<4|m>>8,i[y+3]=0;const l=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),c=new u.T(e,l,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),l=this.painter.context,c=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(m,b-y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,i),l.bindFramebuffer.set(null);const T=i[0]+(i[2]>>4<<8),E=i[1]+((15&i[2])<<8),C=this.coordsIndex[255-i[3]],z=C&&this.sourceCache.getTileByID(C);if(!z)return null;const R=this._coordsTextureSize,U=(1<<z.tileID.canonical.z)*R;return new u.a0((z.tileID.canonical.x*R+T)/U+z.tileID.wrap,(z.tileID.canonical.y*R+E)/U,this.getElevation(z.tileID,T,E,R))}depthAtPoint(e){const i=new Uint8Array(4),l=this.painter.context,c=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,i),l.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const l=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,c=l&&e.canonical.y===0,m=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${c?"n":""}_${m?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const b=this.painter.context,T=new u.cu,E=new u.aM,C=this.meshSize,z=u.$/C,R=C*C;for(let ue=0;ue<=C;ue++)for(let Se=0;Se<=C;Se++)T.emplaceBack(Se*z,ue*z,0);for(let ue=0;ue<R;ue+=C+1)for(let Se=0;Se<C;Se++)E.emplaceBack(Se+ue,C+Se+ue+1,C+Se+ue+2),E.emplaceBack(Se+ue,C+Se+ue+2,Se+ue+1);const U=T.length,Z=U+(C+1),te=(C+1)*C,ee=c?u.bg:0,ie=c?0:1,se=m?u.bh:u.$,fe=m?0:1;for(let ue=0;ue<=C;ue++)T.emplaceBack(ue*z,ee,ie);for(let ue=0;ue<=C;ue++)T.emplaceBack(ue*z,se,fe);for(let ue=0;ue<C;ue++)E.emplaceBack(te+ue,Z+ue,Z+ue+1),E.emplaceBack(te+ue,Z+ue+1,te+ue+1),E.emplaceBack(0+ue,U+ue+1,U+ue),E.emplaceBack(0+ue,0+ue+1,U+ue+1);const oe=T.length,ge=oe+2*(C+1);for(const ue of[0,1])for(let Se=0;Se<=C;Se++)for(const Fe of[0,1])T.emplaceBack(ue*u.$,Se*z,Fe);for(let ue=0;ue<2*C;ue+=2)E.emplaceBack(oe+ue,oe+ue+1,oe+ue+3),E.emplaceBack(oe+ue,oe+ue+3,oe+ue+2),E.emplaceBack(ge+ue,ge+ue+3,ge+ue+1),E.emplaceBack(ge+ue,ge+ue+2,ge+ue+3);const ye=new Er(b.createVertexBuffer(T,tc.members),b.createIndexBuffer(E),u.aL.simpleSegment(0,0,T.length,E.length));return this._meshCache[y]=ye,ye}getMeshFrameDelta(e){return 2*Math.PI*u.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var l;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(l=this.getMinMaxElevation(c).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return i&&i.dem&&(l.minElevation=i.dem.min*this.exaggeration,l.maxElevation=i.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,i){const l=u.a0.fromLngLat(e.wrap()),c=(1<<i)*u.$,m=l.x*c,y=l.y*c,b=Math.floor(m/u.$),T=Math.floor(y/u.$);return{tileID:new u.Z(i,0,i,b,T),mercatorX:m,mercatorY:y}}}class _l{constructor(e,i,l){this._context=e,this._size=i,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new u.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(l.texture),{id:e,fbo:i,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const _t={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class zt{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new _l(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(i)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const c=e.sourceCaches[l].getVisibleCoordinates(),m=e.sourceCaches[l].getSource(),y=m instanceof Je?m.terrainTileRanges:null;for(const b of c){const T=this.terrain.sourceCache.getTerrainCoords(b,y);for(const E in T)this._coordsAscending[l][E]||(this._coordsAscending[l][E]=[]),this._coordsAscending[l][E].push(T[E])}}this._coordsAscendingStr={};for(const l of e._order){const c=e._layers[l],m=c.source;if(_t[c.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const y in this._coordsAscending[m])this._coordsAscendingStr[m][y]=this._coordsAscending[m][y].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const c in this._coordsAscendingStr){const m=this._coordsAscendingStr[c][l.tileID.key];m&&m!==l.rttCoords[c]&&(l.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),c=e.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(_t[c]&&(this._prevType&&_t[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(_t[this._prevType]||_t[c]&&y){this._prevType=c;const b=this._stacks.length-1,T=this._stacks[b]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(Yi(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[b]){const z=this.pool.getObjectForId(E.rtt[b].id);if(z.stamp===E.rtt[b].stamp){this.pool.useObject(z);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),E.rtt[b]={id:C.id,stamp:C.stamp},m.context.bindFramebuffer.set(C.fbo.framebuffer),m.context.clear({color:u.be.transparent,stencil:0}),m.currentStencilSource=void 0;for(let z=0;z<T.length;z++){const R=m.style._layers[T[z]],U=R.source?this._coordsAscending[R.source][E.tileID.key]:[E.tileID];m.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),m._renderTileClippingMasks(R,U,!0),m.renderLayer(m,m.style.sourceCaches[R.source],R,U,l),R.source&&(E.rttCoords[R.source]=this._coordsAscendingStr[R.source][E.tileID.key])}}return Yi(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),_t[c]}return!1}}const yl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},lu=Le,Eo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:So,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Qn={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ic{constructor(e,i,l=!1){this.mousedown=m=>{this.startMove(m,ae.mousePos(this.element,m)),ae.addEventListener(window,"mousemove",this.mousemove),ae.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,ae.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHanlder.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ae.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),ae.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ae.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=ae.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const c=new Uc;this._rotatePitchHanlder=new Oa({clickTolerance:3,move:(m,y)=>{const b=i.getBoundingClientRect(),T=new u.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:u.cm(new u.P(m.x,y.y),y,T),pitchDelta:l?-.5*(y.y-m.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,ae.addEventListener(i,"mousedown",this.mousedown),ae.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),ae.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),ae.disableDrag()}move(e,i){const l=this.map,{bearingDelta:c,pitchDelta:m}=this._rotatePitchHanlder.dragMove(e,i)||{};c&&l.setBearing(l.getBearing()+c),m&&l.setPitch(l.getPitch()+m)}off(){const e=this.element;ae.removeEventListener(e,"mousedown",this.mousedown),ae.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ae.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ae.removeEventListener(window,"touchend",this.touchend),ae.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ae.enableDrag(),ae.removeEventListener(window,"mousemove",this.mousemove),ae.removeEventListener(window,"mouseup",this.mouseup),ae.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ae.removeEventListener(window,"touchend",this.touchend)}}let Rn;function nc(p,e,i,l=!1){if(l||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return p==null?void 0:p.wrap();const c=new u.S(p.lng,p.lat);if(p=new u.S(p.lng,p.lat),e){const m=new u.S(p.lng-360,p.lat),y=new u.S(p.lng+360,p.lat),b=i.locationToScreenPoint(p).distSqr(e);i.locationToScreenPoint(m).distSqr(e)<b?p=m:i.locationToScreenPoint(y).distSqr(e)<b&&(p=y)}for(;Math.abs(p.lng-i.center.lng)>180;){const m=i.locationToScreenPoint(p);if(m.x>=0&&m.y>=0&&m.x<=i.width&&m.y<=i.height)break;p.lng>i.center.lng?p.lng-=360:p.lng+=360}return p.lng!==c.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(p))?p:c}const ya={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ui(p,e,i){const l=p.classList;for(const c in ya)l.remove(`maplibregl-${i}-anchor-${c}`);l.add(`maplibregl-${i}-anchor-${e}`)}class Hi extends u.E{constructor(e){if(super(),this._onKeyPress=i=>{const l=i.code,c=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=i=>{const l=i.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=nc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),ae.setTransform(this._element,`${ya[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${c}`),we.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.l("dragstart"))),this.fire(new u.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ae.create("div");const i=ae.createNS("http://www.w3.org/2000/svg","svg"),l=41,c=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${l}px`),i.setAttributeNS(null,"width",`${c}px`),i.setAttributeNS(null,"viewBox",`0 0 ${c} ${l}`);const m=ae.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=ae.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=ae.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ie of T){const se=ae.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ie.rx),se.setAttributeNS(null,"ry",ie.ry),b.appendChild(se)}const E=ae.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const C=ae.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(C);const z=ae.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const R=ae.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(R);const U=ae.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const Z=ae.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=ae.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const ee=ae.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#FFFFFF"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962"),Z.appendChild(te),Z.appendChild(ee),y.appendChild(b),y.appendChild(E),y.appendChild(z),y.appendChild(U),y.appendChild(Z),i.appendChild(y),i.setAttributeNS(null,"height",l*this._scale+"px"),i.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(i),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),Ui(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ae.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,l;const c=(i=this._map)===null||i===void 0?void 0:i.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!c||m){const U=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==U&&(this._element.style.opacity=U))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,b=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-b<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/y.transform.pixelsPerMeter,C=Math.sin(y.getPitch()*Math.PI/180)*E,z=y.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),R=y.transform.lngLatToCameraDepth(this._lngLat,T+C)-z>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ys=0,Hs=!1;const uu={maxWidth:100,unit:"metric"};function vl(p,e,i){const l=i&&i.maxWidth||100,c=p._container.clientHeight/2,m=p._container.clientWidth/2,y=p.unproject([m-l/2,c]),b=p.unproject([m+l/2,c]),T=Math.round(p.project(b).x-p.project(y).x),E=Math.min(l,T,p._container.clientWidth),C=y.distanceTo(b);if(i&&i.unit==="imperial"){const z=3.2808*C;z>5280?va(e,E,z/5280,p._getUIString("ScaleControl.Miles")):va(e,E,z,p._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?va(e,E,C/1852,p._getUIString("ScaleControl.NauticalMiles")):C>=1e3?va(e,E,C/1e3,p._getUIString("ScaleControl.Kilometers")):va(e,E,C,p._getUIString("ScaleControl.Meters"))}function va(p,e,i,l){const c=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E}(b),y*b}(i);p.style.width=e*(c/i)+"px",p.innerHTML=`${c}&nbsp;${l}`}const ko={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},cu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xl(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,p),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-p),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(p,0),right:new u.P(-p,0)}}if(p instanceof u.P||Array.isArray(p)){const e=u.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(p.center||[0,0]),top:u.P.convert(p.top||[0,0]),"top-left":u.P.convert(p["top-left"]||[0,0]),"top-right":u.P.convert(p["top-right"]||[0,0]),bottom:u.P.convert(p.bottom||[0,0]),"bottom-left":u.P.convert(p["bottom-left"]||[0,0]),"bottom-right":u.P.convert(p["bottom-right"]||[0,0]),left:u.P.convert(p.left||[0,0]),right:u.P.convert(p.right||[0,0])}}return xl(new u.P(0,0))}const hu=Le;A.AJAXError=u.cy,A.Event=u.l,A.Evented=u.E,A.LngLat=u.S,A.MercatorCoordinate=u.a0,A.Point=u.P,A.addProtocol=u.cz,A.config=u.a,A.removeProtocol=u.cA,A.AttributionControl=gl,A.BoxZoomHandler=Jl,A.CanvasSource=Rr,A.CooperativeGesturesHandler=Qu,A.DoubleClickZoomHandler=pl,A.DragPanHandler=ru,A.DragRotateHandler=ml,A.EdgeInsets=rr,A.FullscreenControl=class extends u.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ae.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=ae.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ae.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=Hn,A.GeolocateControl=class extends u.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new u.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,c=this._map.getBearing(),m=u.e({bearing:c},this.options.fitBoundsOptions),y=ci.fromLngLat(i,l);this._map.fitBounds(y,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new u.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Hs)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=ae.create("button","maplibregl-ctrl-geolocate",this._container),ae.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ae.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Hi({element:this._dotElement}),this._circleElement=ae.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.l("trackuserlocationend")),this.fire(new u.l("userlocationlostfocus")))})}},this.options=u.e({},rc,p)}onAdd(p){return this._map=p,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(e=!1){if(Rn!==void 0&&!e)return Rn;if(window.navigator.permissions===void 0)return Rn=!!window.navigator.geolocation,Rn;try{Rn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Rn=!!window.navigator.geolocation}return Rn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ae.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ys=0,Hs=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),i=p.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),i=p.getNorthEast(),l=e.distanceTo(i),c=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ys--,Hs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.l("trackuserlocationstart")),this.fire(new u.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ys++,Ys>1?(p={maximumAge:6e5,timeout:0},Hs=!0):(p=this.options.positionOptions,Hs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.GlobeControl=class{constructor(){this._toggleProjection=()=>{var p;const e=(p=this._map.getProjection())===null||p===void 0?void 0:p.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var p;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((p=this._map.getProjection())===null||p===void 0?void 0:p.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(p){return this._map=p,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ae.create("button","maplibregl-ctrl-globe",this._container),ae.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ae.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},A.Hash=vo,A.ImageSource=Je,A.KeyboardHandler=ja,A.LngLatBounds=ci,A.LogoControl=ou,A.Map=class extends Fi{constructor(p){var e,i;u.cv.mark(u.cw.create);const l=Object.assign(Object.assign(Object.assign({},Eo),p),{canvasContextAttributes:Object.assign(Object.assign({},Eo.canvasContextAttributes),p.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new Xi,m=new pi;if(l.minZoom!==void 0&&c.setMinZoom(l.minZoom),l.maxZoom!==void 0&&c.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&c.setMinPitch(l.minPitch),l.maxPitch!==void 0&&c.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&c.setRenderWorldCopies(l.renderWorldCopies),super(c,m,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ec,this._controls=[],this._mapId=u.a6(),this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},yl),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ft.addThrottleControl(()=>this.isMoving()),this._requestManager=new rt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const T=ul(E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())},50);this._resizeObserver=new ResizeObserver(E=>{b?T(E):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Xs(this,l),this._hash=l.hash&&new vo(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,u.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((i=(e=l.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new gl(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new ou,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const b=u.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new u.l(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new u.l(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new u.l("sourcedataabort",b))})}_getMapId(){return this._mapId}setGlobalStateProperty(p,e){return this.style.setGlobalStateProperty(p,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new u.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(i,l.firstChild):l.appendChild(i),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new u.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,i,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,i,l)}resize(p,e=!0){const[i,l]=this._containerDimensions(),c=this._getClampedPixelRatio(i,l);if(this._resizeCanvas(i,l,c),this.painter.resize(i,l,c),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const b=this._getClampedPixelRatio(i,l);this._resizeCanvas(i,l,b),this.painter.resize(i,l,b)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new u.l("movestart",p)).fire(new u.l("move",p))),this.fire(new u.l("resize",p)),m&&this.fire(new u.l("moveend",p)),this}_resizeTransform(p=!0){var e;const[i,l]=this._containerDimensions();this.transform.resize(i,l,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,l,p)}_getClampedPixelRatio(p,e){const{0:i,1:l}=this._maxCanvasSize,c=this.getPixelRatio(),m=p*c,y=e*c;return Math.min(m>i?i/m:1,y>l?l/y:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(ci.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.setMinZoom(p),this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.setMaxZoom(p),this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.setMinPitch(p),this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(p>=this.transform.minPitch)return this.transform.setMaxPitch(p),this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.setRenderWorldCopies(p),this._update()}project(p){return this.transform.locationToScreenPoint(u.S.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.screenPointToLocation(u.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,i){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layers:e,listener:i,delegates:{mousemove:m=>{const y=e.filter(T=>this.getLayer(T)),b=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length?l||(l=!0,i.call(this,new lr(p,this,m.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layers:e,listener:i,delegates:{mousemove:y=>{const b=e.filter(T=>this.getLayer(T));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?l=!0:l&&(l=!1,i.call(this,new lr(p,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,i.call(this,new lr(p,this,y.originalEvent)))}}}}{const l=c=>{const m=e.filter(b=>this.getLayer(b)),y=m.length!==0?this.queryRenderedFeatures(c.point,{layers:m}):[];y.length&&(c.features=y,i.call(this,c),delete c.features)};return{layers:e,listener:i,delegates:{[p]:l}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,i){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const l=this._delegatedListeners[p];for(let c=0;c<l.length;c++){const m=l[c];if(m.listener===i&&m.layers.length===e.length&&m.layers.every(y=>e.includes(y))){for(const y in m.delegates)this.off(y,m.delegates[y]);return void l.splice(c,1)}}}on(p,e,i){if(i===void 0)return super.on(p,e);const l=typeof e=="string"?[e]:e,c=this._createDelegatedListener(p,l,i);this._saveDelegatedListener(p,c);for(const m in c.delegates)this.on(m,c.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(p,l,i)}}}once(p,e,i){if(i===void 0)return super.once(p,e);const l=typeof e=="string"?[e]:e,c=this._createDelegatedListener(p,l,i);for(const m in c.delegates){const y=c.delegates[m];c.delegates[m]=(...b)=>{this._removeDelegatedListener(p,l,i),y(...b)}}this._saveDelegatedListener(p,c);for(const m in c.delegates)this.once(m,c.delegates[m]);return this}off(p,e,i){return i===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let i;const l=p instanceof u.P||Array.isArray(p),c=l?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:p)||{},c instanceof u.P||typeof c[0]=="number")i=[u.P.convert(c)];else{const m=u.P.convert(c[0]),y=u.P.convert(c[1]);i=[m,new u.P(y.x,m.y),y,new u.P(m.x,y.y),m]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){var i,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Ia(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,c):this.style.loadJSON(p,e,c),this):((l=(i=this.style)===null||i===void 0?void 0:i.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ia(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const i=this._requestManager.transformRequest(p,"Style");u.j(i,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new u.k(l))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(i){u.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new u.k(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const l=this.style._layers[i];l.type==="hillshade"&&l.source===p.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===p.source&&u.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new cs(this.painter,e,p),this.painter.renderToTexture=new zt(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var l;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==p.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=i.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.l("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const i=p[e]._tiles;for(const l in i){const c=i[l];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}setSourceTileLodParams(p,e,i){if(i){const l=this.getSource(i);if(!l)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);l.calculateTileZoom=Me(Math.max(1,p),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=Me(Math.max(1,p),Math.max(1,e));return this._update(!0),this}refreshTiles(p,e){const i=this.style.sourceCaches[p];if(!i)throw new Error(`There is no source cache with ID "${p}", cannot refresh tile`);e===void 0?i.reload(!0):i.refreshTiles(e.map(l=>new u.a3(l.z,l.x,l.y)))}addImage(p,e,i={}){const{pixelRatio:l=1,sdf:c=!1,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:E}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:z,data:R}=e,U=e;return this.style.addImage(p,{data:new u.R({width:C,height:z},new Uint8Array(R)),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:E,sdf:c,version:0,userImage:U}),U.onAdd&&U.onAdd(this,p),this}}{const{width:C,height:z,data:R}=we.getImageData(e);this.style.addImage(p,{data:new u.R({width:C,height:z},R),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:E,sdf:c,version:0})}}updateImage(p,e){const i=this.style.getImage(p);if(!i)return this.fire(new u.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||u.b(e)?we.getImageData(e):e,{width:c,height:m,data:y}=l;if(c===void 0||m===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==i.data.width||m!==i.data.height)return this.fire(new u.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||u.b(e));return i.data.replace(y,b),this.style.updateImage(p,i),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new u.k(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return ft.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,i){return this.style.setLayerZoomRange(p,e,i),this._update(!0)}setFilter(p,e,i={}){return this.style.setFilter(p,e,i),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,i,l={}){return this.style.setPaintProperty(p,e,i,l),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,i,l={}){return this.style.setLayoutProperty(p,e,i,l),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,i,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,i=>{i||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(p,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=ae.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ae.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),l=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],l);const c=this._controlContainer=ae.create("div","maplibregl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=ae.create("div",`maplibregl-ctrl-${y} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,i){this._canvas.width=Math.floor(i*p),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:p},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,p):this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p),!i){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Pr(i,this.transform),Te.testSupport(i)}migrateProjection(p,e){super.migrateProjection(p,e),this.painter.transform=p,this.fire(new u.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){var e,i,l,c,m;const y=this._idleTriggered?this._fadeDuration:0,b=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,R=we.now();this.style.zoomHistory.update(z,R);const U=new u.F(z,{now:R,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),Z=U.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(T=!0,this._crossFadingFactor=Z),this.style.update(U)}const E=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new u.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cv.mark(u.cw.load),this.fire(new u.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const C=this._sourcesDirty||this._styleDirty||this._placementDirty;return C||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.l("idle")),!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,u.cv.mark(u.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ft.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ae.remove(this._canvasContainer),ae.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cv.clearMetrics(),this._removed=!0,this.fire(new u.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,we.frame(this._frameRequest,p=>{u.cv.frame(p),this._frameRequest=null;try{this._render(p)}catch(e){if(!u.cx(e)&&!function(i){return i.message===ql}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return lu}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),this.style.setProjection(p),this._update(!0)}},A.MapMouseEvent=lr,A.MapTouchEvent=Vr,A.MapWheelEvent=Kl,A.Marker=Hi,A.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const l=this._map._getUIString(`NavigationControl.${i}`);e.title=l,e.setAttribute("aria-label",l)},this.options=u.e({},Qn,p),this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),ae.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),ae.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=ae.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ic(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ae.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const i=ae.create("button",p,this._container);return i.type="button",i.addEventListener("click",e),i}},A.Popup=class extends u.E{constructor(p){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&ae.remove(this._content),this._container&&(ae.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ae.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ae.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=nc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const c=xl(this.options.offset);if(!l){const y=this._container.offsetWidth,b=this._container.offsetHeight;let T;T=i.y+c.bottom.y<b?["top"]:i.y>this._map.transform.height-b?["bottom"]:[],i.x<y/2?T.push("left"):i.x>this._map.transform.width-y/2&&T.push("right"),l=T.length===0?"bottom":T.join("-")}let m=i.add(c[l]);this.options.subpixelPositioning||(m=m.round()),ae.setTransform(this._container,`${ya[l]} translate(${m.x}px,${m.y}px)`),Ui(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(ko),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=u.S.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),i=document.createElement("body");let l;for(i.innerHTML=p;l=i.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ae.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=ae.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(cu);p&&p.focus()}},A.RasterDEMTileSource=nn,A.RasterTileSource=ps,A.ScaleControl=class{constructor(p){this._onMove=()=>{vl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,vl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},uu),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ae.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=Ju,A.Style=Ia,A.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ae.create("button","maplibregl-ctrl-terrain",this._container),ae.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ae.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=tu,A.TwoFingersTouchRotateHandler=eu,A.TwoFingersTouchZoomHandler=us,A.TwoFingersTouchZoomRotateHandler=su,A.VectorTileSource=tn,A.VideoSource=Kr,A.addSourceType=(p,e)=>u._(void 0,void 0,void 0,function*(){if(ms(p))throw new Error(`A source type called "${p}" already exists.`);((i,l)=>{fr[i]=l})(p,e)}),A.clearPrewarmedResources=function(){const p=yi;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(xt),yi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.createTileMesh=eo,A.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return Mn().getRTLTextPluginStatus()},A.getVersion=function(){return hu},A.getWorkerCount=function(){return bi.workerCount},A.getWorkerUrl=function(){return u.a.WORKER_URL},A.importScriptInWorkers=function(p){return dr().broadcast("IS",p)},A.prewarm=function(){Bi().acquire(xt)},A.setMaxParallelImageRequests=function(p){u.a.MAX_PARALLEL_IMAGE_REQUESTS=p},A.setRTLTextPlugin=function(p,e){return Mn().setRTLTextPlugin(p,e)},A.setWorkerCount=function(p){bi.workerCount=p},A.setWorkerUrl=function(p){u.a.WORKER_URL=p}});var le=$;return le})}(Cc)),Cc.exports}var Og=Ng();const Ar=cp(Og);var Wr=Uint8Array,zl=Uint16Array,Fg=Int32Array,dp=new Wr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fp=new Wr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bg=new Wr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pp=function(D,F){for(var $=new zl(31),N=0;N<31;++N)$[N]=F+=1<<D[N-1];for(var B=new Fg($[30]),N=1;N<30;++N)for(var le=$[N];le<$[N+1];++le)B[le]=le-$[N]<<5|N;return{b:$,r:B}},mp=pp(dp,2),gp=mp.b,jg=mp.r;gp[28]=258,jg[258]=28;var Ug=pp(fp,0),Vg=Ug.b,Uh=new zl(32768);for(var Ki=0;Ki<32768;++Ki){var Xa=(Ki&43690)>>1|(Ki&21845)<<1;Xa=(Xa&52428)>>2|(Xa&13107)<<2,Xa=(Xa&61680)>>4|(Xa&3855)<<4,Uh[Ki]=((Xa&65280)>>8|(Xa&255)<<8)>>1}var Du=function(D,F,$){for(var N=D.length,B=0,le=new zl(F);B<N;++B)D[B]&&++le[D[B]-1];var A=new zl(F);for(B=1;B<F;++B)A[B]=A[B-1]+le[B-1]<<1;var u;if($){u=new zl(1<<F);var Le=15-F;for(B=0;B<N;++B)if(D[B])for(var Ae=B<<4|D[B],_e=F-D[B],de=A[D[B]-1]++<<_e,we=de|(1<<_e)-1;de<=we;++de)u[Uh[de]>>Le]=Ae}else for(u=new zl(N),B=0;B<N;++B)D[B]&&(u[B]=Uh[A[D[B]-1]++]>>15-D[B]);return u},Ou=new Wr(288);for(var Ki=0;Ki<144;++Ki)Ou[Ki]=8;for(var Ki=144;Ki<256;++Ki)Ou[Ki]=9;for(var Ki=256;Ki<280;++Ki)Ou[Ki]=7;for(var Ki=280;Ki<288;++Ki)Ou[Ki]=8;var _p=new Wr(32);for(var Ki=0;Ki<32;++Ki)_p[Ki]=5;var Gg=Du(Ou,9,1),qg=Du(_p,5,1),Oh=function(D){for(var F=D[0],$=1;$<D.length;++$)D[$]>F&&(F=D[$]);return F},Os=function(D,F,$){var N=F/8|0;return(D[N]|D[N+1]<<8)>>(F&7)&$},Fh=function(D,F){var $=F/8|0;return(D[$]|D[$+1]<<8|D[$+2]<<16)>>(F&7)},$g=function(D){return(D+7)/8|0},Zg=function(D,F,$){return($==null||$>D.length)&&($=D.length),new Wr(D.subarray(F,$))},Xg=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hr=function(D,F,$){var N=new Error(F||Xg[D]);if(N.code=D,Error.captureStackTrace&&Error.captureStackTrace(N,Hr),!$)throw N;return N},Hh=function(D,F,$,N){var B=D.length,le=0;if(!B||F.f&&!F.l)return $||new Wr(0);var A=!$,u=A||F.i!=2,Le=F.i;A&&($=new Wr(B*3));var Ae=function(yt){var me=$.length;if(yt>me){var ci=new Wr(Math.max(me*2,yt));ci.set($),$=ci}},_e=F.f||0,de=F.p||0,we=F.b||0,ae=F.l,Te=F.d,ot=F.m,pt=F.n,Ct=B*8;do{if(!ae){_e=Os(D,de,1);var vt=Os(D,de+1,3);if(de+=3,vt)if(vt==1)ae=Gg,Te=qg,ot=9,pt=5;else if(vt==2){var lt=Os(D,de,31)+257,wt=Os(D,de+10,15)+4,Ft=lt+Os(D,de+5,31)+1;de+=14;for(var It=new Wr(Ft),oi=new Wr(19),Xt=0;Xt<wt;++Xt)oi[Bg[Xt]]=Os(D,de+Xt*3,7);de+=wt*3;for(var ri=Oh(oi),li=(1<<ri)-1,ut=Du(oi,ri,1),Xt=0;Xt<Ft;){var Bt=ut[Os(D,de,li)];de+=Bt&15;var nt=Bt>>4;if(nt<16)It[Xt++]=nt;else{var Ht=0,ui=0;for(nt==16?(ui=3+Os(D,de,3),de+=2,Ht=It[Xt-1]):nt==17?(ui=3+Os(D,de,7),de+=3):nt==18&&(ui=11+Os(D,de,127),de+=7);ui--;)It[Xt++]=Ht}}var Li=It.subarray(0,lt),gi=It.subarray(lt);ot=Oh(Li),pt=Oh(gi),ae=Du(Li,ot,1),Te=Du(gi,pt,1)}else Hr(1);else{var nt=$g(de)+4,ft=D[nt-4]|D[nt-3]<<8,rt=nt+ft;if(rt>B){Le&&Hr(0);break}u&&Ae(we+ft),$.set(D.subarray(nt,rt),we),F.b=we+=ft,F.p=de=rt*8,F.f=_e;continue}if(de>Ct){Le&&Hr(0);break}}u&&Ae(we+131072);for(var xt=(1<<ot)-1,bi=(1<<pt)-1,jt=de;;jt=de){var Ht=ae[Fh(D,de)&xt],yi=Ht>>4;if(de+=Ht&15,de>Ct){Le&&Hr(0);break}if(Ht||Hr(2),yi<256)$[we++]=yi;else if(yi==256){jt=de,ae=null;break}else{var Ot=yi-254;if(yi>264){var Xt=yi-257,Bi=dp[Xt];Ot=Os(D,de,(1<<Bi)-1)+gp[Xt],de+=Bi}var hr=Te[Fh(D,de)&bi],dr=hr>>4;hr||Hr(3),de+=hr&15;var gi=Vg[dr];if(dr>3){var Bi=fp[dr];gi+=Fh(D,de)&(1<<Bi)-1,de+=Bi}if(de>Ct){Le&&Hr(0);break}u&&Ae(we+131072);var ze=we+Ot;if(we<gi){var ji=le-gi,vi=Math.min(gi,ze);for(ji+we<0&&Hr(3);we<vi;++we)$[we]=N[ji+we]}for(;we<ze;++we)$[we]=$[we-gi]}}F.l=ae,F.p=jt,F.b=we,F.f=_e,ae&&(_e=1,F.m=ot,F.d=Te,F.n=pt)}while(!_e);return we!=$.length&&A?Zg($,0,we):$.subarray(0,we)},Yg=new Wr(0),Hg=function(D){(D[0]!=31||D[1]!=139||D[2]!=8)&&Hr(6,"invalid gzip data");var F=D[3],$=10;F&4&&($+=(D[10]|D[11]<<8)+2);for(var N=(F>>3&1)+(F>>4&1);N>0;N-=!D[$++]);return $+(F&2)},Wg=function(D){var F=D.length;return(D[F-4]|D[F-3]<<8|D[F-2]<<16|D[F-1]<<24)>>>0},Kg=function(D,F){return((D[0]&15)!=8||D[0]>>4>7||(D[0]<<8|D[1])%31)&&Hr(6,"invalid zlib data"),(D[1]>>5&1)==1&&Hr(6,"invalid zlib data: "+(D[1]&32?"need":"unexpected")+" dictionary"),(D[1]>>3&4)+2};function Jg(D,F){return Hh(D,{i:2},F,F)}function Qg(D,F){var $=Hg(D);return $+8>D.length&&Hr(6,"invalid gzip data"),Hh(D.subarray($,-8),{i:2},new Wr(Wg(D)),F)}function e_(D,F){return Hh(D.subarray(Kg(D),-4),{i:2},F,F)}function t_(D,F){return D[0]==31&&D[1]==139&&D[2]==8?Qg(D,F):(D[0]&15)!=8||D[0]>>4>7||(D[0]<<8|D[1])%31?Jg(D,F):e_(D,F)}var i_=typeof TextDecoder<"u"&&new TextDecoder,n_=0;try{i_.decode(Yg,{stream:!0}),n_=1}catch{}var r_=Object.defineProperty,zu=Math.pow,Oi=(D,F)=>r_(D,"name",{value:F,configurable:!0}),Zn=(D,F,$)=>new Promise((N,B)=>{var le=Le=>{try{u($.next(Le))}catch(Ae){B(Ae)}},A=Le=>{try{u($.throw(Le))}catch(Ae){B(Ae)}},u=Le=>Le.done?N(Le.value):Promise.resolve(Le.value).then(le,A);u(($=$.apply(D,F)).next())});Oi((D,F)=>{let $=!1,N="",B=L.GridLayer.extend({createTile:Oi((le,A)=>{let u=document.createElement("img"),Le=new AbortController,Ae=Le.signal;return u.cancel=()=>{Le.abort()},$||(D.getHeader().then(_e=>{_e.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):_e.tileType===2?N="image/png":_e.tileType===3?N="image/jpeg":_e.tileType===4?N="image/webp":_e.tileType===5&&(N="image/avif")}),$=!0),D.getZxy(le.z,le.x,le.y,Ae).then(_e=>{if(_e){let de=new Blob([_e.data],{type:N}),we=window.URL.createObjectURL(de);u.src=we,u.cancel=void 0,A(void 0,u)}}).catch(_e=>{if(_e.name!=="AbortError")throw _e}),u},"createTile"),_removeTile:Oi(function(le){let A=this._tiles[le];A&&(A.el.cancel&&A.el.cancel(),A.el.width=0,A.el.height=0,A.el.deleted=!0,L.DomUtil.remove(A.el),delete this._tiles[le],this.fire("tileunload",{tile:A.el,coords:this._keyToTileCoords(le)}))},"_removeTile")});return new B(F)},"leafletRasterLayer");var s_=Oi(D=>(F,$)=>{if($ instanceof AbortController)return D(F,$);let N=new AbortController;return D(F,N).then(B=>$(void 0,B.data,B.cacheControl||"",B.expires||""),B=>$(B)).catch(B=>$(B)),{cancel:Oi(()=>N.abort(),"cancel")}},"v3compat"),yp=class{constructor(F){this.tilev4=Oi(($,N)=>Zn(this,null,function*(){if($.type==="json"){let ae=$.url.substr(10),Te=this.tiles.get(ae);if(Te||(Te=new Gf(ae),this.tiles.set(ae,Te)),this.metadata)return{data:yield Te.getTileJson($.url)};let ot=yield Te.getHeader();return(ot.minLon>=ot.maxLon||ot.minLat>=ot.maxLat)&&console.error(`Bounds of PMTiles archive ${ot.minLon},${ot.minLat},${ot.maxLon},${ot.maxLat} are not valid.`),{data:{tiles:[`${$.url}/{z}/{x}/{y}`],minzoom:ot.minZoom,maxzoom:ot.maxZoom,bounds:[ot.minLon,ot.minLat,ot.maxLon,ot.maxLat]}}}let B=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),le=$.url.match(B);if(!le)throw new Error("Invalid PMTiles protocol URL");let A=le[1],u=this.tiles.get(A);u||(u=new Gf(A),this.tiles.set(A,u));let Le=le[2],Ae=le[3],_e=le[4],de=yield u.getHeader(),we=yield u==null?void 0:u.getZxy(+Le,+Ae,+_e,N.signal);if(we)return{data:new Uint8Array(we.data),cacheControl:we.cacheControl,expires:we.expires};if(de.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=s_(this.tilev4),this.tiles=new Map,this.metadata=(F==null?void 0:F.metadata)||!1,this.errorOnMissingTile=(F==null?void 0:F.errorOnMissingTile)||!1}add(F){this.tiles.set(F.source.getKey(),F)}get(F){return this.tiles.get(F)}};Oi(yp,"Protocol");var a_=yp;function vp(D,F){return(F>>>0)*4294967296+(D>>>0)}Oi(vp,"toNum");function xp(D,F){let $=F.buf,N=$[F.pos++],B=(N&112)>>4;if(N<128||(N=$[F.pos++],B|=(N&127)<<3,N<128)||(N=$[F.pos++],B|=(N&127)<<10,N<128)||(N=$[F.pos++],B|=(N&127)<<17,N<128)||(N=$[F.pos++],B|=(N&127)<<24,N<128)||(N=$[F.pos++],B|=(N&1)<<31,N<128))return vp(D,B);throw new Error("Expected varint not more than 10 bytes")}Oi(xp,"readVarintRemainder");function Dl(D){let F=D.buf,$=F[D.pos++],N=$&127;return $<128||($=F[D.pos++],N|=($&127)<<7,$<128)||($=F[D.pos++],N|=($&127)<<14,$<128)||($=F[D.pos++],N|=($&127)<<21,$<128)?N:($=F[D.pos],N|=($&15)<<28,xp(N,D))}Oi(Dl,"readVarint");function Wh(D,F,$,N){if(N===0){$===1&&(F[0]=D-1-F[0],F[1]=D-1-F[1]);let B=F[0];F[0]=F[1],F[1]=B}}Oi(Wh,"rotate");function bp(D,F){let $=zu(2,D),N=F,B=F,le=F,A=[0,0],u=1;for(;u<$;)N=1&le/2,B=1&(le^N),Wh(u,A,N,B),A[0]+=u*N,A[1]+=u*B,le=le/4,u*=2;return[D,A[0],A[1]]}Oi(bp,"idOnLevel");var o_=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function wp(D,F,$){if(D>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(F>zu(2,D)-1||$>zu(2,D)-1)throw new Error("tile x/y outside zoom level bounds");let N=o_[D],B=zu(2,D),le=0,A=0,u=0,Le=[F,$],Ae=B/2;for(;Ae>0;)le=(Le[0]&Ae)>0?1:0,A=(Le[1]&Ae)>0?1:0,u+=Ae*Ae*(3*le^A),Wh(Ae,Le,le,A),Ae=Ae/2;return N+u}Oi(wp,"zxyToTileId");function l_(D){let F=0;for(let $=0;$<27;$++){let N=(1<<$)*(1<<$);if(F+N>D)return bp($,D-F);F+=N}throw new Error("Tile zoom level exceeds max safe number limit (26)")}Oi(l_,"tileIdToZxy");var u_=(D=>(D[D.Unknown=0]="Unknown",D[D.None=1]="None",D[D.Gzip=2]="Gzip",D[D.Brotli=3]="Brotli",D[D.Zstd=4]="Zstd",D))(u_||{});function Oc(D,F){return Zn(this,null,function*(){if(F===1||F===0)return D;if(F===2){if(typeof globalThis.DecompressionStream>"u")return t_(new Uint8Array(D));let $=new Response(D).body;if(!$)throw new Error("Failed to read response stream");let N=$.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(N).arrayBuffer()}throw new Error("Compression method not supported")})}Oi(Oc,"defaultDecompress");var c_=(D=>(D[D.Unknown=0]="Unknown",D[D.Mvt=1]="Mvt",D[D.Png=2]="Png",D[D.Jpeg=3]="Jpeg",D[D.Webp=4]="Webp",D[D.Avif=5]="Avif",D))(c_||{});function Tp(D){return D===1?".mvt":D===2?".png":D===3?".jpg":D===4?".webp":D===5?".avif":""}Oi(Tp,"tileTypeExt");var h_=127;function Ip(D,F){let $=0,N=D.length-1;for(;$<=N;){let B=N+$>>1,le=F-D[B].tileId;if(le>0)$=B+1;else if(le<0)N=B-1;else return D[B]}return N>=0&&(D[N].runLength===0||F-D[N].tileId<D[N].runLength)?D[N]:null}Oi(Ip,"findTile");var d_=class{constructor(F){this.file=F}getKey(){return this.file.name}getBytes(F,$){return Zn(this,null,function*(){return{data:yield this.file.slice(F,F+$).arrayBuffer()}})}};Oi(d_,"FileSource");var Sp=class{constructor(F,$=new Headers){this.url=F,this.customHeaders=$,this.mustReload=!1;let N="";"navigator"in globalThis&&(N=globalThis.navigator.userAgent||"");let B=N.indexOf("Windows")>-1,le=/Chrome|Chromium|Edg|OPR|Brave/.test(N);this.chromeWindowsNoCache=!1,B&&le&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(F){this.customHeaders=F}getBytes(F,$,N,B){return Zn(this,null,function*(){let le,A;N?A=N:(le=new AbortController,A=le.signal);let u=new Headers(this.customHeaders);u.set("range",`bytes=${F}-${F+$-1}`);let Le;this.mustReload?Le="reload":this.chromeWindowsNoCache&&(Le="no-store");let Ae=yield fetch(this.url,{signal:A,cache:Le,headers:u});if(F===0&&Ae.status===416){let we=Ae.headers.get("Content-Range");if(!we||!we.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let ae=+we.substr(8);Ae=yield fetch(this.url,{signal:A,cache:"reload",headers:{range:`bytes=0-${ae-1}`}})}let _e=Ae.headers.get("Etag");if(_e!=null&&_e.startsWith("W/")&&(_e=null),Ae.status===416||B&&_e&&_e!==B)throw this.mustReload=!0,new Vh(`Server returned non-matching ETag ${B} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(Ae.status>=300)throw new Error(`Bad response code: ${Ae.status}`);let de=Ae.headers.get("Content-Length");if(Ae.status===200&&(!de||+de>$))throw le&&le.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield Ae.arrayBuffer(),etag:_e||void 0,cacheControl:Ae.headers.get("Cache-Control")||void 0,expires:Ae.headers.get("Expires")||void 0}})}};Oi(Sp,"FetchSource");var f_=Sp;function ds(D,F){let $=D.getUint32(F+4,!0),N=D.getUint32(F+0,!0);return $*zu(2,32)+N}Oi(ds,"getUint64");function Ep(D,F){let $=new DataView(D),N=$.getUint8(7);if(N>3)throw new Error(`Archive is spec version ${N} but this library supports up to spec version 3`);return{specVersion:N,rootDirectoryOffset:ds($,8),rootDirectoryLength:ds($,16),jsonMetadataOffset:ds($,24),jsonMetadataLength:ds($,32),leafDirectoryOffset:ds($,40),leafDirectoryLength:ds($,48),tileDataOffset:ds($,56),tileDataLength:ds($,64),numAddressedTiles:ds($,72),numTileEntries:ds($,80),numTileContents:ds($,88),clustered:$.getUint8(96)===1,internalCompression:$.getUint8(97),tileCompression:$.getUint8(98),tileType:$.getUint8(99),minZoom:$.getUint8(100),maxZoom:$.getUint8(101),minLon:$.getInt32(102,!0)/1e7,minLat:$.getInt32(106,!0)/1e7,maxLon:$.getInt32(110,!0)/1e7,maxLat:$.getInt32(114,!0)/1e7,centerZoom:$.getUint8(118),centerLon:$.getInt32(119,!0)/1e7,centerLat:$.getInt32(123,!0)/1e7,etag:F}}Oi(Ep,"bytesToHeader");function Kh(D){let F={buf:new Uint8Array(D),pos:0},$=Dl(F),N=[],B=0;for(let le=0;le<$;le++){let A=Dl(F);N.push({tileId:B+A,offset:0,length:0,runLength:1}),B+=A}for(let le=0;le<$;le++)N[le].runLength=Dl(F);for(let le=0;le<$;le++)N[le].length=Dl(F);for(let le=0;le<$;le++){let A=Dl(F);A===0&&le>0?N[le].offset=N[le-1].offset+N[le-1].length:N[le].offset=A-1}return N}Oi(Kh,"deserializeIndex");var kp=class extends Error{};Oi(kp,"EtagMismatch");var Vh=kp;function Jh(D,F){return Zn(this,null,function*(){let $=yield D.getBytes(0,16384);if(new DataView($.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let N=$.data.slice(0,h_),B=Ep(N,$.etag),le=$.data.slice(B.rootDirectoryOffset,B.rootDirectoryOffset+B.rootDirectoryLength),A=`${D.getKey()}|${B.etag||""}|${B.rootDirectoryOffset}|${B.rootDirectoryLength}`,u=Kh(yield F(le,B.internalCompression));return[B,[A,u.length,u]]})}Oi(Jh,"getHeaderAndRoot");function Qh(D,F,$,N,B){return Zn(this,null,function*(){let le=yield D.getBytes($,N,void 0,B.etag),A=yield F(le.data,B.internalCompression),u=Kh(A);if(u.length===0)throw new Error("Empty directory is invalid");return u})}Oi(Qh,"getDirectory");var p_=class{constructor(F=100,$=!0,N=Oc){this.cache=new Map,this.maxCacheEntries=F,this.counter=1,this.decompress=N}getHeader(F){return Zn(this,null,function*(){let $=F.getKey(),N=this.cache.get($);if(N)return N.lastUsed=this.counter++,N.data;let B=yield Jh(F,this.decompress);return B[1]&&this.cache.set(B[1][0],{lastUsed:this.counter++,data:B[1][2]}),this.cache.set($,{lastUsed:this.counter++,data:B[0]}),this.prune(),B[0]})}getDirectory(F,$,N,B){return Zn(this,null,function*(){let le=`${F.getKey()}|${B.etag||""}|${$}|${N}`,A=this.cache.get(le);if(A)return A.lastUsed=this.counter++,A.data;let u=yield Qh(F,this.decompress,$,N,B);return this.cache.set(le,{lastUsed:this.counter++,data:u}),this.prune(),u})}prune(){if(this.cache.size>this.maxCacheEntries){let F=1/0,$;this.cache.forEach((N,B)=>{N.lastUsed<F&&(F=N.lastUsed,$=B)}),$&&this.cache.delete($)}}invalidate(F){return Zn(this,null,function*(){this.cache.delete(F.getKey())})}};Oi(p_,"ResolvedValueCache");var Cp=class{constructor(F=100,$=!0,N=Oc){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=F,this.counter=1,this.decompress=N}getHeader(F){return Zn(this,null,function*(){let $=F.getKey(),N=this.cache.get($);if(N)return N.lastUsed=this.counter++,yield N.data;let B=new Promise((le,A)=>{Jh(F,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),le(u[0]),this.prune()}).catch(u=>{A(u)})});return this.cache.set($,{lastUsed:this.counter++,data:B}),B})}getDirectory(F,$,N,B){return Zn(this,null,function*(){let le=`${F.getKey()}|${B.etag||""}|${$}|${N}`,A=this.cache.get(le);if(A)return A.lastUsed=this.counter++,yield A.data;let u=new Promise((Le,Ae)=>{Qh(F,this.decompress,$,N,B).then(_e=>{Le(_e),this.prune()}).catch(_e=>{Ae(_e)})});return this.cache.set(le,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let F=1/0,$;this.cache.forEach((N,B)=>{N.lastUsed<F&&(F=N.lastUsed,$=B)}),$&&this.cache.delete($)}}invalidate(F){return Zn(this,null,function*(){let $=F.getKey();if(this.invalidations.get($))return yield this.invalidations.get($);this.cache.delete(F.getKey());let N=new Promise((B,le)=>{this.getHeader(F).then(A=>{B(),this.invalidations.delete($)}).catch(A=>{le(A)})});this.invalidations.set($,N)})}};Oi(Cp,"SharedPromiseCache");var m_=Cp,Pp=class{constructor(F,$,N){typeof F=="string"?this.source=new f_(F):this.source=F,N?this.decompress=N:this.decompress=Oc,$?this.cache=$:this.cache=new m_}getHeader(){return Zn(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(F,$,N,B){return Zn(this,null,function*(){let le=wp(F,$,N),A=yield this.cache.getHeader(this.source);if(F<A.minZoom||F>A.maxZoom)return;let u=A.rootDirectoryOffset,Le=A.rootDirectoryLength;for(let Ae=0;Ae<=3;Ae++){let _e=yield this.cache.getDirectory(this.source,u,Le,A),de=Ip(_e,le);if(de){if(de.runLength>0){let we=yield this.source.getBytes(A.tileDataOffset+de.offset,de.length,B,A.etag);return{data:yield this.decompress(we.data,A.tileCompression),cacheControl:we.cacheControl,expires:we.expires}}u=A.leafDirectoryOffset+de.offset,Le=de.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(F,$,N,B){return Zn(this,null,function*(){try{return yield this.getZxyAttempt(F,$,N,B)}catch(le){if(le instanceof Vh)return this.cache.invalidate(this.source),yield this.getZxyAttempt(F,$,N,B);throw le}})}getMetadataAttempt(){return Zn(this,null,function*(){let F=yield this.cache.getHeader(this.source),$=yield this.source.getBytes(F.jsonMetadataOffset,F.jsonMetadataLength,void 0,F.etag),N=yield this.decompress($.data,F.internalCompression),B=new TextDecoder("utf-8");return JSON.parse(B.decode(N))})}getMetadata(){return Zn(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(F){if(F instanceof Vh)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw F}})}getTileJson(F){return Zn(this,null,function*(){let $=yield this.getHeader(),N=yield this.getMetadata(),B=Tp($.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${F}/{z}/{x}/{y}${B}`],vector_layers:N.vector_layers,attribution:N.attribution,description:N.description,name:N.name,version:N.version,bounds:[$.minLon,$.minLat,$.maxLon,$.maxLat],center:[$.centerLon,$.centerLat,$.centerZoom],minzoom:$.minZoom,maxzoom:$.maxZoom}})}};Oi(Pp,"PMTiles");var Gf=Pp,Lr=63710088e-1,Mp={centimeters:Lr*100,centimetres:Lr*100,degrees:360/(2*Math.PI),feet:Lr*3.28084,inches:Lr*39.37,kilometers:Lr/1e3,kilometres:Lr/1e3,meters:Lr,metres:Lr,miles:Lr/1609.344,millimeters:Lr*1e3,millimetres:Lr*1e3,nauticalmiles:Lr/1852,radians:1,yards:Lr*1.0936};function ed(D,F,$={}){const N={type:"Feature"};return($.id===0||$.id)&&(N.id=$.id),$.bbox&&(N.bbox=$.bbox),N.properties=F||{},N.geometry=D,N}function Ap(D,F,$={}){if(!D)throw new Error("coordinates is required");if(!Array.isArray(D))throw new Error("coordinates must be an Array");if(D.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qf(D[0])||!qf(D[1]))throw new Error("coordinates must contain numbers");return ed({type:"Point",coordinates:D},F,$)}function g_(D,F,$={}){for(const B of D){if(B.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(B[B.length-1].length!==B[0].length)throw new Error("First and last Position are not equivalent.");for(let le=0;le<B[B.length-1].length;le++)if(B[B.length-1][le]!==B[0][le])throw new Error("First and last Position are not equivalent.")}return ed({type:"Polygon",coordinates:D},F,$)}function Gh(D,F={}){const $={type:"FeatureCollection"};return F.id&&($.id=F.id),F.bbox&&($.bbox=F.bbox),$.features=D,$}function __(D,F="kilometers"){const $=Mp[F];if(!$)throw new Error(F+" units is invalid");return D*$}function y_(D,F="kilometers"){const $=Mp[F];if(!$)throw new Error(F+" units is invalid");return D/$}function qf(D){return!isNaN(D)&&D!==null&&!Array.isArray(D)}function Lp(D,F,$){if(D!==null)for(var N,B,le,A,u,Le,Ae,_e=0,de=0,we,ae=D.type,Te=ae==="FeatureCollection",ot=ae==="Feature",pt=Te?D.features.length:1,Ct=0;Ct<pt;Ct++){Ae=Te?D.features[Ct].geometry:ot?D.geometry:D,we=Ae?Ae.type==="GeometryCollection":!1,u=we?Ae.geometries.length:1;for(var vt=0;vt<u;vt++){var nt=0,ft=0;if(A=we?Ae.geometries[vt]:Ae,A!==null){Le=A.coordinates;var rt=A.type;switch(_e=0,rt){case null:break;case"Point":if(F(Le,de,Ct,nt,ft)===!1)return!1;de++,nt++;break;case"LineString":case"MultiPoint":for(N=0;N<Le.length;N++){if(F(Le[N],de,Ct,nt,ft)===!1)return!1;de++,rt==="MultiPoint"&&nt++}rt==="LineString"&&nt++;break;case"Polygon":case"MultiLineString":for(N=0;N<Le.length;N++){for(B=0;B<Le[N].length-_e;B++){if(F(Le[N][B],de,Ct,nt,ft)===!1)return!1;de++}rt==="MultiLineString"&&nt++,rt==="Polygon"&&ft++}rt==="Polygon"&&nt++;break;case"MultiPolygon":for(N=0;N<Le.length;N++){for(ft=0,B=0;B<Le[N].length;B++){for(le=0;le<Le[N][B].length-_e;le++){if(F(Le[N][B][le],de,Ct,nt,ft)===!1)return!1;de++}ft++}nt++}break;case"GeometryCollection":for(N=0;N<A.geometries.length;N++)if(Lp(A.geometries[N],F)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $f(D,F){if(D.type==="Feature")F(D,0);else if(D.type==="FeatureCollection")for(var $=0;$<D.features.length&&F(D.features[$],$)!==!1;$++);}function Rp(D,F){var $,N,B,le,A,u,Le,Ae,_e,de,we=0,ae=D.type==="FeatureCollection",Te=D.type==="Feature",ot=ae?D.features.length:1;for($=0;$<ot;$++){for(u=ae?D.features[$].geometry:Te?D.geometry:D,Ae=ae?D.features[$].properties:Te?D.properties:{},_e=ae?D.features[$].bbox:Te?D.bbox:void 0,de=ae?D.features[$].id:Te?D.id:void 0,Le=u?u.type==="GeometryCollection":!1,A=Le?u.geometries.length:1,B=0;B<A;B++){if(le=Le?u.geometries[B]:u,le===null){if(F(null,we,Ae,_e,de)===!1)return!1;continue}switch(le.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(F(le,we,Ae,_e,de)===!1)return!1;break}case"GeometryCollection":{for(N=0;N<le.geometries.length;N++)if(F(le.geometries[N],we,Ae,_e,de)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}we++}}function Dp(D,F={}){if(D.bbox!=null&&F.recompute!==!0)return D.bbox;const $=[1/0,1/0,-1/0,-1/0];return Lp(D,N=>{$[0]>N[0]&&($[0]=N[0]),$[1]>N[1]&&($[1]=N[1]),$[2]<N[0]&&($[2]=N[0]),$[3]<N[1]&&($[3]=N[1])}),$}function v_(D,F={}){const $=Number(D[0]),N=Number(D[1]),B=Number(D[2]),le=Number(D[3]);if(D.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const A=[$,N];return g_([[A,[B,N],[B,le],[$,le],A]],F.properties,{bbox:D,id:F.id})}function x_(D,F={}){const $=Dp(D),N=($[0]+$[2])/2,B=($[1]+$[3])/2;return Ap([N,B],F.properties,F)}var Pc={exports:{}},b_=Pc.exports,Zf;function w_(){return Zf||(Zf=1,function(D,F){(function($,N){D.exports=N()})(b_,function(){function $(f,s){(s==null||s>f.length)&&(s=f.length);for(var a=0,d=Array(s);a<s;a++)d[a]=f[a];return d}function N(f,s,a){return s=_e(s),function(d,v){if(v&&(typeof v=="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}(d)}(f,we()?Reflect.construct(s,a||[],_e(f).constructor):s.apply(f,a))}function B(f,s){if(!(f instanceof s))throw new TypeError("Cannot call a class as a function")}function le(f,s,a){if(we())return Reflect.construct.apply(null,arguments);var d=[null];d.push.apply(d,s);var v=new(f.bind.apply(f,d));return a&&ae(v,a.prototype),v}function A(f,s){for(var a=0;a<s.length;a++){var d=s[a];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(f,pt(d.key),d)}}function u(f,s,a){return s&&A(f.prototype,s),a&&A(f,a),Object.defineProperty(f,"prototype",{writable:!1}),f}function Le(f,s){var a=typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(!a){if(Array.isArray(f)||(a=Ct(f))||s){a&&(f=a);var d=0,v=function(){};return{s:v,n:function(){return d>=f.length?{done:!0}:{done:!1,value:f[d++]}},e:function(K){throw K},f:v}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I,P=!0,O=!1;return{s:function(){a=a.call(f)},n:function(){var K=a.next();return P=K.done,K},e:function(K){O=!0,I=K},f:function(){try{P||a.return==null||a.return()}finally{if(O)throw I}}}}function Ae(){return Ae=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(f,s,a){var d=function(I,P){for(;!{}.hasOwnProperty.call(I,P)&&(I=_e(I))!==null;);return I}(f,s);if(d){var v=Object.getOwnPropertyDescriptor(d,s);return v.get?v.get.call(arguments.length<3?f:a):v.value}},Ae.apply(null,arguments)}function _e(f){return _e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},_e(f)}function de(f,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(s&&s.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),s&&ae(f,s)}function we(){try{var f=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(we=function(){return!!f})()}function ae(f,s){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,d){return a.__proto__=d,a},ae(f,s)}function Te(f,s,a,d){var v=Ae(_e(1&d?f.prototype:f),s,a);return 2&d&&typeof v=="function"?function(I){return v.apply(a,I)}:v}function ot(f){return function(s){if(Array.isArray(s))return $(s)}(f)||function(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}(f)||Ct(f)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function pt(f){var s=function(a,d){if(typeof a!="object"||!a)return a;var v=a[Symbol.toPrimitive];if(v!==void 0){var I=v.call(a,d);if(typeof I!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(f,"string");return typeof s=="symbol"?s:s+""}function Ct(f,s){if(f){if(typeof f=="string")return $(f,s);var a={}.toString.call(f).slice(8,-1);return a==="Object"&&f.constructor&&(a=f.constructor.name),a==="Map"||a==="Set"?Array.from(f):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?$(f,s):void 0}}function vt(f){var s=typeof Map=="function"?new Map:void 0;return vt=function(a){if(a===null||!function(v){try{return Function.toString.call(v).indexOf("[native code]")!==-1}catch{return typeof v=="function"}}(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(a))return s.get(a);s.set(a,d)}function d(){return le(a,arguments,_e(this).constructor)}return d.prototype=Object.create(a.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),ae(d,a)},vt(f)}var nt=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(s){this._quadrantSegments=s,this._quadrantSegments===0&&(this._joinStyle=f.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=f.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),s<=0&&(this._quadrantSegments=1),this._joinStyle!==f.JOIN_ROUND&&(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(s){this._joinStyle=s}},{key:"setSimplifyFactor",value:function(s){this._simplifyFactor=s<0?0:s}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(s){this._endCapStyle=s}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(s){this._mitreLimit=s}},{key:"setSingleSided",value:function(s){this._isSingleSided=s}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=f.CAP_ROUND,this._joinStyle=f.JOIN_ROUND,this._mitreLimit=f.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=f.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.setQuadrantSegments(s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.setQuadrantSegments(a),this.setEndCapStyle(d)}else if(arguments.length===4){var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3];this.setQuadrantSegments(v),this.setEndCapStyle(I),this.setJoinStyle(P),this.setMitreLimit(O)}}}},{key:"bufferDistanceError",value:function(s){var a=Math.PI/2/s;return 1-Math.cos(a/2)}}])}();nt.CAP_ROUND=1,nt.CAP_FLAT=2,nt.CAP_SQUARE=3,nt.JOIN_ROUND=1,nt.JOIN_MITRE=2,nt.JOIN_BEVEL=3,nt.DEFAULT_QUADRANT_SEGMENTS=8,nt.DEFAULT_MITRE_LIMIT=5,nt.DEFAULT_SIMPLIFY_FACTOR=.01;var ft=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({Exception:s})[0],d}return de(s,f),u(s,[{key:"toString",value:function(){return this.message}}])}(vt(Error)),rt=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({IllegalArgumentException:s})[0],d}return de(s,f),u(s)}(ft),lt=function(){return u(function f(){B(this,f)},[{key:"filter",value:function(f){}}])}();function wt(){}function Ft(){}function It(){}var oi,Xt,ri,li,ut,Bt,Ht,ui,Li=function(){return u(function f(){B(this,f)},null,[{key:"equalsWithTolerance",value:function(f,s,a){return Math.abs(f-s)<=a}}])}(),gi=function(){return u(function f(s,a){B(this,f),this.low=a||0,this.high=s||0},null,[{key:"toBinaryString",value:function(f){var s,a="";for(s=2147483648;s>0;s>>>=1)a+=(f.high&s)===s?"1":"0";for(s=2147483648;s>0;s>>>=1)a+=(f.low&s)===s?"1":"0";return a}}])}();function xt(){}function bi(){}xt.NaN=NaN,xt.isNaN=function(f){return Number.isNaN(f)},xt.isInfinite=function(f){return!Number.isFinite(f)},xt.MAX_VALUE=Number.MAX_VALUE,xt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,xt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(Bt=2146435072,Ht=new Float64Array(1),ui=new Int32Array(Ht.buffer),xt.doubleToLongBits=function(f){Ht[0]=f;var s=0|ui[0],a=0|ui[1];return(a&Bt)===Bt&&1048575&a&&s!==0&&(s=0,a=2146959360),new gi(a,s)},xt.longBitsToDouble=function(f){return ui[0]=f.low,ui[1]=f.high,Ht[0]}):(oi=1023,Xt=Math.log2,ri=Math.floor,li=Math.pow,ut=function(){for(var f=53;f>0;f--){var s=li(2,f)-1;if(ri(Xt(s))+1===f)return s}return 0}(),xt.doubleToLongBits=function(f){var s,a,d,v,I,P,O,K,re;if(f<0||1/f===Number.NEGATIVE_INFINITY?(P=1<<31,f=-f):P=0,f===0)return new gi(K=P,re=0);if(f===1/0)return new gi(K=2146435072|P,re=0);if(f!=f)return new gi(K=2146959360,re=0);if(v=0,re=0,(s=ri(f))>1)if(s<=ut)(v=ri(Xt(s)))<=20?(re=0,K=s<<20-v&1048575):(re=s%(a=li(2,d=v-20))<<32-d,K=s/a&1048575);else for(d=s,re=0;(d=ri(a=d/2))!==0;)v++,re>>>=1,re|=(1&K)<<31,K>>>=1,a!==d&&(K|=524288);if(O=v+oi,I=s===0,s=f-s,v<52&&s!==0)for(d=0;;){if((a=2*s)>=1?(s=a-1,I?(O--,I=!1):(d<<=1,d|=1,v++)):(s=a,I?--O==0&&(v++,I=!1):(d<<=1,v++)),v===20)K|=d,d=0;else if(v===52){re|=d;break}if(a===1){v<20?K|=d<<20-v:v<52&&(re|=d<<52-v);break}}return K|=O<<20,new gi(K|=P,re)},xt.longBitsToDouble=function(f){var s,a,d,v,I=f.high,P=f.low,O=I&1<<31?-1:1;for(d=((2146435072&I)>>20)-oi,v=0,a=1<<19,s=1;s<=20;s++)I&a&&(v+=li(2,-s)),a>>>=1;for(a=1<<31,s=21;s<=52;s++)P&a&&(v+=li(2,-s)),a>>>=1;if(d===-1023){if(v===0)return 0*O;d=-1022}else{if(d===1024)return v===0?O/0:NaN;v+=1}return O*v*li(2,d)});var jt=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({RuntimeException:s})[0],d}return de(s,f),u(s)}(ft),yi=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,null,[{key:"constructor_",value:function(){if(arguments.length===0)jt.constructor_.call(this);else if(arguments.length===1){var a=arguments[0];jt.constructor_.call(this,a)}}}])}(jt),Ot=function(){function f(){B(this,f)}return u(f,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)f.shouldNeverReachHere(null);else if(arguments.length===1){var s=arguments[0];throw new yi("Should never reach here"+(s!==null?": "+s:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var s=arguments[0];f.isTrue(s,null)}else if(arguments.length===2){var a=arguments[1];if(!arguments[0])throw a===null?new yi:new yi(a)}}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];f.equals(s,a,null)}else if(arguments.length===3){var d=arguments[0],v=arguments[1],I=arguments[2];if(!v.equals(d))throw new yi("Expected "+d+" but encountered "+v+(I!==null?": "+I:""))}}}])}(),Bi=new ArrayBuffer(8),hr=new Float64Array(Bi),dr=new Int32Array(Bi),ze=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getM",value:function(){return xt.NaN}},{key:"setOrdinate",value:function(s,a){switch(s){case f.X:this.x=a;break;case f.Y:this.y=a;break;case f.Z:this.setZ(a);break;default:throw new rt("Invalid ordinate index: "+s)}}},{key:"equals2D",value:function(){if(arguments.length===1){var s=arguments[0];return this.x===s.x&&this.y===s.y}if(arguments.length===2){var a=arguments[0],d=arguments[1];return!!Li.equalsWithTolerance(this.x,a.x,d)&&!!Li.equalsWithTolerance(this.y,a.y,d)}}},{key:"setM",value:function(s){throw new rt("Invalid ordinate index: "+f.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(s){switch(s){case f.X:return this.x;case f.Y:return this.y;case f.Z:return this.getZ()}throw new rt("Invalid ordinate index: "+s)}},{key:"equals3D",value:function(s){return this.x===s.x&&this.y===s.y&&(this.getZ()===s.getZ()||xt.isNaN(this.getZ())&&xt.isNaN(s.getZ()))}},{key:"equals",value:function(s){return s instanceof f&&this.equals2D(s)}},{key:"equalInZ",value:function(s,a){return Li.equalsWithTolerance(this.getZ(),s.getZ(),a)}},{key:"setX",value:function(s){this.x=s}},{key:"compareTo",value:function(s){var a=s;return this.x<a.x?-1:this.x>a.x?1:this.y<a.y?-1:this.y>a.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(s){this.z=s}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return Ot.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw s}}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(s){var a=this.x-s.x,d=this.y-s.y,v=this.getZ()-s.getZ();return Math.sqrt(a*a+d*d+v*v)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(s){this.y=s}},{key:"distance",value:function(s){var a=this.x-s.x,d=this.y-s.y;return Math.sqrt(a*a+d*d)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*s+f.hashCode(this.x))+f.hashCode(this.y)}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}},{key:"interfaces_",get:function(){return[wt,Ft,It]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)f.constructor_.call(this,0,0);else if(arguments.length===1){var s=arguments[0];f.constructor_.call(this,s.x,s.y,s.getZ())}else if(arguments.length===2){var a=arguments[0],d=arguments[1];f.constructor_.call(this,a,d,f.NULL_ORDINATE)}else if(arguments.length===3){var v=arguments[0],I=arguments[1],P=arguments[2];this.x=v,this.y=I,this.z=P}}},{key:"hashCode",value:function(s){return hr[0]=s,dr[0]^dr[1]}}])}(),ji=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"compare",value:function(s,a){var d=f.compare(s.x,a.x);if(d!==0)return d;var v=f.compare(s.y,a.y);return v!==0?v:this._dimensionsToTest<=2?0:f.compare(s.getZ(),a.getZ())}},{key:"interfaces_",get:function(){return[bi]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)f.constructor_.call(this,2);else if(arguments.length===1){var s=arguments[0];if(s!==2&&s!==3)throw new rt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=s}}},{key:"compare",value:function(s,a){return s<a?-1:s>a?1:xt.isNaN(s)?xt.isNaN(a)?0:-1:xt.isNaN(a)?1:0}}])}();ze.DimensionalComparator=ji,ze.NULL_ORDINATE=xt.NaN,ze.X=0,ze.Y=1,ze.Z=2,ze.M=3;var vi=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(s){if(!(s instanceof f))return!1;var a=s;return this.isNull()?a.isNull():this._maxx===a.getMaxX()&&this._maxy===a.getMaxY()&&this._minx===a.getMinX()&&this._miny===a.getMinY()}},{key:"intersection",value:function(s){if(this.isNull()||s.isNull()||!this.intersects(s))return new f;var a=this._minx>s._minx?this._minx:s._minx,d=this._miny>s._miny?this._miny:s._miny;return new f(a,this._maxx<s._maxx?this._maxx:s._maxx,d,this._maxy<s._maxy?this._maxy:s._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof ze){var s=arguments[0];return this.covers(s.x,s.y)}if(arguments[0]instanceof f){var a=arguments[0];return!this.isNull()&&!a.isNull()&&a.getMinX()>=this._minx&&a.getMaxX()<=this._maxx&&a.getMinY()>=this._miny&&a.getMaxY()<=this._maxy}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];return!this.isNull()&&d>=this._minx&&d<=this._maxx&&v>=this._miny&&v<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var s=arguments[0];return!this.isNull()&&!s.isNull()&&!(s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny)}if(arguments[0]instanceof ze){var a=arguments[0];return this.intersects(a.x,a.y)}}else if(arguments.length===2){if(arguments[0]instanceof ze&&arguments[1]instanceof ze){var d=arguments[0],v=arguments[1];return!this.isNull()&&!((d.x<v.x?d.x:v.x)>this._maxx)&&!((d.x>v.x?d.x:v.x)<this._minx)&&!((d.y<v.y?d.y:v.y)>this._maxy)&&!((d.y>v.y?d.y:v.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var I=arguments[0],P=arguments[1];return!this.isNull()&&!(I>this._maxx||I<this._minx||P>this._maxy||P<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var s=this.getWidth(),a=this.getHeight();return Math.sqrt(s*s+a*a)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof ze){var s=arguments[0];this.expandToInclude(s.x,s.y)}else if(arguments[0]instanceof f){var a=arguments[0];if(a.isNull())return null;this.isNull()?(this._minx=a.getMinX(),this._maxx=a.getMaxX(),this._miny=a.getMinY(),this._maxy=a.getMaxY()):(a._minx<this._minx&&(this._minx=a._minx),a._maxx>this._maxx&&(this._maxx=a._maxx),a._miny<this._miny&&(this._miny=a._miny),a._maxy>this._maxy&&(this._maxy=a._maxy))}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this.isNull()?(this._minx=d,this._maxx=d,this._miny=v,this._maxy=v):(d<this._minx&&(this._minx=d),d>this._maxx&&(this._maxx=d),v<this._miny&&(this._miny=v),v>this._maxy&&(this._maxy=v))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),a=this.getHeight();return s<a?s:a}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(s){var a=s;return this.isNull()?a.isNull()?0:-1:a.isNull()?1:this._minx<a._minx?-1:this._minx>a._minx?1:this._miny<a._miny?-1:this._miny>a._miny?1:this._maxx<a._maxx?-1:this._maxx>a._maxx?1:this._maxy<a._maxy?-1:this._maxy>a._maxy?1:0}},{key:"translate",value:function(s,a){if(this.isNull())return null;this.init(this.getMinX()+s,this.getMaxX()+s,this.getMinY()+a,this.getMaxY()+a)}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(s){return!(!this.isNull()&&!s.isNull())||s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),a=this.getHeight();return s>a?s:a}},{key:"expandBy",value:function(){if(arguments.length===1){var s=arguments[0];this.expandBy(s,s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];if(this.isNull())return null;this._minx-=a,this._maxx+=a,this._miny-=d,this._maxy+=d,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var s=arguments[0];return this.covers(s)}if(arguments[0]instanceof ze){var a=arguments[0];return this.covers(a)}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];return this.covers(d,v)}}},{key:"centre",value:function(){return this.isNull()?null:new ze((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof ze){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof f){var a=arguments[0];this._minx=a._minx,this._maxx=a._maxx,this._miny=a._miny,this._maxy=a._maxy}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this.init(d.x,v.x,d.y,v.y)}else if(arguments.length===4){var I=arguments[0],P=arguments[1],O=arguments[2],K=arguments[3];I<P?(this._minx=I,this._maxx=P):(this._minx=P,this._maxx=I),O<K?(this._miny=O,this._maxy=K):(this._miny=K,this._maxy=O)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(s){if(this.intersects(s))return 0;var a=0;this._maxx<s._minx?a=s._minx-this._maxx:this._minx>s._maxx&&(a=this._minx-s._maxx);var d=0;return this._maxy<s._miny?d=s._miny-this._maxy:this._miny>s._maxy&&(d=this._miny-s._maxy),a===0?d:d===0?a:Math.sqrt(a*a+d*d)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*(s=37*(s=37*s+ze.hashCode(this._minx))+ze.hashCode(this._maxx))+ze.hashCode(this._miny))+ze.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[wt,It]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof ze){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof f){var a=arguments[0];this.init(a)}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this.init(d.x,v.x,d.y,v.y)}else if(arguments.length===4){var I=arguments[0],P=arguments[1],O=arguments[2],K=arguments[3];this.init(I,P,O,K)}}},{key:"intersects",value:function(){if(arguments.length===3){var s=arguments[0],a=arguments[1],d=arguments[2];return d.x>=(s.x<a.x?s.x:a.x)&&d.x<=(s.x>a.x?s.x:a.x)&&d.y>=(s.y<a.y?s.y:a.y)&&d.y<=(s.y>a.y?s.y:a.y)}if(arguments.length===4){var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3],K=Math.min(P.x,O.x),re=Math.max(P.x,O.x),Ce=Math.min(v.x,I.x),Oe=Math.max(v.x,I.x);return!(Ce>re)&&!(Oe<K)&&(K=Math.min(P.y,O.y),re=Math.max(P.y,O.y),Ce=Math.min(v.y,I.y),Oe=Math.max(v.y,I.y),!(Ce>re)&&!(Oe<K))}}}])}(),yt=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(s){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(s){return this===s||this.equalsExact(s,0)}},{key:"geometryChanged",value:function(){this.apply(f.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(s){return s!==null&&this.norm().equalsExact(s.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var s;if(arguments.length===1){var a=arguments[0];return s=a,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(a)}if(arguments.length===2){var d=arguments[0],v=arguments[1];return s=d,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(d,v)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(s){if(s.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION)throw new rt("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(s,a,d){return d===0?s.equals(a):s.distance(a)<=d}},{key:"norm",value:function(){var s=this.copy();return s.normalize(),s}},{key:"reverse",value:function(){var s=this.reverseInternal();return this.envelope!=null&&(s.envelope=this.envelope.copy()),s.setSRID(this.getSRID()),s}},{key:"copy",value:function(){var s=this.copyInternal();return s.envelope=this._envelope==null?null:this._envelope.copy(),s._SRID=this._SRID,s._userData=this._userData,s}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new vi(this._envelope)}},{key:"setSRID",value:function(s){this._SRID=s}},{key:"setUserData",value:function(s){this._userData=s}},{key:"compare",value:function(s,a){for(var d=s.iterator(),v=a.iterator();d.hasNext()&&v.hasNext();){var I=d.next(),P=v.next(),O=I.compareTo(P);if(O!==0)return O}return d.hasNext()?1:v.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(s){return this.getClass()===s.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===f.TYPECODE_MULTIPOINT||this.getTypeCode()===f.TYPECODE_MULTILINESTRING||this.getTypeCode()===f.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Ft,wt,It]}},{key:"getClass",value:function(){return f}}],[{key:"hasNonEmptyElements",value:function(s){for(var a=0;a<s.length;a++)if(!s[a].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(s){for(var a=0;a<s.length;a++)if(s[a]===null)return!0;return!1}}])}();yt.constructor_=function(f){f&&(this._envelope=null,this._userData=null,this._factory=f,this._SRID=f.getSRID())},yt.TYPECODE_POINT=0,yt.TYPECODE_MULTIPOINT=1,yt.TYPECODE_LINESTRING=2,yt.TYPECODE_LINEARRING=3,yt.TYPECODE_MULTILINESTRING=4,yt.TYPECODE_POLYGON=5,yt.TYPECODE_MULTIPOLYGON=6,yt.TYPECODE_GEOMETRYCOLLECTION=7,yt.TYPENAME_POINT="Point",yt.TYPENAME_MULTIPOINT="MultiPoint",yt.TYPENAME_LINESTRING="LineString",yt.TYPENAME_LINEARRING="LinearRing",yt.TYPENAME_MULTILINESTRING="MultiLineString",yt.TYPENAME_POLYGON="Polygon",yt.TYPENAME_MULTIPOLYGON="MultiPolygon",yt.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",yt.geometryChangedFilter={get interfaces_(){return[lt]},filter:function(f){f.geometryChangedAction()}};var me=function(){function f(){B(this,f)}return u(f,null,[{key:"toLocationSymbol",value:function(s){switch(s){case f.EXTERIOR:return"e";case f.BOUNDARY:return"b";case f.INTERIOR:return"i";case f.NONE:return"-"}throw new rt("Unknown location value: "+s)}}])}();me.INTERIOR=0,me.BOUNDARY=1,me.EXTERIOR=2,me.NONE=-1;var ci=function(){return u(function f(){B(this,f)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),Yn=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({NoSuchElementException:s})[0],d}return de(s,f),u(s)}(ft),tn=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({UnsupportedOperationException:s})[0],d}return de(s,f),u(s)}(ft),ps=function(f){function s(){return B(this,s),N(this,s,arguments)}return de(s,f),u(s,[{key:"contains",value:function(){}}])}(ci),nn=function(f){function s(a){var d;return B(this,s),(d=N(this,s)).map=new Map,a instanceof ci&&d.addAll(a),d}return de(s,f),u(s,[{key:"contains",value:function(a){var d=a.hashCode?a.hashCode():a;return!!this.map.has(d)}},{key:"add",value:function(a){var d=a.hashCode?a.hashCode():a;return!this.map.has(d)&&!!this.map.set(d,a)}},{key:"addAll",value:function(a){var d,v=Le(a);try{for(v.s();!(d=v.n()).done;){var I=d.value;this.add(I)}}catch(P){v.e(P)}finally{v.f()}return!0}},{key:"remove",value:function(){throw new tn}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Hn(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(ps),Hn=function(){return u(function f(s){B(this,f),this.iterator=s.values();var a=this.iterator.next(),d=a.done,v=a.value;this.done=d,this.value=v},[{key:"next",value:function(){if(this.done)throw new Yn;var f=this.value,s=this.iterator.next(),a=s.done,d=s.value;return this.done=a,this.value=d,f}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new tn}}])}(),Je=function(){function f(){B(this,f)}return u(f,null,[{key:"opposite",value:function(s){return s===f.LEFT?f.RIGHT:s===f.RIGHT?f.LEFT:s}}])}();Je.ON=0,Je.LEFT=1,Je.RIGHT=2;var Kr=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({EmptyStackException:s})[0],d}return de(s,f),u(s)}(ft),Rr=function(f){function s(a){var d;return B(this,s),(d=N(this,s,[a])).name=Object.keys({IndexOutOfBoundsException:s})[0],d}return de(s,f),u(s)}(ft),fr=function(f){function s(){return B(this,s),N(this,s,arguments)}return de(s,f),u(s,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(ci),ms=function(f){function s(){var a;return B(this,s),(a=N(this,s)).array=[],a}return de(s,f),u(s,[{key:"add",value:function(a){return this.array.push(a),!0}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new Rr;return this.array[a]}},{key:"push",value:function(a){return this.array.push(a),a}},{key:"pop",value:function(){if(this.array.length===0)throw new Kr;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Kr;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(a){return this.array.indexOf(a)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(fr);function Vt(f,s){return f.interfaces_&&f.interfaces_.indexOf(s)>-1}var pr=function(){return u(function f(s){B(this,f),this.str=s},[{key:"append",value:function(f){this.str+=f}},{key:"setCharAt",value:function(f,s){this.str=this.str.substr(0,f)+s+this.str.substr(f+1)}},{key:"toString",value:function(){return this.str}}])}(),ir=function(){function f(s){B(this,f),this.value=s}return u(f,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(s){return this.value<s?-1:this.value>s?1:0}}],[{key:"compare",value:function(s,a){return s<a?-1:s>a?1:0}},{key:"isNan",value:function(s){return Number.isNaN(s)}},{key:"valueOf",value:function(s){return new f(s)}}])}(),Mn=function(){return u(function f(){B(this,f)},null,[{key:"isWhitespace",value:function(f){return f<=32&&f>=0||f===127}},{key:"toUpperCase",value:function(f){return f.toUpperCase()}}])}(),At=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"le",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<=s._lo}},{key:"extractSignificantDigits",value:function(s,a){var d=this.abs(),v=f.magnitude(d._hi),I=f.TEN.pow(v);(d=d.divide(I)).gt(f.TEN)?(d=d.divide(f.TEN),v+=1):d.lt(f.ONE)&&(d=d.multiply(f.TEN),v-=1);for(var P=v+1,O=new pr,K=f.MAX_PRINT_DIGITS-1,re=0;re<=K;re++){s&&re===P&&O.append(".");var Ce=Math.trunc(d._hi);if(Ce<0)break;var Oe=!1,We=0;Ce>9?(Oe=!0,We="9"):We="0"+Ce,O.append(We),d=d.subtract(f.valueOf(Ce)).multiply(f.TEN),Oe&&d.selfAdd(f.TEN);var ht=!0,Et=f.magnitude(d._hi);if(Et<0&&Math.abs(Et)>=K-re&&(ht=!1),!ht)break}return a[0]=v,O.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof f){var s=arguments[0];return this.add(s.negate())}if(typeof arguments[0]=="number"){var a=arguments[0];return this.add(-a)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof f){var s=arguments[0];return this._hi===s._hi&&this._lo===s._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof f){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s._hi,-s._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.isNaN()?this:this.selfAdd(-a,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(s){return this.le(s)?this:s}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var s=arguments[0];return this.selfDivide(s._hi,s._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.selfDivide(a,0)}}else if(arguments.length===2){var d,v,I,P,O=arguments[0],K=arguments[1],re=null,Ce=null,Oe=null,We=null;return I=this._hi/O,We=(re=(Oe=f.SPLIT*I)-(re=Oe-I))*(Ce=(We=f.SPLIT*O)-(Ce=We-O))-(P=I*O)+re*(v=O-Ce)+(d=I-re)*Ce+d*v,We=I+(Oe=(this._hi-P-We+this._lo-I*K)/O),this._hi=We,this._lo=I-We+Oe,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof f){var s,a,d,v,I=arguments[0],P=null,O=null,K=null,re=null;return s=(d=this._hi/I._hi)-(P=(K=f.SPLIT*d)-(P=K-d)),re=P*(O=(re=f.SPLIT*I._hi)-(O=re-I._hi))-(v=d*I._hi)+P*(a=I._hi-O)+s*O+s*a,new f(re=d+(K=(this._hi-v-re+this._lo-d*I._lo)/I._hi),d-re+K)}if(typeof arguments[0]=="number"){var Ce=arguments[0];return xt.isNaN(Ce)?f.createNaN():f.copy(this).selfDivide(Ce,0)}}},{key:"ge",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>=s._lo}},{key:"pow",value:function(s){if(s===0)return f.valueOf(1);var a=new f(this),d=f.valueOf(1),v=Math.abs(s);if(v>1)for(;v>0;)v%2==1&&d.selfMultiply(a),(v/=2)>0&&(a=a.sqr());else d=a;return s<0?d.reciprocal():d}},{key:"ceil",value:function(){if(this.isNaN())return f.NaN;var s=Math.ceil(this._hi),a=0;return s===this._hi&&(a=Math.ceil(this._lo)),new f(s,a)}},{key:"compareTo",value:function(s){var a=s;return this._hi<a._hi?-1:this._hi>a._hi?1:this._lo<a._lo?-1:this._lo>a._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof f){var s=arguments[0];return this.init(s),this}if(typeof arguments[0]=="number"){var a=arguments[0];return this.init(a),this}}},{key:"max",value:function(s){return this.ge(s)?this:s}},{key:"sqrt",value:function(){if(this.isZero())return f.valueOf(0);if(this.isNegative())return f.NaN;var s=1/Math.sqrt(this._hi),a=this._hi*s,d=f.valueOf(a),v=this.subtract(d.sqr())._hi*(.5*s);return d.add(v)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var s=arguments[0];return this.selfAdd(s._hi,s._lo)}if(typeof arguments[0]=="number"){var a,d,v,I,P,O=arguments[0],K=null;return K=(v=this._hi+O)-(I=v-this._hi),d=(P=(K=O-I+(this._hi-K))+this._lo)+(v-(a=v+P)),this._hi=a+d,this._lo=d+(a-this._hi),this}}else if(arguments.length===2){var re,Ce,Oe,We,ht=arguments[0],Et=arguments[1],Rt=null,Jt=null,ei=null;Oe=this._hi+ht,Ce=this._lo+Et,Jt=Oe-(ei=Oe-this._hi),Rt=Ce-(We=Ce-this._lo);var _i=(re=Oe+(ei=(Jt=ht-ei+(this._hi-Jt))+Ce))+(ei=(Rt=Et-We+(this._lo-Rt))+(ei+(Oe-re))),Ti=ei+(re-_i);return this._hi=_i,this._lo=Ti,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var s=arguments[0];return this.selfMultiply(s._hi,s._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.selfMultiply(a,0)}}else if(arguments.length===2){var d,v,I=arguments[0],P=arguments[1],O=null,K=null,re=null,Ce=null;O=(re=f.SPLIT*this._hi)-this._hi,Ce=f.SPLIT*I,O=re-O,d=this._hi-O,K=Ce-I;var Oe=(re=this._hi*I)+(Ce=O*(K=Ce-K)-re+O*(v=I-K)+d*K+d*v+(this._hi*P+this._lo*I)),We=Ce+(O=re-Oe);return this._hi=Oe,this._lo=We,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return f.NaN;var s=Math.floor(this._hi),a=0;return s===this._hi&&(a=Math.floor(this._lo)),new f(s,a)}},{key:"negate",value:function(){return this.isNaN()?this:new f(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return null;throw s}}},{key:"multiply",value:function(){if(arguments[0]instanceof f){var s=arguments[0];return s.isNaN()?f.createNaN():f.copy(this).selfMultiply(s)}if(typeof arguments[0]=="number"){var a=arguments[0];return xt.isNaN(a)?f.createNaN():f.copy(this).selfMultiply(a,0)}}},{key:"isNaN",value:function(){return xt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var s=f.magnitude(this._hi);return s>=-3&&s<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var s=this.getSpecialNumberString();if(s!==null)return s;var a=new Array(1).fill(null),d=this.extractSignificantDigits(!0,a),v=a[0]+1,I=d;if(d.charAt(0)===".")I="0"+d;else if(v<0)I="0."+f.stringOfChar("0",-v)+d;else if(d.indexOf(".")===-1){var P=v-d.length;I=d+f.stringOfChar("0",P)+".0"}return this.isNegative()?"-"+I:I}},{key:"reciprocal",value:function(){var s,a,d,v,I=null,P=null,O=null,K=null;s=(d=1/this._hi)-(I=(O=f.SPLIT*d)-(I=O-d)),P=(K=f.SPLIT*this._hi)-this._hi;var re=d+(O=(1-(v=d*this._hi)-(K=I*(P=K-P)-v+I*(a=this._hi-P)+s*P+s*a)-d*this._lo)/this._hi);return new f(re,d-re+O)}},{key:"toSciNotation",value:function(){if(this.isZero())return f.SCI_NOT_ZERO;var s=this.getSpecialNumberString();if(s!==null)return s;var a=new Array(1).fill(null),d=this.extractSignificantDigits(!1,a),v=f.SCI_NOT_EXPONENT_CHAR+a[0];if(d.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+d);var I="";d.length>1&&(I=d.substring(1));var P=d.charAt(0)+"."+I;return this.isNegative()?"-"+P+v:P+v}},{key:"abs",value:function(){return this.isNaN()?f.NaN:this.isNegative()?this.negate():new f(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<s._lo}},{key:"add",value:function(){if(arguments[0]instanceof f){var s=arguments[0];return f.copy(this).selfAdd(s)}if(typeof arguments[0]=="number"){var a=arguments[0];return f.copy(this).selfAdd(a)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this._hi=s,this._lo=0}else if(arguments[0]instanceof f){var a=arguments[0];this._hi=a._hi,this._lo=a._lo}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this._hi=d,this._lo=v}}},{key:"gt",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>s._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?f.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[It,wt,Ft]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this.init(s)}else if(arguments[0]instanceof f){var a=arguments[0];this.init(a)}else if(typeof arguments[0]=="string"){var d=arguments[0];f.constructor_.call(this,f.parse(d))}}else if(arguments.length===2){var v=arguments[0],I=arguments[1];this.init(v,I)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1],d=arguments[2],v=arguments[3];return f.determinant(f.valueOf(s),f.valueOf(a),f.valueOf(d),f.valueOf(v))}if(arguments[3]instanceof f&&arguments[2]instanceof f&&arguments[0]instanceof f&&arguments[1]instanceof f){var I=arguments[1],P=arguments[2],O=arguments[3];return arguments[0].multiply(O).selfSubtract(I.multiply(P))}}},{key:"sqr",value:function(s){return f.valueOf(s).selfMultiply(s)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var s=arguments[0];return f.parse(s)}if(typeof arguments[0]=="number")return new f(arguments[0])}},{key:"sqrt",value:function(s){return f.valueOf(s).sqrt()}},{key:"parse",value:function(s){for(var a=0,d=s.length;Mn.isWhitespace(s.charAt(a));)a++;var v=!1;if(a<d){var I=s.charAt(a);I!=="-"&&I!=="+"||(a++,I==="-"&&(v=!0))}for(var P=new f,O=0,K=0,re=0,Ce=!1;!(a>=d);){var Oe=s.charAt(a);if(a++,Mn.isDigit(Oe)){var We=Oe-"0";P.selfMultiply(f.TEN),P.selfAdd(We),O++}else{if(Oe!=="."){if(Oe==="e"||Oe==="E"){var ht=s.substring(a);try{re=ir.parseInt(ht)}catch(_i){throw _i instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+ht+" in string "+s):_i}break}throw new NumberFormatException("Unexpected character '"+Oe+"' at position "+a+" in string "+s)}K=O,Ce=!0}}var Et=P;Ce||(K=O);var Rt=O-K-re;if(Rt===0)Et=P;else if(Rt>0){var Jt=f.TEN.pow(Rt);Et=P.divide(Jt)}else if(Rt<0){var ei=f.TEN.pow(-Rt);Et=P.multiply(ei)}return v?Et.negate():Et}},{key:"createNaN",value:function(){return new f(xt.NaN,xt.NaN)}},{key:"copy",value:function(s){return new f(s)}},{key:"magnitude",value:function(s){var a=Math.abs(s),d=Math.log(a)/Math.log(10),v=Math.trunc(Math.floor(d));return 10*Math.pow(10,v)<=a&&(v+=1),v}},{key:"stringOfChar",value:function(s,a){for(var d=new pr,v=0;v<a;v++)d.append(s);return d.toString()}}])}();At.PI=new At(3.141592653589793,12246467991473532e-32),At.TWO_PI=new At(6.283185307179586,24492935982947064e-32),At.PI_2=new At(1.5707963267948966,6123233995736766e-32),At.E=new At(2.718281828459045,14456468917292502e-32),At.NaN=new At(xt.NaN,xt.NaN),At.EPS=123259516440783e-46,At.SPLIT=134217729,At.MAX_PRINT_DIGITS=32,At.TEN=At.valueOf(10),At.ONE=At.valueOf(1),At.SCI_NOT_EXPONENT_CHAR="E",At.SCI_NOT_ZERO="0.0E0";var gs=function(){function f(){B(this,f)}return u(f,null,[{key:"orientationIndex",value:function(s,a,d){var v=f.orientationIndexFilter(s,a,d);if(v<=1)return v;var I=At.valueOf(a.x).selfAdd(-s.x),P=At.valueOf(a.y).selfAdd(-s.y),O=At.valueOf(d.x).selfAdd(-a.x),K=At.valueOf(d.y).selfAdd(-a.y);return I.selfMultiply(K).selfSubtract(P.selfMultiply(O)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof At&&arguments[2]instanceof At&&arguments[0]instanceof At&&arguments[1]instanceof At){var s=arguments[1],a=arguments[2],d=arguments[3];return arguments[0].multiply(d).selfSubtract(s.multiply(a)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3],K=At.valueOf(v),re=At.valueOf(I),Ce=At.valueOf(P),Oe=At.valueOf(O);return K.multiply(Oe).selfSubtract(re.multiply(Ce)).signum()}}},{key:"intersection",value:function(s,a,d,v){var I=new At(s.y).selfSubtract(a.y),P=new At(a.x).selfSubtract(s.x),O=new At(s.x).selfMultiply(a.y).selfSubtract(new At(a.x).selfMultiply(s.y)),K=new At(d.y).selfSubtract(v.y),re=new At(v.x).selfSubtract(d.x),Ce=new At(d.x).selfMultiply(v.y).selfSubtract(new At(v.x).selfMultiply(d.y)),Oe=P.multiply(Ce).selfSubtract(re.multiply(O)),We=K.multiply(O).selfSubtract(I.multiply(Ce)),ht=I.multiply(re).selfSubtract(K.multiply(P)),Et=Oe.selfDivide(ht).doubleValue(),Rt=We.selfDivide(ht).doubleValue();return xt.isNaN(Et)||xt.isInfinite(Et)||xt.isNaN(Rt)||xt.isInfinite(Rt)?null:new ze(Et,Rt)}},{key:"orientationIndexFilter",value:function(s,a,d){var v=null,I=(s.x-d.x)*(a.y-d.y),P=(s.y-d.y)*(a.x-d.x),O=I-P;if(I>0){if(P<=0)return f.signum(O);v=I+P}else{if(!(I<0)||P>=0)return f.signum(O);v=-I-P}var K=f.DP_SAFE_EPSILON*v;return O>=K||-O>=K?f.signum(O):2}},{key:"signum",value:function(s){return s>0?1:s<0?-1:0}}])}();gs.DP_SAFE_EPSILON=1e-15;var si=function(){return u(function f(){B(this,f)},[{key:"getM",value:function(f){if(this.hasM()){var s=this.getDimension()-this.getMeasures();return this.getOrdinate(f,s)}return xt.NaN}},{key:"setOrdinate",value:function(f,s,a){}},{key:"getZ",value:function(f){return this.hasZ()?this.getOrdinate(f,2):xt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(f,s){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(f){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(f){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(f){}},{key:"copy",value:function(){}},{key:"getY",value:function(f){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[Ft]}}])}();si.X=0,si.Y=1,si.Z=2,si.M=3;var Nt=function(){function f(){B(this,f)}return u(f,null,[{key:"index",value:function(s,a,d){return gs.orientationIndex(s,a,d)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var s=arguments[0],a=s.length-1;if(a<3)throw new rt("Ring has fewer than 4 points, so orientation cannot be determined");for(var d=s[0],v=0,I=1;I<=a;I++){var P=s[I];P.y>d.y&&(d=P,v=I)}var O=v;do(O-=1)<0&&(O=a);while(s[O].equals2D(d)&&O!==v);var K=v;do K=(K+1)%a;while(s[K].equals2D(d)&&K!==v);var re=s[O],Ce=s[K];if(re.equals2D(d)||Ce.equals2D(d)||re.equals2D(Ce))return!1;var Oe=f.index(re,d,Ce);return Oe===0?re.x>Ce.x:Oe>0}if(Vt(arguments[0],si)){var We=arguments[0],ht=We.size()-1;if(ht<3)throw new rt("Ring has fewer than 4 points, so orientation cannot be determined");for(var Et=We.getCoordinate(0),Rt=0,Jt=1;Jt<=ht;Jt++){var ei=We.getCoordinate(Jt);ei.y>Et.y&&(Et=ei,Rt=Jt)}var _i=null,Ti=Rt;do(Ti-=1)<0&&(Ti=ht),_i=We.getCoordinate(Ti);while(_i.equals2D(Et)&&Ti!==Rt);var fn=null,ss=Rt;do ss=(ss+1)%ht,fn=We.getCoordinate(ss);while(fn.equals2D(Et)&&ss!==Rt);if(_i.equals2D(Et)||fn.equals2D(Et)||_i.equals2D(fn))return!1;var Ps=f.index(_i,Et,fn);return Ps===0?_i.x>fn.x:Ps>0}}}])}();Nt.CLOCKWISE=-1,Nt.RIGHT=Nt.CLOCKWISE,Nt.COUNTERCLOCKWISE=1,Nt.LEFT=Nt.COUNTERCLOCKWISE,Nt.COLLINEAR=0,Nt.STRAIGHT=Nt.COLLINEAR;var ke=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(f,s){var a=this.getRightmostSideOfSegment(f,s);return a<0&&(a=this.getRightmostSideOfSegment(f,s-1)),a<0&&(this._minCoord=null,this.checkForRightmostCoordinate(f)),a}},{key:"findRightmostEdgeAtVertex",value:function(){var f=this._minDe.getEdge().getCoordinates();Ot.isTrue(this._minIndex>0&&this._minIndex<f.length,"rightmost point expected to be interior vertex of edge");var s=f[this._minIndex-1],a=f[this._minIndex+1],d=Nt.index(this._minCoord,a,s),v=!1;(s.y<this._minCoord.y&&a.y<this._minCoord.y&&d===Nt.COUNTERCLOCKWISE||s.y>this._minCoord.y&&a.y>this._minCoord.y&&d===Nt.CLOCKWISE)&&(v=!0),v&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(f,s){var a=f.getEdge().getCoordinates();if(s<0||s+1>=a.length||a[s].y===a[s+1].y)return-1;var d=Je.LEFT;return a[s].y<a[s+1].y&&(d=Je.RIGHT),d}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(f){for(var s=f.getEdge().getCoordinates(),a=0;a<s.length-1;a++)(this._minCoord===null||s[a].x>this._minCoord.x)&&(this._minDe=f,this._minIndex=a,this._minCoord=s[a])}},{key:"findRightmostEdgeAtNode",value:function(){var f=this._minDe.getNode().getEdges();this._minDe=f.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(f){for(var s=f.iterator();s.hasNext();){var a=s.next();a.isForward()&&this.checkForRightmostCoordinate(a)}Ot.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Je.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),Y=function(f){function s(a,d){var v;return B(this,s),(v=N(this,s,[d?a+" [ "+d+" ]":a])).pt=d?new ze(d):void 0,v.name=Object.keys({TopologyException:s})[0],v}return de(s,f),u(s,[{key:"getCoordinate",value:function(){return this.pt}}])}(jt),H=function(){return u(function f(){B(this,f),this.array=[]},[{key:"addLast",value:function(f){this.array.push(f)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),W=function(f){function s(a){var d;return B(this,s),(d=N(this,s)).array=[],a instanceof ci&&d.addAll(a),d}return de(s,f),u(s,[{key:"interfaces_",get:function(){return[fr,ci]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(a){return arguments.length===1?this.array.push(a):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(a){var d,v=Le(a);try{for(v.s();!(d=v.n()).done;){var I=d.value;this.array.push(I)}}catch(P){v.e(P)}finally{v.f()}}},{key:"set",value:function(a,d){var v=this.array[a];return this.array[a]=d,v}},{key:"iterator",value:function(){return new ce(this)}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new Rr;return this.array[a]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(a){a?this.array.sort(function(d,v){return a.compare(d,v)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(a){for(var d=0,v=this.array.length;d<v;d++)if(this.array[d]===a)return!!this.array.splice(d,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(fr),ce=function(){return u(function f(s){B(this,f),this.arrayList=s,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Yn;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(f){return this.arrayList.set(this.position-1,f)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),xe=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var f=this._dirEdgeList.iterator();f.hasNext();)f.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(f){for(var s=null,a=f.getEdges().iterator();a.hasNext();){var d=a.next();if(d.isVisited()||d.getSym().isVisited()){s=d;break}}if(s===null)throw new Y("unable to find edge to compute depths at "+f.getCoordinate());f.getEdges().computeDepths(s);for(var v=f.getEdges().iterator();v.hasNext();){var I=v.next();I.setVisited(!0),this.copySymDepths(I)}}},{key:"computeDepth",value:function(f){this.clearVisitedEdges();var s=this._finder.getEdge();s.getNode(),s.getLabel(),s.setEdgeDepths(Je.RIGHT,f),this.copySymDepths(s),this.computeDepths(s)}},{key:"create",value:function(f){this.addReachable(f),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var f=this._dirEdgeList.iterator();f.hasNext();){var s=f.next();s.getDepth(Je.RIGHT)>=1&&s.getDepth(Je.LEFT)<=0&&!s.isInteriorAreaEdge()&&s.setInResult(!0)}}},{key:"computeDepths",value:function(f){var s=new nn,a=new H,d=f.getNode();for(a.addLast(d),s.add(d),f.setVisited(!0);!a.isEmpty();){var v=a.removeFirst();s.add(v),this.computeNodeDepth(v);for(var I=v.getEdges().iterator();I.hasNext();){var P=I.next().getSym();if(!P.isVisited()){var O=P.getNode();s.contains(O)||(a.addLast(O),s.add(O))}}}}},{key:"compareTo",value:function(f){var s=f;return this._rightMostCoord.x<s._rightMostCoord.x?-1:this._rightMostCoord.x>s._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var f=new vi,s=this._dirEdgeList.iterator();s.hasNext();)for(var a=s.next().getEdge().getCoordinates(),d=0;d<a.length-1;d++)f.expandToInclude(a[d]);this._env=f}return this._env}},{key:"addReachable",value:function(f){var s=new ms;for(s.add(f);!s.empty();){var a=s.pop();this.add(a,s)}}},{key:"copySymDepths",value:function(f){var s=f.getSym();s.setDepth(Je.LEFT,f.getDepth(Je.RIGHT)),s.setDepth(Je.RIGHT,f.getDepth(Je.LEFT))}},{key:"add",value:function(f,s){f.setVisited(!0),this._nodes.add(f);for(var a=f.getEdges().iterator();a.hasNext();){var d=a.next();this._dirEdgeList.add(d);var v=d.getSym().getNode();v.isVisited()||s.push(v)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new W,this._nodes=new W,this._rightMostCoord=null,this._env=null,this._finder=new ke}}])}(),Ee=function(){return u(function f(){B(this,f)},null,[{key:"intersection",value:function(f,s,a,d){var v=f.x<s.x?f.x:s.x,I=f.y<s.y?f.y:s.y,P=f.x>s.x?f.x:s.x,O=f.y>s.y?f.y:s.y,K=a.x<d.x?a.x:d.x,re=a.y<d.y?a.y:d.y,Ce=a.x>d.x?a.x:d.x,Oe=a.y>d.y?a.y:d.y,We=((v>K?v:K)+(P<Ce?P:Ce))/2,ht=((I>re?I:re)+(O<Oe?O:Oe))/2,Et=f.x-We,Rt=f.y-ht,Jt=s.x-We,ei=s.y-ht,_i=a.x-We,Ti=a.y-ht,fn=d.x-We,ss=d.y-ht,Ps=Rt-ei,as=Jt-Et,ma=Et*ei-Jt*Rt,ga=Ti-ss,qs=fn-_i,Ms=_i*ss-fn*Ti,fo=Ps*qs-ga*as,os=(as*Ms-qs*ma)/fo,ls=(ga*ma-Ps*Ms)/fo;return xt.isNaN(os)||xt.isInfinite(os)||xt.isNaN(ls)||xt.isInfinite(ls)?null:new ze(os+We,ls+ht)}}])}(),Me=function(){return u(function f(){B(this,f)},null,[{key:"arraycopy",value:function(f,s,a,d,v){for(var I=0,P=s;P<s+v;P++)a[d+I]=f[P],I++}},{key:"getProperty",value:function(f){return{"line.separator":`
`}[f]}}])}(),Ie=function(){function f(){B(this,f)}return u(f,null,[{key:"log10",value:function(s){var a=Math.log(s);return xt.isInfinite(a)||xt.isNaN(a)?a:a/f.LOG_10}},{key:"min",value:function(s,a,d,v){var I=s;return a<I&&(I=a),d<I&&(I=d),v<I&&(I=v),I}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1],d=arguments[2];return s<a?a:s>d?d:s}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var v=arguments[0],I=arguments[1],P=arguments[2];return v<I?I:v>P?P:v}}},{key:"wrap",value:function(s,a){return s<0?a- -s%a:s%a}},{key:"max",value:function(){if(arguments.length===3){var s=arguments[1],a=arguments[2],d=arguments[0];return s>d&&(d=s),a>d&&(d=a),d}if(arguments.length===4){var v=arguments[1],I=arguments[2],P=arguments[3],O=arguments[0];return v>O&&(O=v),I>O&&(O=I),P>O&&(O=P),O}}},{key:"average",value:function(s,a){return(s+a)/2}}])}();Ie.LOG_10=Math.log(10);var Ve=function(){function f(){B(this,f)}return u(f,null,[{key:"segmentToSegment",value:function(s,a,d,v){if(s.equals(a))return f.pointToSegment(s,d,v);if(d.equals(v))return f.pointToSegment(v,s,a);var I=!1;if(vi.intersects(s,a,d,v)){var P=(a.x-s.x)*(v.y-d.y)-(a.y-s.y)*(v.x-d.x);if(P===0)I=!0;else{var O=(s.y-d.y)*(v.x-d.x)-(s.x-d.x)*(v.y-d.y),K=((s.y-d.y)*(a.x-s.x)-(s.x-d.x)*(a.y-s.y))/P,re=O/P;(re<0||re>1||K<0||K>1)&&(I=!0)}}else I=!0;return I?Ie.min(f.pointToSegment(s,d,v),f.pointToSegment(a,d,v),f.pointToSegment(d,s,a),f.pointToSegment(v,s,a)):0}},{key:"pointToSegment",value:function(s,a,d){if(a.x===d.x&&a.y===d.y)return s.distance(a);var v=(d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y),I=((s.x-a.x)*(d.x-a.x)+(s.y-a.y)*(d.y-a.y))/v;if(I<=0)return s.distance(a);if(I>=1)return s.distance(d);var P=((a.y-s.y)*(d.x-a.x)-(a.x-s.x)*(d.y-a.y))/v;return Math.abs(P)*Math.sqrt(v)}},{key:"pointToLinePerpendicular",value:function(s,a,d){var v=(d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y),I=((a.y-s.y)*(d.x-a.x)-(a.x-s.x)*(d.y-a.y))/v;return Math.abs(I)*Math.sqrt(v)}},{key:"pointToSegmentString",value:function(s,a){if(a.length===0)throw new rt("Line array must contain at least one vertex");for(var d=s.distance(a[0]),v=0;v<a.length-1;v++){var I=f.pointToSegment(s,a[v],a[v+1]);I<d&&(d=I)}return d}}])}(),Ue=function(){return u(function f(){B(this,f)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||Vt(arguments[0],si);else if(arguments.length!==2){if(arguments.length===3){var f=arguments[0],s=arguments[1];return this.create(f,s)}}}}])}(),Pe=function(){return u(function f(){B(this,f)},[{key:"filter",value:function(f){}}])}(),Ze=function(){return u(function f(){B(this,f)},null,[{key:"ofLine",value:function(f){var s=f.size();if(s<=1)return 0;var a=0,d=new ze;f.getCoordinate(0,d);for(var v=d.x,I=d.y,P=1;P<s;P++){f.getCoordinate(P,d);var O=d.x,K=d.y,re=O-v,Ce=K-I;a+=Math.sqrt(re*re+Ce*Ce),v=O,I=K}return a}}])}(),ve=u(function f(){B(this,f)}),st=function(){function f(){B(this,f)}return u(f,null,[{key:"copyCoord",value:function(s,a,d,v){for(var I=Math.min(s.getDimension(),d.getDimension()),P=0;P<I;P++)d.setOrdinate(v,P,s.getOrdinate(a,P))}},{key:"isRing",value:function(s){var a=s.size();return a===0||!(a<=3)&&s.getOrdinate(0,si.X)===s.getOrdinate(a-1,si.X)&&s.getOrdinate(0,si.Y)===s.getOrdinate(a-1,si.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(Vt(arguments[0],si)&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];f.scroll(s,a,f.isRing(s))}else if(Vt(arguments[0],si)&&arguments[1]instanceof ze){var d=arguments[0],v=arguments[1],I=f.indexOf(v,d);if(I<=0)return null;f.scroll(d,I)}}else if(arguments.length===3){var P=arguments[0],O=arguments[1],K=arguments[2];if(O<=0)return null;for(var re=P.copy(),Ce=K?P.size()-1:P.size(),Oe=0;Oe<Ce;Oe++)for(var We=0;We<P.getDimension();We++)P.setOrdinate(Oe,We,re.getOrdinate((O+Oe)%Ce,We));if(K)for(var ht=0;ht<P.getDimension();ht++)P.setOrdinate(Ce,ht,P.getOrdinate(0,ht))}}},{key:"isEqual",value:function(s,a){var d=s.size();if(d!==a.size())return!1;for(var v=Math.min(s.getDimension(),a.getDimension()),I=0;I<d;I++)for(var P=0;P<v;P++){var O=s.getOrdinate(I,P),K=a.getOrdinate(I,P);if(s.getOrdinate(I,P)!==a.getOrdinate(I,P)&&(!xt.isNaN(O)||!xt.isNaN(K)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var s=arguments[0];return f.minCoordinateIndex(s,0,s.size()-1)}if(arguments.length===3){for(var a=arguments[0],d=arguments[2],v=-1,I=null,P=arguments[1];P<=d;P++){var O=a.getCoordinate(P);(I===null||I.compareTo(O)>0)&&(I=O,v=P)}return v}}},{key:"extend",value:function(s,a,d){var v=s.create(d,a.getDimension()),I=a.size();if(f.copy(a,0,v,0,I),I>0)for(var P=I;P<d;P++)f.copy(a,I-1,v,P,1);return v}},{key:"reverse",value:function(s){for(var a=s.size()-1,d=Math.trunc(a/2),v=0;v<=d;v++)f.swap(s,v,a-v)}},{key:"swap",value:function(s,a,d){if(a===d)return null;for(var v=0;v<s.getDimension();v++){var I=s.getOrdinate(a,v);s.setOrdinate(a,v,s.getOrdinate(d,v)),s.setOrdinate(d,v,I)}}},{key:"copy",value:function(s,a,d,v,I){for(var P=0;P<I;P++)f.copyCoord(s,a+P,d,v+P)}},{key:"ensureValidRing",value:function(s,a){var d=a.size();return d===0?a:d<=3?f.createClosedRing(s,a,4):a.getOrdinate(0,si.X)===a.getOrdinate(d-1,si.X)&&a.getOrdinate(0,si.Y)===a.getOrdinate(d-1,si.Y)?a:f.createClosedRing(s,a,d+1)}},{key:"indexOf",value:function(s,a){for(var d=0;d<a.size();d++)if(s.x===a.getOrdinate(d,si.X)&&s.y===a.getOrdinate(d,si.Y))return d;return-1}},{key:"createClosedRing",value:function(s,a,d){var v=s.create(d,a.getDimension()),I=a.size();f.copy(a,0,v,0,I);for(var P=I;P<d;P++)f.copy(a,0,v,P,1);return v}},{key:"minCoordinate",value:function(s){for(var a=null,d=0;d<s.size();d++){var v=s.getCoordinate(d);(a===null||a.compareTo(v)>0)&&(a=v)}return a}}])}(),qe=function(){function f(){B(this,f)}return u(f,null,[{key:"toDimensionSymbol",value:function(s){switch(s){case f.FALSE:return f.SYM_FALSE;case f.TRUE:return f.SYM_TRUE;case f.DONTCARE:return f.SYM_DONTCARE;case f.P:return f.SYM_P;case f.L:return f.SYM_L;case f.A:return f.SYM_A}throw new rt("Unknown dimension value: "+s)}},{key:"toDimensionValue",value:function(s){switch(Mn.toUpperCase(s)){case f.SYM_FALSE:return f.FALSE;case f.SYM_TRUE:return f.TRUE;case f.SYM_DONTCARE:return f.DONTCARE;case f.SYM_P:return f.P;case f.SYM_L:return f.L;case f.SYM_A:return f.A}throw new rt("Unknown dimension symbol: "+s)}}])}();qe.P=0,qe.L=1,qe.A=2,qe.FALSE=-1,qe.TRUE=-2,qe.DONTCARE=-3,qe.SYM_FALSE="F",qe.SYM_TRUE="T",qe.SYM_DONTCARE="*",qe.SYM_P="0",qe.SYM_L="1",qe.SYM_A="2";var ct=function(){return u(function f(){B(this,f)},[{key:"filter",value:function(f){}}])}(),St=function(){return u(function f(){B(this,f)},[{key:"filter",value:function(f,s){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),Dt=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new vi:this._points.expandEnvelope(new vi)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new s(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];if(!this.isEquivalentClass(a))return!1;var v=a;if(this._points.size()!==v._points.size())return!1;for(var I=0;I<this._points.size();I++)if(!this.equal(this._points.getCoordinate(I),v._points.getCoordinate(I),d))return!1;return!0}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<Math.trunc(this._points.size()/2);a++){var d=this._points.size()-1-a;if(!this._points.getCoordinate(a).equals(this._points.getCoordinate(d))){if(this._points.getCoordinate(a).compareTo(this._points.getCoordinate(d))>0){var v=this._points.copy();st.reverse(v),this._points=v}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?qe.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var a=this._points.copy();return st.reverse(a),this.getFactory().createLineString(a)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return yt.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Ze.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var a=arguments[0],d=0,v=0;d<this._points.size()&&v<a._points.size();){var I=this._points.getCoordinate(d).compareTo(a._points.getCoordinate(v));if(I!==0)return I;d++,v++}return d<this._points.size()?1:v<a._points.size()?-1:0}if(arguments.length===2){var P=arguments[0];return arguments[1].compare(this._points,P._points)}}},{key:"apply",value:function(){if(Vt(arguments[0],Pe))for(var a=arguments[0],d=0;d<this._points.size();d++)a.filter(this._points.getCoordinate(d));else if(Vt(arguments[0],St)){var v=arguments[0];if(this._points.size()===0)return null;for(var I=0;I<this._points.size()&&(v.filter(this._points,I),!v.isDone());I++);v.isGeometryChanged()&&this.geometryChanged()}else Vt(arguments[0],ct)?arguments[0].filter(this):Vt(arguments[0],lt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new tn}},{key:"isEquivalentClass",value:function(a){return a instanceof s}},{key:"getCoordinateN",value:function(a){return this._points.getCoordinate(a)}},{key:"getGeometryType",value:function(){return yt.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(a){if(a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),a.size()===1)throw new rt("Invalid number of points in LineString (found "+a.size()+" - must be 0 or >= 2)");this._points=a}},{key:"isCoordinate",value:function(a){for(var d=0;d<this._points.size();d++)if(this._points.getCoordinate(d).equals(a))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(a){return this.getFactory().createPoint(this._points.getCoordinate(a))}},{key:"interfaces_",get:function(){return[ve]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],d=arguments[1];yt.constructor_.call(this,d),this.init(a)}}}}])}(yt),wi=u(function f(){B(this,f)}),mi=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new vi;var a=new vi;return a.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),a}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new s(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&(!(!this.isEmpty()||!a.isEmpty())||this.isEmpty()===a.isEmpty()&&this.equal(a.getCoordinate(),this.getCoordinate(),d))}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return qe.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return yt.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0];return this.getCoordinate().compareTo(a.getCoordinate())}if(arguments.length===2){var d=arguments[0];return arguments[1].compare(this._coordinates,d._coordinates)}}},{key:"apply",value:function(){if(Vt(arguments[0],Pe)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this.getCoordinate())}else if(Vt(arguments[0],St)){var d=arguments[0];if(this.isEmpty())return null;d.filter(this._coordinates,0),d.isGeometryChanged()&&this.geometryChanged()}else Vt(arguments[0],ct)?arguments[0].filter(this):Vt(arguments[0],lt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return yt.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(a){a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),Ot.isTrue(a.size()<=1),this._coordinates=a}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[wi]}}],[{key:"constructor_",value:function(){this._coordinates=null;var a=arguments[0],d=arguments[1];yt.constructor_.call(this,d),this.init(a)}}])}(yt),hi=function(){function f(){B(this,f)}return u(f,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];return Math.abs(f.ofRingSigned(s))}if(Vt(arguments[0],si)){var a=arguments[0];return Math.abs(f.ofRingSigned(a))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];if(s.length<3)return 0;for(var a=0,d=s[0].x,v=1;v<s.length-1;v++){var I=s[v].x-d,P=s[v+1].y;a+=I*(s[v-1].y-P)}return a/2}if(Vt(arguments[0],si)){var O=arguments[0],K=O.size();if(K<3)return 0;var re=new ze,Ce=new ze,Oe=new ze;O.getCoordinate(0,Ce),O.getCoordinate(1,Oe);var We=Ce.x;Oe.x-=We;for(var ht=0,Et=1;Et<K-1;Et++)re.y=Ce.y,Ce.x=Oe.x,Ce.y=Oe.y,O.getCoordinate(Et+1,Oe),Oe.x-=We,ht+=Ce.x*(re.y-Oe.y);return ht/2}}}])}(),Pt=function(){return u(function f(){B(this,f)},null,[{key:"sort",value:function(){var f=arguments,s=arguments[0];if(arguments.length===1)s.sort(function(We,ht){return We.compareTo(ht)});else if(arguments.length===2)s.sort(function(We,ht){return f[1].compare(We,ht)});else if(arguments.length===3){var a=s.slice(arguments[1],arguments[2]);a.sort();var d=s.slice(0,arguments[1]).concat(a,s.slice(arguments[2],s.length));s.splice(0,s.length);var v,I=Le(d);try{for(I.s();!(v=I.n()).done;){var P=v.value;s.push(P)}}catch(We){I.e(We)}finally{I.f()}}else if(arguments.length===4){var O=s.slice(arguments[1],arguments[2]);O.sort(function(We,ht){return f[3].compare(We,ht)});var K=s.slice(0,arguments[1]).concat(O,s.slice(arguments[2],s.length));s.splice(0,s.length);var re,Ce=Le(K);try{for(Ce.s();!(re=Ce.n()).done;){var Oe=re.value;s.push(Oe)}}catch(We){Ce.e(We)}finally{Ce.f()}}}},{key:"asList",value:function(f){var s,a=new W,d=Le(f);try{for(d.s();!(s=d.n()).done;){var v=s.value;a.add(v)}}catch(I){d.e(I)}finally{d.f()}return a}},{key:"copyOf",value:function(f,s){return f.slice(0,s)}}])}(),Qt=u(function f(){B(this,f)}),Zi=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),d=-1,v=this._shell.getCoordinates(),I=0;I<v.length;I++)a[++d]=v[I];for(var P=0;P<this._holes.length;P++)for(var O=this._holes[P].getCoordinates(),K=0;K<O.length;K++)a[++d]=O[K];return a}},{key:"getArea",value:function(){var a=0;a+=hi.ofRing(this._shell.getCoordinateSequence());for(var d=0;d<this._holes.length;d++)a-=hi.ofRing(this._holes[d].getCoordinateSequence());return a}},{key:"copyInternal",value:function(){for(var a=this._shell.copy(),d=new Array(this._holes.length).fill(null),v=0;v<this._holes.length;v++)d[v]=this._holes[v].copy();return new s(a,d,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var a=this._shell.getCoordinateSequence(),d=this.getEnvelopeInternal(),v=0;v<5;v++){var I=a.getX(v);if(I!==d.getMinX()&&I!==d.getMaxX())return!1;var P=a.getY(v);if(P!==d.getMinY()&&P!==d.getMaxY())return!1}for(var O=a.getX(0),K=a.getY(0),re=1;re<=4;re++){var Ce=a.getX(re),Oe=a.getY(re);if(Ce!==O==(Oe!==K))return!1;O=Ce,K=Oe}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];if(!this.isEquivalentClass(a))return!1;var v=a,I=this._shell,P=v._shell;if(!I.equalsExact(P,d)||this._holes.length!==v._holes.length)return!1;for(var O=0;O<this._holes.length;O++)if(!this._holes[O].equalsExact(v._holes[O],d))return!1;return!0}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var a=0;a<this._holes.length;a++)this._holes[a]=this.normalized(this._holes[a],!1);Pt.sort(this._holes)}else if(arguments.length===2){var d=arguments[0],v=arguments[1];if(d.isEmpty())return null;var I=d.getCoordinateSequence(),P=st.minCoordinateIndex(I,0,I.size()-2);st.scroll(I,P,!0),Nt.isCCW(I)===v&&st.reverse(I)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var a=this.getExteriorRing().reverse(),d=new Array(this.getNumInteriorRing()).fill(null),v=0;v<d.length;v++)d[v]=this.getInteriorRingN(v).reverse();return this.getFactory().createPolygon(a,d)}},{key:"getTypeCode",value:function(){return yt.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var a=0;a+=this._shell.getLength();for(var d=0;d<this._holes.length;d++)a+=this._holes[d].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=this._shell.getNumPoints(),d=0;d<this._holes.length;d++)a+=this._holes[d].getNumPoints();return a}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(a,d){var v=a.copy();return this.normalize(v,d),v}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],d=this._shell,v=a._shell;return d.compareToSameClass(v)}if(arguments.length===2){var I=arguments[1],P=arguments[0],O=this._shell,K=P._shell,re=O.compareToSameClass(K,I);if(re!==0)return re;for(var Ce=this.getNumInteriorRing(),Oe=P.getNumInteriorRing(),We=0;We<Ce&&We<Oe;){var ht=this.getInteriorRingN(We),Et=P.getInteriorRingN(We),Rt=ht.compareToSameClass(Et,I);if(Rt!==0)return Rt;We++}return We<Ce?1:We<Oe?-1:0}}},{key:"apply",value:function(){if(Vt(arguments[0],Pe)){var a=arguments[0];this._shell.apply(a);for(var d=0;d<this._holes.length;d++)this._holes[d].apply(a)}else if(Vt(arguments[0],St)){var v=arguments[0];if(this._shell.apply(v),!v.isDone())for(var I=0;I<this._holes.length&&(this._holes[I].apply(v),!v.isDone());I++);v.isGeometryChanged()&&this.geometryChanged()}else if(Vt(arguments[0],ct))arguments[0].filter(this);else if(Vt(arguments[0],lt)){var P=arguments[0];P.filter(this),this._shell.apply(P);for(var O=0;O<this._holes.length;O++)this._holes[O].apply(P)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var d=0;d<this._holes.length;d++)a[d+1]=this._holes[d];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)}},{key:"getGeometryType",value:function(){return yt.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(a){return this._holes[a]}},{key:"interfaces_",get:function(){return[Qt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var a=arguments[0],d=arguments[1],v=arguments[2];if(yt.constructor_.call(this,v),a===null&&(a=this.getFactory().createLinearRing()),d===null&&(d=[]),yt.hasNullElements(d))throw new rt("holes must not contain null elements");if(a.isEmpty()&&yt.hasNonEmptyElements(d))throw new rt("shell is empty but holes are not");this._shell=a,this._holes=d}}])}(yt),et=function(f){function s(){return B(this,s),N(this,s,arguments)}return de(s,f),u(s)}(ps),ln=function(f){function s(a){var d;return B(this,s),(d=N(this,s)).array=[],a instanceof ci&&d.addAll(a),d}return de(s,f),u(s,[{key:"contains",value:function(a){var d,v=Le(this.array);try{for(v.s();!(d=v.n()).done;)if(d.value.compareTo(a)===0)return!0}catch(I){v.e(I)}finally{v.f()}return!1}},{key:"add",value:function(a){if(this.contains(a))return!1;for(var d=0,v=this.array.length;d<v;d++)if(this.array[d].compareTo(a)===1)return!!this.array.splice(d,0,a);return this.array.push(a),!0}},{key:"addAll",value:function(a){var d,v=Le(a);try{for(v.s();!(d=v.n()).done;){var I=d.value;this.add(I)}}catch(P){v.e(P)}finally{v.f()}return!0}},{key:"remove",value:function(){throw new tn}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Ri(this.array)}}])}(et),Ri=function(){return u(function f(s){B(this,f),this.array=s,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new Yn;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new tn}}])}(),Ji=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"computeEnvelopeInternal",value:function(){for(var a=new vi,d=0;d<this._geometries.length;d++)a.expandToInclude(this._geometries[d].getEnvelopeInternal());return a}},{key:"getGeometryN",value:function(a){return this._geometries[a]}},{key:"getCoordinates",value:function(){for(var a=new Array(this.getNumPoints()).fill(null),d=-1,v=0;v<this._geometries.length;v++)for(var I=this._geometries[v].getCoordinates(),P=0;P<I.length;P++)a[++d]=I[P];return a}},{key:"getArea",value:function(){for(var a=0,d=0;d<this._geometries.length;d++)a+=this._geometries[d].getArea();return a}},{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];if(!this.isEquivalentClass(a))return!1;var v=a;if(this._geometries.length!==v._geometries.length)return!1;for(var I=0;I<this._geometries.length;I++)if(!this._geometries[I].equalsExact(v._geometries[I],d))return!1;return!0}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<this._geometries.length;a++)this._geometries[a].normalize();Pt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var a=qe.FALSE,d=0;d<this._geometries.length;d++)a=Math.max(a,this._geometries[d].getBoundaryDimension());return a}},{key:"reverseInternal",value:function(){for(var a=this._geometries.length,d=new W(a),v=0;v<a;v++)d.add(this._geometries[v].reverse());return this.getFactory().buildGeometry(d)}},{key:"getTypeCode",value:function(){return yt.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var a=qe.FALSE,d=0;d<this._geometries.length;d++)a=Math.max(a,this._geometries[d].getDimension());return a}},{key:"getLength",value:function(){for(var a=0,d=0;d<this._geometries.length;d++)a+=this._geometries[d].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=0,d=0;d<this._geometries.length;d++)a+=this._geometries[d].getNumPoints();return a}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],d=new ln(Pt.asList(this._geometries)),v=new ln(Pt.asList(a._geometries));return this.compare(d,v)}if(arguments.length===2){for(var I=arguments[1],P=arguments[0],O=this.getNumGeometries(),K=P.getNumGeometries(),re=0;re<O&&re<K;){var Ce=this.getGeometryN(re),Oe=P.getGeometryN(re),We=Ce.compareToSameClass(Oe,I);if(We!==0)return We;re++}return re<O?1:re<K?-1:0}}},{key:"apply",value:function(){if(Vt(arguments[0],Pe))for(var a=arguments[0],d=0;d<this._geometries.length;d++)this._geometries[d].apply(a);else if(Vt(arguments[0],St)){var v=arguments[0];if(this._geometries.length===0)return null;for(var I=0;I<this._geometries.length&&(this._geometries[I].apply(v),!v.isDone());I++);v.isGeometryChanged()&&this.geometryChanged()}else if(Vt(arguments[0],ct)){var P=arguments[0];P.filter(this);for(var O=0;O<this._geometries.length;O++)this._geometries[O].apply(P)}else if(Vt(arguments[0],lt)){var K=arguments[0];K.filter(this);for(var re=0;re<this._geometries.length;re++)this._geometries[re].apply(K)}}},{key:"getBoundary",value:function(){return yt.checkNotGeometryCollection(this),Ot.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return yt.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],d=arguments[1];if(yt.constructor_.call(this,d),a===null&&(a=[]),yt.hasNullElements(a))throw new rt("geometries must not contain null elements");this._geometries=a}}}}])}(yt),Dr=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&Te(s,"equalsExact",this,1).call(this,a,d)}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var a=arguments[0];return this._geometries[a].getCoordinate()}return Te(s,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return qe.FALSE}},{key:"getTypeCode",value:function(){return yt.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return yt.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[wi]}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Ji.constructor_.call(this,a,d)}}])}(Ji),tt=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"copyInternal",value:function(){return new s(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return qe.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||Te(s,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var a=this._points.copy();return st.reverse(a),this.getFactory().createLinearRing(a)}},{key:"getTypeCode",value:function(){return yt.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!Te(s,"isClosed",this,1).call(this))throw new rt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<s.MINIMUM_VALID_SIZE)throw new rt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return yt.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Dt.constructor_.call(this,a,d),this.validateConstruction()}}])}(Dt);tt.MINIMUM_VALID_SIZE=4;var Gt=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"setOrdinate",value:function(a,d){switch(a){case s.X:this.x=d;break;case s.Y:this.y=d;break;default:throw new rt("Invalid ordinate index: "+a)}}},{key:"getZ",value:function(){return ze.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case s.X:return this.x;case s.Y:return this.y}throw new rt("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new rt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)ze.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof s){var a=arguments[0];ze.constructor_.call(this,a.x,a.y)}else if(arguments[0]instanceof ze){var d=arguments[0];ze.constructor_.call(this,d.x,d.y)}}else if(arguments.length===2){var v=arguments[0],I=arguments[1];ze.constructor_.call(this,v,I,ze.NULL_ORDINATE)}}}])}(ze);Gt.X=0,Gt.Y=1,Gt.Z=-1,Gt.M=-1;var qt=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,d){switch(a){case s.X:this.x=d;break;case s.Y:this.y=d;break;case s.M:this._m=d;break;default:throw new rt("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getZ",value:function(){return ze.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case s.X:return this.x;case s.Y:return this.y;case s.M:return this._m}throw new rt("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new rt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)ze.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof s){var a=arguments[0];ze.constructor_.call(this,a.x,a.y),this._m=a._m}else if(arguments[0]instanceof ze){var d=arguments[0];ze.constructor_.call(this,d.x,d.y),this._m=this.getM()}}else if(arguments.length===3){var v=arguments[0],I=arguments[1],P=arguments[2];ze.constructor_.call(this,v,I,ze.NULL_ORDINATE),this._m=P}}}])}(ze);qt.X=0,qt.Y=1,qt.Z=-1,qt.M=2;var An=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,d){switch(a){case ze.X:this.x=d;break;case ze.Y:this.y=d;break;case ze.Z:this.z=d;break;case ze.M:this._m=d;break;default:throw new rt("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getOrdinate",value:function(a){switch(a){case ze.X:return this.x;case ze.Y:return this.y;case ze.Z:return this.getZ();case ze.M:return this.getM()}throw new rt("Invalid ordinate index: "+a)}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)ze.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof s){var a=arguments[0];ze.constructor_.call(this,a),this._m=a._m}else if(arguments[0]instanceof ze){var d=arguments[0];ze.constructor_.call(this,d),this._m=this.getM()}}else if(arguments.length===4){var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3];ze.constructor_.call(this,v,I,P),this._m=O}}}])}(ze),_s=function(){function f(){B(this,f)}return u(f,null,[{key:"measures",value:function(s){return s instanceof Gt?0:s instanceof qt||s instanceof An?1:0}},{key:"dimension",value:function(s){return s instanceof Gt?2:s instanceof qt?3:s instanceof An?4:3}},{key:"create",value:function(){if(arguments.length===1){var s=arguments[0];return f.create(s,0)}if(arguments.length===2){var a=arguments[0],d=arguments[1];return a===2?new Gt:a===3&&d===0?new ze:a===3&&d===1?new qt:a===4&&d===1?new An:new ze}}}])}(),jn=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"getCoordinate",value:function(a){return this.get(a)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&Vt(arguments[0],ci)){for(var a=arguments[1],d=!1,v=arguments[0].iterator();v.hasNext();)this.add(v.next(),a),d=!0;return d}return Te(s,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var a=Te(s,"clone",this,1).call(this),d=0;d<this.size();d++)a.add(d,this.get(d).clone());return a}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(s.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(s.coordArrayType);for(var a=this.size(),d=new Array(a).fill(null),v=0;v<a;v++)d[v]=this.get(a-v-1);return d}}},{key:"add",value:function(){if(arguments.length===1){var a=arguments[0];return Te(s,"add",this,1).call(this,a)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var d=arguments[0],v=arguments[1];return this.add(d,v,!0),!0}if(arguments[0]instanceof ze&&typeof arguments[1]=="boolean"){var I=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(I))return null;Te(s,"add",this,1).call(this,I)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var P=arguments[0],O=arguments[1];return this.add(P,O),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var K=arguments[0],re=arguments[1];if(arguments[2])for(var Ce=0;Ce<K.length;Ce++)this.add(K[Ce],re);else for(var Oe=K.length-1;Oe>=0;Oe--)this.add(K[Oe],re);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof ze){var We=arguments[0],ht=arguments[1];if(!arguments[2]){var Et=this.size();if(Et>0&&(We>0&&this.get(We-1).equals2D(ht)||We<Et&&this.get(We).equals2D(ht)))return null}Te(s,"add",this,1).call(this,We,ht)}}else if(arguments.length===4){var Rt=arguments[0],Jt=arguments[1],ei=arguments[2],_i=arguments[3],Ti=1;ei>_i&&(Ti=-1);for(var fn=ei;fn!==_i;fn+=Ti)this.add(Rt[fn],Jt);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var a=this.get(0).copy();this.add(a,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var a=arguments[0];this.ensureCapacity(a.length),this.add(a,!0)}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this.ensureCapacity(d.length),this.add(d,v)}}}}])}(W);jn.coordArrayType=new Array(0).fill(null);var kt=function(){function f(){B(this,f)}return u(f,null,[{key:"isRing",value:function(s){return!(s.length<4)&&!!s[0].equals2D(s[s.length-1])}},{key:"ptNotInList",value:function(s,a){for(var d=0;d<s.length;d++){var v=s[d];if(f.indexOf(v,a)<0)return v}return null}},{key:"scroll",value:function(s,a){var d=f.indexOf(a,s);if(d<0)return null;var v=new Array(s.length).fill(null);Me.arraycopy(s,d,v,0,s.length-d),Me.arraycopy(s,0,v,s.length-d,d),Me.arraycopy(v,0,s,0,s.length)}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];if(s===a)return!0;if(s===null||a===null||s.length!==a.length)return!1;for(var d=0;d<s.length;d++)if(!s[d].equals(a[d]))return!1;return!0}if(arguments.length===3){var v=arguments[0],I=arguments[1],P=arguments[2];if(v===I)return!0;if(v===null||I===null||v.length!==I.length)return!1;for(var O=0;O<v.length;O++)if(P.compare(v[O],I[O])!==0)return!1;return!0}}},{key:"intersection",value:function(s,a){for(var d=new jn,v=0;v<s.length;v++)a.intersects(s[v])&&d.add(s[v],!0);return d.toCoordinateArray()}},{key:"measures",value:function(s){if(s===null||s.length===0)return 0;var a,d=0,v=Le(s);try{for(v.s();!(a=v.n()).done;){var I=a.value;d=Math.max(d,_s.measures(I))}}catch(P){v.e(P)}finally{v.f()}return d}},{key:"hasRepeatedPoints",value:function(s){for(var a=1;a<s.length;a++)if(s[a-1].equals(s[a]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(s){return f.hasRepeatedPoints(s)?new jn(s,!1).toCoordinateArray():s}},{key:"reverse",value:function(s){for(var a=s.length-1,d=Math.trunc(a/2),v=0;v<=d;v++){var I=s[v];s[v]=s[a-v],s[a-v]=I}}},{key:"removeNull",value:function(s){for(var a=0,d=0;d<s.length;d++)s[d]!==null&&a++;var v=new Array(a).fill(null);if(a===0)return v;for(var I=0,P=0;P<s.length;P++)s[P]!==null&&(v[I++]=s[P]);return v}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var s=arguments[0],a=new Array(s.length).fill(null),d=0;d<s.length;d++)a[d]=s[d].copy();return a}if(arguments.length===5)for(var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3],K=arguments[4],re=0;re<K;re++)P[O+re]=v[I+re].copy()}},{key:"isEqualReversed",value:function(s,a){for(var d=0;d<s.length;d++){var v=s[d],I=a[s.length-d-1];if(v.compareTo(I)!==0)return!1}return!0}},{key:"envelope",value:function(s){for(var a=new vi,d=0;d<s.length;d++)a.expandToInclude(s[d]);return a}},{key:"toCoordinateArray",value:function(s){return s.toArray(f.coordArrayType)}},{key:"dimension",value:function(s){if(s===null||s.length===0)return 3;var a,d=0,v=Le(s);try{for(v.s();!(a=v.n()).done;){var I=a.value;d=Math.max(d,_s.dimension(I))}}catch(P){v.e(P)}finally{v.f()}return d}},{key:"atLeastNCoordinatesOrNothing",value:function(s,a){return a.length>=s?a:[]}},{key:"indexOf",value:function(s,a){for(var d=0;d<a.length;d++)if(s.equals(a[d]))return d;return-1}},{key:"increasingDirection",value:function(s){for(var a=0;a<Math.trunc(s.length/2);a++){var d=s.length-1-a,v=s[a].compareTo(s[d]);if(v!==0)return v}return 1}},{key:"compare",value:function(s,a){for(var d=0;d<s.length&&d<a.length;){var v=s[d].compareTo(a[d]);if(v!==0)return v;d++}return d<a.length?-1:d<s.length?1:0}},{key:"minCoordinate",value:function(s){for(var a=null,d=0;d<s.length;d++)(a===null||a.compareTo(s[d])>0)&&(a=s[d]);return a}},{key:"extract",value:function(s,a,d){a=Ie.clamp(a,0,s.length);var v=(d=Ie.clamp(d,-1,s.length))-a+1;d<0&&(v=0),a>=s.length&&(v=0),d<a&&(v=0);var I=new Array(v).fill(null);if(v===0)return I;for(var P=0,O=a;O<=d;O++)I[P++]=s[O];return I}}])}(),zr=function(){return u(function f(){B(this,f)},[{key:"compare",value:function(f,s){var a=f,d=s;return kt.compare(a,d)}},{key:"interfaces_",get:function(){return[bi]}}])}(),ys=function(){return u(function f(){B(this,f)},[{key:"compare",value:function(f,s){var a=f,d=s;if(a.length<d.length)return-1;if(a.length>d.length)return 1;if(a.length===0)return 0;var v=kt.compare(a,d);return kt.isEqualReversed(a,d)?0:v}},{key:"OLDcompare",value:function(f,s){var a=f,d=s;if(a.length<d.length)return-1;if(a.length>d.length)return 1;if(a.length===0)return 0;for(var v=kt.increasingDirection(a),I=kt.increasingDirection(d),P=v>0?0:a.length-1,O=I>0?0:a.length-1,K=0;K<a.length;K++){var re=a[P].compareTo(d[O]);if(re!==0)return re;P+=v,O+=I}return 0}},{key:"interfaces_",get:function(){return[bi]}}])}();kt.ForwardComparator=zr,kt.BidirectionalComparator=ys,kt.coordArrayType=new Array(0).fill(null);var Di=function(){return u(function f(s){B(this,f),this.str=s},[{key:"append",value:function(f){this.str+=f}},{key:"setCharAt",value:function(f,s){this.str=this.str.substr(0,f)+s+this.str.substr(f+1)}},{key:"toString",value:function(){return this.str}}])}(),Nr=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getM",value:function(s){return this.hasM()?this._coordinates[s].getM():xt.NaN}},{key:"setOrdinate",value:function(s,a,d){switch(a){case si.X:this._coordinates[s].x=d;break;case si.Y:this._coordinates[s].y=d;break;default:this._coordinates[s].setOrdinate(a,d)}}},{key:"getZ",value:function(s){return this.hasZ()?this._coordinates[s].getZ():xt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(s,a){switch(a){case si.X:return this._coordinates[s].x;case si.Y:return this._coordinates[s].y;default:return this._coordinates[s].getOrdinate(a)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var s=arguments[0];return this._coordinates[s]}if(arguments.length===2){var a=arguments[0];arguments[1].setCoordinate(this._coordinates[a])}}},{key:"getCoordinateCopy",value:function(s){var a=this.createCoordinate();return a.setCoordinate(this._coordinates[s]),a}},{key:"createCoordinate",value:function(){return _s.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(s){return this._coordinates[s].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(s){for(var a=0;a<this._coordinates.length;a++)s.expandToInclude(this._coordinates[a]);return s}},{key:"copy",value:function(){for(var s=new Array(this.size()).fill(null),a=0;a<this._coordinates.length;a++){var d=this.createCoordinate();d.setCoordinate(this._coordinates[a]),s[a]=d}return new f(s,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var s=new Di(17*this._coordinates.length);s.append("("),s.append(this._coordinates[0]);for(var a=1;a<this._coordinates.length;a++)s.append(", "),s.append(this._coordinates[a]);return s.append(")"),s.toString()}return"()"}},{key:"getY",value:function(s){return this._coordinates[s].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[si,It]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];f.constructor_.call(this,s,kt.dimension(s),kt.measures(s))}else if(Number.isInteger(arguments[0])){var a=arguments[0];this._coordinates=new Array(a).fill(null);for(var d=0;d<a;d++)this._coordinates[d]=new ze}else if(Vt(arguments[0],si)){var v=arguments[0];if(v===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=v.getDimension(),this._measures=v.getMeasures(),this._coordinates=new Array(v.size()).fill(null);for(var I=0;I<this._coordinates.length;I++)this._coordinates[I]=v.getCoordinateCopy(I)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var P=arguments[0],O=arguments[1];f.constructor_.call(this,P,O,kt.measures(P))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var K=arguments[0],re=arguments[1];this._coordinates=new Array(K).fill(null),this._dimension=re;for(var Ce=0;Ce<K;Ce++)this._coordinates[Ce]=_s.create(re)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Oe=arguments[0],We=arguments[1],ht=arguments[2];this._dimension=We,this._measures=ht,this._coordinates=Oe===null?new Array(0).fill(null):Oe}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Et=arguments[0],Rt=arguments[1],Jt=arguments[2];this._coordinates=new Array(Et).fill(null),this._dimension=Rt,this._measures=Jt;for(var ei=0;ei<Et;ei++)this._coordinates[ei]=this.createCoordinate()}}}}])}(),vs=function(){function f(){B(this,f)}return u(f,[{key:"readResolve",value:function(){return f.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Nr(arguments[0]);if(Vt(arguments[0],si))return new Nr(arguments[0])}else{if(arguments.length===2){var s=arguments[1];return s>3&&(s=3),s<2&&(s=2),new Nr(arguments[0],s)}if(arguments.length===3){var a=arguments[2],d=arguments[1]-a;return a>1&&(a=1),d>3&&(d=3),d<2&&(d=2),new Nr(arguments[0],d+a,a)}}}},{key:"interfaces_",get:function(){return[Ue,It]}}],[{key:"instance",value:function(){return f.instanceObject}}])}();vs.instanceObject=new vs;var mr=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&Te(s,"equalsExact",this,1).call(this,a,d)}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return yt.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new W,d=0;d<this._geometries.length;d++)for(var v=this._geometries[d].getBoundary(),I=0;I<v.getNumGeometries();I++)a.add(v.getGeometryN(I));var P=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(P))}},{key:"getGeometryType",value:function(){return yt.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Qt]}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Ji.constructor_.call(this,a,d)}}])}(Ji),Fs=function(){return u(function f(){B(this,f)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),Wn=function(f){function s(){var a;return B(this,s),(a=N(this,s)).map=new Map,a}return de(s,f),u(s,[{key:"get",value:function(a){return this.map.get(a)||null}},{key:"put",value:function(a,d){return this.map.set(a,d),d}},{key:"values",value:function(){for(var a=new W,d=this.map.values(),v=d.next();!v.done;)a.add(v.value),v=d.next();return a}},{key:"entrySet",value:function(){var a=new nn;return this.map.entries().forEach(function(d){return a.add(d)}),a}},{key:"size",value:function(){return this.map.size()}}])}(Fs),fi=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"equals",value:function(s){if(!(s instanceof f))return!1;var a=s;return this._modelType===a._modelType&&this._scale===a._scale}},{key:"compareTo",value:function(s){var a=s,d=this.getMaximumSignificantDigits(),v=a.getMaximumSignificantDigits();return ir.compare(d,v)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===f.FLOATING||this._modelType===f.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var s="UNKNOWN";return this._modelType===f.FLOATING?s="Floating":this._modelType===f.FLOATING_SINGLE?s="Floating-Single":this._modelType===f.FIXED&&(s="Fixed (Scale="+this.getScale()+")"),s}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var s=arguments[0];return xt.isNaN(s)||this._modelType===f.FLOATING_SINGLE?s:this._modelType===f.FIXED?Math.round(s*this._scale)/this._scale:s}if(arguments[0]instanceof ze){var a=arguments[0];if(this._modelType===f.FLOATING)return null;a.x=this.makePrecise(a.x),a.y=this.makePrecise(a.y)}}},{key:"getMaximumSignificantDigits",value:function(){var s=16;return this._modelType===f.FLOATING?s=16:this._modelType===f.FLOATING_SINGLE?s=6:this._modelType===f.FIXED&&(s=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),s}},{key:"setScale",value:function(s){this._scale=Math.abs(s)}},{key:"interfaces_",get:function(){return[It,wt]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=f.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof xs){var s=arguments[0];this._modelType=s,s===f.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var a=arguments[0];this._modelType=f.FIXED,this.setScale(a)}else if(arguments[0]instanceof f){var d=arguments[0];this._modelType=d._modelType,this._scale=d._scale}}}},{key:"mostPrecise",value:function(s,a){return s.compareTo(a)>=0?s:a}}])}(),xs=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"readResolve",value:function(){return f.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[It]}}],[{key:"constructor_",value:function(){this._name=null;var s=arguments[0];this._name=s,f.nameToTypeMap.put(s,this)}}])}();xs.nameToTypeMap=new Wn,fi.Type=xs,fi.FIXED=new xs("FIXED"),fi.FLOATING=new xs("FLOATING"),fi.FLOATING_SINGLE=new xs("FLOATING SINGLE"),fi.maximumPreciseValue=9007199254740992;var bs=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),d=0;d<a.length;d++)a[d]=this._geometries[d].copy();return new s(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof yt){var a=arguments[0],d=arguments[1];return!!this.isEquivalentClass(a)&&Te(s,"equalsExact",this,1).call(this,a,d)}return Te(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?qe.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return yt.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new tn}},{key:"getGeometryType",value:function(){return yt.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[ve]}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Ji.constructor_.call(this,a,d)}}])}(Ji),Or=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"createEmpty",value:function(s){switch(s){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new rt("Invalid dimension: "+s)}}},{key:"toGeometry",value:function(s){return s.isNull()?this.createPoint():s.getMinX()===s.getMaxX()&&s.getMinY()===s.getMaxY()?this.createPoint(new ze(s.getMinX(),s.getMinY())):s.getMinX()===s.getMaxX()||s.getMinY()===s.getMaxY()?this.createLineString([new ze(s.getMinX(),s.getMinY()),new ze(s.getMaxX(),s.getMaxY())]):this.createPolygon(this.createLinearRing([new ze(s.getMinX(),s.getMinY()),new ze(s.getMinX(),s.getMaxY()),new ze(s.getMaxX(),s.getMaxY()),new ze(s.getMaxX(),s.getMinY()),new ze(s.getMinX(),s.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLineString(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(Vt(arguments[0],si))return new Dt(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new bs(null,this):arguments.length===1?new bs(arguments[0],this):void 0}},{key:"buildGeometry",value:function(s){for(var a=null,d=!1,v=!1,I=s.iterator();I.hasNext();){var P=I.next(),O=P.getTypeCode();a===null&&(a=O),O!==a&&(d=!0),P instanceof Ji&&(v=!0)}if(a===null)return this.createGeometryCollection();if(d||v)return this.createGeometryCollection(f.toGeometryArray(s));var K=s.iterator().next();if(s.size()>1){if(K instanceof Zi)return this.createMultiPolygon(f.toPolygonArray(s));if(K instanceof Dt)return this.createMultiLineString(f.toLineStringArray(s));if(K instanceof mi)return this.createMultiPoint(f.toPointArray(s));Ot.shouldNeverReachHere("Unhandled geometry type: "+K.getGeometryType())}return K}},{key:"createMultiPointFromCoords",value:function(s){return this.createMultiPoint(s!==null?this.getCoordinateSequenceFactory().create(s):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof ze){var s=arguments[0];return this.createPoint(s!==null?this.getCoordinateSequenceFactory().create([s]):null)}if(Vt(arguments[0],si))return new mi(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(Vt(arguments[0],si)){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof Array){var a=arguments[0];return this.createPolygon(this.createLinearRing(a))}if(arguments[0]instanceof tt){var d=arguments[0];return this.createPolygon(d,null)}}else if(arguments.length===2)return new Zi(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new Ji(null,this):arguments.length===1?new Ji(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLinearRing(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(Vt(arguments[0],si))return new tt(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new mr(null,this):arguments.length===1?new mr(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Dr(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Dr(arguments[0],this);if(Vt(arguments[0],si)){var s=arguments[0];if(s===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(s.size()).fill(null),d=0;d<s.size();d++){var v=this.getCoordinateSequenceFactory().create(1,s.getDimension(),s.getMeasures());st.copy(s,d,v,0,1),a[d]=this.createPoint(v)}return this.createMultiPoint(a)}}}},{key:"interfaces_",get:function(){return[It]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)f.constructor_.call(this,new fi,0);else if(arguments.length===1){if(Vt(arguments[0],Ue)){var s=arguments[0];f.constructor_.call(this,new fi,0,s)}else if(arguments[0]instanceof fi){var a=arguments[0];f.constructor_.call(this,a,0,f.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];f.constructor_.call(this,d,v,f.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var I=arguments[0],P=arguments[1],O=arguments[2];this._precisionModel=I,this._coordinateSequenceFactory=O,this._SRID=P}}},{key:"toMultiPolygonArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toGeometryArray",value:function(s){if(s===null)return null;var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return vs.instance()}},{key:"toMultiLineStringArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toLineStringArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toMultiPointArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toLinearRingArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toPointArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"toPolygonArray",value:function(s){var a=new Array(s.size()).fill(null);return s.toArray(a)}},{key:"createPointFromInternalCoord",value:function(s,a){return a.getPrecisionModel().makePrecise(s),a.getFactory().createPoint(s)}}])}(),Fr="XY",Jr="XYZ",Uo="XYM",Vo="XYZM",Wa={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},ws="EMPTY",ra=1,Sr=2,nr=3,Go=4,Ts=5,Bs=6;for(var Ka in Wa)Wa[Ka].toUpperCase();var Ja=function(){return u(function f(s){B(this,f),this.wkt=s,this.index_=-1},[{key:"isAlpha_",value:function(f){return f>="a"&&f<="z"||f>="A"&&f<="Z"}},{key:"isNumeric_",value:function(f,s){return f>="0"&&f<="9"||f=="."&&!(s!==void 0&&s)}},{key:"isWhiteSpace_",value:function(f){return f==" "||f=="	"||f=="\r"||f==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var f,s=this.nextChar_(),a=this.index_,d=s;if(s=="(")f=Sr;else if(s==",")f=Ts;else if(s==")")f=nr;else if(this.isNumeric_(s)||s=="-")f=Go,d=this.readNumber_();else if(this.isAlpha_(s))f=ra,d=this.readText_();else{if(this.isWhiteSpace_(s))return this.nextToken();if(s!=="")throw new Error("Unexpected character: "+s);f=Bs}return{position:a,value:d,type:f}}},{key:"readNumber_",value:function(){var f,s=this.index_,a=!1,d=!1;do f=="."?a=!0:f!="e"&&f!="E"||(d=!0),f=this.nextChar_();while(this.isNumeric_(f,a)||!d&&(f=="e"||f=="E")||d&&(f=="-"||f=="+"));return parseFloat(this.wkt.substring(s,this.index_--))}},{key:"readText_",value:function(){var f,s=this.index_;do f=this.nextChar_();while(this.isAlpha_(f));return this.wkt.substring(s,this.index_--).toUpperCase()}}])}(),qo=function(){return u(function f(s,a){B(this,f),this.lexer_=s,this.token_,this.layout_=Fr,this.factory=a},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(f){return this.token_.type==f}},{key:"match",value:function(f){var s=this.isTokenType(f);return s&&this.consume_(),s}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var f=Fr,s=this.token_;if(this.isTokenType(ra)){var a=s.value;a==="Z"?f=Jr:a==="M"?f=Uo:a==="ZM"&&(f=Vo),f!==Fr&&this.consume_()}return f}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Sr)){var f=[];do f.push(this.parseGeometry_());while(this.match(Ts));if(this.match(nr))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Sr)){var f=this.parsePoint_();if(this.match(nr))return f}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Sr)){var f=this.parsePointList_();if(this.match(nr))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Sr)){var f=this.parseLineStringTextList_();if(this.match(nr))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var f;if(this.match(Sr)){if(f=this.token_.type==Sr?this.parsePointTextList_():this.parsePointList_(),this.match(nr))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Sr)){var f=this.parseLineStringTextList_();if(this.match(nr))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Sr)){var f=this.parsePolygonTextList_();if(this.match(nr))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var f=[],s=this.layout_.length,a=0;a<s;++a){var d=this.token_;if(!this.match(Go))break;f.push(d.value)}if(f.length==s)return f;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var f=[this.parsePoint_()];this.match(Ts);)f.push(this.parsePoint_());return f}},{key:"parsePointTextList_",value:function(){for(var f=[this.parsePointText_()];this.match(Ts);)f.push(this.parsePointText_());return f}},{key:"parseLineStringTextList_",value:function(){for(var f=[this.parseLineStringText_()];this.match(Ts);)f.push(this.parseLineStringText_());return f}},{key:"parsePolygonTextList_",value:function(){for(var f=[this.parsePolygonText_()];this.match(Ts);)f.push(this.parsePolygonText_());return f}},{key:"isEmptyGeometry_",value:function(){var f=this.isTokenType(ra)&&this.token_.value==ws;return f&&this.consume_(),f}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var f=this.factory,s=function(Rt){return le(ze,ot(Rt))},a=function(Rt){var Jt=Rt.map(function(ei){return f.createLinearRing(ei.map(s))});return Jt.length>1?f.createPolygon(Jt[0],Jt.slice(1)):f.createPolygon(Jt[0])},d=this.token_;if(this.match(ra)){var v=d.value;if(this.layout_=this.parseGeometryLayout_(),v=="GEOMETRYCOLLECTION"){var I=this.parseGeometryCollectionText_();return f.createGeometryCollection(I)}switch(v){case"POINT":var P=this.parsePointText_();return P?f.createPoint(le(ze,ot(P))):f.createPoint();case"LINESTRING":var O=this.parseLineStringText_().map(s);return f.createLineString(O);case"LINEARRING":var K=this.parseLineStringText_().map(s);return f.createLinearRing(K);case"POLYGON":var re=this.parsePolygonText_();return re&&re.length!==0?a(re):f.createPolygon();case"MULTIPOINT":var Ce=this.parseMultiPointText_();if(!Ce||Ce.length===0)return f.createMultiPoint();var Oe=Ce.map(s).map(function(Rt){return f.createPoint(Rt)});return f.createMultiPoint(Oe);case"MULTILINESTRING":var We=this.parseMultiLineStringText_().map(function(Rt){return f.createLineString(Rt.map(s))});return f.createMultiLineString(We);case"MULTIPOLYGON":var ht=this.parseMultiPolygonText_();if(!ht||ht.length===0)return f.createMultiPolygon();var Et=ht.map(a);return f.createMultiPolygon(Et);default:throw new Error("Invalid geometry type: "+v)}}throw new Error(this.formatErrorMessage_())}}])}();function sa(f){if(f.isEmpty())return"";var s=f.getCoordinate(),a=[s.x,s.y];return s.z===void 0||Number.isNaN(s.z)||a.push(s.z),s.m===void 0||Number.isNaN(s.m)||a.push(s.m),a.join(" ")}function Qr(f){for(var s=f.getCoordinates().map(function(I){var P=[I.x,I.y];return I.z===void 0||Number.isNaN(I.z)||P.push(I.z),I.m===void 0||Number.isNaN(I.m)||P.push(I.m),P}),a=[],d=0,v=s.length;d<v;++d)a.push(s[d].join(" "));return a.join(", ")}function gr(f){var s=[];s.push("("+Qr(f.getExteriorRing())+")");for(var a=0,d=f.getNumInteriorRing();a<d;++a)s.push("("+Qr(f.getInteriorRingN(a))+")");return s.join(", ")}var Kt={Point:sa,LineString:Qr,LinearRing:Qr,Polygon:gr,MultiPoint:function(f){for(var s=[],a=0,d=f.getNumGeometries();a<d;++a)s.push("("+sa(f.getGeometryN(a))+")");return s.join(", ")},MultiLineString:function(f){for(var s=[],a=0,d=f.getNumGeometries();a<d;++a)s.push("("+Qr(f.getGeometryN(a))+")");return s.join(", ")},MultiPolygon:function(f){for(var s=[],a=0,d=f.getNumGeometries();a<d;++a)s.push("("+gr(f.getGeometryN(a))+")");return s.join(", ")},GeometryCollection:function(f){for(var s=[],a=0,d=f.getNumGeometries();a<d;++a)s.push(Er(f.getGeometryN(a)));return s.join(", ")}};function Er(f){var s=f.getGeometryType(),a=Kt[s];s=s.toUpperCase();var d=function(v){var I="";if(v.isEmpty())return I;var P=v.getCoordinate();return P.z===void 0||Number.isNaN(P.z)||(I+="Z"),P.m===void 0||Number.isNaN(P.m)||(I+="M"),I}(f);return d.length>0&&(s+=" "+d),f.isEmpty()?s+" "+ws:s+" ("+a(f)+")"}var Br=function(){return u(function f(s){B(this,f),this.geometryFactory=s||new Or,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(f){var s=new Ja(f);return new qo(s,this.geometryFactory).parse()}},{key:"write",value:function(f){return Er(f)}}])}(),jr=function(){return u(function f(s){B(this,f),this.parser=new Br(s)},[{key:"write",value:function(f){return this.parser.write(f)}}],[{key:"toLineString",value:function(f,s){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+f.x+" "+f.y+", "+s.x+" "+s.y+" )"}}])}(),ki=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getIndexAlongSegment",value:function(s,a){return this.computeIntLineIndex(),this._intLineIndex[s][a]}},{key:"getTopologySummary",value:function(){var s=new Di;return this.isEndPoint()&&s.append(" endpoint"),this._isProper&&s.append(" proper"),this.isCollinear()&&s.append(" collinear"),s.toString()}},{key:"computeIntersection",value:function(s,a,d,v){this._inputLines[0][0]=s,this._inputLines[0][1]=a,this._inputLines[1][0]=d,this._inputLines[1][1]=v,this._result=this.computeIntersect(s,a,d,v)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var s=arguments[0];this.getEdgeDistance(s,0)>this.getEdgeDistance(s,1)?(this._intLineIndex[s][0]=0,this._intLineIndex[s][1]=1):(this._intLineIndex[s][0]=1,this._intLineIndex[s][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var s=arguments[0],a=0;a<this._result;a++)if(!this._intPt[a].equals2D(this._inputLines[s][0])&&!this._intPt[a].equals2D(this._inputLines[s][1]))return!0;return!1}}},{key:"getIntersection",value:function(s){return this._intPt[s]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==f.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(s,a){return f.computeEdgeDistance(this._intPt[a],this._inputLines[s][0],this._inputLines[s][1])}},{key:"isCollinear",value:function(){return this._result===f.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return jr.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+jr.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(s,a){return this._inputLines[s][a]}},{key:"isIntersection",value:function(s){for(var a=0;a<this._result;a++)if(this._intPt[a].equals2D(s))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(s,a){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[s][a]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new ze,this._intPt[1]=new ze,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(s,a,d){var v=Math.abs(d.x-a.x),I=Math.abs(d.y-a.y),P=-1;if(s.equals(a))P=0;else if(s.equals(d))P=v>I?v:I;else{var O=Math.abs(s.x-a.x),K=Math.abs(s.y-a.y);(P=v>I?O:K)!==0||s.equals(a)||(P=Math.max(O,K))}return Ot.isTrue(!(P===0&&!s.equals(a)),"Bad distance calculation"),P}},{key:"nonRobustComputeEdgeDistance",value:function(s,a,d){var v=s.x-a.x,I=s.y-a.y,P=Math.sqrt(v*v+I*I);return Ot.isTrue(!(P===0&&!s.equals(a)),"Invalid distance calculation"),P}}])}();ki.DONT_INTERSECT=0,ki.DO_INTERSECT=1,ki.COLLINEAR=2,ki.NO_INTERSECTION=0,ki.POINT_INTERSECTION=1,ki.COLLINEAR_INTERSECTION=2;var Ur=function(f){function s(){return B(this,s),N(this,s)}return de(s,f),u(s,[{key:"isInSegmentEnvelopes",value:function(a){var d=new vi(this._inputLines[0][0],this._inputLines[0][1]),v=new vi(this._inputLines[1][0],this._inputLines[1][1]);return d.contains(a)&&v.contains(a)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return Te(s,"computeIntersection",this,1).apply(this,arguments);var a=arguments[0],d=arguments[1],v=arguments[2];if(this._isProper=!1,vi.intersects(d,v,a)&&Nt.index(d,v,a)===0&&Nt.index(v,d,a)===0)return this._isProper=!0,(a.equals(d)||a.equals(v))&&(this._isProper=!1),this._result=ki.POINT_INTERSECTION,null;this._result=ki.NO_INTERSECTION}},{key:"intersection",value:function(a,d,v,I){var P=this.intersectionSafe(a,d,v,I);return this.isInSegmentEnvelopes(P)||(P=new ze(s.nearestEndpoint(a,d,v,I))),this._precisionModel!==null&&this._precisionModel.makePrecise(P),P}},{key:"checkDD",value:function(a,d,v,I,P){var O=gs.intersection(a,d,v,I),K=this.isInSegmentEnvelopes(O);Me.out.println("DD in env = "+K+"  --------------------- "+O),P.distance(O)>1e-4&&Me.out.println("Distance = "+P.distance(O))}},{key:"intersectionSafe",value:function(a,d,v,I){var P=Ee.intersection(a,d,v,I);return P===null&&(P=s.nearestEndpoint(a,d,v,I)),P}},{key:"computeCollinearIntersection",value:function(a,d,v,I){var P=vi.intersects(a,d,v),O=vi.intersects(a,d,I),K=vi.intersects(v,I,a),re=vi.intersects(v,I,d);return P&&O?(this._intPt[0]=v,this._intPt[1]=I,ki.COLLINEAR_INTERSECTION):K&&re?(this._intPt[0]=a,this._intPt[1]=d,ki.COLLINEAR_INTERSECTION):P&&K?(this._intPt[0]=v,this._intPt[1]=a,!v.equals(a)||O||re?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):P&&re?(this._intPt[0]=v,this._intPt[1]=d,!v.equals(d)||O||K?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):O&&K?(this._intPt[0]=I,this._intPt[1]=a,!I.equals(a)||P||re?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):O&&re?(this._intPt[0]=I,this._intPt[1]=d,!I.equals(d)||P||K?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):ki.NO_INTERSECTION}},{key:"computeIntersect",value:function(a,d,v,I){if(this._isProper=!1,!vi.intersects(a,d,v,I))return ki.NO_INTERSECTION;var P=Nt.index(a,d,v),O=Nt.index(a,d,I);if(P>0&&O>0||P<0&&O<0)return ki.NO_INTERSECTION;var K=Nt.index(v,I,a),re=Nt.index(v,I,d);return K>0&&re>0||K<0&&re<0?ki.NO_INTERSECTION:P===0&&O===0&&K===0&&re===0?this.computeCollinearIntersection(a,d,v,I):(P===0||O===0||K===0||re===0?(this._isProper=!1,a.equals2D(v)||a.equals2D(I)?this._intPt[0]=a:d.equals2D(v)||d.equals2D(I)?this._intPt[0]=d:P===0?this._intPt[0]=new ze(v):O===0?this._intPt[0]=new ze(I):K===0?this._intPt[0]=new ze(a):re===0&&(this._intPt[0]=new ze(d))):(this._isProper=!0,this._intPt[0]=this.intersection(a,d,v,I)),ki.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(a,d,v,I){var P=a,O=Ve.pointToSegment(a,v,I),K=Ve.pointToSegment(d,v,I);return K<O&&(O=K,P=d),(K=Ve.pointToSegment(v,a,d))<O&&(O=K,P=v),(K=Ve.pointToSegment(I,a,d))<O&&(O=K,P=I),P}}])}(ki),rr=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"countSegment",value:function(s,a){if(s.x<this._p.x&&a.x<this._p.x)return null;if(this._p.x===a.x&&this._p.y===a.y)return this._isPointOnSegment=!0,null;if(s.y===this._p.y&&a.y===this._p.y){var d=s.x,v=a.x;return d>v&&(d=a.x,v=s.x),this._p.x>=d&&this._p.x<=v&&(this._isPointOnSegment=!0),null}if(s.y>this._p.y&&a.y<=this._p.y||a.y>this._p.y&&s.y<=this._p.y){var I=Nt.index(s,a,this._p);if(I===Nt.COLLINEAR)return this._isPointOnSegment=!0,null;a.y<s.y&&(I=-I),I===Nt.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==me.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?me.BOUNDARY:this._crossingCount%2==1?me.INTERIOR:me.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var s=arguments[0];this._p=s}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof ze&&Vt(arguments[1],si)){for(var s=arguments[1],a=new f(arguments[0]),d=new ze,v=new ze,I=1;I<s.size();I++)if(s.getCoordinate(I,d),s.getCoordinate(I-1,v),a.countSegment(d,v),a.isOnSegment())return a.getLocation();return a.getLocation()}if(arguments[0]instanceof ze&&arguments[1]instanceof Array){for(var P=arguments[1],O=new f(arguments[0]),K=1;K<P.length;K++){var re=P[K],Ce=P[K-1];if(O.countSegment(re,Ce),O.isOnSegment())return O.getLocation()}return O.getLocation()}}}])}(),_r=function(){function f(){B(this,f)}return u(f,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof ze&&Vt(arguments[1],si)){for(var s=arguments[0],a=arguments[1],d=new Ur,v=new ze,I=new ze,P=a.size(),O=1;O<P;O++)if(a.getCoordinate(O-1,v),a.getCoordinate(O,I),d.computeIntersection(s,v,I),d.hasIntersection())return!0;return!1}if(arguments[0]instanceof ze&&arguments[1]instanceof Array){for(var K=arguments[0],re=arguments[1],Ce=new Ur,Oe=1;Oe<re.length;Oe++){var We=re[Oe-1],ht=re[Oe];if(Ce.computeIntersection(K,We,ht),Ce.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(s,a){return rr.locatePointInRing(s,a)}},{key:"isInRing",value:function(s,a){return f.locateInRing(s,a)!==me.EXTERIOR}}])}(),Ut=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"setAllLocations",value:function(s){for(var a=0;a<this.location.length;a++)this.location[a]=s}},{key:"isNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]!==me.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(s){for(var a=0;a<this.location.length;a++)this.location[a]===me.NONE&&(this.location[a]=s)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(s){if(s.location.length>this.location.length){var a=new Array(3).fill(null);a[Je.ON]=this.location[Je.ON],a[Je.LEFT]=me.NONE,a[Je.RIGHT]=me.NONE,this.location=a}for(var d=0;d<this.location.length;d++)this.location[d]===me.NONE&&d<s.location.length&&(this.location[d]=s.location[d])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var s=this.location[Je.LEFT];this.location[Je.LEFT]=this.location[Je.RIGHT],this.location[Je.RIGHT]=s}},{key:"toString",value:function(){var s=new pr;return this.location.length>1&&s.append(me.toLocationSymbol(this.location[Je.LEFT])),s.append(me.toLocationSymbol(this.location[Je.ON])),this.location.length>1&&s.append(me.toLocationSymbol(this.location[Je.RIGHT])),s.toString()}},{key:"setLocations",value:function(s,a,d){this.location[Je.ON]=s,this.location[Je.LEFT]=a,this.location[Je.RIGHT]=d}},{key:"get",value:function(s){return s<this.location.length?this.location[s]:me.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]===me.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var s=arguments[0];this.setLocation(Je.ON,s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.location[a]=d}}},{key:"init",value:function(s){this.location=new Array(s).fill(null),this.setAllLocations(me.NONE)}},{key:"isEqualOnSide",value:function(s,a){return this.location[a]===s.location[a]}},{key:"allPositionsEqual",value:function(s){for(var a=0;a<this.location.length;a++)if(this.location[a]!==s)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];this.init(s.length)}else if(Number.isInteger(arguments[0])){var a=arguments[0];this.init(1),this.location[Je.ON]=a}else if(arguments[0]instanceof f){var d=arguments[0];if(this.init(d.location.length),d!==null)for(var v=0;v<this.location.length;v++)this.location[v]=d.location[v]}}else if(arguments.length===3){var I=arguments[0],P=arguments[1],O=arguments[2];this.init(3),this.location[Je.ON]=I,this.location[Je.LEFT]=P,this.location[Je.RIGHT]=O}}}])}(),_n=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getGeometryCount",value:function(){var s=0;return this.elt[0].isNull()||s++,this.elt[1].isNull()||s++,s}},{key:"setAllLocations",value:function(s,a){this.elt[s].setAllLocations(a)}},{key:"isNull",value:function(s){return this.elt[s].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var s=arguments[0];this.setAllLocationsIfNull(0,s),this.setAllLocationsIfNull(1,s)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.elt[a].setAllLocationsIfNull(d)}}},{key:"isLine",value:function(s){return this.elt[s].isLine()}},{key:"merge",value:function(s){for(var a=0;a<2;a++)this.elt[a]===null&&s.elt[a]!==null?this.elt[a]=new Ut(s.elt[a]):this.elt[a].merge(s.elt[a])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var s=arguments[0];return this.elt[s].get(Je.ON)}if(arguments.length===2){var a=arguments[0],d=arguments[1];return this.elt[a].get(d)}}},{key:"toString",value:function(){var s=new pr;return this.elt[0]!==null&&(s.append("A:"),s.append(this.elt[0].toString())),this.elt[1]!==null&&(s.append(" B:"),s.append(this.elt[1].toString())),s.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var s=arguments[0];return this.elt[s].isArea()}}},{key:"isAnyNull",value:function(s){return this.elt[s].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];this.elt[s].setLocation(Je.ON,a)}else if(arguments.length===3){var d=arguments[0],v=arguments[1],I=arguments[2];this.elt[d].setLocation(v,I)}}},{key:"isEqualOnSide",value:function(s,a){return this.elt[0].isEqualOnSide(s.elt[0],a)&&this.elt[1].isEqualOnSide(s.elt[1],a)}},{key:"allPositionsEqual",value:function(s,a){return this.elt[s].allPositionsEqual(a)}},{key:"toLine",value:function(s){this.elt[s].isArea()&&(this.elt[s]=new Ut(this.elt[s].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var s=arguments[0];this.elt[0]=new Ut(s),this.elt[1]=new Ut(s)}else if(arguments[0]instanceof f){var a=arguments[0];this.elt[0]=new Ut(a.elt[0]),this.elt[1]=new Ut(a.elt[1])}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this.elt[0]=new Ut(me.NONE),this.elt[1]=new Ut(me.NONE),this.elt[d].setLocation(v)}else if(arguments.length===3){var I=arguments[0],P=arguments[1],O=arguments[2];this.elt[0]=new Ut(I,P,O),this.elt[1]=new Ut(I,P,O)}else if(arguments.length===4){var K=arguments[0],re=arguments[1],Ce=arguments[2],Oe=arguments[3];this.elt[0]=new Ut(me.NONE,me.NONE,me.NONE),this.elt[1]=new Ut(me.NONE,me.NONE,me.NONE),this.elt[K].setLocations(re,Ce,Oe)}}},{key:"toLineLabel",value:function(s){for(var a=new f(me.NONE),d=0;d<2;d++)a.setLocation(d,s.getLocation(d));return a}}])}(),Is=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var f=new Array(this._pts.size()).fill(null),s=0;s<this._pts.size();s++)f[s]=this._pts.get(s);this._ring=this._geometryFactory.createLinearRing(f),this._isHole=Nt.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(f){this._startDe=f;var s=f,a=!0;do{if(s===null)throw new Y("Found null DirectedEdge");if(s.getEdgeRing()===this)throw new Y("Directed Edge visited twice during ring-building at "+s.getCoordinate());this._edges.add(s);var d=s.getLabel();Ot.isTrue(d.isArea()),this.mergeLabel(d),this.addPoints(s.getEdge(),s.isForward(),a),a=!1,this.setEdgeRing(s,this),s=this.getNext(s)}while(s!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(f){return this._pts.get(f)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var f=this._startDe;do{var s=f.getNode().getEdges().getOutgoingDegree(this);s>this._maxNodeDegree&&(this._maxNodeDegree=s),f=this.getNext(f)}while(f!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(f,s,a){var d=f.getCoordinates();if(s){var v=1;a&&(v=0);for(var I=v;I<d.length;I++)this._pts.add(d[I])}else{var P=d.length-2;a&&(P=d.length-1);for(var O=P;O>=0;O--)this._pts.add(d[O])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var f=this._startDe;do f.getEdge().setInResult(!0),f=f.getNext();while(f!==this._startDe)}},{key:"containsPoint",value:function(f){var s=this.getLinearRing();if(!s.getEnvelopeInternal().contains(f)||!_r.isInRing(f,s.getCoordinates()))return!1;for(var a=this._holes.iterator();a.hasNext();)if(a.next().containsPoint(f))return!1;return!0}},{key:"addHole",value:function(f){this._holes.add(f)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var f=arguments[0];this.mergeLabel(f,0),this.mergeLabel(f,1)}else if(arguments.length===2){var s=arguments[1],a=arguments[0].getLocation(s,Je.RIGHT);if(a===me.NONE)return null;if(this._label.getLocation(s)===me.NONE)return this._label.setLocation(s,a),null}}},{key:"setShell",value:function(f){this._shell=f,f!==null&&f.addHole(this)}},{key:"toPolygon",value:function(f){for(var s=new Array(this._holes.size()).fill(null),a=0;a<this._holes.size();a++)s[a]=this._holes.get(a).getLinearRing();return f.createPolygon(this.getLinearRing(),s)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new W,this._pts=new W,this._label=new _n(me.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new W,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],s=arguments[1];this._geometryFactory=s,this.computePoints(f),this.computeRing()}}}}])}(),Qa=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"setEdgeRing",value:function(a,d){a.setMinEdgeRing(d)}},{key:"getNext",value:function(a){return a.getNextMin()}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Is.constructor_.call(this,a,d)}}])}(Is),yn=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"buildMinimalRings",value:function(){var a=new W,d=this._startDe;do{if(d.getMinEdgeRing()===null){var v=new Qa(d,this._geometryFactory);a.add(v)}d=d.getNext()}while(d!==this._startDe);return a}},{key:"setEdgeRing",value:function(a,d){a.setEdgeRing(d)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var a=this._startDe;do a.getNode().getEdges().linkMinimalDirectedEdges(this),a=a.getNext();while(a!==this._startDe)}},{key:"getNext",value:function(a){return a.getNext()}}],[{key:"constructor_",value:function(){var a=arguments[0],d=arguments[1];Is.constructor_.call(this,a,d)}}])}(Is),Xi=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(f){this._isVisited=f}},{key:"setInResult",value:function(f){this._isInResult=f}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(f){this._label=f}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(f){this._isCovered=f,this._isCoveredSet=!0}},{key:"updateIM",value:function(f){Ot.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(f)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this._label=f}}}}])}(),rn=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"isIncidentEdgeInResult",value:function(){for(var a=this.getEdges().getEdges().iterator();a.hasNext();)if(a.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(a){a.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(a){}},{key:"computeMergedLocation",value:function(a,d){var v=me.NONE;if(v=this._label.getLocation(d),!a.isNull(d)){var I=a.getLocation(d);v!==me.BOUNDARY&&(v=I)}return v}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return Te(s,"setLabel",this,1).apply(this,arguments);var a=arguments[0],d=arguments[1];this._label===null?this._label=new _n(a,d):this._label.setLocation(a,d)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof s){var a=arguments[0];this.mergeLabel(a._label)}else if(arguments[0]instanceof _n)for(var d=arguments[0],v=0;v<2;v++){var I=this.computeMergedLocation(d,v);this._label.getLocation(v)===me.NONE&&this._label.setLocation(v,I)}}},{key:"add",value:function(a){this._edges.insert(a),a.setNode(this)}},{key:"setLabelBoundary",value:function(a){if(this._label===null)return null;var d=me.NONE;this._label!==null&&(d=this._label.getLocation(a));var v=null;switch(d){case me.BOUNDARY:v=me.INTERIOR;break;case me.INTERIOR:default:v=me.BOUNDARY}this._label.setLocation(a,v)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var a=arguments[0],d=arguments[1];this._coord=a,this._edges=d,this._label=new _n(0,me.NONE)}}])}(Xi),un=function(f){function s(){return B(this,s),N(this,s,arguments)}return de(s,f),u(s)}(Fs);function Mi(f){return f==null?0:f.color}function pi(f){return f==null?null:f.parent}function Yt(f,s){f!==null&&(f.color=s)}function vn(f){return f==null?null:f.left}function $t(f){return f==null?null:f.right}var Zt=function(f){function s(){var a;return B(this,s),(a=N(this,s)).root_=null,a.size_=0,a}return de(s,f),u(s,[{key:"get",value:function(a){for(var d=this.root_;d!==null;){var v=a.compareTo(d.key);if(v<0)d=d.left;else{if(!(v>0))return d.value;d=d.right}}return null}},{key:"put",value:function(a,d){if(this.root_===null)return this.root_={key:a,value:d,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var v,I,P=this.root_;do if(v=P,(I=a.compareTo(P.key))<0)P=P.left;else{if(!(I>0)){var O=P.value;return P.value=d,O}P=P.right}while(P!==null);var K={key:a,left:null,right:null,value:d,parent:v,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return I<0?v.left=K:v.right=K,this.fixAfterInsertion(K),this.size_++,null}},{key:"fixAfterInsertion",value:function(a){var d;for(a.color=1;a!=null&&a!==this.root_&&a.parent.color===1;)pi(a)===vn(pi(pi(a)))?Mi(d=$t(pi(pi(a))))===1?(Yt(pi(a),0),Yt(d,0),Yt(pi(pi(a)),1),a=pi(pi(a))):(a===$t(pi(a))&&(a=pi(a),this.rotateLeft(a)),Yt(pi(a),0),Yt(pi(pi(a)),1),this.rotateRight(pi(pi(a)))):Mi(d=vn(pi(pi(a))))===1?(Yt(pi(a),0),Yt(d,0),Yt(pi(pi(a)),1),a=pi(pi(a))):(a===vn(pi(a))&&(a=pi(a),this.rotateRight(a)),Yt(pi(a),0),Yt(pi(pi(a)),1),this.rotateLeft(pi(pi(a))));this.root_.color=0}},{key:"values",value:function(){var a=new W,d=this.getFirstEntry();if(d!==null)for(a.add(d.value);(d=s.successor(d))!==null;)a.add(d.value);return a}},{key:"entrySet",value:function(){var a=new nn,d=this.getFirstEntry();if(d!==null)for(a.add(d);(d=s.successor(d))!==null;)a.add(d);return a}},{key:"rotateLeft",value:function(a){if(a!=null){var d=a.right;a.right=d.left,d.left!=null&&(d.left.parent=a),d.parent=a.parent,a.parent==null?this.root_=d:a.parent.left===a?a.parent.left=d:a.parent.right=d,d.left=a,a.parent=d}}},{key:"rotateRight",value:function(a){if(a!=null){var d=a.left;a.left=d.right,d.right!=null&&(d.right.parent=a),d.parent=a.parent,a.parent==null?this.root_=d:a.parent.right===a?a.parent.right=d:a.parent.left=d,d.right=a,a.parent=d}}},{key:"getFirstEntry",value:function(){var a=this.root_;if(a!=null)for(;a.left!=null;)a=a.left;return a}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(a){for(var d=this.root_;d!==null;){var v=a.compareTo(d.key);if(v<0)d=d.left;else{if(!(v>0))return!0;d=d.right}}return!1}}],[{key:"successor",value:function(a){var d;if(a===null)return null;if(a.right!==null){for(d=a.right;d.left!==null;)d=d.left;return d}d=a.parent;for(var v=a;d!==null&&v===d.right;)v=d,d=d.parent;return d}}])}(un),es=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"find",value:function(f){return this.nodeMap.get(f)}},{key:"addNode",value:function(){if(arguments[0]instanceof ze){var f=arguments[0],s=this.nodeMap.get(f);return s===null&&(s=this.nodeFact.createNode(f),this.nodeMap.put(f,s)),s}if(arguments[0]instanceof rn){var a=arguments[0],d=this.nodeMap.get(a.getCoordinate());return d===null?(this.nodeMap.put(a.getCoordinate(),a),a):(d.mergeLabel(a),d)}}},{key:"print",value:function(f){for(var s=this.iterator();s.hasNext();)s.next().print(f)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(f){for(var s=new W,a=this.iterator();a.hasNext();){var d=a.next();d.getLabel().getLocation(f)===me.BOUNDARY&&s.add(d)}return s}},{key:"add",value:function(f){var s=f.getCoordinate();this.addNode(s).add(f)}}],[{key:"constructor_",value:function(){this.nodeMap=new Zt,this.nodeFact=null;var f=arguments[0];this.nodeFact=f}}])}(),bt=function(){function f(){B(this,f)}return u(f,null,[{key:"isNorthern",value:function(s){return s===f.NE||s===f.NW}},{key:"isOpposite",value:function(s,a){return s!==a&&(s-a+4)%4===2}},{key:"commonHalfPlane",value:function(s,a){if(s===a)return s;if((s-a+4)%4===2)return-1;var d=s<a?s:a;return d===0&&(s>a?s:a)===3?3:d}},{key:"isInHalfPlane",value:function(s,a){return a===f.SE?s===f.SE||s===f.SW:s===a||s===a+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1];if(s===0&&a===0)throw new rt("Cannot compute the quadrant for point ( "+s+", "+a+" )");return s>=0?a>=0?f.NE:f.SE:a>=0?f.NW:f.SW}if(arguments[0]instanceof ze&&arguments[1]instanceof ze){var d=arguments[0],v=arguments[1];if(v.x===d.x&&v.y===d.y)throw new rt("Cannot compute the quadrant for two identical points "+d);return v.x>=d.x?v.y>=d.y?f.NE:f.SE:v.y>=d.y?f.NW:f.SW}}}])}();bt.NE=0,bt.NW=1,bt.SW=2,bt.SE=3;var ts=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"compareDirection",value:function(s){return this._dx===s._dx&&this._dy===s._dy?0:this._quadrant>s._quadrant?1:this._quadrant<s._quadrant?-1:Nt.index(s._p0,s._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(s){this._node=s}},{key:"print",value:function(s){var a=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),v=d.lastIndexOf("."),I=d.substring(v+1);s.print("  "+I+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+a+"   "+this._label)}},{key:"compareTo",value:function(s){var a=s;return this.compareDirection(a)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var s=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),d=a.lastIndexOf(".");return"  "+a.substring(d+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label}},{key:"computeLabel",value:function(s){}},{key:"init",value:function(s,a){this._p0=s,this._p1=a,this._dx=a.x-s.x,this._dy=a.y-s.y,this._quadrant=bt.quadrant(this._dx,this._dy),Ot.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var s=arguments[0];this._edge=s}else if(arguments.length===3){var a=arguments[0],d=arguments[1],v=arguments[2];f.constructor_.call(this,a,d,v,null)}else if(arguments.length===4){var I=arguments[0],P=arguments[1],O=arguments[2],K=arguments[3];f.constructor_.call(this,I),this.init(P,O),this._label=K}}}])}(),dn=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(a){return this._depth[a]}},{key:"setVisited",value:function(a){this._isVisited=a}},{key:"computeDirectedLabel",value:function(){this._label=new _n(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(a,d){if(this._depth[a]!==-999&&this._depth[a]!==d)throw new Y("assigned depths do not match",this.getCoordinate());this._depth[a]=d}},{key:"isInteriorAreaEdge",value:function(){for(var a=!0,d=0;d<2;d++)this._label.isArea(d)&&this._label.getLocation(d,Je.LEFT)===me.INTERIOR&&this._label.getLocation(d,Je.RIGHT)===me.INTERIOR||(a=!1);return a}},{key:"setNextMin",value:function(a){this._nextMin=a}},{key:"print",value:function(a){Te(s,"print",this,1).call(this,a),a.print(" "+this._depth[Je.LEFT]+"/"+this._depth[Je.RIGHT]),a.print(" ("+this.getDepthDelta()+")"),this._isInResult&&a.print(" inResult")}},{key:"setMinEdgeRing",value:function(a){this._minEdgeRing=a}},{key:"isLineEdge",value:function(){var a=this._label.isLine(0)||this._label.isLine(1),d=!this._label.isArea(0)||this._label.allPositionsEqual(0,me.EXTERIOR),v=!this._label.isArea(1)||this._label.allPositionsEqual(1,me.EXTERIOR);return a&&d&&v}},{key:"setEdgeRing",value:function(a){this._edgeRing=a}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var a=this._edge.getDepthDelta();return this._isForward||(a=-a),a}},{key:"setInResult",value:function(a){this._isInResult=a}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(a){this.print(a),a.print(" "),this._isForward?this._edge.print(a):this._edge.printReverse(a)}},{key:"setSym",value:function(a){this._sym=a}},{key:"setVisitedEdge",value:function(a){this.setVisited(a),this._sym.setVisited(a)}},{key:"setEdgeDepths",value:function(a,d){var v=this.getEdge().getDepthDelta();this._isForward||(v=-v);var I=1;a===Je.LEFT&&(I=-1);var P=Je.opposite(a),O=d+v*I;this.setDepth(a,d),this.setDepth(P,O)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(a){this._next=a}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var a=arguments[0],d=arguments[1];if(ts.constructor_.call(this,a),this._isForward=d,d)this.init(a.getCoordinate(0),a.getCoordinate(1));else{var v=a.getNumPoints()-1;this.init(a.getCoordinate(v),a.getCoordinate(v-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(a,d){return a===me.EXTERIOR&&d===me.INTERIOR?1:a===me.INTERIOR&&d===me.EXTERIOR?-1:0}}])}(ts),Ss=function(){return u(function f(){B(this,f)},[{key:"createNode",value:function(f){return new rn(f,null)}}])}(),Kn=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(f){f.println("Edges:");for(var s=0;s<this._edges.size();s++){f.println("edge "+s+":");var a=this._edges.get(s);a.print(f),a.eiList.print(f)}}},{key:"find",value:function(f){return this._nodes.find(f)}},{key:"addNode",value:function(){if(arguments[0]instanceof rn){var f=arguments[0];return this._nodes.addNode(f)}if(arguments[0]instanceof ze){var s=arguments[0];return this._nodes.addNode(s)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(f){Me.out.println(f)}},{key:"isBoundaryNode",value:function(f,s){var a=this._nodes.find(s);if(a===null)return!1;var d=a.getLabel();return d!==null&&d.getLocation(f)===me.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(f,s,a,d){return!!f.equals(a)&&Nt.index(f,s,d)===Nt.COLLINEAR&&bt.quadrant(f,s)===bt.quadrant(a,d)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(f){Me.out.print(f)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(f,s){for(var a=0;a<this._edges.size();a++){var d=this._edges.get(a),v=d.getCoordinates();if(this.matchInSameDirection(f,s,v[0],v[1])||this.matchInSameDirection(f,s,v[v.length-1],v[v.length-2]))return d}return null}},{key:"insertEdge",value:function(f){this._edges.add(f)}},{key:"findEdgeEnd",value:function(f){for(var s=this.getEdgeEnds().iterator();s.hasNext();){var a=s.next();if(a.getEdge()===f)return a}return null}},{key:"addEdges",value:function(f){for(var s=f.iterator();s.hasNext();){var a=s.next();this._edges.add(a);var d=new dn(a,!0),v=new dn(a,!1);d.setSym(v),v.setSym(d),this.add(d),this.add(v)}}},{key:"add",value:function(f){this._nodes.add(f),this._edgeEndList.add(f)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(f,s){for(var a=0;a<this._edges.size();a++){var d=this._edges.get(a),v=d.getCoordinates();if(f.equals(v[0])&&s.equals(v[1]))return d}return null}}],[{key:"constructor_",value:function(){if(this._edges=new W,this._nodes=null,this._edgeEndList=new W,arguments.length===0)this._nodes=new es(new Ss);else if(arguments.length===1){var f=arguments[0];this._nodes=new es(f)}}},{key:"linkResultDirectedEdges",value:function(f){for(var s=f.iterator();s.hasNext();)s.next().getEdges().linkResultDirectedEdges()}}])}(),eo=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"sortShellsAndHoles",value:function(s,a,d){for(var v=s.iterator();v.hasNext();){var I=v.next();I.isHole()?d.add(I):a.add(I)}}},{key:"computePolygons",value:function(s){for(var a=new W,d=s.iterator();d.hasNext();){var v=d.next().toPolygon(this._geometryFactory);a.add(v)}return a}},{key:"placeFreeHoles",value:function(s,a){for(var d=a.iterator();d.hasNext();){var v=d.next();if(v.getShell()===null){var I=f.findEdgeRingContaining(v,s);if(I===null)throw new Y("unable to assign hole to a shell",v.getCoordinate(0));v.setShell(I)}}}},{key:"buildMinimalEdgeRings",value:function(s,a,d){for(var v=new W,I=s.iterator();I.hasNext();){var P=I.next();if(P.getMaxNodeDegree()>2){P.linkDirectedEdgesForMinimalEdgeRings();var O=P.buildMinimalRings(),K=this.findShell(O);K!==null?(this.placePolygonHoles(K,O),a.add(K)):d.addAll(O)}else v.add(P)}return v}},{key:"buildMaximalEdgeRings",value:function(s){for(var a=new W,d=s.iterator();d.hasNext();){var v=d.next();if(v.isInResult()&&v.getLabel().isArea()&&v.getEdgeRing()===null){var I=new yn(v,this._geometryFactory);a.add(I),I.setInResult()}}return a}},{key:"placePolygonHoles",value:function(s,a){for(var d=a.iterator();d.hasNext();){var v=d.next();v.isHole()&&v.setShell(s)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(s){for(var a=0,d=null,v=s.iterator();v.hasNext();){var I=v.next();I.isHole()||(d=I,a++)}return Ot.isTrue(a<=1,"found two shells in MinimalEdgeRing list"),d}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];this.add(s.getEdgeEnds(),s.getNodes())}else if(arguments.length===2){var a=arguments[0],d=arguments[1];Kn.linkResultDirectedEdges(d);var v=this.buildMaximalEdgeRings(a),I=new W,P=this.buildMinimalEdgeRings(v,this._shellList,I);this.sortShellsAndHoles(P,this._shellList,I),this.placeFreeHoles(this._shellList,I)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new W;var s=arguments[0];this._geometryFactory=s}},{key:"findEdgeRingContaining",value:function(s,a){for(var d=s.getLinearRing(),v=d.getEnvelopeInternal(),I=d.getCoordinateN(0),P=null,O=null,K=a.iterator();K.hasNext();){var re=K.next(),Ce=re.getLinearRing(),Oe=Ce.getEnvelopeInternal();if(!Oe.equals(v)&&Oe.contains(v)){I=kt.ptNotInList(d.getCoordinates(),Ce.getCoordinates());var We=!1;_r.isInRing(I,Ce.getCoordinates())&&(We=!0),We&&(P===null||O.contains(Oe))&&(O=(P=re).getLinearRing().getEnvelopeInternal())}}return P}}])}(),yr=function(){return u(function f(){B(this,f)},[{key:"getBounds",value:function(){}}])}(),kr=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[yr,It]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var f=arguments[0],s=arguments[1];this._bounds=f,this._item=s}}])}(),aa=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var f=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),f}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(f){for(var s=null,a=this._items.get(f);2*f<=this._size&&((s=2*f)!==this._size&&this._items.get(s+1).compareTo(this._items.get(s))<0&&s++,this._items.get(s).compareTo(a)<0);f=s)this._items.set(f,this._items.get(s));this._items.set(f,a)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(f){this._items.add(null),this._size+=1;var s=this._size;for(this._items.set(0,f);f.compareTo(this._items.get(Math.trunc(s/2)))<0;s/=2)this._items.set(s,this._items.get(Math.trunc(s/2)));this._items.set(s,f)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new W,this._items.add(null)}}])}(),oa=function(){return u(function f(){B(this,f)},[{key:"insert",value:function(f,s){}},{key:"remove",value:function(f,s){}},{key:"query",value:function(){}}])}(),xn=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(f){Ot.isTrue(this._bounds===null),this._childBoundables.add(f)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[yr,It]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new W,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this._level=f}}}}])}(),bn={reverseOrder:function(){return{compare:function(f,s){return s.compareTo(f)}}},min:function(f){return bn.sort(f),f.get(0)},sort:function(f,s){var a=f.toArray();s?Pt.sort(a,s):Pt.sort(a);for(var d=f.iterator(),v=0,I=a.length;v<I;v++)d.next(),d.set(a[v])},singletonList:function(f){var s=new W;return s.add(f),s}},cn=function(){function f(){B(this,f)}return u(f,null,[{key:"maxDistance",value:function(s,a,d,v,I,P,O,K){var re=f.distance(s,a,I,P);return re=Math.max(re,f.distance(s,a,O,K)),re=Math.max(re,f.distance(d,v,I,P)),re=Math.max(re,f.distance(d,v,O,K))}},{key:"distance",value:function(s,a,d,v){var I=d-s,P=v-a;return Math.sqrt(I*I+P*P)}},{key:"maximumDistance",value:function(s,a){var d=Math.min(s.getMinX(),a.getMinX()),v=Math.min(s.getMinY(),a.getMinY()),I=Math.max(s.getMaxX(),a.getMaxX()),P=Math.max(s.getMaxY(),a.getMaxY());return f.distance(d,v,I,P)}},{key:"minMaxDistance",value:function(s,a){var d=s.getMinX(),v=s.getMinY(),I=s.getMaxX(),P=s.getMaxY(),O=a.getMinX(),K=a.getMinY(),re=a.getMaxX(),Ce=a.getMaxY(),Oe=f.maxDistance(d,v,d,P,O,K,O,Ce);return Oe=Math.min(Oe,f.maxDistance(d,v,d,P,O,K,re,K)),Oe=Math.min(Oe,f.maxDistance(d,v,d,P,re,Ce,O,Ce)),Oe=Math.min(Oe,f.maxDistance(d,v,d,P,re,Ce,re,K)),Oe=Math.min(Oe,f.maxDistance(d,v,I,v,O,K,O,Ce)),Oe=Math.min(Oe,f.maxDistance(d,v,I,v,O,K,re,K)),Oe=Math.min(Oe,f.maxDistance(d,v,I,v,re,Ce,O,Ce)),Oe=Math.min(Oe,f.maxDistance(d,v,I,v,re,Ce,re,K)),Oe=Math.min(Oe,f.maxDistance(I,P,d,P,O,K,O,Ce)),Oe=Math.min(Oe,f.maxDistance(I,P,d,P,O,K,re,K)),Oe=Math.min(Oe,f.maxDistance(I,P,d,P,re,Ce,O,Ce)),Oe=Math.min(Oe,f.maxDistance(I,P,d,P,re,Ce,re,K)),Oe=Math.min(Oe,f.maxDistance(I,P,I,v,O,K,O,Ce)),Oe=Math.min(Oe,f.maxDistance(I,P,I,v,O,K,re,K)),Oe=Math.min(Oe,f.maxDistance(I,P,I,v,re,Ce,O,Ce)),Oe=Math.min(Oe,f.maxDistance(I,P,I,v,re,Ce,re,K))}}])}(),vr=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"maximumDistance",value:function(){return cn.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(s,a){var d=f.isComposite(this._boundable1),v=f.isComposite(this._boundable2);if(d&&v)return f.area(this._boundable1)>f.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,s,a),null):(this.expand(this._boundable2,this._boundable1,!0,s,a),null);if(d)return this.expand(this._boundable1,this._boundable2,!1,s,a),null;if(v)return this.expand(this._boundable2,this._boundable1,!0,s,a),null;throw new rt("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(f.isComposite(this._boundable1)||f.isComposite(this._boundable2))}},{key:"compareTo",value:function(s){var a=s;return this._distance<a._distance?-1:this._distance>a._distance?1:0}},{key:"expand",value:function(s,a,d,v,I){for(var P=s.getChildBoundables().iterator();P.hasNext();){var O=P.next(),K=null;(K=d?new f(a,O,this._itemDistance):new f(O,a,this._itemDistance)).getDistance()<I&&v.add(K)}}},{key:"getBoundable",value:function(s){return s===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var s=arguments[0],a=arguments[1],d=arguments[2];this._boundable1=s,this._boundable2=a,this._itemDistance=d,this._distance=this.distance()}},{key:"area",value:function(s){return s.getBounds().getArea()}},{key:"isComposite",value:function(s){return s instanceof xn}}])}(),js=function(){return u(function f(){B(this,f)},[{key:"visitItem",value:function(f){}}])}(),xr=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"queryInternal",value:function(){if(Vt(arguments[2],js)&&arguments[0]instanceof Object&&arguments[1]instanceof xn)for(var s=arguments[0],a=arguments[2],d=arguments[1].getChildBoundables(),v=0;v<d.size();v++){var I=d.get(v);this.getIntersectsOp().intersects(I.getBounds(),s)&&(I instanceof xn?this.queryInternal(s,I,a):I instanceof kr?a.visitItem(I.getItem()):Ot.shouldNeverReachHere())}else if(Vt(arguments[2],fr)&&arguments[0]instanceof Object&&arguments[1]instanceof xn)for(var P=arguments[0],O=arguments[2],K=arguments[1].getChildBoundables(),re=0;re<K.size();re++){var Ce=K.get(re);this.getIntersectsOp().intersects(Ce.getBounds(),P)&&(Ce instanceof xn?this.queryInternal(P,Ce,O):Ce instanceof kr?O.add(Ce.getItem()):Ot.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(s){return s.get(s.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var s=0,a=arguments[0].getChildBoundables().iterator();a.hasNext();){var d=a.next();d instanceof xn?s+=this.size(d):d instanceof kr&&(s+=1)}return s}}},{key:"removeItem",value:function(s,a){for(var d=null,v=s.getChildBoundables().iterator();v.hasNext();){var I=v.next();I instanceof kr&&I.getItem()===a&&(d=I)}return d!==null&&(s.getChildBoundables().remove(d),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var s=this.itemsTree(this._root);return s===null?new W:s}if(arguments.length===1){for(var a=arguments[0],d=new W,v=a.getChildBoundables().iterator();v.hasNext();){var I=v.next();if(I instanceof xn){var P=this.itemsTree(I);P!==null&&d.add(P)}else I instanceof kr?d.add(I.getItem()):Ot.shouldNeverReachHere()}return d.size()<=0?null:d}}},{key:"insert",value:function(s,a){Ot.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new kr(s,a))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var s=arguments[0],a=new W;return this.boundablesAtLevel(s,this._root,a),a}if(arguments.length===3){var d=arguments[0],v=arguments[1],I=arguments[2];if(Ot.isTrue(d>-2),v.getLevel()===d)return I.add(v),null;for(var P=v.getChildBoundables().iterator();P.hasNext();){var O=P.next();O instanceof xn?this.boundablesAtLevel(d,O,I):(Ot.isTrue(O instanceof kr),d===-1&&I.add(O))}return null}}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];this.build();var a=new W;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.queryInternal(s,this._root,a),a}if(arguments.length===2){var d=arguments[0],v=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),d)&&this.queryInternal(d,this._root,v)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.remove(s,this._root,a)}if(arguments.length===3){var d=arguments[0],v=arguments[1],I=arguments[2],P=this.removeItem(v,I);if(P)return!0;for(var O=null,K=v.getChildBoundables().iterator();K.hasNext();){var re=K.next();if(this.getIntersectsOp().intersects(re.getBounds(),d)&&re instanceof xn&&(P=this.remove(d,re,I))){O=re;break}}return O!==null&&O.getChildBoundables().isEmpty()&&v.getChildBoundables().remove(O),P}}},{key:"createHigherLevels",value:function(s,a){Ot.isTrue(!s.isEmpty());var d=this.createParentBoundables(s,a+1);return d.size()===1?d.get(0):this.createHigherLevels(d,a+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var s=0,a=arguments[0].getChildBoundables().iterator();a.hasNext();){var d=a.next();if(d instanceof xn){var v=this.depth(d);v>s&&(s=v)}}return s+1}}},{key:"createParentBoundables",value:function(s,a){Ot.isTrue(!s.isEmpty());var d=new W;d.add(this.createNode(a));var v=new W(s);bn.sort(v,this.getComparator());for(var I=v.iterator();I.hasNext();){var P=I.next();this.lastNode(d).getChildBoundables().size()===this.getNodeCapacity()&&d.add(this.createNode(a)),this.lastNode(d).addChildBoundable(P)}return d}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[It]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new W,this._nodeCapacity=null,arguments.length===0)f.constructor_.call(this,f.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];Ot.isTrue(s>1,"Node capacity must be greater than 1"),this._nodeCapacity=s}}},{key:"compareDoubles",value:function(s,a){return s>a?1:s<a?-1:0}}])}();xr.IntersectsOp=function(){},xr.DEFAULT_NODE_CAPACITY=10;var Qi=function(){return u(function f(){B(this,f)},[{key:"distance",value:function(f,s){}}])}(),Un=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"createParentBoundablesFromVerticalSlices",value:function(a,d){Ot.isTrue(a.length>0);for(var v=new W,I=0;I<a.length;I++)v.addAll(this.createParentBoundablesFromVerticalSlice(a[I],d));return v}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var a=arguments[0],d=arguments[1];return this.nearestNeighbourK(a,xt.POSITIVE_INFINITY,d)}if(arguments.length===3){var v=arguments[0],I=arguments[2],P=arguments[1],O=new aa;O.add(v);for(var K=new aa;!O.isEmpty()&&P>=0;){var re=O.poll(),Ce=re.getDistance();if(Ce>=P)break;re.isLeaves()?K.size()<I?K.add(re):(K.peek().getDistance()>Ce&&(K.poll(),K.add(re)),P=K.peek().getDistance()):re.expandToQueue(O,P)}return s.getItems(K)}}},{key:"createNode",value:function(a){return new Es(a)}},{key:"size",value:function(){return arguments.length===0?Te(s,"size",this,1).call(this):Te(s,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof vi))return Te(s,"insert",this,1).apply(this,arguments);var a=arguments[0],d=arguments[1];if(a.isNull())return null;Te(s,"insert",this,1).call(this,a,d)}},{key:"getIntersectsOp",value:function(){return s.intersectsOp}},{key:"verticalSlices",value:function(a,d){for(var v=Math.trunc(Math.ceil(a.size()/d)),I=new Array(d).fill(null),P=a.iterator(),O=0;O<d;O++){I[O]=new W;for(var K=0;P.hasNext()&&K<v;){var re=P.next();I[O].add(re),K++}}return I}},{key:"query",value:function(){if(arguments.length===1){var a=arguments[0];return Te(s,"query",this,1).call(this,a)}if(arguments.length===2){var d=arguments[0],v=arguments[1];Te(s,"query",this,1).call(this,d,v)}}},{key:"getComparator",value:function(){return s.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(a,d){return Te(s,"createParentBoundables",this,1).call(this,a,d)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof vi){var a=arguments[0],d=arguments[1];return Te(s,"remove",this,1).call(this,a,d)}return Te(s,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?Te(s,"depth",this,1).call(this):Te(s,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(a,d){Ot.isTrue(!a.isEmpty());var v=Math.trunc(Math.ceil(a.size()/this.getNodeCapacity())),I=new W(a);bn.sort(I,s.xComparator);var P=this.verticalSlices(I,Math.trunc(Math.ceil(Math.sqrt(v))));return this.createParentBoundablesFromVerticalSlices(P,d)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(Vt(arguments[0],Qi)){var a=arguments[0];if(this.isEmpty())return null;var d=new vr(this.getRoot(),this.getRoot(),a);return this.nearestNeighbour(d)}if(arguments[0]instanceof vr){var v=arguments[0],I=xt.POSITIVE_INFINITY,P=null,O=new aa;for(O.add(v);!O.isEmpty()&&I>0;){var K=O.poll(),re=K.getDistance();if(re>=I)break;K.isLeaves()?(I=re,P=K):K.expandToQueue(O,I)}return P===null?null:[P.getBoundable(0).getItem(),P.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Ce=arguments[0],Oe=arguments[1];if(this.isEmpty()||Ce.isEmpty())return null;var We=new vr(this.getRoot(),Ce.getRoot(),Oe);return this.nearestNeighbour(We)}if(arguments.length===3){var ht=arguments[2],Et=new kr(arguments[0],arguments[1]),Rt=new vr(this.getRoot(),Et,ht);return this.nearestNeighbour(Rt)[0]}if(arguments.length===4){var Jt=arguments[2],ei=arguments[3],_i=new kr(arguments[0],arguments[1]),Ti=new vr(this.getRoot(),_i,Jt);return this.nearestNeighbourK(Ti,ei)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var a=arguments[0],d=arguments[1],v=xt.POSITIVE_INFINITY,I=new aa;for(I.add(a);!I.isEmpty();){var P=I.poll(),O=P.getDistance();if(O>d)return!1;if(P.maximumDistance()<=d)return!0;if(P.isLeaves()){if((v=O)<=d)return!0}else P.expandToQueue(I,v)}return!1}if(arguments.length===3){var K=arguments[0],re=arguments[1],Ce=arguments[2],Oe=new vr(this.getRoot(),K.getRoot(),re);return this.isWithinDistance(Oe,Ce)}}},{key:"interfaces_",get:function(){return[oa,It]}}],[{key:"constructor_",value:function(){if(arguments.length===0)s.constructor_.call(this,s.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var a=arguments[0];xr.constructor_.call(this,a)}}},{key:"centreX",value:function(a){return s.avg(a.getMinX(),a.getMaxX())}},{key:"avg",value:function(a,d){return(a+d)/2}},{key:"getItems",value:function(a){for(var d=new Array(a.size()).fill(null),v=0;!a.isEmpty();){var I=a.poll();d[v]=I.getBoundable(0).getItem(),v++}return d}},{key:"centreY",value:function(a){return s.avg(a.getMinY(),a.getMaxY())}}])}(xr),Es=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"computeBounds",value:function(){for(var a=null,d=this.getChildBoundables().iterator();d.hasNext();){var v=d.next();a===null?a=new vi(v.getBounds()):a.expandToInclude(v.getBounds())}return a}}],[{key:"constructor_",value:function(){var a=arguments[0];xn.constructor_.call(this,a)}}])}(xn);Un.STRtreeNode=Es,Un.xComparator=new(function(){return u(function f(){B(this,f)},[{key:"interfaces_",get:function(){return[bi]}},{key:"compare",value:function(f,s){return xr.compareDoubles(Un.centreX(f.getBounds()),Un.centreX(s.getBounds()))}}])}()),Un.yComparator=new(function(){return u(function f(){B(this,f)},[{key:"interfaces_",get:function(){return[bi]}},{key:"compare",value:function(f,s){return xr.compareDoubles(Un.centreY(f.getBounds()),Un.centreY(s.getBounds()))}}])}()),Un.intersectsOp=new(function(){return u(function f(){B(this,f)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(f,s){return f.intersects(s)}}])}()),Un.DEFAULT_NODE_CAPACITY=10;var Us=function(){function f(){B(this,f)}return u(f,null,[{key:"relativeSign",value:function(s,a){return s<a?-1:s>a?1:0}},{key:"compare",value:function(s,a,d){if(a.equals2D(d))return 0;var v=f.relativeSign(a.x,d.x),I=f.relativeSign(a.y,d.y);switch(s){case 0:return f.compareValue(v,I);case 1:return f.compareValue(I,v);case 2:return f.compareValue(I,-v);case 3:return f.compareValue(-v,I);case 4:return f.compareValue(-v,-I);case 5:return f.compareValue(-I,-v);case 6:return f.compareValue(-I,v);case 7:return f.compareValue(v,-I)}return Ot.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(s,a){return s<0?-1:s>0?1:a<0?-1:a>0?1:0}}])}(),jl=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(f){var s=f;return this.segmentIndex<s.segmentIndex?-1:this.segmentIndex>s.segmentIndex?1:this.coord.equals2D(s.coord)?0:this._isInterior?s._isInterior?Us.compare(this._segmentOctant,this.coord,s.coord):1:-1}},{key:"isEndPoint",value:function(f){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===f}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var f=arguments[0],s=arguments[1],a=arguments[2],d=arguments[3];this._segString=f,this.coord=new ze(s),this.segmentIndex=a,this._segmentOctant=d,this._isInterior=!s.equals2D(f.getCoordinate(a))}}])}(),is=function(){return u(function f(){B(this,f)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),la=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var f=new jn;this.addEndpoints();for(var s=this.iterator(),a=s.next();s.hasNext();){var d=s.next();this.addEdgeCoordinates(a,d,f),a=d}return f.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var f=new W;this.findCollapsesFromInsertedNodes(f),this.findCollapsesFromExistingVertices(f);for(var s=f.iterator();s.hasNext();){var a=s.next().intValue();this.add(this._edge.getCoordinate(a),a)}}},{key:"createSplitEdgePts",value:function(f,s){var a=s.segmentIndex-f.segmentIndex+2;if(a===2)return[new ze(f.coord),new ze(s.coord)];var d=this._edge.getCoordinate(s.segmentIndex),v=s.isInterior()||!s.coord.equals2D(d);v||a--;var I=new Array(a).fill(null),P=0;I[P++]=new ze(f.coord);for(var O=f.segmentIndex+1;O<=s.segmentIndex;O++)I[P++]=this._edge.getCoordinate(O);return v&&(I[P]=new ze(s.coord)),I}},{key:"print",value:function(f){f.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(f)}},{key:"findCollapsesFromExistingVertices",value:function(f){for(var s=0;s<this._edge.size()-2;s++){var a=this._edge.getCoordinate(s);this._edge.getCoordinate(s+1);var d=this._edge.getCoordinate(s+2);a.equals2D(d)&&f.add(ir.valueOf(s+1))}}},{key:"addEdgeCoordinates",value:function(f,s,a){var d=this.createSplitEdgePts(f,s);a.add(d,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(f){this.addEndpoints(),this.addCollapsedNodes();for(var s=this.iterator(),a=s.next();s.hasNext();){var d=s.next(),v=this.createSplitEdge(a,d);f.add(v),a=d}}},{key:"findCollapseIndex",value:function(f,s,a){if(!f.coord.equals2D(s.coord))return!1;var d=s.segmentIndex-f.segmentIndex;return s.isInterior()||d--,d===1&&(a[0]=f.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(f){for(var s=new Array(1).fill(null),a=this.iterator(),d=a.next();a.hasNext();){var v=a.next();this.findCollapseIndex(d,v,s)&&f.add(ir.valueOf(s[0])),d=v}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var f=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(f),f)}},{key:"createSplitEdge",value:function(f,s){var a=this.createSplitEdgePts(f,s);return new sr(a,this._edge.getData())}},{key:"add",value:function(f,s){var a=new jl(this._edge,f,s,this._edge.getSegmentOctant(s)),d=this._nodeMap.get(a);return d!==null?(Ot.isTrue(d.coord.equals2D(f),"Found equal nodes with different coordinates"),d):(this._nodeMap.put(a,a),a)}},{key:"checkSplitEdgesCorrectness",value:function(f){var s=this._edge.getCoordinates(),a=f.get(0).getCoordinate(0);if(!a.equals2D(s[0]))throw new jt("bad split edge start point at "+a);var d=f.get(f.size()-1).getCoordinates(),v=d[d.length-1];if(!v.equals2D(s[s.length-1]))throw new jt("bad split edge end point at "+v)}}],[{key:"constructor_",value:function(){this._nodeMap=new Zt,this._edge=null;var f=arguments[0];this._edge=f}}])}(),to=function(){function f(){B(this,f)}return u(f,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1];if(s===0&&a===0)throw new rt("Cannot compute the octant for point ( "+s+", "+a+" )");var d=Math.abs(s),v=Math.abs(a);return s>=0?a>=0?d>=v?0:1:d>=v?7:6:a>=0?d>=v?3:2:d>=v?4:5}if(arguments[0]instanceof ze&&arguments[1]instanceof ze){var I=arguments[0],P=arguments[1],O=P.x-I.x,K=P.y-I.y;if(O===0&&K===0)throw new rt("Cannot compute the octant for two identical points "+I);return f.octant(O,K)}}}])}(),Ul=function(){return u(function f(){B(this,f)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(f){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(f){}},{key:"getData",value:function(){}}])}(),Ln=function(){return u(function f(){B(this,f)},[{key:"addIntersection",value:function(f,s){}},{key:"interfaces_",get:function(){return[Ul]}}])}(),sr=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(s){return this._pts[s]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(s){return s===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(s),this.getCoordinate(s+1))}},{key:"setData",value:function(s){this._data=s}},{key:"safeOctant",value:function(s,a){return s.equals2D(a)?0:to.octant(s,a)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];this.addIntersectionNode(s,a)}else if(arguments.length===4){var d=arguments[1],v=arguments[3],I=new ze(arguments[0].getIntersection(v));this.addIntersection(I,d)}}},{key:"toString",value:function(){return jr.toLineString(new Nr(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(s,a){var d=a,v=d+1;if(v<this._pts.length){var I=this._pts[v];s.equals2D(I)&&(d=v)}return this._nodeList.add(s,d)}},{key:"addIntersections",value:function(s,a,d){for(var v=0;v<s.getIntersectionNum();v++)this.addIntersection(s,a,d,v)}},{key:"interfaces_",get:function(){return[Ln]}}],[{key:"constructor_",value:function(){this._nodeList=new la(this),this._pts=null,this._data=null;var s=arguments[0],a=arguments[1];this._pts=s,this._data=a}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var s=arguments[0],a=new W;return f.getNodedSubstrings(s,a),a}if(arguments.length===2)for(var d=arguments[1],v=arguments[0].iterator();v.hasNext();)v.next().getNodeList().addSplitEdges(d)}}])}(),Ai=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof f){var s=arguments[0],a=Nt.index(this.p0,this.p1,s.p0),d=Nt.index(this.p0,this.p1,s.p1);return a>=0&&d>=0||a<=0&&d<=0?Math.max(a,d):0}if(arguments[0]instanceof ze){var v=arguments[0];return Nt.index(this.p0,this.p1,v)}}},{key:"toGeometry",value:function(s){return s.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(s){if(!(s instanceof f))return!1;var a=s;return this.p0.equals(a.p0)&&this.p1.equals(a.p1)}},{key:"intersection",value:function(s){var a=new Ur;return a.computeIntersection(this.p0,this.p1,s.p0,s.p1),a.hasIntersection()?a.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof ze){var s=arguments[0];if(s.equals(this.p0)||s.equals(this.p1))return new ze(s);var a=this.projectionFactor(s),d=new ze;return d.x=this.p0.x+a*(this.p1.x-this.p0.x),d.y=this.p0.y+a*(this.p1.y-this.p0.y),d}if(arguments[0]instanceof f){var v=arguments[0],I=this.projectionFactor(v.p0),P=this.projectionFactor(v.p1);if(I>=1&&P>=1||I<=0&&P<=0)return null;var O=this.project(v.p0);I<0&&(O=this.p0),I>1&&(O=this.p1);var K=this.project(v.p1);return P<0&&(K=this.p0),P>1&&(K=this.p1),new f(O,K)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(s){return s===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(s){return Ve.pointToLinePerpendicular(s,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return f.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(s){if(s.equals(this.p0))return 0;if(s.equals(this.p1))return 1;var a=this.p1.x-this.p0.x,d=this.p1.y-this.p0.y,v=a*a+d*d;return v<=0?xt.NaN:((s.x-this.p0.x)*a+(s.y-this.p0.y)*d)/v}},{key:"closestPoints",value:function(s){var a=this.intersection(s);if(a!==null)return[a,a];var d=new Array(2).fill(null),v=xt.MAX_VALUE,I=null,P=this.closestPoint(s.p0);v=P.distance(s.p0),d[0]=P,d[1]=s.p0;var O=this.closestPoint(s.p1);(I=O.distance(s.p1))<v&&(v=I,d[0]=O,d[1]=s.p1);var K=s.closestPoint(this.p0);(I=K.distance(this.p0))<v&&(v=I,d[0]=this.p0,d[1]=K);var re=s.closestPoint(this.p1);return(I=re.distance(this.p1))<v&&(v=I,d[0]=this.p1,d[1]=re),d}},{key:"closestPoint",value:function(s){var a=this.projectionFactor(s);return a>0&&a<1?this.project(s):this.p0.distance(s)<this.p1.distance(s)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(s){var a=s,d=this.p0.compareTo(a.p0);return d!==0?d:this.p1.compareTo(a.p1)}},{key:"reverse",value:function(){var s=this.p0;this.p0=this.p1,this.p1=s}},{key:"equalsTopo",value:function(s){return this.p0.equals(s.p0)&&this.p1.equals(s.p1)||this.p0.equals(s.p1)&&this.p1.equals(s.p0)}},{key:"lineIntersection",value:function(s){return Ee.intersection(this.p0,this.p1,s.p0,s.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(s,a){var d=this.p0.x+s*(this.p1.x-this.p0.x),v=this.p0.y+s*(this.p1.y-this.p0.y),I=this.p1.x-this.p0.x,P=this.p1.y-this.p0.y,O=Math.sqrt(I*I+P*P),K=0,re=0;if(a!==0){if(O<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");K=a*I/O,re=a*P/O}return new ze(d-re,v+K)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var s=arguments[0];this.setCoordinates(s.p0,s.p1)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.p0.x=a.x,this.p0.y=a.y,this.p1.x=d.x,this.p1.y=d.y}}},{key:"segmentFraction",value:function(s){var a=this.projectionFactor(s);return a<0?a=0:(a>1||xt.isNaN(a))&&(a=1),a}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(s){var a=this.p1.getY()-this.p0.getY(),d=this.p0.getX()-this.p1.getX(),v=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),I=a*a+d*d,P=a*a-d*d,O=s.getX(),K=s.getY();return new ze((-P*O-2*a*d*K-2*a*v)/I,(P*K-2*a*d*O-2*d*v)/I)}},{key:"distance",value:function(){if(arguments[0]instanceof f){var s=arguments[0];return Ve.segmentToSegment(this.p0,this.p1,s.p0,s.p1)}if(arguments[0]instanceof ze){var a=arguments[0];return Ve.pointToSegment(a,this.p0,this.p1)}}},{key:"pointAlong",value:function(s){var a=new ze;return a.x=this.p0.x+s*(this.p1.x-this.p0.x),a.y=this.p0.y+s*(this.p1.y-this.p0.y),a}},{key:"hashCode",value:function(){var s=xt.doubleToLongBits(this.p0.x);s^=31*xt.doubleToLongBits(this.p0.y);var a=Math.trunc(s)^Math.trunc(s>>32),d=xt.doubleToLongBits(this.p1.x);return d^=31*xt.doubleToLongBits(this.p1.y),a^(Math.trunc(d)^Math.trunc(d>>32))}},{key:"interfaces_",get:function(){return[wt,It]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)f.constructor_.call(this,new ze,new ze);else if(arguments.length===1){var s=arguments[0];f.constructor_.call(this,s.p0,s.p1)}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this.p0=a,this.p1=d}else if(arguments.length===4){var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3];f.constructor_.call(this,new ze(v,I),new ze(P,O))}}},{key:"midPoint",value:function(s,a){return new ze((s.x+a.x)/2,(s.y+a.y)/2)}}])}(),Vn=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var f=arguments[1],s=arguments[2],a=arguments[3];arguments[0].getLineSegment(f,this._overlapSeg1),s.getLineSegment(a,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Ai,this._overlapSeg2=new Ai}}])}(),Ta=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(f,s){s.p0=this._pts[f],s.p1=this._pts[f+1]}},{key:"computeSelect",value:function(f,s,a,d){var v=this._pts[s],I=this._pts[a];if(a-s==1)return d.select(this,s),null;if(!f.intersects(v,I))return null;var P=Math.trunc((s+a)/2);s<P&&this.computeSelect(f,s,P,d),P<a&&this.computeSelect(f,P,a,d)}},{key:"getCoordinates",value:function(){for(var f=new Array(this._end-this._start+1).fill(null),s=0,a=this._start;a<=this._end;a++)f[s++]=this._pts[a];return f}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var f=arguments[0],s=arguments[1];this.computeOverlaps(this._start,this._end,f,f._start,f._end,s)}else if(arguments.length===6){var a=arguments[0],d=arguments[1],v=arguments[2],I=arguments[3],P=arguments[4],O=arguments[5];if(d-a==1&&P-I==1)return O.overlap(this,a,v,I),null;if(!this.overlaps(a,d,v,I,P))return null;var K=Math.trunc((a+d)/2),re=Math.trunc((I+P)/2);a<K&&(I<re&&this.computeOverlaps(a,K,v,I,re,O),re<P&&this.computeOverlaps(a,K,v,re,P,O)),K<d&&(I<re&&this.computeOverlaps(K,d,v,I,re,O),re<P&&this.computeOverlaps(K,d,v,re,P,O))}}},{key:"setId",value:function(f){this._id=f}},{key:"select",value:function(f,s){this.computeSelect(f,this._start,this._end,s)}},{key:"getEnvelope",value:function(){if(this._env===null){var f=this._pts[this._start],s=this._pts[this._end];this._env=new vi(f,s)}return this._env}},{key:"overlaps",value:function(f,s,a,d,v){return vi.intersects(this._pts[f],this._pts[s],a._pts[d],a._pts[v])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var f=arguments[0],s=arguments[1],a=arguments[2],d=arguments[3];this._pts=f,this._start=s,this._end=a,this._context=d}}])}(),ua=function(){function f(){B(this,f)}return u(f,null,[{key:"findChainEnd",value:function(s,a){for(var d=a;d<s.length-1&&s[d].equals2D(s[d+1]);)d++;if(d>=s.length-1)return s.length-1;for(var v=bt.quadrant(s[d],s[d+1]),I=a+1;I<s.length&&!(!s[I-1].equals2D(s[I])&&bt.quadrant(s[I-1],s[I])!==v);)I++;return I-1}},{key:"getChains",value:function(){if(arguments.length===1){var s=arguments[0];return f.getChains(s,null)}if(arguments.length===2){var a=arguments[0],d=arguments[1],v=new W,I=0;do{var P=f.findChainEnd(a,I),O=new Ta(a,I,P,d);v.add(O),I=P}while(I<a.length-1);return v}}}])}(),ns=function(){return u(function f(){B(this,f)},[{key:"computeNodes",value:function(f){}},{key:"getNodedSubstrings",value:function(){}}])}(),Ia=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(f){this._segInt=f}},{key:"interfaces_",get:function(){return[ns]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this.setSegmentIntersector(f)}}}}])}(),io=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return sr.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(a){for(var d=ua.getChains(a.getCoordinates(),a).iterator();d.hasNext();){var v=d.next();v.setId(this._idCounter++),this._index.insert(v.getEnvelope(),v),this._monoChains.add(v)}}},{key:"computeNodes",value:function(a){this._nodedSegStrings=a;for(var d=a.iterator();d.hasNext();)this.add(d.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var a=new $o(this._segInt),d=this._monoChains.iterator();d.hasNext();)for(var v=d.next(),I=this._index.query(v.getEnvelope()).iterator();I.hasNext();){var P=I.next();if(P.getId()>v.getId()&&(v.computeOverlaps(P,a),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new W,this._index=new Un,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var a=arguments[0];Ia.constructor_.call(this,a)}}}}])}(Ia),$o=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"overlap",value:function(){if(arguments.length!==4)return Te(s,"overlap",this,1).apply(this,arguments);var a=arguments[1],d=arguments[2],v=arguments[3],I=arguments[0].getContext(),P=d.getContext();this._si.processIntersections(I,a,P,v)}}],[{key:"constructor_",value:function(){this._si=null;var a=arguments[0];this._si=a}}])}(Vn);io.SegmentOverlapAction=$o;var br=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"isDeletable",value:function(s,a,d,v){var I=this._inputLine[s],P=this._inputLine[a],O=this._inputLine[d];return!!this.isConcave(I,P,O)&&!!this.isShallow(I,P,O,v)&&this.isShallowSampled(I,P,s,d,v)}},{key:"deleteShallowConcavities",value:function(){for(var s=1,a=this.findNextNonDeletedIndex(s),d=this.findNextNonDeletedIndex(a),v=!1;d<this._inputLine.length;){var I=!1;this.isDeletable(s,a,d,this._distanceTol)&&(this._isDeleted[a]=f.DELETE,I=!0,v=!0),s=I?d:a,a=this.findNextNonDeletedIndex(s),d=this.findNextNonDeletedIndex(a)}return v}},{key:"isShallowConcavity",value:function(s,a,d,v){return Nt.index(s,a,d)===this._angleOrientation&&Ve.pointToSegment(a,s,d)<v}},{key:"isShallowSampled",value:function(s,a,d,v,I){var P=Math.trunc((v-d)/f.NUM_PTS_TO_CHECK);P<=0&&(P=1);for(var O=d;O<v;O+=P)if(!this.isShallow(s,a,this._inputLine[O],I))return!1;return!0}},{key:"isConcave",value:function(s,a,d){var v=Nt.index(s,a,d)===this._angleOrientation;return v}},{key:"simplify",value:function(s){this._distanceTol=Math.abs(s),s<0&&(this._angleOrientation=Nt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var a=!1;do a=this.deleteShallowConcavities();while(a);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(s){for(var a=s+1;a<this._inputLine.length&&this._isDeleted[a]===f.DELETE;)a++;return a}},{key:"isShallow",value:function(s,a,d,v){return Ve.pointToSegment(a,s,d)<v}},{key:"collapseLine",value:function(){for(var s=new jn,a=0;a<this._inputLine.length;a++)this._isDeleted[a]!==f.DELETE&&s.add(this._inputLine[a]);return s.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Nt.COUNTERCLOCKWISE;var s=arguments[0];this._inputLine=s}},{key:"simplify",value:function(s,a){return new f(s).simplify(a)}}])}();br.INIT=0,br.DELETE=1,br.KEEP=1,br.NUM_PTS_TO_CHECK=10;var Zo=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getCoordinates",value:function(){return this._ptList.toArray(f.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"addPt",value:function(s){var a=new ze(s);if(this._precisionModel.makePrecise(a),this.isRedundant(a))return null;this._ptList.add(a)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(s,a){if(a)for(var d=0;d<s.length;d++)this.addPt(s[d]);else for(var v=s.length-1;v>=0;v--)this.addPt(s[v])}},{key:"isRedundant",value:function(s){if(this._ptList.size()<1)return!1;var a=this._ptList.get(this._ptList.size()-1);return s.distance(a)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Or().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var s=new ze(this._ptList.get(0)),a=this._ptList.get(this._ptList.size()-1);if(s.equals(a))return null;this._ptList.add(s)}},{key:"setMinimumVertexDistance",value:function(s){this._minimimVertexDistance=s}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new W}}])}();Zo.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var wn=function(){function f(){B(this,f)}return u(f,null,[{key:"toDegrees",value:function(s){return 180*s/Math.PI}},{key:"normalize",value:function(s){for(;s>Math.PI;)s-=f.PI_TIMES_2;for(;s<=-Math.PI;)s+=f.PI_TIMES_2;return s}},{key:"angle",value:function(){if(arguments.length===1){var s=arguments[0];return Math.atan2(s.y,s.x)}if(arguments.length===2){var a=arguments[0],d=arguments[1],v=d.x-a.x,I=d.y-a.y;return Math.atan2(I,v)}}},{key:"isAcute",value:function(s,a,d){var v=s.x-a.x,I=s.y-a.y;return v*(d.x-a.x)+I*(d.y-a.y)>0}},{key:"isObtuse",value:function(s,a,d){var v=s.x-a.x,I=s.y-a.y;return v*(d.x-a.x)+I*(d.y-a.y)<0}},{key:"interiorAngle",value:function(s,a,d){var v=f.angle(a,s),I=f.angle(a,d);return Math.abs(I-v)}},{key:"normalizePositive",value:function(s){if(s<0){for(;s<0;)s+=f.PI_TIMES_2;s>=f.PI_TIMES_2&&(s=0)}else{for(;s>=f.PI_TIMES_2;)s-=f.PI_TIMES_2;s<0&&(s=0)}return s}},{key:"angleBetween",value:function(s,a,d){var v=f.angle(a,s),I=f.angle(a,d);return f.diff(v,I)}},{key:"diff",value:function(s,a){var d=null;return(d=s<a?a-s:s-a)>Math.PI&&(d=2*Math.PI-d),d}},{key:"toRadians",value:function(s){return s*Math.PI/180}},{key:"getTurn",value:function(s,a){var d=Math.sin(a-s);return d>0?f.COUNTERCLOCKWISE:d<0?f.CLOCKWISE:f.NONE}},{key:"angleBetweenOriented",value:function(s,a,d){var v=f.angle(a,s),I=f.angle(a,d)-v;return I<=-Math.PI?I+f.PI_TIMES_2:I>Math.PI?I-f.PI_TIMES_2:I}}])}();wn.PI_TIMES_2=2*Math.PI,wn.PI_OVER_2=Math.PI/2,wn.PI_OVER_4=Math.PI/4,wn.COUNTERCLOCKWISE=Nt.COUNTERCLOCKWISE,wn.CLOCKWISE=Nt.CLOCKWISE,wn.NONE=Nt.COLLINEAR;var rs=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"addNextSegment",value:function(s,a){if(this._s0=this._s1,this._s1=this._s2,this._s2=s,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var d=Nt.index(this._s0,this._s1,this._s2),v=d===Nt.CLOCKWISE&&this._side===Je.LEFT||d===Nt.COUNTERCLOCKWISE&&this._side===Je.RIGHT;d===0?this.addCollinear(a):v?this.addOutsideTurn(d,a):this.addInsideTurn(d,a)}},{key:"addLineEndCap",value:function(s,a){var d=new Ai(s,a),v=new Ai;this.computeOffsetSegment(d,Je.LEFT,this._distance,v);var I=new Ai;this.computeOffsetSegment(d,Je.RIGHT,this._distance,I);var P=a.x-s.x,O=a.y-s.y,K=Math.atan2(O,P);switch(this._bufParams.getEndCapStyle()){case nt.CAP_ROUND:this._segList.addPt(v.p1),this.addDirectedFillet(a,K+Math.PI/2,K-Math.PI/2,Nt.CLOCKWISE,this._distance),this._segList.addPt(I.p1);break;case nt.CAP_FLAT:this._segList.addPt(v.p1),this._segList.addPt(I.p1);break;case nt.CAP_SQUARE:var re=new ze;re.x=Math.abs(this._distance)*Math.cos(K),re.y=Math.abs(this._distance)*Math.sin(K);var Ce=new ze(v.p1.x+re.x,v.p1.y+re.y),Oe=new ze(I.p1.x+re.x,I.p1.y+re.y);this._segList.addPt(Ce),this._segList.addPt(Oe)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(s,a,d,v){var I=Ee.intersection(a.p0,a.p1,d.p0,d.p1);if(I!==null&&(v<=0?1:I.distance(s)/Math.abs(v))<=this._bufParams.getMitreLimit())return this._segList.addPt(I),null;this.addLimitedMitreJoin(a,d,v,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(s,a){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*f.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===nt.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===nt.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(a&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,s,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(s){this._segList.addPt(new ze(s.x+this._distance,s.y+this._distance)),this._segList.addPt(new ze(s.x+this._distance,s.y-this._distance)),this._segList.addPt(new ze(s.x-this._distance,s.y-this._distance)),this._segList.addPt(new ze(s.x-this._distance,s.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(s,a){this._segList.addPts(s,a)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(s,a,d,v,I){var P=a.x-s.x,O=a.y-s.y,K=Math.atan2(O,P),re=d.x-s.x,Ce=d.y-s.y,Oe=Math.atan2(Ce,re);v===Nt.CLOCKWISE?K<=Oe&&(K+=2*Math.PI):K>=Oe&&(K-=2*Math.PI),this._segList.addPt(a),this.addDirectedFillet(s,K,Oe,v,I),this._segList.addPt(d)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(s,a,d){this._s1=s,this._s2=a,this._side=d,this._seg1.setCoordinates(s,a),this.computeOffsetSegment(this._seg1,d,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(s,a,d,v){var I=this._seg0.p1,P=wn.angle(I,this._seg0.p0),O=wn.angleBetweenOriented(this._seg0.p0,I,this._seg1.p1)/2,K=wn.normalize(P+O),re=wn.normalize(K+Math.PI),Ce=v*d,Oe=d-Ce*Math.abs(Math.sin(O)),We=I.x+Ce*Math.cos(re),ht=I.y+Ce*Math.sin(re),Et=new ze(We,ht),Rt=new Ai(I,Et),Jt=Rt.pointAlongOffset(1,Oe),ei=Rt.pointAlongOffset(1,-Oe);this._side===Je.LEFT?(this._segList.addPt(Jt),this._segList.addPt(ei)):(this._segList.addPt(ei),this._segList.addPt(Jt))}},{key:"addDirectedFillet",value:function(s,a,d,v,I){var P=v===Nt.CLOCKWISE?-1:1,O=Math.abs(a-d),K=Math.trunc(O/this._filletAngleQuantum+.5);if(K<1)return null;for(var re=O/K,Ce=new ze,Oe=0;Oe<K;Oe++){var We=a+P*Oe*re;Ce.x=s.x+I*Math.cos(We),Ce.y=s.y+I*Math.sin(We),this._segList.addPt(Ce)}}},{key:"computeOffsetSegment",value:function(s,a,d,v){var I=a===Je.LEFT?1:-1,P=s.p1.x-s.p0.x,O=s.p1.y-s.p0.y,K=Math.sqrt(P*P+O*O),re=I*d*P/K,Ce=I*d*O/K;v.p0.x=s.p0.x-Ce,v.p0.y=s.p0.y+re,v.p1.x=s.p1.x-Ce,v.p1.y=s.p1.y+re}},{key:"addInsideTurn",value:function(s,a){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*f.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var d=new ze((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(d);var v=new ze((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(v)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(s){var a=new ze(s.x+this._distance,s.y);this._segList.addPt(a),this.addDirectedFillet(s,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(s,a){this._segList.addPt(s.p1),this._segList.addPt(a.p0)}},{key:"init",value:function(s){this._distance=s,this._maxCurveSegmentError=s*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Zo,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(s*f.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(s){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===nt.JOIN_BEVEL||this._bufParams.getJoinStyle()===nt.JOIN_MITRE?(s&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Nt.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ai,this._seg1=new Ai,this._offset0=new Ai,this._offset1=new Ai,this._side=0,this._hasNarrowConcaveAngle=!1;var s=arguments[0],a=arguments[1],d=arguments[2];this._precisionModel=s,this._bufParams=a,this._li=new Ur,this._filletAngleQuantum=Math.PI/2/a.getQuadrantSegments(),a.getQuadrantSegments()>=8&&a.getJoinStyle()===nt.JOIN_ROUND&&(this._closingSegLengthFactor=f.MAX_CLOSING_SEG_LEN_FACTOR),this.init(d)}}])}();rs.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,rs.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,rs.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,rs.MAX_CLOSING_SEG_LEN_FACTOR=80;var Sa=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getOffsetCurve",value:function(s,a){if(this._distance=a,a===0)return null;var d=a<0,v=Math.abs(a),I=this.getSegGen(v);s.length<=1?this.computePointCurve(s[0],I):this.computeOffsetCurve(s,d,I);var P=I.getCoordinates();return d&&kt.reverse(P),P}},{key:"computeSingleSidedBufferCurve",value:function(s,a,d){var v=this.simplifyTolerance(this._distance);if(a){d.addSegments(s,!0);var I=br.simplify(s,-v),P=I.length-1;d.initSideSegments(I[P],I[P-1],Je.LEFT),d.addFirstSegment();for(var O=P-2;O>=0;O--)d.addNextSegment(I[O],!0)}else{d.addSegments(s,!1);var K=br.simplify(s,v),re=K.length-1;d.initSideSegments(K[0],K[1],Je.LEFT),d.addFirstSegment();for(var Ce=2;Ce<=re;Ce++)d.addNextSegment(K[Ce],!0)}d.addLastSegment(),d.closeRing()}},{key:"computeRingBufferCurve",value:function(s,a,d){var v=this.simplifyTolerance(this._distance);a===Je.RIGHT&&(v=-v);var I=br.simplify(s,v),P=I.length-1;d.initSideSegments(I[P-1],I[0],a);for(var O=1;O<=P;O++){var K=O!==1;d.addNextSegment(I[O],K)}d.closeRing()}},{key:"computeLineBufferCurve",value:function(s,a){var d=this.simplifyTolerance(this._distance),v=br.simplify(s,d),I=v.length-1;a.initSideSegments(v[0],v[1],Je.LEFT);for(var P=2;P<=I;P++)a.addNextSegment(v[P],!0);a.addLastSegment(),a.addLineEndCap(v[I-1],v[I]);var O=br.simplify(s,-d),K=O.length-1;a.initSideSegments(O[K],O[K-1],Je.LEFT);for(var re=K-2;re>=0;re--)a.addNextSegment(O[re],!0);a.addLastSegment(),a.addLineEndCap(O[1],O[0]),a.closeRing()}},{key:"computePointCurve",value:function(s,a){switch(this._bufParams.getEndCapStyle()){case nt.CAP_ROUND:a.createCircle(s);break;case nt.CAP_SQUARE:a.createSquare(s)}}},{key:"getLineCurve",value:function(s,a){if(this._distance=a,this.isLineOffsetEmpty(a))return null;var d=Math.abs(a),v=this.getSegGen(d);if(s.length<=1)this.computePointCurve(s[0],v);else if(this._bufParams.isSingleSided()){var I=a<0;this.computeSingleSidedBufferCurve(s,I,v)}else this.computeLineBufferCurve(s,v);return v.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(s){return s*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(s,a,d){if(this._distance=d,s.length<=2)return this.getLineCurve(s,d);if(d===0)return f.copyCoordinates(s);var v=this.getSegGen(d);return this.computeRingBufferCurve(s,a,v),v.getCoordinates()}},{key:"computeOffsetCurve",value:function(s,a,d){var v=this.simplifyTolerance(this._distance);if(a){var I=br.simplify(s,-v),P=I.length-1;d.initSideSegments(I[P],I[P-1],Je.LEFT),d.addFirstSegment();for(var O=P-2;O>=0;O--)d.addNextSegment(I[O],!0)}else{var K=br.simplify(s,v),re=K.length-1;d.initSideSegments(K[0],K[1],Je.LEFT),d.addFirstSegment();for(var Ce=2;Ce<=re;Ce++)d.addNextSegment(K[Ce],!0)}d.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(s){return s===0||s<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(s){return new rs(this._precisionModel,this._bufParams,s)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var s=arguments[0],a=arguments[1];this._precisionModel=s,this._bufParams=a}},{key:"copyCoordinates",value:function(s){for(var a=new Array(s.length).fill(null),d=0;d<a.length;d++)a[d]=new ze(s[d]);return a}}])}(),Vs=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var f=arguments[0],s=new W,a=this._subgraphs.iterator();a.hasNext();){var d=a.next(),v=d.getEnvelope();f.y<v.getMinY()||f.y>v.getMaxY()||this.findStabbedSegments(f,d.getDirectedEdges(),s)}return s}if(arguments.length===3){if(Vt(arguments[2],fr)&&arguments[0]instanceof ze&&arguments[1]instanceof dn){for(var I=arguments[0],P=arguments[1],O=arguments[2],K=P.getEdge().getCoordinates(),re=0;re<K.length-1;re++)if(this._seg.p0=K[re],this._seg.p1=K[re+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<I.x||this._seg.isHorizontal()||I.y<this._seg.p0.y||I.y>this._seg.p1.y||Nt.index(this._seg.p0,this._seg.p1,I)===Nt.RIGHT)){var Ce=P.getDepth(Je.LEFT);this._seg.p0.equals(K[re])||(Ce=P.getDepth(Je.RIGHT));var Oe=new Ea(this._seg,Ce);O.add(Oe)}}else if(Vt(arguments[2],fr)&&arguments[0]instanceof ze&&Vt(arguments[1],fr))for(var We=arguments[0],ht=arguments[2],Et=arguments[1].iterator();Et.hasNext();){var Rt=Et.next();Rt.isForward()&&this.findStabbedSegments(We,Rt,ht)}}}},{key:"getDepth",value:function(f){var s=this.findStabbedSegments(f);return s.size()===0?0:bn.min(s)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Ai;var f=arguments[0];this._subgraphs=f}}])}(),Ea=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(f){var s=f;if(this._upwardSeg.minX()>=s._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=s._upwardSeg.minX())return-1;var a=this._upwardSeg.orientationIndex(s._upwardSeg);return a!==0||(a=-1*s._upwardSeg.orientationIndex(this._upwardSeg))!==0?a:this._upwardSeg.compareTo(s._upwardSeg)}},{key:"compareX",value:function(f,s){var a=f.p0.compareTo(s.p0);return a!==0?a:f.p1.compareTo(s.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var f=arguments[0],s=arguments[1];this._upwardSeg=new Ai(f),this._leftDepth=s}}])}();Vs.DepthSegment=Ea;var ca=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,null,[{key:"constructor_",value:function(){ft.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(ft),ar=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getY",value:function(){var s=this.y/this.w;if(xt.isNaN(s)||xt.isInfinite(s))throw new ca;return s}},{key:"getX",value:function(){var s=this.x/this.w;if(xt.isNaN(s)||xt.isInfinite(s))throw new ca;return s}},{key:"getCoordinate",value:function(){var s=new ze;return s.x=this.getX(),s.y=this.getY(),s}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var s=arguments[0];this.x=s.x,this.y=s.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var a=arguments[0],d=arguments[1];this.x=a,this.y=d,this.w=1}else if(arguments[0]instanceof f&&arguments[1]instanceof f){var v=arguments[0],I=arguments[1];this.x=v.y*I.w-I.y*v.w,this.y=I.x*v.w-v.x*I.w,this.w=v.x*I.y-I.x*v.y}else if(arguments[0]instanceof ze&&arguments[1]instanceof ze){var P=arguments[0],O=arguments[1];this.x=P.y-O.y,this.y=O.x-P.x,this.w=P.x*O.y-O.x*P.y}}else if(arguments.length===3){var K=arguments[0],re=arguments[1],Ce=arguments[2];this.x=K,this.y=re,this.w=Ce}else if(arguments.length===4){var Oe=arguments[0],We=arguments[1],ht=arguments[2],Et=arguments[3],Rt=Oe.y-We.y,Jt=We.x-Oe.x,ei=Oe.x*We.y-We.x*Oe.y,_i=ht.y-Et.y,Ti=Et.x-ht.x,fn=ht.x*Et.y-Et.x*ht.y;this.x=Jt*fn-Ti*ei,this.y=_i*ei-Rt*fn,this.w=Rt*Ti-_i*Jt}}}])}(),Vl=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"area",value:function(){return f.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return f.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(s){if(s===null)throw new rt("Supplied point is null.");return f.interpolateZ(s,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return f.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return f.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return f.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return f.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return f.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return f.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var s=arguments[0],a=arguments[1],d=arguments[2];this.p0=s,this.p1=a,this.p2=d}},{key:"area",value:function(s,a,d){return Math.abs(((d.x-s.x)*(a.y-s.y)-(a.x-s.x)*(d.y-s.y))/2)}},{key:"signedArea",value:function(s,a,d){return((d.x-s.x)*(a.y-s.y)-(a.x-s.x)*(d.y-s.y))/2}},{key:"det",value:function(s,a,d,v){return s*v-a*d}},{key:"interpolateZ",value:function(s,a,d,v){var I=a.x,P=a.y,O=d.x-I,K=v.x-I,re=d.y-P,Ce=v.y-P,Oe=O*Ce-K*re,We=s.x-I,ht=s.y-P,Et=(Ce*We-K*ht)/Oe,Rt=(-re*We+O*ht)/Oe;return a.getZ()+Et*(d.getZ()-a.getZ())+Rt*(v.getZ()-a.getZ())}},{key:"longestSideLength",value:function(s,a,d){var v=s.distance(a),I=a.distance(d),P=d.distance(s),O=v;return I>O&&(O=I),P>O&&(O=P),O}},{key:"circumcentreDD",value:function(s,a,d){var v=At.valueOf(s.x).subtract(d.x),I=At.valueOf(s.y).subtract(d.y),P=At.valueOf(a.x).subtract(d.x),O=At.valueOf(a.y).subtract(d.y),K=At.determinant(v,I,P,O).multiply(2),re=v.sqr().add(I.sqr()),Ce=P.sqr().add(O.sqr()),Oe=At.determinant(I,re,O,Ce),We=At.determinant(v,re,P,Ce),ht=At.valueOf(d.x).subtract(Oe.divide(K)).doubleValue(),Et=At.valueOf(d.y).add(We.divide(K)).doubleValue();return new ze(ht,Et)}},{key:"isAcute",value:function(s,a,d){return!!wn.isAcute(s,a,d)&&!!wn.isAcute(a,d,s)&&!!wn.isAcute(d,s,a)}},{key:"circumcentre",value:function(s,a,d){var v=d.x,I=d.y,P=s.x-v,O=s.y-I,K=a.x-v,re=a.y-I,Ce=2*f.det(P,O,K,re),Oe=f.det(O,P*P+O*O,re,K*K+re*re),We=f.det(P,P*P+O*O,K,K*K+re*re);return new ze(v-Oe/Ce,I+We/Ce)}},{key:"perpendicularBisector",value:function(s,a){var d=a.x-s.x,v=a.y-s.y,I=new ar(s.x+d/2,s.y+v/2,1),P=new ar(s.x-v+d/2,s.y+d+v/2,1);return new ar(I,P)}},{key:"angleBisector",value:function(s,a,d){var v=a.distance(s),I=v/(v+a.distance(d)),P=d.x-s.x,O=d.y-s.y;return new ze(s.x+I*P,s.y+I*O)}},{key:"area3D",value:function(s,a,d){var v=a.x-s.x,I=a.y-s.y,P=a.getZ()-s.getZ(),O=d.x-s.x,K=d.y-s.y,re=d.getZ()-s.getZ(),Ce=I*re-P*K,Oe=P*O-v*re,We=v*K-I*O,ht=Ce*Ce+Oe*Oe+We*We,Et=Math.sqrt(ht)/2;return Et}},{key:"centroid",value:function(s,a,d){var v=(s.x+a.x+d.x)/3,I=(s.y+a.y+d.y)/3;return new ze(v,I)}},{key:"inCentre",value:function(s,a,d){var v=a.distance(d),I=s.distance(d),P=s.distance(a),O=v+I+P,K=(v*s.x+I*a.x+P*d.x)/O,re=(v*s.y+I*a.y+P*d.y)/O;return new ze(K,re)}}])}(),no=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(f,s,a,d,v){if(s===0&&f.length<tt.MINIMUM_VALID_SIZE)return null;var I=d,P=v;f.length>=tt.MINIMUM_VALID_SIZE&&Nt.isCCW(f)&&(I=v,P=d,a=Je.opposite(a));var O=this._curveBuilder.getRingCurve(f,a,s);this.addCurve(O,I,P)}},{key:"addRingBothSides",value:function(f,s){this.addRingSide(f,s,Je.LEFT,me.EXTERIOR,me.INTERIOR),this.addRingSide(f,s,Je.RIGHT,me.INTERIOR,me.EXTERIOR)}},{key:"addPoint",value:function(f){if(this._distance<=0)return null;var s=f.getCoordinates(),a=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(a,me.EXTERIOR,me.INTERIOR)}},{key:"addPolygon",value:function(f){var s=this._distance,a=Je.LEFT;this._distance<0&&(s=-this._distance,a=Je.RIGHT);var d=f.getExteriorRing(),v=kt.removeRepeatedPoints(d.getCoordinates());if(this._distance<0&&this.isErodedCompletely(d,this._distance)||this._distance<=0&&v.length<3)return null;this.addRingSide(v,s,a,me.EXTERIOR,me.INTERIOR);for(var I=0;I<f.getNumInteriorRing();I++){var P=f.getInteriorRingN(I),O=kt.removeRepeatedPoints(P.getCoordinates());this._distance>0&&this.isErodedCompletely(P,-this._distance)||this.addRingSide(O,s,Je.opposite(a),me.INTERIOR,me.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(f,s){var a=new Vl(f[0],f[1],f[2]),d=a.inCentre();return Ve.pointToSegment(d,a.p0,a.p1)<Math.abs(s)}},{key:"addLineString",value:function(f){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var s=kt.removeRepeatedPoints(f.getCoordinates());if(kt.isRing(s)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(s,this._distance);else{var a=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(a,me.EXTERIOR,me.INTERIOR)}}},{key:"addCurve",value:function(f,s,a){if(f===null||f.length<2)return null;var d=new sr(f,new _n(0,me.BOUNDARY,s,a));this._curveList.add(d)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(f){if(f.isEmpty())return null;if(f instanceof Zi)this.addPolygon(f);else if(f instanceof Dt)this.addLineString(f);else if(f instanceof mi)this.addPoint(f);else if(f instanceof Dr)this.addCollection(f);else if(f instanceof bs)this.addCollection(f);else if(f instanceof mr)this.addCollection(f);else{if(!(f instanceof Ji))throw new tn(f.getGeometryType());this.addCollection(f)}}},{key:"isErodedCompletely",value:function(f,s){var a=f.getCoordinates();if(a.length<4)return s<0;if(a.length===4)return this.isTriangleErodedCompletely(a,s);var d=f.getEnvelopeInternal(),v=Math.min(d.getHeight(),d.getWidth());return s<0&&2*Math.abs(s)>v}},{key:"addCollection",value:function(f){for(var s=0;s<f.getNumGeometries();s++){var a=f.getGeometryN(s);this.add(a)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new W;var f=arguments[0],s=arguments[1],a=arguments[2];this._inputGeom=f,this._distance=s,this._curveBuilder=a}}])}(),ha=function(){return u(function f(){B(this,f)},[{key:"locate",value:function(f){}}])}(),da=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,f.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Yn;var s=this._parent.getGeometryN(this._index++);return s instanceof Ji?(this._subcollectionIterator=new f(s),this._subcollectionIterator.next()):s}},{key:"remove",value:function(){throw new tn(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[is]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var s=arguments[0];this._parent=s,this._atStart=!0,this._index=0,this._max=s.getNumGeometries()}},{key:"isAtomic",value:function(s){return!(s instanceof Ji)}}])}(),Xo=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"locate",value:function(s){return f.locate(s,this._geom)}},{key:"interfaces_",get:function(){return[ha]}}],[{key:"constructor_",value:function(){this._geom=null;var s=arguments[0];this._geom=s}},{key:"locatePointInPolygon",value:function(s,a){if(a.isEmpty())return me.EXTERIOR;var d=a.getExteriorRing(),v=f.locatePointInRing(s,d);if(v!==me.INTERIOR)return v;for(var I=0;I<a.getNumInteriorRing();I++){var P=a.getInteriorRingN(I),O=f.locatePointInRing(s,P);if(O===me.BOUNDARY)return me.BOUNDARY;if(O===me.INTERIOR)return me.EXTERIOR}return me.INTERIOR}},{key:"locatePointInRing",value:function(s,a){return a.getEnvelopeInternal().intersects(s)?_r.locateInRing(s,a.getCoordinates()):me.EXTERIOR}},{key:"containsPointInPolygon",value:function(s,a){return me.EXTERIOR!==f.locatePointInPolygon(s,a)}},{key:"locateInGeometry",value:function(s,a){if(a instanceof Zi)return f.locatePointInPolygon(s,a);if(a instanceof Ji)for(var d=new da(a);d.hasNext();){var v=d.next();if(v!==a){var I=f.locateInGeometry(s,v);if(I!==me.EXTERIOR)return I}}return me.EXTERIOR}},{key:"isContained",value:function(s,a){return me.EXTERIOR!==f.locate(s,a)}},{key:"locate",value:function(s,a){return a.isEmpty()?me.EXTERIOR:a.getEnvelopeInternal().intersects(s)?f.locateInGeometry(s,a):me.EXTERIOR}}])}(),fa=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(f){this.getEdges();var s=this._edgeList.indexOf(f),a=s-1;return s===0&&(a=this._edgeList.size()-1),this._edgeList.get(a)}},{key:"propagateSideLabels",value:function(f){for(var s=me.NONE,a=this.iterator();a.hasNext();){var d=a.next().getLabel();d.isArea(f)&&d.getLocation(f,Je.LEFT)!==me.NONE&&(s=d.getLocation(f,Je.LEFT))}if(s===me.NONE)return null;for(var v=s,I=this.iterator();I.hasNext();){var P=I.next(),O=P.getLabel();if(O.getLocation(f,Je.ON)===me.NONE&&O.setLocation(f,Je.ON,v),O.isArea(f)){var K=O.getLocation(f,Je.LEFT),re=O.getLocation(f,Je.RIGHT);if(re!==me.NONE){if(re!==v)throw new Y("side location conflict",P.getCoordinate());K===me.NONE&&Ot.shouldNeverReachHere("found single null side (at "+P.getCoordinate()+")"),v=K}else Ot.isTrue(O.getLocation(f,Je.LEFT)===me.NONE,"found single null side"),O.setLocation(f,Je.RIGHT,v),O.setLocation(f,Je.LEFT,v)}}}},{key:"getCoordinate",value:function(){var f=this.iterator();return f.hasNext()?f.next().getCoordinate():null}},{key:"print",value:function(f){Me.out.println("EdgeEndStar:   "+this.getCoordinate());for(var s=this.iterator();s.hasNext();)s.next().print(f)}},{key:"isAreaLabelsConsistent",value:function(f){return this.computeEdgeEndLabels(f.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(f){var s=this.getEdges();if(s.size()<=0)return!0;var a=s.size()-1,d=s.get(a).getLabel().getLocation(f,Je.LEFT);Ot.isTrue(d!==me.NONE,"Found unlabelled area edge");for(var v=d,I=this.iterator();I.hasNext();){var P=I.next().getLabel();Ot.isTrue(P.isArea(f),"Found non-area edge");var O=P.getLocation(f,Je.LEFT),K=P.getLocation(f,Je.RIGHT);if(O===K||K!==v)return!1;v=O}return!0}},{key:"findIndex",value:function(f){this.iterator();for(var s=0;s<this._edgeList.size();s++)if(this._edgeList.get(s)===f)return s;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new W(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(f,s,a){return this._ptInAreaLocation[f]===me.NONE&&(this._ptInAreaLocation[f]=Xo.locate(s,a[f].getGeometry())),this._ptInAreaLocation[f]}},{key:"toString",value:function(){var f=new pr;f.append("EdgeEndStar:   "+this.getCoordinate()),f.append(`
`);for(var s=this.iterator();s.hasNext();){var a=s.next();f.append(a),f.append(`
`)}return f.toString()}},{key:"computeEdgeEndLabels",value:function(f){for(var s=this.iterator();s.hasNext();)s.next().computeLabel(f)}},{key:"computeLabelling",value:function(f){this.computeEdgeEndLabels(f[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var s=[!1,!1],a=this.iterator();a.hasNext();)for(var d=a.next().getLabel(),v=0;v<2;v++)d.isLine(v)&&d.getLocation(v)===me.BOUNDARY&&(s[v]=!0);for(var I=this.iterator();I.hasNext();)for(var P=I.next(),O=P.getLabel(),K=0;K<2;K++)if(O.isAnyNull(K)){var re=me.NONE;if(s[K])re=me.EXTERIOR;else{var Ce=P.getCoordinate();re=this.getLocation(K,Ce,f)}O.setAllLocationsIfNull(K,re)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(f,s){this._edgeMap.put(f,s),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Zt,this._edgeList=null,this._ptInAreaLocation=[me.NONE,me.NONE]}}])}(),Yo=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var a=null,d=null,v=this._SCANNING_FOR_INCOMING,I=0;I<this._resultAreaEdgeList.size();I++){var P=this._resultAreaEdgeList.get(I),O=P.getSym();if(P.getLabel().isArea())switch(a===null&&P.isInResult()&&(a=P),v){case this._SCANNING_FOR_INCOMING:if(!O.isInResult())continue;d=O,v=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!P.isInResult())continue;d.setNext(P),v=this._SCANNING_FOR_INCOMING}}if(v===this._LINKING_TO_OUTGOING){if(a===null)throw new Y("no outgoing dirEdge found",this.getCoordinate());Ot.isTrue(a.isInResult(),"unable to link last incoming dirEdge"),d.setNext(a)}}},{key:"insert",value:function(a){var d=a;this.insertEdgeEnd(d,d)}},{key:"getRightmostEdge",value:function(){var a=this.getEdges(),d=a.size();if(d<1)return null;var v=a.get(0);if(d===1)return v;var I=a.get(d-1),P=v.getQuadrant(),O=I.getQuadrant();return bt.isNorthern(P)&&bt.isNorthern(O)?v:bt.isNorthern(P)||bt.isNorthern(O)?v.getDy()!==0?v:I.getDy()!==0?I:(Ot.shouldNeverReachHere("found two horizontal edges incident on node"),null):I}},{key:"print",value:function(a){Me.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var d=this.iterator();d.hasNext();){var v=d.next();a.print("out "),v.print(a),a.println(),a.print("in "),v.getSym().print(a),a.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new W;for(var a=this.iterator();a.hasNext();){var d=a.next();(d.isInResult()||d.getSym().isInResult())&&this._resultAreaEdgeList.add(d)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(a){for(var d=this.iterator();d.hasNext();){var v=d.next().getLabel();v.setAllLocationsIfNull(0,a.getLocation(0)),v.setAllLocationsIfNull(1,a.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var a=null,d=null,v=this._edgeList.size()-1;v>=0;v--){var I=this._edgeList.get(v),P=I.getSym();d===null&&(d=P),a!==null&&P.setNext(a),a=I}d.setNext(a)}},{key:"computeDepths",value:function(){if(arguments.length===1){var a=arguments[0],d=this.findIndex(a),v=a.getDepth(Je.LEFT),I=a.getDepth(Je.RIGHT),P=this.computeDepths(d+1,this._edgeList.size(),v);if(this.computeDepths(0,d,P)!==I)throw new Y("depth mismatch at "+a.getCoordinate())}else if(arguments.length===3){for(var O=arguments[1],K=arguments[2],re=arguments[0];re<O;re++){var Ce=this._edgeList.get(re);Ce.setEdgeDepths(Je.RIGHT,K),K=Ce.getDepth(Je.LEFT)}return K}}},{key:"mergeSymLabels",value:function(){for(var a=this.iterator();a.hasNext();){var d=a.next();d.getLabel().merge(d.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(a){for(var d=null,v=null,I=this._SCANNING_FOR_INCOMING,P=this._resultAreaEdgeList.size()-1;P>=0;P--){var O=this._resultAreaEdgeList.get(P),K=O.getSym();switch(d===null&&O.getEdgeRing()===a&&(d=O),I){case this._SCANNING_FOR_INCOMING:if(K.getEdgeRing()!==a)continue;v=K,I=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(O.getEdgeRing()!==a)continue;v.setNextMin(O),I=this._SCANNING_FOR_INCOMING}}I===this._LINKING_TO_OUTGOING&&(Ot.isTrue(d!==null,"found null for first outgoing dirEdge"),Ot.isTrue(d.getEdgeRing()===a,"unable to link last incoming dirEdge"),v.setNextMin(d))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var a=0,d=this.iterator();d.hasNext();)d.next().isInResult()&&a++;return a}if(arguments.length===1){for(var v=arguments[0],I=0,P=this.iterator();P.hasNext();)P.next().getEdgeRing()===v&&I++;return I}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var a=me.NONE,d=this.iterator();d.hasNext();){var v=d.next(),I=v.getSym();if(!v.isLineEdge()){if(v.isInResult()){a=me.INTERIOR;break}if(I.isInResult()){a=me.EXTERIOR;break}}}if(a===me.NONE)return null;for(var P=a,O=this.iterator();O.hasNext();){var K=O.next(),re=K.getSym();K.isLineEdge()?K.getEdge().setCovered(P===me.INTERIOR):(K.isInResult()&&(P=me.EXTERIOR),re.isInResult()&&(P=me.INTERIOR))}}},{key:"computeLabelling",value:function(a){Te(s,"computeLabelling",this,1).call(this,a),this._label=new _n(me.NONE);for(var d=this.iterator();d.hasNext();)for(var v=d.next().getEdge().getLabel(),I=0;I<2;I++){var P=v.getLocation(I);P!==me.INTERIOR&&P!==me.BOUNDARY||this._label.setLocation(I,me.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(fa),Gs=function(f){function s(){return B(this,s),N(this,s)}return de(s,f),u(s,[{key:"createNode",value:function(a){return new rn(a,new Yo)}}])}(Ss),Ho=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"compareTo",value:function(s){var a=s;return f.compareOriented(this._pts,this._orientation,a._pts,a._orientation)}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var s=arguments[0];this._pts=s,this._orientation=f.orientation(s)}},{key:"orientation",value:function(s){return kt.increasingDirection(s)===1}},{key:"compareOriented",value:function(s,a,d,v){for(var I=a?1:-1,P=v?1:-1,O=a?s.length:-1,K=v?d.length:-1,re=a?0:s.length-1,Ce=v?0:d.length-1;;){var Oe=s[re].compareTo(d[Ce]);if(Oe!==0)return Oe;var We=(re+=I)===O,ht=(Ce+=P)===K;if(We&&!ht)return-1;if(!We&&ht)return 1;if(We&&ht)return 0}}}])}(),Wo=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"print",value:function(f){f.print("MULTILINESTRING ( ");for(var s=0;s<this._edges.size();s++){var a=this._edges.get(s);s>0&&f.print(","),f.print("(");for(var d=a.getCoordinates(),v=0;v<d.length;v++)v>0&&f.print(","),f.print(d[v].x+" "+d[v].y);f.println(")")}f.print(")  ")}},{key:"addAll",value:function(f){for(var s=f.iterator();s.hasNext();)this.add(s.next())}},{key:"findEdgeIndex",value:function(f){for(var s=0;s<this._edges.size();s++)if(this._edges.get(s).equals(f))return s;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(f){return this._edges.get(f)}},{key:"findEqualEdge",value:function(f){var s=new Ho(f.getCoordinates());return this._ocaMap.get(s)}},{key:"add",value:function(f){this._edges.add(f);var s=new Ho(f.getCoordinates());this._ocaMap.put(s,f)}}],[{key:"constructor_",value:function(){this._edges=new W,this._ocaMap=new Zt}}])}(),Ko=function(){return u(function f(){B(this,f)},[{key:"processIntersections",value:function(f,s,a,d){}},{key:"isDone",value:function(){}}])}(),ka=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"isTrivialIntersection",value:function(s,a,d,v){if(s===d&&this._li.getIntersectionNum()===1){if(f.isAdjacentSegments(a,v))return!0;if(s.isClosed()){var I=s.size()-1;if(a===0&&v===I||v===0&&a===I)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(s,a,d,v){if(s===d&&a===v)return null;this.numTests++;var I=s.getCoordinates()[a],P=s.getCoordinates()[a+1],O=d.getCoordinates()[v],K=d.getCoordinates()[v+1];this._li.computeIntersection(I,P,O,K),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(s,a,d,v)||(this._hasIntersection=!0,s.addIntersections(this._li,a,0),d.addIntersections(this._li,v,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Ko]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var s=arguments[0];this._li=s}},{key:"isAdjacentSegments",value:function(s,a){return Math.abs(s-a)===1}}])}(),ro=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex),f.println(" dist = "+this.dist)}},{key:"compareTo",value:function(f){var s=f;return this.compare(s.segmentIndex,s.dist)}},{key:"isEndPoint",value:function(f){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===f}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(f,s){return this.segmentIndex<f?-1:this.segmentIndex>f?1:this.dist<s?-1:this.dist>s?1:0}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var f=arguments[0],s=arguments[1],a=arguments[2];this.coord=new ze(f),this.segmentIndex=s,this.dist=a}}])}(),Jo=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"print",value:function(f){f.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(f)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(f){this.addEndpoints();for(var s=this.iterator(),a=s.next();s.hasNext();){var d=s.next(),v=this.createSplitEdge(a,d);f.add(v),a=d}}},{key:"addEndpoints",value:function(){var f=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[f],f,0)}},{key:"createSplitEdge",value:function(f,s){var a=s.segmentIndex-f.segmentIndex+2,d=this.edge.pts[s.segmentIndex],v=s.dist>0||!s.coord.equals2D(d);v||a--;var I=new Array(a).fill(null),P=0;I[P++]=new ze(f.coord);for(var O=f.segmentIndex+1;O<=s.segmentIndex;O++)I[P++]=this.edge.pts[O];return v&&(I[P]=s.coord),new Ca(I,new _n(this.edge._label))}},{key:"add",value:function(f,s,a){var d=new ro(f,s,a),v=this._nodeMap.get(d);return v!==null?v:(this._nodeMap.put(d,d),d)}},{key:"isIntersection",value:function(f){for(var s=this.iterator();s.hasNext();)if(s.next().coord.equals(f))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Zt,this.edge=null;var f=arguments[0];this.edge=f}}])}(),Qo=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])||f.isTrue(this._matrix[me.INTERIOR][me.BOUNDARY])||f.isTrue(this._matrix[me.BOUNDARY][me.INTERIOR])||f.isTrue(this._matrix[me.BOUNDARY][me.BOUNDARY]))&&this._matrix[me.EXTERIOR][me.INTERIOR]===qe.FALSE&&this._matrix[me.EXTERIOR][me.BOUNDARY]===qe.FALSE}},{key:"isCoveredBy",value:function(){return(f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])||f.isTrue(this._matrix[me.INTERIOR][me.BOUNDARY])||f.isTrue(this._matrix[me.BOUNDARY][me.INTERIOR])||f.isTrue(this._matrix[me.BOUNDARY][me.BOUNDARY]))&&this._matrix[me.INTERIOR][me.EXTERIOR]===qe.FALSE&&this._matrix[me.BOUNDARY][me.EXTERIOR]===qe.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var s=arguments[0],a=0;a<s.length;a++){var d=Math.trunc(a/3),v=a%3;this._matrix[d][v]=qe.toDimensionValue(s.charAt(a))}else if(arguments.length===3){var I=arguments[0],P=arguments[1],O=arguments[2];this._matrix[I][P]=O}}},{key:"isContains",value:function(){return f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])&&this._matrix[me.EXTERIOR][me.INTERIOR]===qe.FALSE&&this._matrix[me.EXTERIOR][me.BOUNDARY]===qe.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var s=arguments[0],a=0;a<s.length;a++){var d=Math.trunc(a/3),v=a%3;this.setAtLeast(d,v,qe.toDimensionValue(s.charAt(a)))}else if(arguments.length===3){var I=arguments[0],P=arguments[1],O=arguments[2];this._matrix[I][P]<O&&(this._matrix[I][P]=O)}}},{key:"setAtLeastIfValid",value:function(s,a,d){s>=0&&a>=0&&this.setAtLeast(s,a,d)}},{key:"isWithin",value:function(){return f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])&&this._matrix[me.INTERIOR][me.EXTERIOR]===qe.FALSE&&this._matrix[me.BOUNDARY][me.EXTERIOR]===qe.FALSE}},{key:"isTouches",value:function(s,a){return s>a?this.isTouches(a,s):(s===qe.A&&a===qe.A||s===qe.L&&a===qe.L||s===qe.L&&a===qe.A||s===qe.P&&a===qe.A||s===qe.P&&a===qe.L)&&this._matrix[me.INTERIOR][me.INTERIOR]===qe.FALSE&&(f.isTrue(this._matrix[me.INTERIOR][me.BOUNDARY])||f.isTrue(this._matrix[me.BOUNDARY][me.INTERIOR])||f.isTrue(this._matrix[me.BOUNDARY][me.BOUNDARY]))}},{key:"isOverlaps",value:function(s,a){return s===qe.P&&a===qe.P||s===qe.A&&a===qe.A?f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])&&f.isTrue(this._matrix[me.INTERIOR][me.EXTERIOR])&&f.isTrue(this._matrix[me.EXTERIOR][me.INTERIOR]):s===qe.L&&a===qe.L&&this._matrix[me.INTERIOR][me.INTERIOR]===1&&f.isTrue(this._matrix[me.INTERIOR][me.EXTERIOR])&&f.isTrue(this._matrix[me.EXTERIOR][me.INTERIOR])}},{key:"isEquals",value:function(s,a){return s===a&&f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])&&this._matrix[me.INTERIOR][me.EXTERIOR]===qe.FALSE&&this._matrix[me.BOUNDARY][me.EXTERIOR]===qe.FALSE&&this._matrix[me.EXTERIOR][me.INTERIOR]===qe.FALSE&&this._matrix[me.EXTERIOR][me.BOUNDARY]===qe.FALSE}},{key:"toString",value:function(){for(var s=new Di("123456789"),a=0;a<3;a++)for(var d=0;d<3;d++)s.setCharAt(3*a+d,qe.toDimensionSymbol(this._matrix[a][d]));return s.toString()}},{key:"setAll",value:function(s){for(var a=0;a<3;a++)for(var d=0;d<3;d++)this._matrix[a][d]=s}},{key:"get",value:function(s,a){return this._matrix[s][a]}},{key:"transpose",value:function(){var s=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=s,s=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=s,s=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=s,this}},{key:"matches",value:function(s){if(s.length!==9)throw new rt("Should be length 9: "+s);for(var a=0;a<3;a++)for(var d=0;d<3;d++)if(!f.matches(this._matrix[a][d],s.charAt(3*a+d)))return!1;return!0}},{key:"add",value:function(s){for(var a=0;a<3;a++)for(var d=0;d<3;d++)this.setAtLeast(a,d,s.get(a,d))}},{key:"isDisjoint",value:function(){return this._matrix[me.INTERIOR][me.INTERIOR]===qe.FALSE&&this._matrix[me.INTERIOR][me.BOUNDARY]===qe.FALSE&&this._matrix[me.BOUNDARY][me.INTERIOR]===qe.FALSE&&this._matrix[me.BOUNDARY][me.BOUNDARY]===qe.FALSE}},{key:"isCrosses",value:function(s,a){return s===qe.P&&a===qe.L||s===qe.P&&a===qe.A||s===qe.L&&a===qe.A?f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])&&f.isTrue(this._matrix[me.INTERIOR][me.EXTERIOR]):s===qe.L&&a===qe.P||s===qe.A&&a===qe.P||s===qe.A&&a===qe.L?f.isTrue(this._matrix[me.INTERIOR][me.INTERIOR])&&f.isTrue(this._matrix[me.EXTERIOR][me.INTERIOR]):s===qe.L&&a===qe.L&&this._matrix[me.INTERIOR][me.INTERIOR]===0}},{key:"interfaces_",get:function(){return[Ft]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(qe.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var s=arguments[0];f.constructor_.call(this),this.set(s)}else if(arguments[0]instanceof f){var a=arguments[0];f.constructor_.call(this),this._matrix[me.INTERIOR][me.INTERIOR]=a._matrix[me.INTERIOR][me.INTERIOR],this._matrix[me.INTERIOR][me.BOUNDARY]=a._matrix[me.INTERIOR][me.BOUNDARY],this._matrix[me.INTERIOR][me.EXTERIOR]=a._matrix[me.INTERIOR][me.EXTERIOR],this._matrix[me.BOUNDARY][me.INTERIOR]=a._matrix[me.BOUNDARY][me.INTERIOR],this._matrix[me.BOUNDARY][me.BOUNDARY]=a._matrix[me.BOUNDARY][me.BOUNDARY],this._matrix[me.BOUNDARY][me.EXTERIOR]=a._matrix[me.BOUNDARY][me.EXTERIOR],this._matrix[me.EXTERIOR][me.INTERIOR]=a._matrix[me.EXTERIOR][me.INTERIOR],this._matrix[me.EXTERIOR][me.BOUNDARY]=a._matrix[me.EXTERIOR][me.BOUNDARY],this._matrix[me.EXTERIOR][me.EXTERIOR]=a._matrix[me.EXTERIOR][me.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var s=arguments[0],a=arguments[1];return a===qe.SYM_DONTCARE||a===qe.SYM_TRUE&&(s>=0||s===qe.TRUE)||a===qe.SYM_FALSE&&s===qe.FALSE||a===qe.SYM_P&&s===qe.P||a===qe.SYM_L&&s===qe.L||a===qe.SYM_A&&s===qe.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var d=arguments[1];return new f(arguments[0]).matches(d)}}},{key:"isTrue",value:function(s){return s>=0||s===qe.TRUE}}])}(),so=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(s){return s===null||s.length===0?null:(this.ensureCapacity(this._size+s.length),Me.arraycopy(s,0,this._data,this._size,s.length),void(this._size+=s.length))}},{key:"ensureCapacity",value:function(s){if(s<=this._data.length)return null;var a=Math.max(s,2*this._data.length);this._data=Pt.copyOf(this._data,a)}},{key:"toArray",value:function(){var s=new Array(this._size).fill(null);return Me.arraycopy(this._data,0,s,0,this._size),s}},{key:"add",value:function(s){this.ensureCapacity(this._size+1),this._data[this._size]=s,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)f.constructor_.call(this,10);else if(arguments.length===1){var s=arguments[0];this._data=new Array(s).fill(null)}}}])}(),ao=function(){function f(){B(this,f)}return u(f,[{key:"getChainStartIndices",value:function(s){var a=0,d=new so(Math.trunc(s.length/2));d.add(a);do{var v=this.findChainEnd(s,a);d.add(v),a=v}while(a<s.length-1);return d.toArray()}},{key:"findChainEnd",value:function(s,a){for(var d=bt.quadrant(s[a],s[a+1]),v=a+1;v<s.length&&bt.quadrant(s[v-1],s[v])===d;)v++;return v-1}},{key:"OLDgetChainStartIndices",value:function(s){var a=0,d=new W;d.add(a);do{var v=this.findChainEnd(s,a);d.add(v),a=v}while(a<s.length-1);return f.toIntArray(d)}}],[{key:"toIntArray",value:function(s){for(var a=new Array(s.size()).fill(null),d=0;d<a.length;d++)a[d]=s.get(d).intValue();return a}}])}(),ks=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(f){var s=this.pts[this.startIndex[f]].x,a=this.pts[this.startIndex[f+1]].x;return s>a?s:a}},{key:"getMinX",value:function(f){var s=this.pts[this.startIndex[f]].x,a=this.pts[this.startIndex[f+1]].x;return s<a?s:a}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var f=arguments[0],s=arguments[1],a=arguments[2],d=arguments[3];this.computeIntersectsForChain(this.startIndex[f],this.startIndex[f+1],s,s.startIndex[a],s.startIndex[a+1],d)}else if(arguments.length===6){var v=arguments[0],I=arguments[1],P=arguments[2],O=arguments[3],K=arguments[4],re=arguments[5];if(I-v==1&&K-O==1)return re.addIntersections(this.e,v,P.e,O),null;if(!this.overlaps(v,I,P,O,K))return null;var Ce=Math.trunc((v+I)/2),Oe=Math.trunc((O+K)/2);v<Ce&&(O<Oe&&this.computeIntersectsForChain(v,Ce,P,O,Oe,re),Oe<K&&this.computeIntersectsForChain(v,Ce,P,Oe,K,re)),Ce<I&&(O<Oe&&this.computeIntersectsForChain(Ce,I,P,O,Oe,re),Oe<K&&this.computeIntersectsForChain(Ce,I,P,Oe,K,re))}}},{key:"overlaps",value:function(f,s,a,d,v){return vi.intersects(this.pts[f],this.pts[s],a.pts[d],a.pts[v])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(f,s){for(var a=0;a<this.startIndex.length-1;a++)for(var d=0;d<f.startIndex.length-1;d++)this.computeIntersectsForChain(a,f,d,s)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var f=arguments[0];this.e=f,this.pts=f.getCoordinates();var s=new ao;this.startIndex=s.getChainStartIndices(this.pts)}}])}(),oo=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"getDepth",value:function(s,a){return this._depth[s][a]}},{key:"setDepth",value:function(s,a,d){this._depth[s][a]=d}},{key:"isNull",value:function(){if(arguments.length===0){for(var s=0;s<2;s++)for(var a=0;a<3;a++)if(this._depth[s][a]!==f.NULL_VALUE)return!1;return!0}if(arguments.length===1){var d=arguments[0];return this._depth[d][1]===f.NULL_VALUE}if(arguments.length===2){var v=arguments[0],I=arguments[1];return this._depth[v][I]===f.NULL_VALUE}}},{key:"normalize",value:function(){for(var s=0;s<2;s++)if(!this.isNull(s)){var a=this._depth[s][1];this._depth[s][2]<a&&(a=this._depth[s][2]),a<0&&(a=0);for(var d=1;d<3;d++){var v=0;this._depth[s][d]>a&&(v=1),this._depth[s][d]=v}}}},{key:"getDelta",value:function(s){return this._depth[s][Je.RIGHT]-this._depth[s][Je.LEFT]}},{key:"getLocation",value:function(s,a){return this._depth[s][a]<=0?me.EXTERIOR:me.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var s=arguments[0],a=0;a<2;a++)for(var d=1;d<3;d++){var v=s.getLocation(a,d);v!==me.EXTERIOR&&v!==me.INTERIOR||(this.isNull(a,d)?this._depth[a][d]=f.depthAtLocation(v):this._depth[a][d]+=f.depthAtLocation(v))}else if(arguments.length===3){var I=arguments[0],P=arguments[1];arguments[2]===me.INTERIOR&&this._depth[I][P]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var s=0;s<2;s++)for(var a=0;a<3;a++)this._depth[s][a]=f.NULL_VALUE}},{key:"depthAtLocation",value:function(s){return s===me.EXTERIOR?0:s===me.INTERIOR?1:f.NULL_VALUE}}])}();oo.NULL_VALUE=-1;var Ca=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var a=new Array(2).fill(null);return a[0]=this.pts[0],a[1]=this.pts[1],new s(a,_n.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(a){this._isIsolated=a}},{key:"setName",value:function(a){this._name=a}},{key:"equals",value:function(a){if(!(a instanceof s))return!1;var d=a;if(this.pts.length!==d.pts.length)return!1;for(var v=!0,I=!0,P=this.pts.length,O=0;O<this.pts.length;O++)if(this.pts[O].equals2D(d.pts[O])||(v=!1),this.pts[O].equals2D(d.pts[--P])||(I=!1),!v&&!I)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var a=arguments[0];return this.pts[a]}}},{key:"print",value:function(a){a.print("edge "+this._name+": "),a.print("LINESTRING (");for(var d=0;d<this.pts.length;d++)d>0&&a.print(","),a.print(this.pts[d].x+" "+this.pts[d].y);a.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(a){s.updateIM(this._label,a)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(a){a.print("edge "+this._name+": ");for(var d=this.pts.length-1;d>=0;d--)a.print(this.pts[d]+" ");a.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new ks(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new vi;for(var a=0;a<this.pts.length;a++)this._env.expandToInclude(this.pts[a])}return this._env}},{key:"addIntersection",value:function(a,d,v,I){var P=new ze(a.getIntersection(I)),O=d,K=a.getEdgeDistance(v,I),re=O+1;if(re<this.pts.length){var Ce=this.pts[re];P.equals2D(Ce)&&(O=re,K=0)}this.eiList.add(P,O,K)}},{key:"toString",value:function(){var a=new Di;a.append("edge "+this._name+": "),a.append("LINESTRING (");for(var d=0;d<this.pts.length;d++)d>0&&a.append(","),a.append(this.pts[d].x+" "+this.pts[d].y);return a.append(")  "+this._label+" "+this._depthDelta),a.toString()}},{key:"isPointwiseEqual",value:function(a){if(this.pts.length!==a.pts.length)return!1;for(var d=0;d<this.pts.length;d++)if(!this.pts[d].equals2D(a.pts[d]))return!1;return!0}},{key:"setDepthDelta",value:function(a){this._depthDelta=a}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(a,d,v){for(var I=0;I<a.getIntersectionNum();I++)this.addIntersection(a,d,v,I)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Jo(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new oo,this._depthDelta=0,arguments.length===1){var a=arguments[0];s.constructor_.call(this,a,null)}else if(arguments.length===2){var d=arguments[0],v=arguments[1];this.pts=d,this._label=v}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Qo&&arguments[0]instanceof _n))return Te(s,"updateIM",this).apply(this,arguments);var a=arguments[0],d=arguments[1];d.setAtLeastIfValid(a.getLocation(0,Je.ON),a.getLocation(1,Je.ON),1),a.isArea()&&(d.setAtLeastIfValid(a.getLocation(0,Je.LEFT),a.getLocation(1,Je.LEFT),2),d.setAtLeastIfValid(a.getLocation(0,Je.RIGHT),a.getLocation(1,Je.RIGHT),2))}}])}(Xi),Cs=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"setWorkingPrecisionModel",value:function(s){this._workingPrecisionModel=s}},{key:"insertUniqueEdge",value:function(s){var a=this._edgeList.findEqualEdge(s);if(a!==null){var d=a.getLabel(),v=s.getLabel();a.isPointwiseEqual(s)||(v=new _n(s.getLabel())).flip(),d.merge(v);var I=f.depthDelta(v),P=a.getDepthDelta()+I;a.setDepthDelta(P)}else this._edgeList.add(s),s.setDepthDelta(f.depthDelta(s.getLabel()))}},{key:"buildSubgraphs",value:function(s,a){for(var d=new W,v=s.iterator();v.hasNext();){var I=v.next(),P=I.getRightmostCoordinate(),O=new Vs(d).getDepth(P);I.computeDepth(O),I.findResultEdges(),d.add(I),a.add(I.getDirectedEdges(),I.getNodes())}}},{key:"createSubgraphs",value:function(s){for(var a=new W,d=s.getNodes().iterator();d.hasNext();){var v=d.next();if(!v.isVisited()){var I=new xe;I.create(v),a.add(I)}}return bn.sort(a,bn.reverseOrder()),a}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(s){if(this._workingNoder!==null)return this._workingNoder;var a=new io,d=new Ur;return d.setPrecisionModel(s),a.setSegmentIntersector(new ka(d)),a}},{key:"buffer",value:function(s,a){var d=this._workingPrecisionModel;d===null&&(d=s.getPrecisionModel()),this._geomFact=s.getFactory();var v=new Sa(d,this._bufParams),I=new no(s,a,v).getCurves();if(I.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(I,d),this._graph=new Kn(new Gs),this._graph.addEdges(this._edgeList.getEdges());var P=this.createSubgraphs(this._graph),O=new eo(this._geomFact);this.buildSubgraphs(P,O);var K=O.getPolygons();return K.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(K)}},{key:"computeNodedEdges",value:function(s,a){var d=this.getNoder(a);d.computeNodes(s);for(var v=d.getNodedSubstrings().iterator();v.hasNext();){var I=v.next(),P=I.getCoordinates();if(P.length!==2||!P[0].equals2D(P[1])){var O=I.getData(),K=new Ca(I.getCoordinates(),new _n(O));this.insertUniqueEdge(K)}}}},{key:"setNoder",value:function(s){this._workingNoder=s}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Wo;var s=arguments[0];this._bufParams=s}},{key:"depthDelta",value:function(s){var a=s.getLocation(0,Je.LEFT),d=s.getLocation(0,Je.RIGHT);return a===me.INTERIOR&&d===me.EXTERIOR?1:a===me.EXTERIOR&&d===me.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(s){for(var a=new Or,d=new W;s.hasNext();){var v=s.next(),I=a.createLineString(v.getCoordinates());d.add(I)}return a.buildGeometry(d)}}])}(),Gl=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"rescale",value:function(){if(Vt(arguments[0],ci))for(var s=arguments[0].iterator();s.hasNext();){var a=s.next();this.rescale(a.getCoordinates())}else if(arguments[0]instanceof Array){for(var d=arguments[0],v=0;v<d.length;v++)d[v].x=d[v].x/this._scaleFactor+this._offsetX,d[v].y=d[v].y/this._scaleFactor+this._offsetY;d.length===2&&d[0].equals2D(d[1])&&Me.out.println(d)}}},{key:"scale",value:function(){if(Vt(arguments[0],ci)){for(var s=arguments[0],a=new W(s.size()),d=s.iterator();d.hasNext();){var v=d.next();a.add(new sr(this.scale(v.getCoordinates()),v.getData()))}return a}if(arguments[0]instanceof Array){for(var I=arguments[0],P=new Array(I.length).fill(null),O=0;O<I.length;O++)P[O]=new ze(Math.round((I[O].x-this._offsetX)*this._scaleFactor),Math.round((I[O].y-this._offsetY)*this._scaleFactor),I[O].getZ());return kt.removeRepeatedPoints(P)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var s=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(s),s}},{key:"computeNodes",value:function(s){var a=s;this._isScaled&&(a=this.scale(s)),this._noder.computeNodes(a)}},{key:"interfaces_",get:function(){return[ns]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var s=arguments[0],a=arguments[1];f.constructor_.call(this,s,a,0,0)}else if(arguments.length===4){var d=arguments[0],v=arguments[1];this._noder=d,this._scaleFactor=v,this._isScaled=!this.isIntegerPrecision()}}}])}(),pa=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var a=s.next().getCoordinates();this.checkEndPtVertexIntersections(a[0],this._segStrings),this.checkEndPtVertexIntersections(a[a.length-1],this._segStrings)}else if(arguments.length===2){for(var d=arguments[0],v=arguments[1].iterator();v.hasNext();)for(var I=v.next().getCoordinates(),P=1;P<I.length-1;P++)if(I[P].equals(d))throw new jt("found endpt/interior pt intersection at index "+P+" :pt "+d)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();)for(var a=s.next(),d=this._segStrings.iterator();d.hasNext();){var v=d.next();this.checkInteriorIntersections(a,v)}else if(arguments.length===2)for(var I=arguments[0],P=arguments[1],O=I.getCoordinates(),K=P.getCoordinates(),re=0;re<O.length-1;re++)for(var Ce=0;Ce<K.length-1;Ce++)this.checkInteriorIntersections(I,re,P,Ce);else if(arguments.length===4){var Oe=arguments[0],We=arguments[1],ht=arguments[2],Et=arguments[3];if(Oe===ht&&We===Et)return null;var Rt=Oe.getCoordinates()[We],Jt=Oe.getCoordinates()[We+1],ei=ht.getCoordinates()[Et],_i=ht.getCoordinates()[Et+1];if(this._li.computeIntersection(Rt,Jt,ei,_i),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Rt,Jt)||this.hasInteriorIntersection(this._li,ei,_i)))throw new jt("found non-noded intersection at "+Rt+"-"+Jt+" and "+ei+"-"+_i)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var a=s.next();this.checkCollapses(a)}else if(arguments.length===1)for(var d=arguments[0].getCoordinates(),v=0;v<d.length-2;v++)this.checkCollapse(d[v],d[v+1],d[v+2])}},{key:"hasInteriorIntersection",value:function(s,a,d){for(var v=0;v<s.getIntersectionNum();v++){var I=s.getIntersection(v);if(!I.equals(a)&&!I.equals(d))return!0}return!1}},{key:"checkCollapse",value:function(s,a,d){if(s.equals(d))throw new jt("found non-noded collapse at "+f.fact.createLineString([s,a,d]))}}],[{key:"constructor_",value:function(){this._li=new Ur,this._segStrings=null;var s=arguments[0];this._segStrings=s}}])}();pa.fact=new Or;var lo=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"intersectsScaled",value:function(s,a){var d=Math.min(s.x,a.x),v=Math.max(s.x,a.x),I=Math.min(s.y,a.y),P=Math.max(s.y,a.y),O=this._maxx<d||this._minx>v||this._maxy<I||this._miny>P;if(O)return!1;var K=this.intersectsToleranceSquare(s,a);return Ot.isTrue(!(O&&K),"Found bad envelope test"),K}},{key:"initCorners",value:function(s){var a=.5;this._minx=s.x-a,this._maxx=s.x+a,this._miny=s.y-a,this._maxy=s.y+a,this._corner[0]=new ze(this._maxx,this._maxy),this._corner[1]=new ze(this._minx,this._maxy),this._corner[2]=new ze(this._minx,this._miny),this._corner[3]=new ze(this._maxx,this._miny)}},{key:"intersects",value:function(s,a){return this._scaleFactor===1?this.intersectsScaled(s,a):(this.copyScaled(s,this._p0Scaled),this.copyScaled(a,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(s){return Math.round(s*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(s,a){a.x=this.scale(s.x),a.y=this.scale(s.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var s=f.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new vi(this._originalPt.x-s,this._originalPt.x+s,this._originalPt.y-s,this._originalPt.y+s)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(s,a){return this._li.computeIntersection(s,a,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,a,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,a,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,a,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(s,a){var d=!1,v=!1;return this._li.computeIntersection(s,a,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(s,a,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(d=!0),this._li.computeIntersection(s,a,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(v=!0),this._li.computeIntersection(s,a,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!d||!v)||!!s.equals(this._pt)||!!a.equals(this._pt))))}},{key:"addSnappedNode",value:function(s,a){var d=s.getCoordinate(a),v=s.getCoordinate(a+1);return!!this.intersects(d,v)&&(s.addIntersection(this.getCoordinate(),a),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var s=arguments[0],a=arguments[1],d=arguments[2];if(this._originalPt=s,this._pt=s,this._scaleFactor=a,this._li=d,a<=0)throw new rt("Scale factor must be non-zero");a!==1&&(this._pt=new ze(this.scale(s.x),this.scale(s.y)),this._p0Scaled=new ze,this._p1Scaled=new ze),this.initCorners(this._pt)}}])}();lo.SAFE_ENV_EXPANSION_FACTOR=.75;var el=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var f=arguments[1];arguments[0].getLineSegment(f,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Ai}}])}(),uo=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var f=arguments[0];return this.snap(f,null,-1)}if(arguments.length===3){var s=arguments[0],a=arguments[1],d=arguments[2],v=s.getSafeEnvelope(),I=new co(s,a,d);return this._index.query(v,new(function(){return u(function P(){B(this,P)},[{key:"interfaces_",get:function(){return[js]}},{key:"visitItem",value:function(P){P.select(v,I)}}])}())),I.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var f=arguments[0];this._index=f}}])}(),co=function(f){function s(){var a;return B(this,s),a=N(this,s),s.constructor_.apply(a,arguments),a}return de(s,f),u(s,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Ta))return Te(s,"select",this,1).apply(this,arguments);var a=arguments[1],d=arguments[0].getContext();if(this._parentEdge===d&&(a===this._hotPixelVertexIndex||a+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(d,a)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var a=arguments[0],d=arguments[1],v=arguments[2];this._hotPixel=a,this._parentEdge=d,this._hotPixelVertexIndex=v}}])}(el);uo.HotPixelSnapAction=co;var tl=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(f,s,a,d){if(f===a&&s===d)return null;var v=f.getCoordinates()[s],I=f.getCoordinates()[s+1],P=a.getCoordinates()[d],O=a.getCoordinates()[d+1];if(this._li.computeIntersection(v,I,P,O),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var K=0;K<this._li.getIntersectionNum();K++)this._interiorIntersections.add(this._li.getIntersection(K));f.addIntersections(this._li,s,0),a.addIntersections(this._li,d,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Ko]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var f=arguments[0];this._li=f,this._interiorIntersections=new W}}])}(),ho=function(){return u(function f(){B(this,f),f.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(f){var s=sr.getNodedSubstrings(f),a=new pa(s);try{a.checkValid()}catch(d){if(!(d instanceof ft))throw d;d.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return sr.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(f,s){var a=this.findInteriorIntersections(f,s);this.computeIntersectionSnaps(a),this.computeVertexSnaps(f)}},{key:"findInteriorIntersections",value:function(f,s){var a=new tl(s);return this._noder.setSegmentIntersector(a),this._noder.computeNodes(f),a.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(Vt(arguments[0],ci))for(var f=arguments[0].iterator();f.hasNext();){var s=f.next();this.computeVertexSnaps(s)}else if(arguments[0]instanceof sr)for(var a=arguments[0],d=a.getCoordinates(),v=0;v<d.length;v++){var I=new lo(d[v],this._scaleFactor,this._li);this._pointSnapper.snap(I,a,v)&&a.addIntersection(d[v],v)}}},{key:"computeNodes",value:function(f){this._nodedSegStrings=f,this._noder=new io,this._pointSnapper=new uo(this._noder.getIndex()),this.snapRound(f,this._li)}},{key:"computeIntersectionSnaps",value:function(f){for(var s=f.iterator();s.hasNext();){var a=s.next(),d=new lo(a,this._scaleFactor,this._li);this._pointSnapper.snap(d)}}},{key:"interfaces_",get:function(){return[ns]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var f=arguments[0];this._pm=f,this._li=new Ur,this._li.setPrecisionModel(f),this._scaleFactor=f.getScale()}}])}(),ti=function(){function f(){B(this,f),f.constructor_.apply(this,arguments)}return u(f,[{key:"bufferFixedPrecision",value:function(s){var a=new Gl(new ho(new fi(1)),s.getScale()),d=new Cs(this._bufParams);d.setWorkingPrecisionModel(s),d.setNoder(a),this._resultGeometry=d.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var s=f.MAX_PRECISION_DIGITS;s>=0;s--){try{this.bufferReducedPrecision(s)}catch(I){if(!(I instanceof Y))throw I;this._saveException=I}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var a=arguments[0],d=f.precisionScaleFactor(this._argGeom,this._distance,a),v=new fi(d);this.bufferFixedPrecision(v)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var s=this._argGeom.getFactory().getPrecisionModel();s.getType()===fi.FIXED?this.bufferFixedPrecision(s):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(s){this._bufParams.setQuadrantSegments(s)}},{key:"bufferOriginalPrecision",value:function(){try{var s=new Cs(this._bufParams);this._resultGeometry=s.buffer(this._argGeom,this._distance)}catch(a){if(!(a instanceof jt))throw a;this._saveException=a}}},{key:"getResultGeometry",value:function(s){return this._distance=s,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(s){this._bufParams.setEndCapStyle(s)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new nt,this._resultGeometry=null,this._saveException=null,arguments.length===1){var s=arguments[0];this._argGeom=s}else if(arguments.length===2){var a=arguments[0],d=arguments[1];this._argGeom=a,this._bufParams=d}}},{key:"bufferOp",value:function(){if(arguments.length===2){var s=arguments[1];return new f(arguments[0]).getResultGeometry(s)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof yt&&typeof arguments[1]=="number"){var a=arguments[1],d=arguments[2],v=new f(arguments[0]);return v.setQuadrantSegments(d),v.getResultGeometry(a)}if(arguments[2]instanceof nt&&arguments[0]instanceof yt&&typeof arguments[1]=="number"){var I=arguments[1];return new f(arguments[0],arguments[2]).getResultGeometry(I)}}else if(arguments.length===4){var P=arguments[1],O=arguments[2],K=arguments[3],re=new f(arguments[0]);return re.setQuadrantSegments(O),re.setEndCapStyle(K),re.getResultGeometry(P)}}},{key:"precisionScaleFactor",value:function(s,a,d){var v=s.getEnvelopeInternal(),I=Ie.max(Math.abs(v.getMaxX()),Math.abs(v.getMaxY()),Math.abs(v.getMinX()),Math.abs(v.getMinY()))+2*(a>0?a:0),P=d-Math.trunc(Math.log(I)/Math.log(10)+1);return Math.pow(10,P)}}])}();ti.CAP_ROUND=nt.CAP_ROUND,ti.CAP_BUTT=nt.CAP_FLAT,ti.CAP_FLAT=nt.CAP_FLAT,ti.CAP_SQUARE=nt.CAP_SQUARE,ti.MAX_PRECISION_DIGITS=12;var Pa=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Cr=function(){return u(function f(s){B(this,f),this.geometryFactory=s||new Or},[{key:"read",value:function(f){var s,a=(s=typeof f=="string"?JSON.parse(f):f).type;if(!Gn[a])throw new Error("Unknown GeoJSON type: "+s.type);return Pa.indexOf(a)!==-1?Gn[a].call(this,s.coordinates):a==="GeometryCollection"?Gn[a].call(this,s.geometries):Gn[a].call(this,s)}},{key:"write",value:function(f){var s=f.getGeometryType();if(!or[s])throw new Error("Geometry is not supported");return or[s].call(this,f)}}])}(),Gn={Feature:function(f){var s={};for(var a in f)s[a]=f[a];if(f.geometry){var d=f.geometry.type;if(!Gn[d])throw new Error("Unknown GeoJSON type: "+f.type);s.geometry=this.read(f.geometry)}return f.bbox&&(s.bbox=Gn.bbox.call(this,f.bbox)),s},FeatureCollection:function(f){var s={};if(f.features){s.features=[];for(var a=0;a<f.features.length;++a)s.features.push(this.read(f.features[a]))}return f.bbox&&(s.bbox=this.parse.bbox.call(this,f.bbox)),s},coordinates:function(f){for(var s=[],a=0;a<f.length;++a){var d=f[a];s.push(le(ze,ot(d)))}return s},bbox:function(f){return this.geometryFactory.createLinearRing([new ze(f[0],f[1]),new ze(f[2],f[1]),new ze(f[2],f[3]),new ze(f[0],f[3]),new ze(f[0],f[1])])},Point:function(f){var s=le(ze,ot(f));return this.geometryFactory.createPoint(s)},MultiPoint:function(f){for(var s=[],a=0;a<f.length;++a)s.push(Gn.Point.call(this,f[a]));return this.geometryFactory.createMultiPoint(s)},LineString:function(f){var s=Gn.coordinates.call(this,f);return this.geometryFactory.createLineString(s)},MultiLineString:function(f){for(var s=[],a=0;a<f.length;++a)s.push(Gn.LineString.call(this,f[a]));return this.geometryFactory.createMultiLineString(s)},Polygon:function(f){for(var s=Gn.coordinates.call(this,f[0]),a=this.geometryFactory.createLinearRing(s),d=[],v=1;v<f.length;++v){var I=f[v],P=Gn.coordinates.call(this,I),O=this.geometryFactory.createLinearRing(P);d.push(O)}return this.geometryFactory.createPolygon(a,d)},MultiPolygon:function(f){for(var s=[],a=0;a<f.length;++a){var d=f[a];s.push(Gn.Polygon.call(this,d))}return this.geometryFactory.createMultiPolygon(s)},GeometryCollection:function(f){for(var s=[],a=0;a<f.length;++a){var d=f[a];s.push(this.read(d))}return this.geometryFactory.createGeometryCollection(s)}},or={coordinate:function(f){var s=[f.x,f.y];return f.z&&s.push(f.z),f.m&&s.push(f.m),s},Point:function(f){return{type:"Point",coordinates:or.coordinate.call(this,f.getCoordinate())}},MultiPoint:function(f){for(var s=[],a=0;a<f._geometries.length;++a){var d=f._geometries[a],v=or.Point.call(this,d);s.push(v.coordinates)}return{type:"MultiPoint",coordinates:s}},LineString:function(f){for(var s=[],a=f.getCoordinates(),d=0;d<a.length;++d){var v=a[d];s.push(or.coordinate.call(this,v))}return{type:"LineString",coordinates:s}},MultiLineString:function(f){for(var s=[],a=0;a<f._geometries.length;++a){var d=f._geometries[a],v=or.LineString.call(this,d);s.push(v.coordinates)}return{type:"MultiLineString",coordinates:s}},Polygon:function(f){var s=[],a=or.LineString.call(this,f._shell);s.push(a.coordinates);for(var d=0;d<f._holes.length;++d){var v=f._holes[d],I=or.LineString.call(this,v);s.push(I.coordinates)}return{type:"Polygon",coordinates:s}},MultiPolygon:function(f){for(var s=[],a=0;a<f._geometries.length;++a){var d=f._geometries[a],v=or.Polygon.call(this,d);s.push(v.coordinates)}return{type:"MultiPolygon",coordinates:s}},GeometryCollection:function(f){for(var s=[],a=0;a<f._geometries.length;++a){var d=f._geometries[a],v=d.getGeometryType();s.push(or[v].call(this,d))}return{type:"GeometryCollection",geometries:s}}};return{BufferOp:ti,GeoJSONReader:function(){return u(function f(s){B(this,f),this.parser=new Cr(s||new Or)},[{key:"read",value:function(f){return this.parser.read(f)}}])}(),GeoJSONWriter:function(){return u(function f(){B(this,f),this.parser=new Cr(this.geometryFactory)},[{key:"write",value:function(f){return this.parser.write(f)}}])}()}})}(Pc)),Pc.exports}var T_=w_();const I_=cp(T_);function Ha(){return new Lc}function Lc(){this.reset()}Lc.prototype={constructor:Lc,reset:function(){this.s=this.t=0},add:function(D){Xf(Tc,D,this.t),Xf(this,Tc.s,this.s),this.s?this.t+=Tc.t:this.s=Tc.t},valueOf:function(){return this.s}};var Tc=new Lc;function Xf(D,F,$){var N=D.s=F+$,B=N-F,le=N-B;D.t=F-le+($-B)}var $i=1e-6,Ii=Math.PI,ia=Ii/2,Yf=Ii/4,na=Ii*2,Ya=180/Ii,fs=Ii/180,Xn=Math.abs,S_=Math.atan,Nl=Math.atan2,an=Math.cos,on=Math.sin,Bl=Math.sqrt;function zp(D){return D>1?0:D<-1?Ii:Math.acos(D)}function jo(D){return D>1?ia:D<-1?-ia:Math.asin(D)}function Lu(){}function Rc(D,F){D&&Wf.hasOwnProperty(D.type)&&Wf[D.type](D,F)}var Hf={Feature:function(D,F){Rc(D.geometry,F)},FeatureCollection:function(D,F){for(var $=D.features,N=-1,B=$.length;++N<B;)Rc($[N].geometry,F)}},Wf={Sphere:function(D,F){F.sphere()},Point:function(D,F){D=D.coordinates,F.point(D[0],D[1],D[2])},MultiPoint:function(D,F){for(var $=D.coordinates,N=-1,B=$.length;++N<B;)D=$[N],F.point(D[0],D[1],D[2])},LineString:function(D,F){qh(D.coordinates,F,0)},MultiLineString:function(D,F){for(var $=D.coordinates,N=-1,B=$.length;++N<B;)qh($[N],F,0)},Polygon:function(D,F){Kf(D.coordinates,F)},MultiPolygon:function(D,F){for(var $=D.coordinates,N=-1,B=$.length;++N<B;)Kf($[N],F)},GeometryCollection:function(D,F){for(var $=D.geometries,N=-1,B=$.length;++N<B;)Rc($[N],F)}};function qh(D,F,$){var N=-1,B=D.length-$,le;for(F.lineStart();++N<B;)le=D[N],F.point(le[0],le[1],le[2]);F.lineEnd()}function Kf(D,F){var $=-1,N=D.length;for(F.polygonStart();++$<N;)qh(D[$],F,1);F.polygonEnd()}function E_(D,F){D&&Hf.hasOwnProperty(D.type)?Hf[D.type](D,F):Rc(D,F)}Ha();Ha();function $h(D){return[Nl(D[1],D[0]),jo(D[2])]}function Ol(D){var F=D[0],$=D[1],N=an($);return[N*an(F),N*on(F),on($)]}function Ic(D,F){return D[0]*F[0]+D[1]*F[1]+D[2]*F[2]}function Dc(D,F){return[D[1]*F[2]-D[2]*F[1],D[2]*F[0]-D[0]*F[2],D[0]*F[1]-D[1]*F[0]]}function Bh(D,F){D[0]+=F[0],D[1]+=F[1],D[2]+=F[2]}function Sc(D,F){return[D[0]*F,D[1]*F,D[2]*F]}function Zh(D){var F=Bl(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);D[0]/=F,D[1]/=F,D[2]/=F}Ha();function Np(D,F){function $(N,B){return N=D(N,B),F(N[0],N[1])}return D.invert&&F.invert&&($.invert=function(N,B){return N=F.invert(N,B),N&&D.invert(N[0],N[1])}),$}function Xh(D,F){return[D>Ii?D-na:D<-Ii?D+na:D,F]}Xh.invert=Xh;function k_(D,F,$){return(D%=na)?F||$?Np(Qf(D),ep(F,$)):Qf(D):F||$?ep(F,$):Xh}function Jf(D){return function(F,$){return F+=D,[F>Ii?F-na:F<-Ii?F+na:F,$]}}function Qf(D){var F=Jf(D);return F.invert=Jf(-D),F}function ep(D,F){var $=an(D),N=on(D),B=an(F),le=on(F);function A(u,Le){var Ae=an(Le),_e=an(u)*Ae,de=on(u)*Ae,we=on(Le),ae=we*$+_e*N;return[Nl(de*B-ae*le,_e*$-we*N),jo(ae*B+de*le)]}return A.invert=function(u,Le){var Ae=an(Le),_e=an(u)*Ae,de=on(u)*Ae,we=on(Le),ae=we*B-de*le;return[Nl(de*B+we*le,_e*$+ae*N),jo(ae*$-_e*N)]},A}function C_(D,F,$,N,B,le){if($){var A=an(F),u=on(F),Le=N*$;B==null?(B=F+N*na,le=F-Le/2):(B=tp(A,B),le=tp(A,le),(N>0?B<le:B>le)&&(B+=N*na));for(var Ae,_e=B;N>0?_e>le:_e<le;_e-=Le)Ae=$h([A,-u*an(_e),-u*on(_e)]),D.point(Ae[0],Ae[1])}}function tp(D,F){F=Ol(F),F[0]-=D,Zh(F);var $=zp(-F[1]);return((-F[2]<0?-$:$)+na-$i)%na}function Op(){var D=[],F;return{point:function($,N){F.push([$,N])},lineStart:function(){D.push(F=[])},lineEnd:Lu,rejoin:function(){D.length>1&&D.push(D.pop().concat(D.shift()))},result:function(){var $=D;return D=[],F=null,$}}}function P_(D,F,$,N,B,le){var A=D[0],u=D[1],Le=F[0],Ae=F[1],_e=0,de=1,we=Le-A,ae=Ae-u,Te;if(Te=$-A,!(!we&&Te>0)){if(Te/=we,we<0){if(Te<_e)return;Te<de&&(de=Te)}else if(we>0){if(Te>de)return;Te>_e&&(_e=Te)}if(Te=B-A,!(!we&&Te<0)){if(Te/=we,we<0){if(Te>de)return;Te>_e&&(_e=Te)}else if(we>0){if(Te<_e)return;Te<de&&(de=Te)}if(Te=N-u,!(!ae&&Te>0)){if(Te/=ae,ae<0){if(Te<_e)return;Te<de&&(de=Te)}else if(ae>0){if(Te>de)return;Te>_e&&(_e=Te)}if(Te=le-u,!(!ae&&Te<0)){if(Te/=ae,ae<0){if(Te>de)return;Te>_e&&(_e=Te)}else if(ae>0){if(Te<_e)return;Te<de&&(de=Te)}return _e>0&&(D[0]=A+_e*we,D[1]=u+_e*ae),de<1&&(F[0]=A+de*we,F[1]=u+de*ae),!0}}}}}function Mc(D,F){return Xn(D[0]-F[0])<$i&&Xn(D[1]-F[1])<$i}function Ec(D,F,$,N){this.x=D,this.z=F,this.o=$,this.e=N,this.v=!1,this.n=this.p=null}function Fp(D,F,$,N,B){var le=[],A=[],u,Le;if(D.forEach(function(Te){if(!((ot=Te.length-1)<=0)){var ot,pt=Te[0],Ct=Te[ot],vt;if(Mc(pt,Ct)){for(B.lineStart(),u=0;u<ot;++u)B.point((pt=Te[u])[0],pt[1]);B.lineEnd();return}le.push(vt=new Ec(pt,Te,null,!0)),A.push(vt.o=new Ec(pt,null,vt,!1)),le.push(vt=new Ec(Ct,Te,null,!1)),A.push(vt.o=new Ec(Ct,null,vt,!0))}}),!!le.length){for(A.sort(F),ip(le),ip(A),u=0,Le=A.length;u<Le;++u)A[u].e=$=!$;for(var Ae=le[0],_e,de;;){for(var we=Ae,ae=!0;we.v;)if((we=we.n)===Ae)return;_e=we.z,B.lineStart();do{if(we.v=we.o.v=!0,we.e){if(ae)for(u=0,Le=_e.length;u<Le;++u)B.point((de=_e[u])[0],de[1]);else N(we.x,we.n.x,1,B);we=we.n}else{if(ae)for(_e=we.p.z,u=_e.length-1;u>=0;--u)B.point((de=_e[u])[0],de[1]);else N(we.x,we.p.x,-1,B);we=we.p}we=we.o,_e=we.z,ae=!ae}while(!we.v);B.lineEnd()}}}function ip(D){if(F=D.length){for(var F,$=0,N=D[0],B;++$<F;)N.n=B=D[$],B.p=N,N=B;N.n=B=D[0],B.p=N}}function Bp(D,F){return D<F?-1:D>F?1:D>=F?0:NaN}function M_(D){return D.length===1&&(D=A_(D)),{left:function(F,$,N,B){for(N==null&&(N=0),B==null&&(B=F.length);N<B;){var le=N+B>>>1;D(F[le],$)<0?N=le+1:B=le}return N},right:function(F,$,N,B){for(N==null&&(N=0),B==null&&(B=F.length);N<B;){var le=N+B>>>1;D(F[le],$)>0?B=le:N=le+1}return N}}}function A_(D){return function(F,$){return Bp(D(F),$)}}M_(Bp);function jp(D){for(var F=D.length,$,N=-1,B=0,le,A;++N<F;)B+=D[N].length;for(le=new Array(B);--F>=0;)for(A=D[F],$=A.length;--$>=0;)le[--B]=A[$];return le}var Ru=1e9,kc=-Ru;function L_(D,F,$,N){function B(Ae,_e){return D<=Ae&&Ae<=$&&F<=_e&&_e<=N}function le(Ae,_e,de,we){var ae=0,Te=0;if(Ae==null||(ae=A(Ae,de))!==(Te=A(_e,de))||Le(Ae,_e)<0^de>0)do we.point(ae===0||ae===3?D:$,ae>1?N:F);while((ae=(ae+de+4)%4)!==Te);else we.point(_e[0],_e[1])}function A(Ae,_e){return Xn(Ae[0]-D)<$i?_e>0?0:3:Xn(Ae[0]-$)<$i?_e>0?2:1:Xn(Ae[1]-F)<$i?_e>0?1:0:_e>0?3:2}function u(Ae,_e){return Le(Ae.x,_e.x)}function Le(Ae,_e){var de=A(Ae,1),we=A(_e,1);return de!==we?de-we:de===0?_e[1]-Ae[1]:de===1?Ae[0]-_e[0]:de===2?Ae[1]-_e[1]:_e[0]-Ae[0]}return function(Ae){var _e=Ae,de=Op(),we,ae,Te,ot,pt,Ct,vt,nt,ft,rt,lt,wt={point:Ft,lineStart:ri,lineEnd:li,polygonStart:oi,polygonEnd:Xt};function Ft(Bt,Ht){B(Bt,Ht)&&_e.point(Bt,Ht)}function It(){for(var Bt=0,Ht=0,ui=ae.length;Ht<ui;++Ht)for(var Li=ae[Ht],gi=1,xt=Li.length,bi=Li[0],jt,yi,Ot=bi[0],Bi=bi[1];gi<xt;++gi)jt=Ot,yi=Bi,bi=Li[gi],Ot=bi[0],Bi=bi[1],yi<=N?Bi>N&&(Ot-jt)*(N-yi)>(Bi-yi)*(D-jt)&&++Bt:Bi<=N&&(Ot-jt)*(N-yi)<(Bi-yi)*(D-jt)&&--Bt;return Bt}function oi(){_e=de,we=[],ae=[],lt=!0}function Xt(){var Bt=It(),Ht=lt&&Bt,ui=(we=jp(we)).length;(Ht||ui)&&(Ae.polygonStart(),Ht&&(Ae.lineStart(),le(null,null,1,Ae),Ae.lineEnd()),ui&&Fp(we,u,Bt,le,Ae),Ae.polygonEnd()),_e=Ae,we=ae=Te=null}function ri(){wt.point=ut,ae&&ae.push(Te=[]),rt=!0,ft=!1,vt=nt=NaN}function li(){we&&(ut(ot,pt),Ct&&ft&&de.rejoin(),we.push(de.result())),wt.point=Ft,ft&&_e.lineEnd()}function ut(Bt,Ht){var ui=B(Bt,Ht);if(ae&&Te.push([Bt,Ht]),rt)ot=Bt,pt=Ht,Ct=ui,rt=!1,ui&&(_e.lineStart(),_e.point(Bt,Ht));else if(ui&&ft)_e.point(Bt,Ht);else{var Li=[vt=Math.max(kc,Math.min(Ru,vt)),nt=Math.max(kc,Math.min(Ru,nt))],gi=[Bt=Math.max(kc,Math.min(Ru,Bt)),Ht=Math.max(kc,Math.min(Ru,Ht))];P_(Li,gi,D,F,$,N)?(ft||(_e.lineStart(),_e.point(Li[0],Li[1])),_e.point(gi[0],gi[1]),ui||_e.lineEnd(),lt=!1):ui&&(_e.lineStart(),_e.point(Bt,Ht),lt=!1)}vt=Bt,nt=Ht,ft=ui}return wt}}var jh=Ha();function R_(D,F){var $=F[0],N=F[1],B=[on($),-an($),0],le=0,A=0;jh.reset();for(var u=0,Le=D.length;u<Le;++u)if(_e=(Ae=D[u]).length)for(var Ae,_e,de=Ae[_e-1],we=de[0],ae=de[1]/2+Yf,Te=on(ae),ot=an(ae),pt=0;pt<_e;++pt,we=vt,Te=ft,ot=rt,de=Ct){var Ct=Ae[pt],vt=Ct[0],nt=Ct[1]/2+Yf,ft=on(nt),rt=an(nt),lt=vt-we,wt=lt>=0?1:-1,Ft=wt*lt,It=Ft>Ii,oi=Te*ft;if(jh.add(Nl(oi*wt*on(Ft),ot*rt+oi*an(Ft))),le+=It?lt+wt*na:lt,It^we>=$^vt>=$){var Xt=Dc(Ol(de),Ol(Ct));Zh(Xt);var ri=Dc(B,Xt);Zh(ri);var li=(It^lt>=0?-1:1)*jo(ri[2]);(N>li||N===li&&(Xt[0]||Xt[1]))&&(A+=It^lt>=0?1:-1)}}return(le<-$i||le<$i&&jh<-$i)^A&1}Ha();function np(D){return D}Ha();Ha();var Fl=1/0,zc=Fl,Nu=-Fl,Nc=Nu,rp={point:D_,lineStart:Lu,lineEnd:Lu,polygonStart:Lu,polygonEnd:Lu,result:function(){var D=[[Fl,zc],[Nu,Nc]];return Nu=Nc=-(zc=Fl=1/0),D}};function D_(D,F){D<Fl&&(Fl=D),D>Nu&&(Nu=D),F<zc&&(zc=F),F>Nc&&(Nc=F)}Ha();function Up(D,F,$,N){return function(B,le){var A=F(le),u=B.invert(N[0],N[1]),Le=Op(),Ae=F(Le),_e=!1,de,we,ae,Te={point:ot,lineStart:Ct,lineEnd:vt,polygonStart:function(){Te.point=nt,Te.lineStart=ft,Te.lineEnd=rt,we=[],de=[]},polygonEnd:function(){Te.point=ot,Te.lineStart=Ct,Te.lineEnd=vt,we=jp(we);var lt=R_(de,u);we.length?(_e||(le.polygonStart(),_e=!0),Fp(we,N_,lt,$,le)):lt&&(_e||(le.polygonStart(),_e=!0),le.lineStart(),$(null,null,1,le),le.lineEnd()),_e&&(le.polygonEnd(),_e=!1),we=de=null},sphere:function(){le.polygonStart(),le.lineStart(),$(null,null,1,le),le.lineEnd(),le.polygonEnd()}};function ot(lt,wt){var Ft=B(lt,wt);D(lt=Ft[0],wt=Ft[1])&&le.point(lt,wt)}function pt(lt,wt){var Ft=B(lt,wt);A.point(Ft[0],Ft[1])}function Ct(){Te.point=pt,A.lineStart()}function vt(){Te.point=ot,A.lineEnd()}function nt(lt,wt){ae.push([lt,wt]);var Ft=B(lt,wt);Ae.point(Ft[0],Ft[1])}function ft(){Ae.lineStart(),ae=[]}function rt(){nt(ae[0][0],ae[0][1]),Ae.lineEnd();var lt=Ae.clean(),wt=Le.result(),Ft,It=wt.length,oi,Xt,ri;if(ae.pop(),de.push(ae),ae=null,!!It){if(lt&1){if(Xt=wt[0],(oi=Xt.length-1)>0){for(_e||(le.polygonStart(),_e=!0),le.lineStart(),Ft=0;Ft<oi;++Ft)le.point((ri=Xt[Ft])[0],ri[1]);le.lineEnd()}return}It>1&&lt&2&&wt.push(wt.pop().concat(wt.shift())),we.push(wt.filter(z_))}}return Te}}function z_(D){return D.length>1}function N_(D,F){return((D=D.x)[0]<0?D[1]-ia-$i:ia-D[1])-((F=F.x)[0]<0?F[1]-ia-$i:ia-F[1])}const sp=Up(function(){return!0},O_,B_,[-Ii,-ia]);function O_(D){var F=NaN,$=NaN,N=NaN,B;return{lineStart:function(){D.lineStart(),B=1},point:function(le,A){var u=le>0?Ii:-Ii,Le=Xn(le-F);Xn(Le-Ii)<$i?(D.point(F,$=($+A)/2>0?ia:-ia),D.point(N,$),D.lineEnd(),D.lineStart(),D.point(u,$),D.point(le,$),B=0):N!==u&&Le>=Ii&&(Xn(F-N)<$i&&(F-=N*$i),Xn(le-u)<$i&&(le-=u*$i),$=F_(F,$,le,A),D.point(N,$),D.lineEnd(),D.lineStart(),D.point(u,$),B=0),D.point(F=le,$=A),N=u},lineEnd:function(){D.lineEnd(),F=$=NaN},clean:function(){return 2-B}}}function F_(D,F,$,N){var B,le,A=on(D-$);return Xn(A)>$i?S_((on(F)*(le=an(N))*on($)-on(N)*(B=an(F))*on(D))/(B*le*A)):(F+N)/2}function B_(D,F,$,N){var B;if(D==null)B=$*ia,N.point(-Ii,B),N.point(0,B),N.point(Ii,B),N.point(Ii,0),N.point(Ii,-B),N.point(0,-B),N.point(-Ii,-B),N.point(-Ii,0),N.point(-Ii,B);else if(Xn(D[0]-F[0])>$i){var le=D[0]<F[0]?Ii:-Ii;B=$*le/2,N.point(-le,B),N.point(0,B),N.point(le,B)}else N.point(F[0],F[1])}function j_(D,F){var $=an(D),N=$>0,B=Xn($)>$i;function le(_e,de,we,ae){C_(ae,D,F,we,_e,de)}function A(_e,de){return an(_e)*an(de)>$}function u(_e){var de,we,ae,Te,ot;return{lineStart:function(){Te=ae=!1,ot=1},point:function(pt,Ct){var vt=[pt,Ct],nt,ft=A(pt,Ct),rt=N?ft?0:Ae(pt,Ct):ft?Ae(pt+(pt<0?Ii:-Ii),Ct):0;if(!de&&(Te=ae=ft)&&_e.lineStart(),ft!==ae&&(nt=Le(de,vt),(!nt||Mc(de,nt)||Mc(vt,nt))&&(vt[0]+=$i,vt[1]+=$i,ft=A(vt[0],vt[1]))),ft!==ae)ot=0,ft?(_e.lineStart(),nt=Le(vt,de),_e.point(nt[0],nt[1])):(nt=Le(de,vt),_e.point(nt[0],nt[1]),_e.lineEnd()),de=nt;else if(B&&de&&N^ft){var lt;!(rt&we)&&(lt=Le(vt,de,!0))&&(ot=0,N?(_e.lineStart(),_e.point(lt[0][0],lt[0][1]),_e.point(lt[1][0],lt[1][1]),_e.lineEnd()):(_e.point(lt[1][0],lt[1][1]),_e.lineEnd(),_e.lineStart(),_e.point(lt[0][0],lt[0][1])))}ft&&(!de||!Mc(de,vt))&&_e.point(vt[0],vt[1]),de=vt,ae=ft,we=rt},lineEnd:function(){ae&&_e.lineEnd(),de=null},clean:function(){return ot|(Te&&ae)<<1}}}function Le(_e,de,we){var ae=Ol(_e),Te=Ol(de),ot=[1,0,0],pt=Dc(ae,Te),Ct=Ic(pt,pt),vt=pt[0],nt=Ct-vt*vt;if(!nt)return!we&&_e;var ft=$*Ct/nt,rt=-$*vt/nt,lt=Dc(ot,pt),wt=Sc(ot,ft),Ft=Sc(pt,rt);Bh(wt,Ft);var It=lt,oi=Ic(wt,It),Xt=Ic(It,It),ri=oi*oi-Xt*(Ic(wt,wt)-1);if(!(ri<0)){var li=Bl(ri),ut=Sc(It,(-oi-li)/Xt);if(Bh(ut,wt),ut=$h(ut),!we)return ut;var Bt=_e[0],Ht=de[0],ui=_e[1],Li=de[1],gi;Ht<Bt&&(gi=Bt,Bt=Ht,Ht=gi);var xt=Ht-Bt,bi=Xn(xt-Ii)<$i,jt=bi||xt<$i;if(!bi&&Li<ui&&(gi=ui,ui=Li,Li=gi),jt?bi?ui+Li>0^ut[1]<(Xn(ut[0]-Bt)<$i?ui:Li):ui<=ut[1]&&ut[1]<=Li:xt>Ii^(Bt<=ut[0]&&ut[0]<=Ht)){var yi=Sc(It,(-oi+li)/Xt);return Bh(yi,wt),[ut,$h(yi)]}}}function Ae(_e,de){var we=N?D:Ii-D,ae=0;return _e<-we?ae|=1:_e>we&&(ae|=2),de<-we?ae|=4:de>we&&(ae|=8),ae}return Up(A,u,le,N?[0,-D]:[-Ii,D-Ii])}function Vp(D){return function(F){var $=new Yh;for(var N in D)$[N]=D[N];return $.stream=F,$}}function Yh(){}Yh.prototype={constructor:Yh,point:function(D,F){this.stream.point(D,F)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Gp(D,F,$){var N=F[1][0]-F[0][0],B=F[1][1]-F[0][1],le=D.clipExtent&&D.clipExtent();D.scale(150).translate([0,0]),le!=null&&D.clipExtent(null),E_($,D.stream(rp));var A=rp.result(),u=Math.min(N/(A[1][0]-A[0][0]),B/(A[1][1]-A[0][1])),Le=+F[0][0]+(N-u*(A[1][0]+A[0][0]))/2,Ae=+F[0][1]+(B-u*(A[1][1]+A[0][1]))/2;return le!=null&&D.clipExtent(le),D.scale(u*150).translate([Le,Ae])}function U_(D,F,$){return Gp(D,[[0,0],F],$)}var ap=16,V_=an(30*fs);function op(D,F){return+F?q_(D,F):G_(D)}function G_(D){return Vp({point:function(F,$){F=D(F,$),this.stream.point(F[0],F[1])}})}function q_(D,F){function $(N,B,le,A,u,Le,Ae,_e,de,we,ae,Te,ot,pt){var Ct=Ae-N,vt=_e-B,nt=Ct*Ct+vt*vt;if(nt>4*F&&ot--){var ft=A+we,rt=u+ae,lt=Le+Te,wt=Bl(ft*ft+rt*rt+lt*lt),Ft=jo(lt/=wt),It=Xn(Xn(lt)-1)<$i||Xn(le-de)<$i?(le+de)/2:Nl(rt,ft),oi=D(It,Ft),Xt=oi[0],ri=oi[1],li=Xt-N,ut=ri-B,Bt=vt*li-Ct*ut;(Bt*Bt/nt>F||Xn((Ct*li+vt*ut)/nt-.5)>.3||A*we+u*ae+Le*Te<V_)&&($(N,B,le,A,u,Le,Xt,ri,It,ft/=wt,rt/=wt,lt,ot,pt),pt.point(Xt,ri),$(Xt,ri,It,ft,rt,lt,Ae,_e,de,we,ae,Te,ot,pt))}}return function(N){var B,le,A,u,Le,Ae,_e,de,we,ae,Te,ot,pt={point:Ct,lineStart:vt,lineEnd:ft,polygonStart:function(){N.polygonStart(),pt.lineStart=rt},polygonEnd:function(){N.polygonEnd(),pt.lineStart=vt}};function Ct(Ft,It){Ft=D(Ft,It),N.point(Ft[0],Ft[1])}function vt(){de=NaN,pt.point=nt,N.lineStart()}function nt(Ft,It){var oi=Ol([Ft,It]),Xt=D(Ft,It);$(de,we,_e,ae,Te,ot,de=Xt[0],we=Xt[1],_e=Ft,ae=oi[0],Te=oi[1],ot=oi[2],ap,N),N.point(de,we)}function ft(){pt.point=Ct,N.lineEnd()}function rt(){vt(),pt.point=lt,pt.lineEnd=wt}function lt(Ft,It){nt(B=Ft,It),le=de,A=we,u=ae,Le=Te,Ae=ot,pt.point=nt}function wt(){$(de,we,_e,ae,Te,ot,le,A,B,u,Le,Ae,ap,N),pt.lineEnd=ft,ft()}return pt}}var $_=Vp({point:function(D,F){this.stream.point(D*fs,F*fs)}});function Z_(D){return X_(function(){return D})()}function X_(D){var F,$=150,N=480,B=250,le,A,u=0,Le=0,Ae=0,_e=0,de=0,we,ae,Te=null,ot=sp,pt=null,Ct,vt,nt,ft=np,rt=.5,lt=op(Xt,rt),wt,Ft;function It(ut){return ut=ae(ut[0]*fs,ut[1]*fs),[ut[0]*$+le,A-ut[1]*$]}function oi(ut){return ut=ae.invert((ut[0]-le)/$,(A-ut[1])/$),ut&&[ut[0]*Ya,ut[1]*Ya]}function Xt(ut,Bt){return ut=F(ut,Bt),[ut[0]*$+le,A-ut[1]*$]}It.stream=function(ut){return wt&&Ft===ut?wt:wt=$_(ot(we,lt(ft(Ft=ut))))},It.clipAngle=function(ut){return arguments.length?(ot=+ut?j_(Te=ut*fs,6*fs):(Te=null,sp),li()):Te*Ya},It.clipExtent=function(ut){return arguments.length?(ft=ut==null?(pt=Ct=vt=nt=null,np):L_(pt=+ut[0][0],Ct=+ut[0][1],vt=+ut[1][0],nt=+ut[1][1]),li()):pt==null?null:[[pt,Ct],[vt,nt]]},It.scale=function(ut){return arguments.length?($=+ut,ri()):$},It.translate=function(ut){return arguments.length?(N=+ut[0],B=+ut[1],ri()):[N,B]},It.center=function(ut){return arguments.length?(u=ut[0]%360*fs,Le=ut[1]%360*fs,ri()):[u*Ya,Le*Ya]},It.rotate=function(ut){return arguments.length?(Ae=ut[0]%360*fs,_e=ut[1]%360*fs,de=ut.length>2?ut[2]%360*fs:0,ri()):[Ae*Ya,_e*Ya,de*Ya]},It.precision=function(ut){return arguments.length?(lt=op(Xt,rt=ut*ut),li()):Bl(rt)},It.fitExtent=function(ut,Bt){return Gp(It,ut,Bt)},It.fitSize=function(ut,Bt){return U_(It,ut,Bt)};function ri(){ae=Np(we=k_(Ae,_e,de),F);var ut=F(u,Le);return le=N-ut[0]*$,A=B+ut[1]*$,li()}function li(){return wt=Ft=null,It}return function(){return F=D.apply(this,arguments),It.invert=F.invert&&oi,ri()}}function qp(D){return function(F,$){var N=an(F),B=an($),le=D(N*B);return[le*B*on(F),le*on($)]}}function $p(D){return function(F,$){var N=Bl(F*F+$*$),B=D(N),le=on(B),A=an(B);return[Nl(F*le,N*A),jo(N&&$*le/N)]}}var Y_=qp(function(D){return Bl(2/(1+D))});Y_.invert=$p(function(D){return 2*jo(D/2)});var Zp=qp(function(D){return(D=zp(D))&&D/on(D)});Zp.invert=$p(function(D){return D});function H_(){return Z_(Zp).scale(79.4188).clipAngle(180-.001)}function lp(D,F){return[D,F]}lp.invert=lp;var{BufferOp:W_,GeoJSONReader:K_,GeoJSONWriter:J_}=I_;function Q_(D,F,$){$=$||{};var N=$.units||"kilometers",B=$.steps||8;if(!D)throw new Error("geojson is required");if(typeof $!="object")throw new Error("options must be an object");if(typeof B!="number")throw new Error("steps must be an number");if(F===void 0)throw new Error("radius is required");if(B<=0)throw new Error("steps must be greater than 0");var le=[];switch(D.type){case"GeometryCollection":return Rp(D,function(A){var u=Ac(A,F,N,B);u&&le.push(u)}),Gh(le);case"FeatureCollection":return $f(D,function(A){var u=Ac(A,F,N,B);u&&$f(u,function(Le){Le&&le.push(Le)})}),Gh(le)}return Ac(D,F,N,B)}function Ac(D,F,$,N){var B=D.properties||{},le=D.type==="Feature"?D.geometry:D;if(le.type==="GeometryCollection"){var A=[];return Rp(D,function(ot){var pt=Ac(ot,F,$,N);pt&&A.push(pt)}),Gh(A)}var u=ey(le),Le={type:le.type,coordinates:Yp(le.coordinates,u)},Ae=new K_,_e=Ae.read(Le),de=__(y_(F,$),"meters"),we=W_.bufferOp(_e,de,N),ae=new J_;if(we=ae.write(we),!Xp(we.coordinates)){var Te={type:we.type,coordinates:Hp(we.coordinates,u)};return ed(Te,B)}}function Xp(D){return Array.isArray(D[0])?Xp(D[0]):isNaN(D[0])}function Yp(D,F){return typeof D[0]!="object"?F(D):D.map(function($){return Yp($,F)})}function Hp(D,F){return typeof D[0]!="object"?F.invert(D):D.map(function($){return Hp($,F)})}function ey(D){var F=x_(D).geometry.coordinates,$=[-F[0],-F[1]];return H_().rotate($).scale(Lr)}const Pn={map:document.getElementById("map"),loading:document.getElementById("loading"),error:document.getElementById("error"),info:document.getElementById("info"),modal:document.getElementById("modal"),modalContent:document.getElementById("modal-content"),closeModal:document.getElementById("close-modal"),search:document.getElementById("search-button"),searchInput:document.getElementById("search-input"),reset:document.getElementById("reset"),imagery:document.getElementById("selected-imagery"),centroids:document.getElementById("search-centroids"),zoom:document.getElementById("zoom"),imageForGeoJSON:document.getElementById("selected-imagery-geojson"),downloadSection:document.getElementById("download-section"),downloadGeoJSON:document.getElementById("download-geojson")};function ty(){let D=new a_;Ar.addProtocol("pmtiles",D.tile),fetch("style.json").then(F=>{F.json().then($=>{const N=new Ar.Map({container:"map",name:"Phase 3 Oblique Centroids",hash:!0,zoom:10.66,center:[-84.0183,37.4145],maxZoom:22,maxPitch:85,attributionControl:!1,maxBounds:[[-124.848974,24.396308],[-66.885444,49.384358]],style:$});let B=!1;const le=[],A=Le=>{B&&N.flyTo({center:Le,zoom:12.5,speed:.5,curve:1,essential:!0})};Pn.zoom.addEventListener("click",()=>{B=!B,Pn.zoom.classList.toggle("active")}),N.on("load",function(Le){N.setSky({"sky-color":"skyblue","sky-horizon-blend":1,"horizon-color":"whitesmoke","horizon-fog-blend":0,"fog-color":"whitesmoke","fog-ground-blend":0})}),N.addControl(new Ar.AttributionControl({compact:!0,customAttribution:"KyFromAbove, UKy Geography, &copy; OSM contributors"})),N.addControl(new Ar.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0}));const u=new Ar.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0});N.addControl(u),u.on("geolocate",function(Le){Le.coords.latitude,Le.coords.longitude}),N.addControl(new Ar.FullscreenControl),N.addControl(new Ar.ScaleControl({maxWidth:80,unit:"imperial"})),N.addControl(new Ar.TerrainControl({source:"terrainSource",exaggeration:2})),N.on("click","obliques-north",Le=>{if(N.setLayoutProperty("obliques-south-images","visibility","none"),Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=_e.ShotID.split("_"),we=_e.OBJECTID;N.setFilter("selected-plane",["==",["get","OBJECTID"],we]),N.setLayoutProperty("selected-plane","visibility","visible"),new Ar.Popup().setLngLat(Ae).setHTML(up(Le)).addTo(N),N.setLayoutProperty("obliques-north-images","visibility","visible");const ae=[`Fwd_${de[1]}_${de[2]}`,`Bwd_${de[1]}_${de[2]}`,`Left_${de[1]}_${de[2]}`,`Right_${de[1]}_${de[2]}`];N.setFilter("obliques-north-images",["in",["get","ShotID"],["literal",ae]]),A(Ae)}}),N.on("click","obliques-south",Le=>{if(N.setLayoutProperty("obliques-north-images","visibility","none"),Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=_e.ShotID.split("_"),we=_e.OBJECTID;N.setFilter("selected-plane",["==",["get","OBJECTID"],we]),N.setLayoutProperty("selected-plane","visibility","visible"),new Ar.Popup().setLngLat(Ae).setHTML(up(Le)).addTo(N),N.setLayoutProperty("obliques-south-images","visibility","visible");const ae=[`Fwd_${de[1]}_${de[2]}`,`Bwd_${de[1]}_${de[2]}`,`Left_${de[1]}_${de[2]}`,`Right_${de[1]}_${de[2]}`];N.setFilter("obliques-south-images",["in",["get","ShotID"],["literal",ae]]),A(Ae)}}),N.on("click","obliques-south-images",Le=>{if(Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=_e.ShotID,ae=`<div class="text-2xl mb-2">${_e.CameraID==="Fwd"?"Forward":_e.CameraID==="Bwd"?"Backward":_e.CameraID==="Left"?"Left":"Right"}</div>
        <a class="text-lg" href="${_e.S3URL}">${de}.tif</a> <br> <a class="text-lg" target='_blank' href="view.html?file=${_e.Filename}">Preview</a>`;new Ar.Popup().setLngLat(Ae).setHTML(ae).addTo(N)}}),N.on("click","obliques-north-images",Le=>{if(Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=_e.ShotID,ae=`<div class="text-2xl mb-2">${_e.CameraID==="Fwd"?"Forward":_e.CameraID==="Bwd"?"Backward":_e.CameraID==="Left"?"Left":"Right"}</div>
        <a class="text-lg" href="${_e.S3URL}">${de}.tif</a><br> <a class="text-lg" target='_blank' href="view.html?file=${_e.Filename}">Preview</a>`;new Ar.Popup().setLngLat(Ae).setHTML(ae).addTo(N)}}),N.on("click","selected-plane",Le=>{if(Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=_e.ShotID,we=`<div class="text-2xl mb-2">Nadir</div>
        <a class="text-lg" href="${_e.S3URL}">${de}.tif</a><br> <a class="text-lg" target='_blank' href="view.html?file=${_e.Filename}">Preview</a>`;new Ar.Popup().setLngLat(Ae).setHTML(we).addTo(N)}}),N.on("click","all-oblique-centroids",Le=>{if(Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=new Date(_e.FlightDate).toLocaleDateString(),we=_e.ShotID,Te=`<div class="text-2xl mb-1">${_e.CameraID} centroid</div>
          <div class="text-lg mb-2">${de}</div>
        <a class="text-lg" href="${_e.S3URL}">${we}.tif</a><br> <a class="text-lg" target='_blank' href="view.html?file=${_e.Filename}">Preview</a>`;new Ar.Popup().setLngLat(Ae).setHTML(Te).addTo(N)}}),N.on("click","all-oblique-centroids",Le=>{if(Le.features.length>0){const Ae=Le.features[0].geometry.coordinates,_e=Le.features[0].properties,de=new Date(_e.FlightDate).toLocaleDateString(),we=_e.ShotID.split("_"),ae=`${we[1]}_${we[2]}`,Te=_e.S3URL,ot=_e.CameraID,pt=Ap(Ae),Ct=Q_(pt,300,{units:"meters"}),vt=Dp(Ct),nt=v_(vt),ft={type:"Feature",properties:{type:"active oblique frame boundary",id:ae,centroid:Ae,season:_e.Season,year:_e.Year,dir:ot,url:Te,fl:_e.FL,date:de,time:_e.FlightTime,file:_e.Filename,preview:`https://boydx.github.io/phase-3-oblique-centroids/view.html?file=${_e.Filename}`},geometry:nt.geometry};le.push(ft),N.getSource("frames").setData({type:"FeatureCollection",features:le});const rt=`
          <div class="text-lg"><a class="text-lg" href="${_e.S3URL}">${_e.ShotID}.tif</a> | <a target='_blank' href="view.html?file=${_e.Filename}">Preview</a></div>
        `;Pn.imageForGeoJSON.innerHTML+=`${rt}`}}),Pn.centroids.addEventListener("click",()=>{Pn.downloadSection.classList.toggle("hidden"),Pn.imageForGeoJSON.classList.toggle("hidden"),Pn.imagery.classList.toggle("hidden"),N.getLayoutProperty("all-oblique-centroids","visibility")==="none"?(N.setLayoutProperty("all-oblique-centroids","visibility","visible"),Pn.centroids.classList.add("active"),N.setLayoutProperty("obliques-north","visibility","none"),N.setLayoutProperty("obliques-south","visibility","none"),N.setLayoutProperty("frame-fill","visibility","visible"),N.setLayoutProperty("frame-stroke","visibility","visible")):(N.setLayoutProperty("all-oblique-centroids","visibility","none"),Pn.centroids.classList.remove("active"),N.setLayoutProperty("obliques-north","visibility","visible"),N.setLayoutProperty("obliques-south","visibility","visible"),N.setLayoutProperty("frame-fill","visibility","none"),N.setLayoutProperty("frame-stroke","visibility","none"))}),Pn.search.addEventListener("click",()=>{let Le=Pn.searchInput.value.trim();const Ae=Le.split("_");if(Ae.length==2){const _e=`Color_${Ae[0]}_${Ae[1]}`,de=[`Fwd_${Ae[0]}_${Ae[1]}`,`Bwd_${Ae[0]}_${Ae[1]}`,`Left_${Ae[0]}_${Ae[1]}`,`Right_${Ae[0]}_${Ae[1]}`];N.setFilter("obliques-south-images",["in",["get","ShotID"],["literal",de]]),N.setFilter("obliques-north-images",["in",["get","ShotID"],["literal",de]]),N.setFilter("selected-plane",["==",["get","ShotID"],_e]),N.setLayoutProperty("selected-plane","icon-allow-overlap",!0),N.setLayoutProperty("obliques-north","visibility","none"),N.setLayoutProperty("obliques-south","visibility","none"),N.setLayoutProperty("obliques-south-images","visibility","visible"),N.setLayoutProperty("obliques-north-images","visibility","visible"),N.setLayoutProperty("selected-plane","visibility","visible"),N.querySourceFeatures("on-points",{sourceLayer:"centroids"}).map(ot=>ot.properties.FL==Ae[0]?ot:null).filter(ot=>ot!==null).map(ot=>{const pt=ot.properties.ShotID.split("_"),Ct=ot.properties.CameraID;return pt[1]==Ae[0]&&pt[2]==Ae[1]&&Ct=="Color"&&(Le=ot.properties.OBJECTID,A(ot.geometry.coordinates)),pt[1]==Ae[0]&&pt[2]==Ae[1]?ot:!1})}}),Pn.reset.addEventListener("click",()=>{Pn.centroids.classList.remove("active"),Pn.downloadSection.classList.add("hidden"),N.setFilter("obliques-south-images",null),N.setFilter("obliques-north-images",null),N.setFilter("selected-plane",null),N.setLayoutProperty("selected-plane","visibility","none"),N.setLayoutProperty("obliques-south-images","visibility","none"),N.setLayoutProperty("obliques-north-images","visibility","none"),N.setLayoutProperty("obliques-north","visibility","visible"),N.setLayoutProperty("obliques-south","visibility","visible"),N.setLayoutProperty("all-oblique-centroids","visibility","none"),N.setLayoutProperty("frame-fill","visibility","none"),N.setLayoutProperty("frame-stroke","visibility","none")}),Pn.downloadGeoJSON.addEventListener("click",()=>{const Le=N.getSource("frames")._data,Ae=new Blob([JSON.stringify(Le)],{type:"application/json"}),_e=URL.createObjectURL(Ae),de=document.createElement("a"),we=new Date().toISOString().split("T")[0];de.href=_e,de.download=`KyFromAbove-phase-3-oblique-active-frames-${we}.geojson`,de.click(),URL.revokeObjectURL(_e)}),N.on("error",Le=>{console.error("Map error: ",Le)})})})}function up(D){const F=D.features[0].properties,$=new Date(F.FlightDate).toLocaleDateString(),N=F.Season,B=F.Year,le=F.ShotID.split("_"),A=`KY_KYAPED_${B}_Season${N}_3IN/Color_${le[1]}_${le[2]}.tif`,u=`KY_KYAPED_${B}_Season${N}_3IN/Fwd_${le[1]}_${le[2]}.tif`,Le=`KY_KYAPED_${B}_Season${N}_3IN/Bwd_${le[1]}_${le[2]}.tif`,Ae=`KY_KYAPED_${B}_Season${N}_3IN/Left_${le[1]}_${le[2]}.tif`,_e=`KY_KYAPED_${B}_Season${N}_3IN/Right_${le[1]}_${le[2]}.tif`,de="https://kyfromabove.s3.amazonaws.com/imagery/obliques/Phase3/",we=`
          <div class="text-xl mb-2 mt-2 ">KY_KYAPED_${B}_Season${N}_3IN</div>
        Forward: <a href="${de}${u}" >Fwd_${le[1]}_${le[2]}.tif</a> | <a target='_blank' href="view.html?file=${u}">Preview</a><br>
            Backward: <a href="${de}${Le}">Bwd_${le[1]}_${le[2]}.tif</a> | <a target='_blank' href="view.html?file=${Le}">Preview</a><br>
            Left: <a href="${de}${Ae}">Left_${le[1]}_${le[2]}.tif</a> | <a target='_blank' href="view.html?file=${Ae}">Preview</a><br>
            Right: <a href="${de}${_e}" >Right_${le[1]}_${le[2]}.tif</a> | <a target='_blank' href="view.html?file=${_e}">Preview</a><br>
            Nadir: <a href="${de}${A}" >Color_${le[1]}_${le[2]}.tif</a> | <a target='_blank' href="view.html?file=${A}">Preview</a><br>
            `,ae=`
  <div class="text-2xl mb-2">${$} ${F.FlightTime}</div>
  <div class="text-lg mb-4">Flight: ${le[1]}<br>
  Shot: ${le[2]}<br>
  ID: ${le[1]}_${le[2]}</div>
  `;return Pn.imagery.innerHTML=`${ae} ${we}`,ae}document.addEventListener("DOMContentLoaded",()=>{Pn.info.addEventListener("click",()=>{Pn.modal.style.display="block"}),Pn.closeModal.addEventListener("click",()=>{Pn.modal.style.display="none"}),ty()});
